!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var o in r)("object"==typeof exports?exports:e)[o]=r[o]}}("undefined"!=typeof self?self:this,(function(){return e={9880:function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},o(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=t.ZegoExpressEngine=void 0;var n=r(9194),s=r(5321),a=function(e){function t(t,r){var o=this;return n.ZegoExpressWebRTMEngine.version="2.12.2",(o=e.call(this,t,r)||this).zegoWebRTC=new s.ZegoWebRTC(o.logger,o.dataReport,o.zegoWebRTM),o}return i(t,e),t.prototype.createRealTimeSequentialDataManager=function(e){return this.zegoWebRTC.createRealTimeSequentialDataManager(e)},t.prototype.destroyRealTimeSequentialDataManager=function(e){this.zegoWebRTC.destroyRealTimeSequentialDataManager(e)},t.use=function(e){n.ZegoExpressWebRTMEngine.use(e),s.ZegoWebRTC.use(e)},t.prototype.checkSystemRequirements=function(e,t){return void 0===t&&(t=0),this.zegoWebRTC.checkSystemRequirements(t,e)},t.prototype.off=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.off(e,t):!!this.zegoWebRTC.stateCenter.listenerList[e]&&this.zegoWebRTC.off(e,t)},t.prototype.on=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.on(e,t):!!this.zegoWebRTC.stateCenter.listenerList[e]&&this.zegoWebRTC.on(e,t)},t.prototype.createStream=function(e){return this.zegoWebRTC.createStream(e)},t.prototype.getElectronScreenSources=function(){return this.zegoWebRTC.getElectronScreenSources()},t.prototype.destroyStream=function(e){return this.zegoWebRTC.destroyStream(e)},t.prototype.startPublishingStream=function(e,t,r){return this.zegoWebRTC.startPublishingStream(e,t,r)},t.prototype.stopPublishingStream=function(e){return this.zegoWebRTC.stopPublishingStream(e)},t.prototype.setVideoConfig=function(e,t){return this.zegoWebRTC.setVideoConfig(e,t)},t.prototype.setAudioConfig=function(e,t){return this.zegoWebRTC.setAudioConfig(e,t)},t.prototype.replaceTrack=function(e,t){return this.zegoWebRTC.replaceTrack(e,t)},t.prototype.setCaptureVolume=function(e,t){return this.zegoWebRTC.setCaptureVolume(e,t)},t.prototype.setStreamExtraInfo=function(e,t){return this.zegoWebRTC.setStreamExtraInfo(e,t)},t.prototype.addPublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWebRTC.addPublishCdnUrl(arguments[0],arguments[2]):this.zegoWebRTC.addPublishCdnUrl(e,t)},t.prototype.removePublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWebRTC.removePublishCdnUrl(arguments[0],arguments[2]):this.zegoWebRTC.removePublishCdnUrl(e,t)},t.prototype.mutePublishStreamVideo=function(e,t,r){return this.zegoWebRTC.mutePublishStreamVideo(e,t,r)},t.prototype.mutePublishStreamAudio=function(e,t){return this.zegoWebRTC.mutePublishStreamAudio(e,t)},t.prototype.startPlayingStream=function(e,t){return this.zegoWebRTC.startPlayingStream(e,t)},t.prototype.stopPlayingStream=function(e){return this.zegoWebRTC.stopPlayingStream(e)},t.prototype.mutePlayStreamVideo=function(e,t){return this.zegoWebRTC.mutePlayStreamVideo(e,t)},t.prototype.mutePlayStreamAudio=function(e,t){return this.zegoWebRTC.mutePlayStreamAudio(e,t)},t.prototype.startMixerTask=function(e){return this.zegoWebRTC.startMixerTask(e)},t.prototype.stopMixerTask=function(e){return this.zegoWebRTC.stopMixerTask(e)},t.prototype.setMixerTaskConfig=function(e){return this.zegoWebRTC.setMixerTaskConfig(e)},t.prototype.startMixingAudio=function(e,t){return this.zegoWebRTC.startMixingAudio(e,t)},t.prototype.stopMixingAudio=function(e,t){return this.zegoWebRTC.stopMixingAudio(e,t)},t.prototype.setMixingAudioVolume=function(e,t,r){return this.zegoWebRTC.setMixingAudioVolume(e,t,r)},t.prototype.enumDevices=function(){return this.zegoWebRTC.enumDevices()},t.prototype.useVideoDevice=function(e,t){return this.zegoWebRTC.useVideoDevice(e,t)},t.prototype.useAudioDevice=function(e,t){return this.zegoWebRTC.useAudioDevice(e,t)},t.prototype.setSoundLevelDelegate=function(e,t){return this.zegoWebRTC.setSoundLevelDelegate(e,t)},t.prototype.isMicrophoneMuted=function(){return this.zegoWebRTC.isMicrophoneMuted()},t.prototype.muteMicrophone=function(e){return this.zegoWebRTC.muteMicrophone(e)},t.prototype.createRangeAudioInstance=function(){return this.zegoWebRTC.createRangeAudioInstance()},t}(n.ZegoExpressWebRTMEngine);t.ZegoExpressEngine=a;var c=r(608);Object.defineProperty(t,"ClientUtil",{enumerable:!0,get:function(){return c.ClientUtil}})},1089:function(e,t){"use strict";var r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_WECHATMINI_ACTION=t.ZEGO_WEBRTC_ACTION=void 0,(o=t.ZEGO_WEBRTC_ACTION||(t.ZEGO_WEBRTC_ACTION={})).CONSTRUCTOR="zc.0",o.CHECK_SUPPORT="zc.csr",o.CREATE_STREAM="zc.cs",o.DESTROY_STREAM="zc.ds",o.START_PUBLISHING_STREAM="zc.sps.0",o.START_PLAYING_STREAM="zc.sps.1",o.STOP_PUBLISHING_STREAM="zc.sps.0.0",o.STOP_PLAYING_STREAM="zc.sps.1.0",o.ON_STREAM="zc.os",o.ON_PUSH_STREAM_UPDATE="zc.opsu",o.BIND_WINDOW_LISTENER="zc.wl",o.SET_AUDIO_OUTPUT="zc.sao",o.SET_CUSTOM_SIGNAL_URL="zc.scsu",o.SET_TURN_OVER_TCP_ONLY="zc.stoto",o.RDH_ACTIVE="zc.rdh.a",o.RDH_MAX_TIME="zc.rdh.m",o.RDH_WEBRTC_URL_RSP="zc.rdh.hfwur",o.PUBLISH_STATE_HANDLE="zc.psh.0",o.PLAY_STATE_HANDLE="zc.psh.1",o.STATECENTER_ACTION_LISTENER="zc.sc.al",o.STATECENTER_SET_SETTING="zc.sc.ss",o.SIGNAL_SET_SESSION_INFO="zc.s.ssi",o.SIGNAL_RESET_CONNECT_TIMER="zc.s.rct",o.SIGNAL_BIND_WEBSOCKET_HANDLE="zc.s.bwh",o.SIGNAL_RESET_CHECK_MESSAGE="zc.s.rcm",o.SIGNAL_UPDATE_TOKEN="zc.s.ut",o.SIGNAL_SEND_MESSAGE_WITH_CALLBACK="zc.s.smwc",o.SIGNAL_CONNECT_SERVER="zc.s.cs.0",o.SIGNAL_START_CONNECT_TIMER="zc.s.sct",o.SIGNAL_DISCONNECT_SERVER="zc.s.dc",o.SIGNAL_CREATE_SESSION="zc.s.cs.1",o.SIGNAL_REMOVE_SESSION="zc.s.rs",o.SIGNAL_SEND_REMOVE_SESSION="zc.s.srs",o.SIGNAL_SEND_MESSAGE="zc.s.sm",o.SIGNAL_HANDLE_RESPOND_DATA="zc.s.hrd",o.SIGNAL_ADD_SESSION="zc.s.as",o.SIGNAL_HANDLE_PUSH_DATA="zc.s.hpd",o.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA="zc.s.hprsd",o.SIGNAL_SEND_MEDIA_DESC="zc.s.smd",o.SIGNAL_SEND_CANDIDATE_INFO="zc.s.sci",o.SIGNAL_SEND_MEDIA_DESC_ACK="zc.s.smda",o.SIGNAL_SEND_CANDIDATE_INFO_ACK="zc.s.scia",o.SIGNAL_SEND_CLOSE_SESSION_ACK="zc.s.scsa",o.SIGNAL_SEND_RESET_SESSION_ACK="zc.s.srsa",o.SIGNAL_REGISTER_PUSH_CALLBACK="zc.s.rpc",o.SIGNAL_CHECK_MESSAGE_TIMEOUT="zc.s.cmt",o.SIGNAL_SEND_HEARTBEAT="zc.s.sh",o.SIGNAL_QUALITY_REPORT="zc.s.qr",o.SIGNAL_SEND_STREAM_STATUS="zc.s.sss",o.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM="zc.s.apvs",o.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM="zc.s.apas",o.SIGNAL_SEND_BROADCAST_STATUS="zc.s.sbs",o.SIGNAL_SEND_NET_PROBE="zc.s.snp",o.SIGNAL_SEND_NET_QUALITY_INFO_PUSH_ACK="zc.s.npa",o.PUBLISHER_START_PUBLISH="zc.p.0.sp.0",o.PUBLISHER_PUBLISH_SUCCESS="zc.p.ps",o.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS="zc.p.0.ocpss",o.PUBLISHER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.0.hcsws",o.PUBLISHER_ON_CREATE_OFFER_SUCCESS="zc.p.0.ocos",o.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.0.oslds",o.PUBLISHER_ON_GET_REMOTE_DESCRIPTION="zc.p.0.ogrd",o.PUBLISHER_ON_RECV_MEDIA_DESC="zc.p.0.ormd",o.PUBLISHER_ON_RECV_CANDIDATE_INFO="zc.p.0.orci.0",o.PUBLISHER_ON_RECV_PUBLISH_EVENT="zc.p.0.orpe",o.PUBLISHER_ON_RECV_CLIENT_INFO="zc.p.0.orci.1",o.PUBLISHER_ON_ICE_CANDIDATE="zc.p.0.oic",o.PUBLISHER_ON_CONNECTION_STATE_CHANGE="zc.p.0.ocsc",o.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.0.oicsc",o.PUBLISHER_RESET_PUBLISH="zc.p.0.rp",o.PUBLISHER_SET_PLAYER_QUALITY_TIMER="zc.p.0.spqt",o.PUBLISHER_UPLOAD_PUBLISH_QUALITY="zc.p.0.upq",o.PUBLISHER_ON_RECV_RESET_SESSION="zc.p.0.orrs",o.PUBLISHER_ON_RECV_CLOSE_SESSION="zc.p.0.orcs",o.PUBLISHER_SEND_CANDIDATE_INFO="zc.p.0.sci",o.PUBLISHER_STATE_ERROR="zc.p.0.psr",o.PUBLISHER_STOP_PUBLISH="zc.p.0.sp.1",o.PUBLISHER_ON_DISCONNECT="zc.p.0.od",o.PUBLISHER_START_SOUND_LEVEL="zc.p.0.ssl.0",o.PUBLISHER_STOP_SOUND_LEVEL="zc.p.0.ssl.1",o.PUBLISHER_HANDLE_ENC_BITRATE="zc.p.0.heb",o.PUBLISHER_ON_RECV_NET_QUALITY_INFO="zc.p.0.nqi",o.PLAYER_START_PLAY="zc.p.1.sp.0",o.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS="zc.p.ocpss.1",o.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.hcsws.1",o.PLAYER_ON_CREATE_OFFER_SUCCESS="zc.p.ocos.1",o.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.oslds.1",o.PLAYER_ON_RECV_MEDIA_DESC="zc.p.ormd.1",o.PLAYER_ON_RECV_CANDIDATE_INFO="zc.p.orci.1",o.PLAYER_ON_RECV_PLAY_EVENT="zc.p.orpe.1",o.PLAYER_ON_RECV_CLIENT_INFO="zc.p.orci.1.1",o.PLAYER_ON_ICE_CANDIDATE="zc.p.oic.1",o.PLAYER_ON_CONNECTION_STATE_CHANGE="zc.p.ocsc.1",o.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.oicsc.1",o.PLAYER_RESET_PLAY="zc.p.rp.1",o.PLAYER_SET_PLAYER_QUALITY_TIMER="zc.p.spqt.1",o.PLAYER_UPLOAD_PLAYER_QUALITY="zc.p.upq.1",o.PLAYER_ON_RECV_RESET_SESSION="zc.p.orrs.1",o.PLAYER_ON_RECV_CLOSE_SESSION="zc.p.orcs.1",o.PLAYER_ON_RECV_STREAM_STATUS="zc.p.orss.1",o.PLAYER_ON_GOT_REMOTE_STREAM="zc.p.ogrs.1",o.PLAYER_SEND_CANDIDATE_INFO="zc.p.sci.1",o.PLAYER_STATE_ERROR="zc.p.psr.1",o.PLAYER_STOP_PLAY="zc.p.1.sp.1",o.PLAYER_ON_DISCONNECT="zc.p.od.1",o.PLAYER_START_SOUND_LEVEL="zc.p.ssl.1",o.PLAYER_STOP_SOUND_LEVEL="zc.p.ssl.1.1",o.PLAYER_ON_RECV_NET_QUALITY_INFO="zc.p.1.nqi",o.PUBLISH_SET_CAPTURE_VOLUME="zc.p.scv",o.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ="zc.sh.msbss",o.STREAMHANDLER_MERGE_STREAM="zc.sh.ms",o.STREAMHANDLER_PATCH_STREAM_LIST="zc.sh.psl",(r=t.ZEGO_WECHATMINI_ACTION||(t.ZEGO_WECHATMINI_ACTION={})).ADD_PUBLISH_CDN_URL="zw.apcu",r.REMOVE_PUBLISH_CDN_URL="zw.rpcu",r.STOP_MIXER_TASK="zw.smt",r.ON_STREAM="zw.os",r.ON_PUSH_STREAM_UPDATE="zw.opsu",r.ON_PUBLISH_STATE_UPDATE="zw.w.opsu",r.ON_PUBLISH_STATE_UPDATE_HANDLE="zw.w.opsuh",r.WECHATMINI_SETPREFERPLAYSOURCETYPE="zw.w.sppst.1",r.WECHATMINI_BIND_LISTENER="zw.w.bl",r.WECHATMINI_DELETE_LISTENER="zw.w.dl",r.WECHATMINI_UPDATE_PLAYER_STATE="zw.w.ups",r.WECHATMINI_UPDATE_PLAYER_NET_STATUS="zw.w.upns",r.WECHATMINI_SET_CUSTOM_SIGNAL_URL="zw.w.scsu",r.WECHATMINI_GET_NEXT_URL="zw.w.gnu",r.WECHATMINI_BIND_STREAM_CENTER_HANDLER="zw.w.bsch",r.WECHATMINI_BIND_RTM_LISTENER="zw.w.brl",r.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE="zw.pu.sppst.0",r.PUBLISHMODULE_START_PUBLISHING_STREAM="zw.pu.sps.0",r.PUBLISHMODULE_STOP_PUBLISHING_STREAM="zw.pu.sps.0.0",r.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL="zw.pu.fpsu.0",r.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP="zw.pu.hfspur.0",r.PUBLISHMODULE_DO_PUBLISH_STREAM="zw.pu.dps.0",r.PUBLISHMODULE_UPDATE_STREAM_INFO="zw.pu.upi",r.PUBLISHMODULE_HANDLE_STREAM_UPDATE_RSP="zw.pu.hsur",r.PLAYMODULE_START_PLAYING_STREAM="zw.pl.sps.1",r.PLAYMODULE_STOP_PLAYING_STREAM="zw.pl.sps.1.0",r.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN="zw.pl.spsfc",r.PLAYMODULE_START_PLAYING_STREAM_FROM_BGP="zw.pl.spsfb",r.PLAYMODULE_DO_PLAY_STREAM="zw.pl.dps",r.PLAYMODULE_FETCH_PLAY_STREAM_URL="zw.pl.fpsu",r.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP="zw.pl.hfsur",r.STREAMCENTERWECHAT_RESET="zw.scw.r.0",r.STREAMCENTERWECHAT_START_PUBLISHING_STREAM="zw.scw.sps.0",r.STREAMCENTERWECHAT_START_PLAYING_STREAM="zw.scw.sps.1",r.STREAMCENTERWECHAT_START_PLAYER="zw.scw.sp.0",r.STREAMCENTERWECHAT_ON_STREAM_URL_UPDATE="zw.scw.opuu.0",r.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE="zw.scw.ups.0",r.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS="zw.scw.upns",r.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE="zw.scw.ups.0.0",r.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE="zw.scw.ups.1.0",r.STREAMCENTERWECHAT_GET_NEXT_URL="zw.scw.gnu",r.STREAMCENTERWECHAT_STOP_PUBLISHING_STREAM="zw.scw.sps.0.0",r.STREAMCENTERWECHAT_STOP_PLAYING_STREAM="zw.scw.sps.1.0",r.STREAMCENTERWECHAT_STOP_PLAYER="zw.scw.sp.1",r.STREAMCENTERWECHAT_ON_PLAY_START="zw.scw.ops.0",r.STREAMCENTERWECHAT_ON_PLAY_STOP="zw.scw.ops.1",r.STREAMCENTERWECHAT_ON_PLAY_RETRY="zw.scw.opr",r.PLAYWECHAT_TRY_START_PLAYER="zw.pw.tsp.0",r.PLAYWECHAT_UPDATE_EVENT="zw.pw.ue",r.PLAYWECHAT_GET_PLAY_URL="zw.pw.gpu"},9595:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTC=t.ZegoSettingConfig=void 0;var r=function(){function e(){this.defaultSetting={publish_video_codec:"H264",camera_video_bitrate:800,screen_video_bitrate:1500,custom_video_bitrate:0,l3_play_buffer_ms:500,AEC:!0,AGC:!0,ANS:!0,resource_mode:0,bitrate_mode:"default"},this.setting=JSON.parse(JSON.stringify(this.defaultSetting))}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setSetting=function(e,t){var r=Array.isArray(t)&&t.length>0;for(var o in e)for(var i in e[o])if(!i.endsWith("_ctrlmode")){if(r&&-1==t.indexOf(i))continue;var n=e[o][i+"_ctrlmode"];1===n||2===n?this.setting[i]=e[o][i]:this.defaultSetting[i]&&(this.setting[i]=this.defaultSetting[i]),"number"==typeof n&&(this.setting[i+"_ctrlmode"]=e[o][i+"_ctrlmode"])}},e.prototype.getSetting=function(e,t){return void 0===t&&(t=!1),t?2==this.setting[e+"_ctrlmode"]?this.setting[e]:void 0:this.setting[e]},e}();t.ZegoSettingConfig=r,t.RTC="rtc"},7325:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StateCenter=void 0;var o=r(6706),i=r(608),n=r(1089),s=r(9595),a=r(6706),c=r(3529),l=function(){function e(e,t){this.logger=e,this.dataReport=t,this.debug=!1,this.testEnvironment=!1,this.pullLimited=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.callbackList={},this.publishStreamList={},this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.turnOverTcpOnly=!1,this.customSetTcpOrUdp=!1,this.supportUdp=!1,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.listenerList={roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],capturedSoundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[],_deviceError:[],_remoteCameraStatusUpdate:[],_remoteMicStatusUpdate:[],_streamUpdated:[],receiveRealTimeSequentialData:[]},this.reportList={},this.reportSeqList={startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1,this.networkState=a.ENUM_NETWORK_STATE.offline,this.streamRetryTime=300,this.checkList=[],this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.streamConnectTime=0,this.clientIP="",this.type="PUBLIC",this.roomList=[],this.isMultiRoom=!1,this.browser="",this.logReportCallback=i.ClientUtil.logReportCallback,this.unregisterCallback=i.ClientUtil.unregisterCallback,this.checkIllegalCharacters=i.ClientUtil.checkIllegalCharacters,this.decodeServerError=i.ClientUtil.decodeServerError,this.getLiveRoomError=i.ClientUtil.getLiveRoomError,this.getServerError=i.ClientUtil.getServerError,this.mergeStreamList=i.ClientUtil.mergeStreamList,this.checkInteger=i.ClientUtil.checkInteger,this.isUrl=i.ClientUtil.isUrl,this.actionSuccessCallback=i.ClientUtil.actionSuccessCallback,this.checkValidNumber=i.ClientUtil.checkValidNumber,this.getDevices=i.ClientUtil.getDevices,this.settingConfig=new s.ZegoSettingConfig}return e.prototype.getRequestId=function(){return this.idName+"-"+a.getSeq()},e.prototype.getSignalCmdContent=function(e,t,r,o){var i={request_id:t,room_id:e,from_userid:this.idName,from_username:this.nickName,to_userid:r};return null!=o&&(i.result=o),JSON.stringify(i)},e.prototype.actionListener=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];if(!["playQualityUpdate","publishQualityUpdate","soundLevelUpdate","capturedSoundLevelUpdate"].includes(e)&&this.listenerList[e]){var s=o.getReportSeq();this.dataReport.newReport(s,c.ZegoRTCLogEvent.kZegoListener.event),this.dataReport.addMsgInfo(s,{listener:e,params:r}),this.dataReport.uploadReport(s)}this.listenerList[e]&&this.listenerList[e].forEach((function(o){try{setTimeout((function(){o.apply(void 0,r)}),0)}catch(r){t.logger.error(n.ZEGO_WEBRTC_ACTION.STATECENTER_ACTION_LISTENER+" "+e+" "+r)}}))},e.prototype.getRoomByRoomID=function(e){return this.roomList.find((function(t){return t.roomID==e}))},e.prototype.getPlayRoom=function(e){return this.roomList.find((function(t){return!!t.streamList.find((function(t){return t.stream_id==e}))}))},e}();t.StateCenter=l},5740:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStreamCenter=void 0;t.ZegoStreamCenter=function(){this.publisherList={},this.playerList={}}},7560:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamHandler=void 0;var o=r(6706),i=r(2752),n=r(1089),s=function(){function e(e,t,r,o,i){this.logger=e,this.stateCenter=t,this.rtm=r,this.streamCenter=o,this.roomID=i,this.minStreamSeq=0,this.streamSeq=0,this.streamQuerying=!1,this.streamSeqMergeMap=null,this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3}return e.prototype.setCDNInfo=function(e,t){e.urlFlv=t.urls_flv instanceof Array?t.urls_flv[0]:"string"==typeof t.urls_flv?t.urls_flv:"",e.urlHls=t.urls_m3u8 instanceof Array?t.urls_m3u8[0]:"string"==typeof t.urls_m3u8?t.urls_m3u8:"",e.urlHttpsFlv=t.urls_https_flv instanceof Array?t.urls_https_flv[0]:"string"==typeof t.urls_https_flv?t.urls_https_flv:"",e.urlHttpsHls=t.urls_https_m3u8 instanceof Array?t.urls_https_m3u8[0]:"string"==typeof t.urls_https_m3u8?t.urls_https_m3u8:"",e.urlRtmp=t.urls_rtmp instanceof Array?t.urls_rtmp[0]:"string"==typeof t.urls_rtmp?t.urls_rtmp:""},e.prototype.onStreamUpdated=function(e,t,r){},e.prototype.onStreamExtraInfoUpdated=function(e,t){},e.prototype.handleStreamStart=function(e,t){this.logger.info("zb.sh.hss call stream update"),this.room=t,e.body?(this.streamListHBMergeInterval=e.body.stream_list_hb_wait_merge_time||2e3,this.streamListMergeInterval=e.body.stream_list_push_merge_timeout||5e3,this.streamQuerying=!1,this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info||[]),this.handleReconnectStream(e.body.stream_info),this.logger.info("zb.sh.hss call end")):this.logger.error("zb.sh.hss server response wrong")},e.prototype.onPublishStateUpdate=function(e,t,r){},e.prototype.updateStreamInfo=function(e,t,r,n){var s,a,c,l=this;if(void 0===r&&(r=""),this.logger.info("zb.sh.usi call"),"PUBLIC"===this.stateCenter.type){var d={stream_id:e,extra_info:r},u=JSON.stringify(d);a={sub_cmd:t,stream_msg:u,third_token:null===(s=this.room)||void 0===s?void 0:s.token},c="stream"}else a={room_header:{room_id:this.roomID,room_sid:this.rtm.getRoomSid()||"0",room_user_session_id:this.rtm.getRoomSessionID()||"0"},stream_id:e,extra_info:r,title:"",stream_sid:this.stateCenter.publishStreamList[e].sid},c=t;var h=this.room;this.room.streamInfoList[e]={},this.room.streamInfoList[e].seq=this.rtm.service.sendMessage(c,a,(function(e,t){l.handleStreamUpdateRsp(e)}),(function(s,a){var c=l.room;if(c&&!c.isResetRoom&&!l.rtm.service.isDisConnect()&&s.code&&s.code==i.errorCodeList.TIMEOUT.code&&c.streamInfoList[e].seq==a)2001==t&&l.stateCenter.publishStreamList[e]&&l.stateCenter.publishStreamList[e].state==o.ENUM_PUBLISH_STREAM_STATE.update_info||2002==t?setTimeout((function(){l.updateStreamInfo(e,t,r,n)}),0):n&&n(i.errorCodeList.TIMEOUT);else if(s.body&&s.body.err_code){var d=l.stateCenter.getServerError(s.body.err_code);[1011,1000002002].includes(d.code)&&(d=i.errorCodeList.TOKEN_EXPIRED),n&&n(d,a),t===o.ENUM_STREAM_SUB_CMD.liveBegin&&l.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.error,e,d)}}),void 0,{sessionID:null==h?void 0:h.sessionID,roomID:null==h?void 0:h.roomID,roomSessionID:null==h?void 0:h.roomSessionID}),this.logger.info("zb.sh.usi call success cmd "+t)},e.prototype.handleStreamUpdateRsp=function(e){var t,r,i;if(this.rtm.service.isDisConnect())this.logger.error("zb.sh.hsur not login");else if(0==e.body.err_code){this.logger.info("zb.sh.hsur stream seq "+this.streamSeq+" server seq "+e.body.stream_seq),"PUBLIC"===this.stateCenter.type?this.streamSeq=e.body.stream_seq:this.streamSeq++;var n=this.room;if(n)if("PUBLIC"===this.stateCenter.type){(null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.token_remain_time)&&(this.stateCenter.getRoomByRoomID(null===(r=null==e?void 0:e.header)||void 0===r?void 0:r.room_id)?this.rtm.resetRoomTokenTimer(e.header.room_id,e.body.token_remain_time):this.logger.error("zb.sh.hsur room no found ignore "+JSON.stringify(null===(i=e.header)||void 0===i?void 0:i.room_id)));for(var s=function(t){var r=e.body.stream_info[t].stream_id,i=a.stateCenter.publishStreamList[r];if(!i)return a.logger.info("hsur.0 stream is not exist"),{value:void 0};i.state==o.ENUM_PUBLISH_STREAM_STATE.update_info&&(i.state=o.ENUM_PUBLISH_STREAM_STATE.publishing,n.streamList.find((function(e){return e.stream_id==r}))||n.streamList.push(e.body.stream_info[t]),a.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.start,r,{code:0,message:""})),delete n.streamInfoList[r]},a=this,c=0;c<e.body.stream_info.length;c++){var l=s(c);if("object"==typeof l)return l.value}}else{var d=e.body.stream_id;this.stateCenter.publishStreamList[d]&&this.stateCenter.publishStreamList[d].state==o.ENUM_PUBLISH_STREAM_STATE.update_info&&(this.stateCenter.publishStreamList[d].state=o.ENUM_PUBLISH_STREAM_STATE.publishing,this.stateCenter.publishStreamList[d].sid=e.body.stream_sid,this.stateCenter.publishStreamList[d].ver=e.body.stream_ver,n.streamList.find((function(e){return e.stream_id==d}))||n.streamList.push({stream_id:e.body.stream_id,stream_seq:e.body.stream_seq,stream_sid:e.body.stream_sid,stream_ver:e.body.stream_ver,user_id:"",user_name:""}),this.onPublishStateUpdate(0,d,{code:0,message:""})),delete n.streamInfoList[d]}else this.logger.info("hsur.0 room no found")}else this.logger.error("zb.sh.hsur stream update error "+e.body.err_code)},e.prototype.handleFetchStreamListRsp=function(e){this.logger.info("zb.sh.hfslr call"),this.streamQuerying=!1,0===e.body.err_code?this.streamSeq!==e.body.stream_seq?(this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info),this.logger.info("zb.sh.hfslr call success")):this.logger.info("zb.sh.hfslr same seq"):this.logger.info("zb.sh.hfslr server error=",e.body.err_code)},e.prototype.handleFullUpdateStream=function(e,t){var r=this;this.logger.info("zb.sh.hfus call"),this.streamSeq=e,this.logger.debug("zb.sh.hfus server seq "+this.streamSeq),this.stateCenter.mergeStreamList(this.stateCenter.idName,this.room.streamList,t,(function(e,t,i){0!==e.length&&(r.logger.debug("zb.sh.hfus callback addstream"),r.onStreamUpdated(r.roomID,o.ENUM_STREAM_UPDATE_TYPE.added,r.makeCallbackStreamList(e))),0!==t.length&&(r.logger.debug("zb.sh.hfus callback delstream"),r.onStreamUpdated(r.roomID,o.ENUM_STREAM_UPDATE_TYPE.deleted,r.makeCallbackStreamList(t))),0!==i.length&&(r.logger.debug("zb.sh.hfus callback updatestream"),r.onStreamExtraInfoUpdated(r.roomID,r.makeCallbackStreamList(i)))})),this.logger.info("zb.sh.hfus call success")},e.prototype.handlePushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call"),e.body.stream_info&&0!==e.body.stream_info.length){if(e.body.stream_info.length+this.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.fetchStreamList();switch(this.streamSeq=e.body.stream_seq,e.body.stream_cmd){case o.ENUM_STREAM_UPDATE_CMD.added:this.handleAddedStreamList(e.body.stream_info);break;case o.ENUM_STREAM_UPDATE_CMD.deleted:this.handleDeletedStreamList(e.body.stream_info);break;case o.ENUM_STREAM_UPDATE_CMD.updated:this.handleUpdatedStreamList(e.body.stream_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handlePriPushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call"),e.body.streams_info&&0!==e.body.streams_info.length){if(e.body.streams_info.length+this.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.mergeStreamByStreamSeq(e.body.stream_cmd,e.body.stream_seq,e.body.streams_info);switch(this.streamSeq=e.body.stream_seq,e.body.stream_cmd){case o.ENUM_STREAM_UPDATE_CMD_PRI.added:this.handleAddedStreamList(e.body.streams_info);break;case o.ENUM_STREAM_UPDATE_CMD_PRI.deleted:this.handleDeletedStreamList(e.body.streams_info);break;case o.ENUM_STREAM_UPDATE_CMD_PRI.updated:this.handleUpdatedStreamList(e.body.streams_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handleAddedStreamList=function(e){this.logger.debug("zb.sh.hasl call");for(var t,r=[],i=0;i<e.length;i++)if(e[i].anchor_id_name!=this.stateCenter.idName&&e[i].user_id!==this.stateCenter.idName){t=!1;for(var n=0;n<this.room.streamList.length;n++)if(e[i].stream_id===this.room.streamList[n].stream_id){t=!0;break}t||r.push(e[i])}else this.logger.debug("hdsl.0 have self stream added");if(0!==r.length){this.logger.debug("zb.sh.hasl callback addstream");for(var s=0;s<r.length;s++)this.room.streamList.push(r[s]);this.onStreamUpdated(this.roomID,o.ENUM_STREAM_UPDATE_TYPE.added,this.makeCallbackStreamList(r))}this.logger.info("zb.sh.hasl call success")},e.prototype.handleDeletedStreamList=function(e){this.logger.debug("zb.sh.hdsl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName&&e[r].user_id!==this.stateCenter.idName){for(var i=this.room.streamList.length-1;i>=0;i--)if(e[r].stream_id===this.room.streamList[i].stream_id){this.room.streamList.splice(i--,1),t.push(e[r]);break}}else this.logger.debug("zb.sh.hdsl have self stream deleted");0!==t.length&&(this.logger.debug("zb.sh.hdsl callback delstream"),this.onStreamUpdated(this.roomID,o.ENUM_STREAM_UPDATE_TYPE.deleted,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.hdsl call")},e.prototype.handleUpdatedStreamList=function(e){this.logger.debug("zb.sh.husl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName&&e[r].user_id!==this.stateCenter.idName){for(var o=0;o<this.room.streamList.length;o++)if(e[r].stream_id===this.room.streamList[o].stream_id){e[r].extra_info!==this.room.streamList[o].extra_info&&(this.room.streamList[o]=e[r],t.push(e[r]));break}}else this.logger.debug("hsul.0 have self stream updated");0!==t.length&&(this.logger.debug("zb.sh.husl callback updatestream"),this.onStreamExtraInfoUpdated(this.roomID,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.husl call success")},e.prototype.fetchStreamList=function(){if(this.logger.info("zb.sh.fsl call"),this.rtm.service.isDisConnect())this.logger.info("zb.sh.fsl state error");else if(this.streamQuerying)this.logger.info("zb.sh.fsl already doing");else if(this.streamQuerying=!0,this.logger.debug("zb.sh.fsl send fetch request"),"PUBLIC"===this.stateCenter.type){var e={reserve:0},t=this.room;this.rtm.service.sendMessage("stream_info",e,this.handleFetchStreamListRsp.bind(this),(function(e,t){}),void 0,{roomID:null==t?void 0:t.roomID,sessionID:null==t?void 0:t.sessionID,roomSessionID:null==t?void 0:t.roomSessionID}),this.logger.info("zb.sh.fsl call success")}else{if(!this.rtm.isLogin(this.roomID))return void this.logger.info("zb.sh.fsl room state error");e={room_header:{room_id:this.roomID,room_sid:this.rtm.getRoomSid()||"0",room_user_session_id:this.rtm.getRoomSessionID()||"0"}},this.rtm.service.sendMessage("zegochat_js.room_info_req",e,this.handleFetchStreamListRsp.bind(this),(function(e,t){}))}},e.prototype.handleReconnectStream=function(e){this.logger.info("zb.sh.hrs call");var t=this.streamCenter.publisherList,r=this.streamCenter.playerList,i=function(r){if(t[r].roomID!==n.roomID)return"continue";if(t[r].publisher.state!=o.ENUM_PUBLISH_STATE.publishing||e.find((function(e){return e.stream_id==r}))){if(t[r].publisher.state==o.ENUM_PUBLISH_STATE.stop&&e.find((function(e){return e.stream_id==r}))){s=void 0,s="PUBLIC"===n.stateCenter.type?o.ENUM_STREAM_SUB_CMD.liveEnd:o.ENUM_STREAM_CMD_PRI.liveEnd,n.updateStreamInfo(r,s);for(var i=0;i<n.room.streamList.length;i++)if(n.room.streamList[i].stream_id==r){n.room.streamList.splice(i--,1);break}}}else{var s=void 0;s="PUBLIC"===n.stateCenter.type?o.ENUM_STREAM_SUB_CMD.liveBegin:o.ENUM_STREAM_CMD_PRI.liveBegin,n.updateStreamInfo(r,s,n.stateCenter.publishStreamList[r].extra_info)}},n=this;for(var s in t)i(s);for(var s in t)t[s].roomID===this.roomID&&t[s].isReDispatch&&(this.logger.info("zb.sh.hrs "+s+"retry dispatch"),(a=t[s].retryDispatchHandler).stopMaxTime(),a.invalid(),a.initStream(s,t[s].publishOption,!0),a.active(0),t[s].isReDispatch=!1);for(var s in r){var a;r[s].roomID===this.roomID&&r[s].isReDispatch&&(this.logger.info("zb.sh.hrs "+s+"retry dispatch"),(a=r[s].retryDispatchHandler).stopMaxTime(),a.invalid(),a.initStream(s,r[s].playOption,!1),a.active(0),r[s].isReDispatch=!1)}this.logger.info("zb.sh.hrs end")},e.prototype.makeCallbackStreamList=function(e){var t=[];if("PUBLIC"===this.stateCenter.type){if(e&&e.length>0)for(var r=0;r<e.length;r++){var o={user:{userID:e[r].anchor_id_name,userName:e[r].anchor_nick_name},extraInfo:e[r].extra_info,streamID:e[r].stream_id,roomID:"",urlFlv:"",urlRtmp:"",urlHls:"",urlHttpsFlv:"",urlHttpsHls:"",streamGID:e[r].stream_gid,closeType:e[r].close_type};this.setCDNInfo(o,e[r]),t.push(o)}}else if(e&&e.length>0)for(r=0;r<e.length;r++)o={user_id:e[r].user_id,user_name:e[r].user_name,stream_id:e[r].stream_id,stream_sid:e[r].stream_sid,extra_info:e[r].extra_info,title:e[r].title,stream_ver:e[r].stream_ver},t.push(o);return t},e.prototype.sendBizChannelRequest=function(e,t,r,o){var i=this;void 0===o&&(o=!1),e=Object.assign(e,{is_retry_req:o?1:0});var n=this.room;this.rtm.service.sendMessage("biz_channel",e,(function(e,r){t(e.header.seq,e.body.cmd,e.body.rsp_body)}),(function(o,n){var s=o.body.err_code,a=o.body.rsp_body;"number"!=typeof s||2002!==s?r(s,n,a):i.sendBizChannelRequest(e,t,r,!0)}),void 0,{roomID:null==n?void 0:n.roomID,sessionID:null==n?void 0:n.sessionID,roomSessionID:null==n?void 0:n.roomSessionID})},e.prototype.updateStreamExtraInfo=function(e,t,r,o){},e.prototype.setStreamExtraInfo=function(e,t,r,o){},e.prototype._publishTarget=function(e,t,r){},e.prototype.patchStreamList=function(e){var t=this;e.body.stream_seq===this.streamSeq||this.streamSeqMergeMap||(this.logger.info(n.ZEGO_WEBRTC_ACTION.STREAMHANDLER_PATCH_STREAM_LIST+" call update stream "+this.streamSeq+" server "+e.body.stream_seq),this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout((function(){t.handleMergeTimeout()}),this.streamListHBMergeInterval)),this.minStreamSeq=e.body.stream_seq},e.prototype.mergeStreamByStreamSeq=function(e,t,r){var o=this;this.streamSeqMergeMap||(this.logger.warn(n.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ+" new merge stream list "+this.streamSeq+" server "+t),this.streamSeqMergeMap={},this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout((function(){o.handleMergeTimeout()}),this.streamListMergeInterval)),this.logger.info(n.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ+" "+this.streamSeqMergeMap+" "+e+" "+t+" "+r),this.streamSeqMergeMap[t]={cmd:e,streamList:r}},e.prototype.handleMergeTimeout=function(){if(this.streamSeqMergeMap){var e=Object.keys(this.streamSeqMergeMap).map((function(e){return+e})).sort((function(e,t){return e-t}));e[e.length-1]-e[0]+1===e.length||e[e.length-1]>=this.minStreamSeq?this.mergeStream(e):(this.streamSeqMergeMap=null,this.fetchStreamList())}},e.prototype.mergeStream=function(e){var t=this;this.logger.info(n.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM+" merge streamList "+this.streamSeq+" streamSeqList "+e.join(","));var r=e[e.length-1],i=[];e.forEach((function(e){if(t.streamSeqMergeMap&&t.streamSeqMergeMap[e])switch(t.streamSeqMergeMap[e].cmd){case o.ENUM_STREAM_UPDATE_CMD.added:t.streamSeqMergeMap[e].streamList.forEach((function(e){var t=i.findIndex((function(t){return t.stream_id==e.stream_id}));-1!==t&&i.splice(t),i.push(e)}));break;case o.ENUM_STREAM_UPDATE_CMD.deleted:t.streamSeqMergeMap[e].streamList.forEach((function(e){var t=i.findIndex((function(t){return t.stream_id==e.stream_id}));-1!==t&&i.splice(t)}));break;case o.ENUM_STREAM_UPDATE_CMD.updated:t.streamSeqMergeMap[e].streamList.forEach((function(e){var t=i.findIndex((function(t){return t.stream_id==e.stream_id}));-1!==t&&i.splice(t),i.push(e)}))}})),this.streamSeqMergeMap=null,this.logger.info(n.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM+" "+i),this.handleFullUpdateStream(r,i)},e.prototype.reset=function(){this.minStreamSeq=0,this.streamSeqMergeMap=null,this.streamSeqMergeTimer&&(clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=void 0),this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3},e.prototype.getRoomInfo=function(){var e=this;return new Promise((function(t,r){if(e.rtm.isLogin(e.roomID)){var o=function(e,o){if(0!==e.body.code)r({errorCode:e.body.code,extendData:e.body.message});else{var i=e.body.streams_info.map((function(e){return{streamID:e.stream_id,user:{userID:e.user_id,userName:e.user_name},extraInfo:e.extra_info}}));t({streamList:i})}},i={room_header:{room_id:e.roomID,room_sid:e.rtm.getRoomSid()||"0",room_user_session_id:e.rtm.getRoomSessionID()||"0"}};e.rtm.service.sendMessage("zegochat_js.room_info_req",i,o,o)}else e.logger.error("zn.rh.gri no enter room")}))},e}();t.StreamHandler=s},6706:function(e,t,r){"use strict";var o,i,n,s,a,c,l,d,u,h,p,g;Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTM=t.ZegoDataReport=t.ZegoLogger=t.ZegoExpressWebRTMEngine=t.getReportSeq=t.getSeq=t.QUALITY_CONSTANT=t.QualityGrade=t.REPORT_ACTION=t.ENUM_RETRY_STATE=t.ENUM_PLAY_STATE_UPDATE=t.ENUM_PUBLISH_STATE_UPDATE=t.LinkedList=t.ListNode=t.E_CLIENT_TYPE=t.ENUM_SOURCE_TYPE=t.ENUM_DISPATCH_TYPE=t.ENUM_BROADCASTER_STATUS=t.ENUM_PLAY_SOURCE_TYPE=t.ENUM_PUBLISH_STATE_NEGO=t.ENUM_PUSH_SIGNAL_SUB_CMD=t.ENUM_SIGNAL_SUB_CMD=t.QUALITYLEVEL=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD_PRI=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.STREAM_DELETE_REASON=t.ENUM_NETWORK_STATE=t.ENUM_RUN_STATE=t.ENUM_STREAM_UPDATE_TYPE=t.ENUM_STREAM_CMD_PRI=t.ENUM_STREAM_SUB_CMD=t.ENUM_PUBLISH_STREAM_STATE=t.MAX_RETRY_CONNECT_INTERVAL=t.MAX_TRANS_DATA_LENGTH=t.MAX_TRANS_TYPE_LENGTH=t.MAX_MESSAGE_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.ENUM_CONNECT_STATE=t.ENUM_PROBE_STATE=t.ENUM_PLAY_STATE_NEGO=t.ENUM_PLAYER_STATE=t.ENUM_PLAY_STATE=t.ENUM_PUBLISH_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.PROTO_VERSION="2.12.2",t.ROOMVERSION="V1",(g=t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={}))[g.debug=0]="debug",g[g.info=1]="info",g[g.warn=2]="warn",g[g.error=3]="error",g[g.report=99]="report",g[g.disable=100]="disable",t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},(p=t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={}))[p.disable=0]="disable",p[p.websocket=1]="websocket",p[p.https=2]="https",t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},(h=t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={}))[h.disconnected=0]="disconnected",h[h.connecting=1]="connecting",h[h.connected=2]="connected",t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1500},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_PUBLISH_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,publishing:6,stop:7,didNotStart:8},t.ENUM_PLAY_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,playing:6,stop:7,didNotStart:8},t.ENUM_PLAYER_STATE={start:0,playing:1,stop:2},t.ENUM_PLAY_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6,iceClosed:7,iceFailed:8},(u=t.ENUM_PROBE_STATE||(t.ENUM_PROBE_STATE={}))[u.tryProbe=0]="tryProbe",u[u.probed=2]="probed",t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=3,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MESSAGE_LENGTH=1024,t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,t.MAX_RETRY_CONNECT_INTERVAL=12,t.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},t.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},t.ENUM_STREAM_CMD_PRI={liveBegin:"zegochat_js.room_stream_create_req",liveEnd:"zegochat_js.room_stream_delete_req",liveUpdate:"zegochat_js.room_stream_update_req"},t.ENUM_STREAM_UPDATE_TYPE={added:1,deleted:0},(d=t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={}))[d.logout=0]="logout",d[d.trylogin=1]="trylogin",d[d.login=2]="login",(l=t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={}))[l.offline=0]="offline",l[l.online=1]="online",t.STREAM_DELETE_REASON={0:{code:1,description:"user_stop_publishing_stream_normal"},1:{code:2,description:"user_heart_beat_timeout"},2:{code:3,description:"user_repeat_login"},3:{code:4,description:"user_kicked_out"},4:{code:5,description:"user_offline"},100:{code:6,description:"remove_by_server"}},t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.ENUM_STREAM_UPDATE_CMD_PRI={added:1,updated:2,deleted:3},t.SERVER_ERROR_CODE=1e4,(c=t.QUALITYLEVEL||(t.QUALITYLEVEL={}))[c.low=1]="low",c[c.stantard=2]="stantard",c[c.hight=3]="hight",c[c.custome=4]="custome",t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},t.ENUM_PUBLISH_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6,iceClosed:7,iceFailed:8},(a=t.ENUM_PLAY_SOURCE_TYPE||(t.ENUM_PLAY_SOURCE_TYPE={}))[a.cdn=0]="cdn",a[a.ultra=1]="ultra",(s=t.ENUM_BROADCASTER_STATUS||(t.ENUM_BROADCASTER_STATUS={}))[s.stop=0]="stop",s[s.start=1]="start",(n=t.ENUM_DISPATCH_TYPE||(t.ENUM_DISPATCH_TYPE={}))[n.cdn=0]="cdn",n[n.ultra=1]="ultra",n[n.customUrl=2]="customUrl",(i=t.ENUM_SOURCE_TYPE||(t.ENUM_SOURCE_TYPE={}))[i.CDN=0]="CDN",i[i.BGP=1]="BGP",(o=t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}))[o.ClientType_None=0]="ClientType_None",o[o.ClientType_H5=1]="ClientType_H5",o[o.ClientType_SmallPragram=2]="ClientType_SmallPragram",o[o.ClientType_Webrtc=3]="ClientType_Webrtc";var f=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._id=null,this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=f;var m,_,E=function(){function e(){this.start=new f,this.end=new f,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new f(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this._numNodes>0?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=E,t.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},t.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2,stop:3},t.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},t.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},(_=t.QualityGrade||(t.QualityGrade={}))[_.Unknown=-1]="Unknown",_[_.Excellent=0]="Excellent",_[_.Good=1]="Good",_[_.Middle=2]="Middle",_[_.Poor=3]="Poor",_[_.Die=4]="Die",(m=t.QUALITY_CONSTANT||(t.QUALITY_CONSTANT={}))[m.MinQuality=0]="MinQuality",m[m.DieQuality=0]="DieQuality",m[m.PoorMinQuality=1]="PoorMinQuality",m[m.MiddleMinQuality=30]="MiddleMinQuality",m[m.GoodMinQuality=60]="GoodMinQuality",m[m.ExcellentMinQuality=85]="ExcellentMinQuality",m[m.MaxQuality=100]="MaxQuality";var T=r(9194);Object.defineProperty(t,"getSeq",{enumerable:!0,get:function(){return T.getSeq}}),Object.defineProperty(t,"getReportSeq",{enumerable:!0,get:function(){return T.getReportSeq}}),Object.defineProperty(t,"ZegoExpressWebRTMEngine",{enumerable:!0,get:function(){return T.ZegoExpressWebRTMEngine}}),Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return T.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return T.ZegoDataReport}}),Object.defineProperty(t,"ZegoExpressWebRTM",{enumerable:!0,get:function(){return T.ZegoExpressWebRTM}})},2752:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},STREAMID_TOO_LONG:{code:1000014,message:"stream ID is too long"},STREAM_ID_NULL:{code:1000015,message:"streamID is empty"},STREAM_ID_INVALID_CHARACTER:{code:1000016,message:"stream ID contains illegal characters"},NETWORK_BROKEN:{code:1000017,message:"network is broken"},LOCALSTREAM_WRONG:{code:1000018,message:"local stream wrong"},INPUT_PARAM:{code:1100001,message:"input param error."},TIMEOUT:{code:1100002,message:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},INIT_SDK_WRONG:{code:1101e3,message:"init sdk wrong"},WX_GET_SETTING_FAIL:{code:1101001,message:"wx get setting fail"},USER_ID_NULL:{code:1002005,message:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,message:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,message:"user ID is too long"},USER_NAME_NULL:{code:1002008,message:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,message:"username is too long"},ROOM_ID_NULL:{code:1002011,message:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,message:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,message:"room ID is too long"},LOGIN_TIMEOUT:{code:1002031,message:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,message:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,message:"kickout may be the same user ID login other"},ROOM_RETRY_TIMEOUT:{code:1002053,message:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,message:"server has sent a signal to kick out"},ROOM_INNER_ERROR:{code:1002099,message:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,message:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,message:"parse json error."},LOGIN_PROCESSING:{code:1102012,message:"login is processing."},LIVEROOM_REQUEST_ERROR:{code:1102013,message:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,message:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,message:"user login state is wrong."},TOKEN_ERROR:{code:1102016,message:"token error"},DISPATCH_ERROR:{code:1102017,message:"dispatch error"},TOKEN_EXPIRED:{code:1102018,message:"token expired"},SUBCMD_ERROR:{code:1102019,message:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,message:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,message:"biz channel error."},DISPATCH_TIMEOUT:{code:1102022,message:"dispatch request timeout"},CONNECT_FAILED:{code:1102023,message:"connect signal fail"},PUBLISHER_MEDIA_SERVER_FORBID:{code:1003025,message:"stream is forbided by media server"},PUBLISHER_EXTRA_INFO_TOO_LONG:{code:1003051,message:"stream extra info is too long"},PUBLISHER_PARAM:{code:1103001,message:"input param error"},PUBLISHER_BROWSER_NOT_SUPPORT:{code:1103002,message:"browser do not support"},PUBLISHER_DISPATCH_FAIL:{code:1103003,message:"dispatch request error"},PUBLISHER_SCREEN_FAILED:{code:1103010,message:"screen fail"},ENUMERATE_DEVICES_FAIL:{code:1103011,message:"enumerate devices fail"},PUBLISHER_DISPATCH_REQUEST_FAIL:{code:1103020,message:"dispatch request fail"},PUBLISHER_SESSION_REQUEST_FAIL:{code:1103021,message:"session request fail"},PUBLISHER_CREATE_OFFER_ERROR:{code:1103022,message:"create offer error"},PUBLISHER_SET_LOCAL_DESC_ERROR:{code:1103023,message:"setLocalDescription error"},PUBLISHER_MEDIA_DESC_ERROR:{code:1103024,message:"mediaDesc error"},PUBLISHER_SET_REMOTE_DESC_ERROR:{code:1103025,message:"other side offer error"},PUBLISHER_CANDIDATE_ERROR:{code:1103026,message:"candidate error"},PUBLISHER_SESSION_CLOSED:{code:1103027,message:"server session closed"},PUBLISHER_MEDIA_CONNECTION_ERROR:{code:1103028,message:"ice connection error"},PUBLISHER_SERVER_NEGO_TIMEOUT:{code:1103030,message:"negotiation timeout"},PUBLISH_DEVICE_OUT_ERR:{code:1103041,message:"device change "},PUBLISH_SCREEN_CANCELED:{code:1103042,message:"screen canceled"},PUBLISH_SCREEN_NOT_SUPPORT:{code:1103043,message:"screen not support"},PUBLISH_NO_PREVIEW:{code:1103044,message:"stream is not from zego"},REPEATED_PULL:{code:1103049,message:"repeated pull same stream"},PUBLISHER_WEBSOCKET_DISCONNECTED:{code:1103050,message:"websocket disconnected"},PUBLISHER_RETRY_TIMEOUT:{code:1103051,message:"publisher retry timeout"},PUBLISHER_HTTPS_REQUIRED:{code:1103053,message:"https is required"},PUBLISHER_NO_PREVIEW:{code:1103054,message:"no preview"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:"publish stream no found"},PUBLISHER_IS_PUBLISHING:{code:1103056,message:"publish is publishing"},PUBLISHER_CLIENT_IP_CHANGED:{code:1103058,message:"client ip changed"},PUBLISHER_TTL_OVERTIME:{code:1103059,message:"ttl over time"},PUBLISHER_SESSION_TIMEOUT:{code:1103060,message:"session request timeout"},PUBLISHER_GET_USER_MEDIA_FAIL:{code:1103061,message:"get media fail"},PUBLISHER_DEVICE_NO_ALLOWED:{code:1103064,message:"get device not allowed"},PUBLISHER_DEVICE_NO_READABLE:{code:1103065,message:"device is not readable"},PUBLISHER_OVER_CONSTRAINED:{code:1103066,message:"device does not meet constraints"},PLAYER_PARAM:{code:1104001,message:"input parm error"},PLAYER_DISPATCH_REQUEST_FAIL:{code:1104020,message:"dispatch request fail"},PLAYER_SESSION_REQUEST_FAIL:{code:1104021,message:"session request fail"},PLAYER_CREATE_OFFER_ERROR:{code:1104022,message:"create offer error"},PLAYER_SET_LOCAL_DESC_ERROR:{code:1104023,message:"setLocalDescription error"},PLAYER_MEDIA_DESC_ERROR:{code:1104024,message:"mediaDesc error"},PLAYER_SET_REMOTE_DESC_ERROR:{code:1104025,message:"other side offer error"},PLAYER_CANDIDATE_ERROR:{code:1104026,message:"candidate error"},PLAYER_SESSION_CLOSED:{code:1104027,message:"server session closed"},PLAYER_MEDIA_CONNECTION_ERROR:{code:1104028,message:"ice connection error"},PLAYER_WEBSOCKET_DISCONNECTED:{code:1104029,message:"websocket disconnected"},PLAYER_SERVER_NEGO_TIMEOUT:{code:1104030,message:"negotiation timeout"},PLAYER_RETRY_TIMEOUT:{code:1104031,message:"player retry timeout"},PLAYER_IS_PLAYING:{code:1104032,message:"player is playing"},PLAYER_CLIENT_IP_CHANGED:{code:1104033,message:"client ip changed"},PLAYER_TTL_OVERTIME:{code:1104034,message:"ttl is over time"},PLAYER_SESSION_RESET:{code:1104035,message:"reset session push"},PLAYER_SESSION_TIMEOUT:{code:1104036,message:"session request timeout"},PLAYER_PROBE_TIMEOUT:{code:1104037,message:"probe time out"},PLAYER_UNSUPPORTED_PROTOCOL:{code:1104038,message:"resource mode is not supported"},DEVICE_ERROR_TYPE_UNPLUGGED:{code:1006006,message:"the device is unplugged"},IM_CONTENT_NULL:{code:1009001,message:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,message:"message content is too long"},IM_SEND_FAILED:{code:1009010,message:"failed to send message"},FREQ_LIMITED:{code:1109001,message:"frequency limited."}}},3529:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoWechatLogEvent=t.ZegoRTCLogEvent=void 0;var o=r(2752),i=function(e){return e};t.ZegoRTCLogEvent={kZegoTaskCreateStream:{event:"/sdk/create_stream",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kParamError:o.errorCodeList.PUBLISHER_PARAM,kScreenCancelError:o.errorCodeList.PUBLISH_SCREEN_CANCELED,kScreenFailedError:o.errorCodeList.PUBLISHER_SCREEN_FAILED,kScreenNotSupportError:o.errorCodeList.PUBLISH_SCREEN_NOT_SUPPORT,kHttpsRequiredError:o.errorCodeList.PUBLISHER_HTTPS_REQUIRED,kGetUserMediaError:o.errorCodeList.PUBLISHER_GET_USER_MEDIA_FAIL,kDeviceNoAllowedError:o.errorCodeList.PUBLISHER_DEVICE_NO_ALLOWED,kDeviceNoReadableError:o.errorCodeList.PUBLISHER_DEVICE_NO_READABLE,kDeviceOverConstrainedError:o.errorCodeList.PUBLISHER_OVER_CONSTRAINED},stream_type:i,screen:i,camera:i,custom:i},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishParamError:o.errorCodeList.PUBLISHER_PARAM,kPublishNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:o.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPublishNoPreviewError:o.errorCodeList.PUBLISH_NO_PREVIEW,kPublishNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:o.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kMediaServerForbidError:o.errorCodeList.PUBLISHER_MEDIA_SERVER_FORBID,kPublishTokenExpiredError:o.errorCodeList.TOKEN_EXPIRED,kPublishSessionClosedError:o.errorCodeList.PUBLISHER_SESSION_CLOSED,kPublishNegoTimeoutError:o.errorCodeList.PUBLISHER_SERVER_NEGO_TIMEOUT,kCreateOfferError:o.errorCodeList.PUBLISHER_CREATE_OFFER_ERROR,kSetLocalDescError:o.errorCodeList.PUBLISHER_SET_LOCAL_DESC_ERROR,kSessionTimeoutError:o.errorCodeList.PUBLISHER_SESSION_TIMEOUT,kSessionRequestError:o.errorCodeList.PUBLISHER_SESSION_REQUEST_FAIL,kSetRemoteDescError:o.errorCodeList.PUBLISHER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:o.errorCodeList.PUBLISHER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:o.errorCodeList.PUBLISHER_WEBSOCKET_DISCONNECTED,kMediaDescError:o.errorCodeList.PUBLISHER_MEDIA_DESC_ERROR,kCandidateError:o.errorCodeList.PUBLISHER_CANDIDATE_ERROR,kIsPublishing:o.errorCodeList.PUBLISHER_IS_PUBLISHING,kClientIPChangedError:o.errorCodeList.PUBLISHER_CLIENT_IP_CHANGED,kTTLOverTimeError:o.errorCodeList.PUBLISHER_TTL_OVERTIME},publishOption:i,message:i,session_id:i,stream:i,video_en_codec_id:i,cap_w:i,cap_h:i,w:i,h:i,video_en_fps:i,video_en_bps:i,audio_c_channel_count:i,audio_en_bps:i,aec_level:i,ans_level:i,agc:i,traffic_control_min_video_bitrate:i},kZegoTaskVideoCaptureSize:{event:"/sdk/api/publish_video_c_size",session_id:i,w:i,h:i},kZegoTaskVideoPlaySize:{event:"/sdk/play_video_size_changed",session_id:i,w:i,h:i},kZegoTaskRePublish:{event:"/sdk/republish",stream:i},kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:i},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPlayParamError:o.errorCodeList.PLAYER_PARAM,kPlayStreamIDToLongError:o.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:o.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:o.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:o.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPlayUnsupportedResourceMode:o.errorCodeList.PLAYER_UNSUPPORTED_PROTOCOL,kPlayRetryTimeoutError:o.errorCodeList.PLAYER_RETRY_TIMEOUT,kPlaySessionClosedError:o.errorCodeList.PLAYER_SESSION_CLOSED,kPlaySessionResetError:o.errorCodeList.PLAYER_SESSION_RESET,kPlayNegoTimeoutError:o.errorCodeList.PLAYER_SERVER_NEGO_TIMEOUT,kCreateOfferError:o.errorCodeList.PLAYER_CREATE_OFFER_ERROR,kSetLocalDescError:o.errorCodeList.PLAYER_SET_LOCAL_DESC_ERROR,kSessionRequestError:o.errorCodeList.PLAYER_SESSION_REQUEST_FAIL,kSessionTimeoutError:o.errorCodeList.PLAYER_SESSION_TIMEOUT,kSetRemoteDescError:o.errorCodeList.PLAYER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:o.errorCodeList.PLAYER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:o.errorCodeList.PLAYER_WEBSOCKET_DISCONNECTED,kCandidateError:o.errorCodeList.PLAYER_CANDIDATE_ERROR,kMediaDescError:o.errorCodeList.PLAYER_MEDIA_DESC_ERROR,kIsPlaying:o.errorCodeList.PLAYER_IS_PLAYING,kClientIPChangedError:o.errorCodeList.PLAYER_CLIENT_IP_CHANGED,kTTLOverTimeError:o.errorCodeList.PLAYER_TTL_OVERTIME,kProbeTimeOutError:o.errorCodeList.PLAYER_PROBE_TIMEOUT},playOption:i,message:i,session_id:i,stream:i,audio_activate:i,video_activate:i},kZegoTaskRePlay:{event:"/sdk/replay",stream:i},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:i},kZegoTaskEnumDevices:{event:"/device/list",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},dev_list:i},kZegoTaskAudioOutput:{event:"/device/audio_capture",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:i,device:i},kZegoTaskVideoCapture:{event:"/device/video_capture",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:i,device:i},kZegoTaskDeviceInterrupt:{event:"/device/interrupt",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:i,interrupt:i},kZegoTaskSetDebug:"/sdk/set_debug",kZegoTaskSetLog:"/sdk/set_log_config",kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",capability:i},kZegoTaskRemoteCameraUpdate:{event:"/sdk/remote_camera_update",stream:i,status:i},kZegoTaskRemoteMicUpdate:{event:"/sdk/remote_mic_update",stream:i,status:i},kZegoTaskDestroyStream:{event:"/sdk/destroy_stream",error:{kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG}},kZegoTaskScreenSharingEnded:"/sdk/screen_share_end",kZegoTaskAudioOutputChanged:{event:"/device/api/audio_output",session_id:i,stream:i,device:i,reason:i},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:i,update_stream:i},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:i},kZegoTaskPlayDecodeFirstVideoFrame:{event:"/sdk/play_decode_first_video_frame",session_id:i,fft_consumed:i},kZegoVisibilityChange:{event:"/app/background"},kZegoSetCaptureVolume:{event:"/sdk/set_capture_volume",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoListener:{event:"/sdk/listener"},kZegoNetProbe:{event:"/sdk/net_probe"},kZegoNetProbeResult:{event:"/sdk/net_probe_result"},kZegoTaskCloudSettingCache:{event:"/cloud_setting/cache"},kZegoTaskCloudSettingRefresh:{event:"/cloud_setting/refresh"}},t.ZegoWechatLogEvent={kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",error:{kCheckSystemGetSettingFailError:o.errorCodeList.WX_GET_SETTING_FAIL},capability:i},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPublishParamError:o.errorCodeList.PUBLISHER_PARAM,kPublishStreamIDTooLongError:o.errorCodeList.STREAMID_TOO_LONG,kPublishStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPublishNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:o.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPublishNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:o.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kIsPublishing:o.errorCodeList.PUBLISHER_IS_PUBLISHING},publishOption:i,stream:i,message:i},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kPlayStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPlayParamError:o.errorCodeList.PLAYER_PARAM,kPlayStreamIDTooLongError:o.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:o.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:o.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:o.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPlayRetryTimeoutError:o.errorCodeList.PLAYER_RETRY_TIMEOUT,kIsPlaying:o.errorCodeList.PLAYER_IS_PLAYING},playOption:i,message:i,session_id:i,stream:i,audio_activate:i,video_activate:i},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoTaskRePublish:"/sdk/republish",kZegoTaskRePlay:"/sdk/replay",kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:i},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:i},kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:i,update_stream:i},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:i}}},608:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=void 0;var n=r(6706),s=r(3529),a=r(4395),c=function(){function e(){}return e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},e.registerCallback=function(e,t,r){var o,i;t.success&&(o=t.success,r[e+"SuccessCallback"]=o),t.error&&(i=t.error,r[e+"ErrorCallback"]=i)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.logReportCallback=function(t,r,o,i){e.registerCallback(t,{success:function(t,i){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];e.dataReportEvent(r,o,t,i,n)}},i)},e.actionLogReportCallback=function(t,r,o,i,n){e.actionSuccessCallback(t,r)&&e.actionSuccessCallback(t,r)(o,i)},e.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};if(0===e)return{code:0,message:""};var r={code:0,message:"liveroom cmd error"};if(r.code=e,e>1e9){var o=t[e];r.message=o?"liveroom cmd error, code: "+e+", message: "+o:t[1e9]+e}else r.message=t[e]?t[e]+" code:"+e:"unknown error code:"+e;return r},e.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},e.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return e>1e9&&(r.code=e-1e9+52e6),t&&(r.message=t),r},e.getLiveRoomError=function(e){return e>1e9?{1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR"}[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},e.getKickoutError=function(e){var t={};switch(e){case 1:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:t.code=63000002,t.message="zpush manual kickout",t.name="MANUAL_KICKOUT";break;case 3:t.code=63000003,t.message="kickout reason = "+e;break;case 4:t.code=63000004,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 5:t.code=63000005,t.message="zpush token expired",t.name="TOKEN_EXPIRED";break;default:t.code=e,t.message="kickout reason = "+e}return t},e.dataReportEvent=function(e,t,r,o,i){switch(r){case"eventStart":e.eventStart(t,o);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,o,i[0]);break;case"addEventMsg":e.addEventMsg(t,o,i[0],i[1]);break;case"addEvent":e.addEvent(t,o);break;case"eventEnd":e.eventEnd(t,o);break;case"addMsgInfo":e.addMsgInfo(t,i[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeStreamList=function(e,t,r,o){var i,n=[],s=[],a=[];r||(r=[]);for(var c=0;c<r.length;c++)if(r[c].anchor_id_name!=e&&r[c].user_id!=e){i=!1;for(var l=0;l<t.length;l++)if(r[c].stream_id===t[l].stream_id){r[c].extra_info!==t[l].extra_info&&a.push(r[c]),i=!0;break}i||n.push(r[c])}for(var d=0;d<t.length;d++){i=!1;for(var u=0;u<r.length;u++)if(t[d].stream_id===r[u].stream_id){i=!0;break}i||s.push(t[d])}for(t.splice(0),c=0;c<r.length;c++)t.push(r[c]);o(n,s,a)},e.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=r},e.uuid=function(e,t){var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(t=t||o.length,e)for(r=0;r<e;r++)i[r]=o[0|Math.random()*t];else{var n=void 0;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;r<36;r++)i[r]||(n=0|16*Math.random(),i[r]=o[19==r?3&n|8:n])}return i.join("")},e.supportDetection=function(e,t,r,n){return o(this,void 0,void 0,(function(){var o,s,a,c,l,d,u,h;return i(this,(function(i){switch(i.label){case 0:return o={webRTC:!1,customCapture:!1,camera:!1,microphone:!1,videoCodec:{H264:!1,H265:!1,VP8:!1,VP9:!1},screenSharing:e,errInfo:{}},n&&"screenSharing"===n?(t({result:e,errInfo:o.errInfo}),[2]):n&&"customCapture"!==n||(((s=document.createElement("video")).captureStream||s.mozCaptureStream)&&(o.customCapture=!0),"customCapture"!==n)?(a=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c="https:"!==window.location.protocol&&"file:"!==window.location.protocol&&-1==window.location.hostname.indexOf("127.0.0.1")&&-1==window.location.hostname.indexOf("localhost"),n&&"camera"!==n&&"microphone"!==n?[3,9]:a?c?(o.camera=!1,console.error("webrtc requires https or localhost"),[3,9]):[3,1]:[3,9]):(t({result:o.customCapture,errInfo:o.errInfo}),[2]);case 1:if(n&&"camera"!==n)return[3,5];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,navigator.mediaDevices.getUserMedia({video:!0})];case 3:return(l=i.sent())&&(o.camera=!0)&&l.getTracks().forEach((function(e){return e.stop()})),[3,5];case 4:return d=i.sent(),o.errInfo.camera={name:d.name,message:d.message},console.error("camera devices detect error: ",d.name,d.message),[3,5];case 5:if(n&&"microphone"!==n)return[3,9];i.label=6;case 6:return i.trys.push([6,8,,9]),[4,navigator.mediaDevices.getUserMedia({audio:!0})];case 7:return(u=i.sent())&&(o.microphone=!0)&&u.getTracks().forEach((function(e){return e.stop()})),[3,9];case 8:return h=i.sent(),o.errInfo.microphone={name:h.name,message:h.message},console.error("microphone devices detect error: ",h.name,h.message),[3,9];case 9:return"camera"===n||"microphone"===n?(t({result:o[n],errInfo:o.errInfo}),[2]):(this.supportVideoCodeType((function(e,r){n||(o.videoCodec.H264=e.H264,o.videoCodec.H265=e.H265,o.videoCodec.VP8=e.VP8,o.videoCodec.VP9=e.VP9,o.webRTC=e.webRTC),r&&("string"==typeof r?o.errInfo.extendedDate=r:o.errInfo.webRTC={name:r.name,message:r.message},console.error("videoCodec detect error: "+r)),t&&t(n?{result:e[n],errInfo:o.errInfo}:o)}),r,n),[2])}}))}))},e.getDevices=function(e,t){void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){for(var r=[],o=[],i=[],n=0;n<t.length;n++){var s=t[n];"audioinput"===s.kind&&r.push({deviceName:s.label,deviceID:s.deviceId}),"audiooutput"===s.kind&&o.push({deviceName:s.label,deviceID:s.deviceId}),"videoinput"===s.kind&&i.push({deviceName:s.label,deviceID:s.deviceId})}e&&e({microphones:r,speakers:o,cameras:i})})).catch((function(e){console.error("enumerate devices wrong "+e),t&&t(s.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kEnumDevicesError)})):t&&t(s.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kBrowserNotSupportError)},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var o=0;o<r;o++){var i=parseInt(e[o]),n=parseInt(t[o]);if(i>n)return 1;if(i<n)return-1}return 0},e.isSupportLive=function(e,t){var r=wx.getSystemInfoSync().SDKVersion,o={code:0,msg:""};this.compareVersion(r,"1.7.0")<0&&(o={code:10001,msg:"当前微信版本过低，无法使用相关组件"},e&&e(o)),wx.getSetting({success:function(t){var r=t.authSetting;r["scope.camera"]&&r["scope.record"]||(o={code:10002,msg:"需要摄像头和录音功能的授权"}),e&&e(o)},fail:function(e){console.error("get setting error",e),t&&t(e)}})},e.supportVideoCodeType=function(e,t,r){return o(this,void 0,void 0,(function(){var o,n,s,c,l,d,u,h,p,g;return i(this,(function(i){switch(i.label){case 0:return o={webRTC:!1,H264:!1,VP8:!1,VP9:!1,H265:!1},r?1!==t||"VP8"!==r&&"H264"!==r?[3,2]:[4,(g=new a.CheckModule).checkSupportByType(r)]:[3,2];case 1:return"boolean"==typeof(n=i.sent())?(o[r]=n,[2,e(o)]):(o[r]=!1,[2,e(o,n)]);case 2:if("webRTC"!==r&&1!==t)return[3,7];i.label=3;case 3:return i.trys.push([3,5,,6]),[4,(new RTCPeerConnection).createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})];case 4:return i.sent(),o.webRTC=!0,[3,6];case 5:return s=i.sent(),e&&e(o,s),[3,6];case 6:if("webRTC"===r)return[2,e(o)];i.label=7;case 7:if(1===t){for(c="",d=[],u=0,h=l=["VP8","H264"];u<h.length;u++)p=h[u],g=new a.CheckModule,d.push(g.checkSupportByType(p));return Promise.all(d).then((function(t){t.forEach((function(e,t){"boolean"==typeof e?o[l[t]]=!0:(o[l[t]]=!1,c=e)})),c?e(o,c):e(o)})),[2]}try{(new RTCPeerConnection).createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){if(o.webRTC=!0,t&&t.sdp){var i=t.sdp.split("\r\n");if(o.H264=i.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H264/")>-1})),"H264"===r)return e(o);if(o.VP8=i.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP8/")>-1})),"VP8"===r)return e(o);o.VP9=i.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP9/")>-1})),o.H265=i.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H265/")>-1})),e&&e(o)}}))}catch(t){e&&e(o,t)}return[2]}}))}))},e.getPublisherStateType=function(e){return 0==e||1==e?0==e?"PUBLISHING":"NO_PUBLISH":"PUBLISH_REQUESTING"},e.getPlayerStateType=function(e){return 0==e||1==e?0==e?"PLAYING":"NO_PLAY":"PLAY_REQUESTING"},e.getSteamUpdateType=function(e){return 0==e?"DELETE":"ADD"},e.checkScreenParams=function(t,r){if("object"==typeof t&&void 0!==t.videoQuality&&!e.checkInteger(t.videoQuality))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," videoQuality must be integer number"),!1;if("object"==typeof t&&void 0!==t.sourceID&&"string"!=typeof t.sourceID)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," sourceID must be string"),!1;if("object"==typeof t&&4===t.videoQuality){if(void 0===t.bitRate)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate is required when videoQuality is 4"),!1;if(!e.checkInteger(t.bitRate))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number"),!1;if(t.bitRate>10240)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps"),!1;if(void 0===t.frameRate)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate is required when videoQuality is 4"),!1;if(!e.checkInteger(t.frameRate))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate must be integer number"),!1;if(void 0===t.width)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width is required when videoQuality is 4"),!1;if(!e.checkInteger(t.width))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width must be integer number"),!1;if(void 0===t.height)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height is required when videoQuality is 4"),!1;if(!e.checkInteger(t.height))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height must be integer number"),!1}return!0},e.checkCameraParams=function(t,r){return t.width&&e.checkValidNumber(t.width)?t.height&&e.checkValidNumber(t.height)?t.frameRate&&e.checkValidNumber(t.frameRate)?!(!t.bitRate||!e.checkValidNumber(t.bitRate))||(r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number"),!1):(r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate must be integer number"),!1):(r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height must be integer number"),!1):(r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width must be integer number"),!1)},e.isParamEmpty=function(e){return null!=e&&""!==e},e.isTypeString=function(e){return"string"==typeof e},e.isTooLong=function(e,t){return!(e.length>=t)},e.isReDispatch=function(e){var t=e.message.match(/action:(\d+)/),r=t?Number(t[1]):NaN;return[s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kTTLOverTimeError,s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kClientIPChangedError,s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kTTLOverTimeError,s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kClientIPChangedError].includes(e)||[6].includes(r)},e.arrAvg=function(e,t,r){return e.push(t),e.length>r&&e.shift(),e.reduce((function(e,t){return e+t}))/e.length},e.getNetQuality=function(e,t,r){return void 0!==r?.15*this.calcQualityOfJitter(r)+.85*Math.min(this.calcQualityOfRtt(e),this.calcQualityOfLostRate(t,!1)):Math.min(this.calcQualityOfRtt(e),this.calcQualityOfLostRate(t,!0))},e.calcQualityOfRtt=function(e){return e<600?97-Math.pow(.09*e,1.1):18*Math.exp(.002*(600-e))},e.calcQualityOfJitter=function(e){return e<=50?98-Math.pow(e,1.15):n.QUALITY_CONSTANT.PoorMinQuality},e.calcQualityOfLostRate=function(e,t){if(t){var r=e;return r<=55?99-Math.pow(.8*r,1.18):n.QUALITY_CONSTANT.PoorMinQuality}var o=100*e;return o<=40?96-Math.pow(o,1.22):n.QUALITY_CONSTANT.PoorMinQuality},e.quality2QualityGrade=function(e){return n.QualityGrade.Unknown,e>=n.QUALITY_CONSTANT.ExcellentMinQuality?n.QualityGrade.Excellent:e>=n.QUALITY_CONSTANT.GoodMinQuality?n.QualityGrade.Good:e>=n.QUALITY_CONSTANT.MiddleMinQuality?n.QualityGrade.Middle:e>=n.QUALITY_CONSTANT.PoorMinQuality?n.QualityGrade.Poor:n.QualityGrade.Die},e}();t.ClientUtil=c},6502:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryHandler=void 0;var r=function(){function e(){this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}return e.prototype.init=function(e,t,r,o){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof r&&(this.RETRY_CONTINUE_COUNT=r),"number"==typeof o&&(this.RETRY_MAX_TIME_INTERVAL=o)},e.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},e}();t.RetryHandler=r},4767:function(e,t){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<r;t++)for(var n=arguments[t],s=0,a=n.length;s<a;s++,i++)o[i]=n[s];return o};Object.defineProperty(t,"__esModule",{value:!0}),t.SdpUtil=void 0;var o=function(){function e(){}return e.zegoSdp=function(e){var t=e.split("\r\n"),o=[],i=[];t.forEach((function(e){var t=e.match(/a=rtpmap:(\d+)\s+((H264\/90000)|(opus\/48000\/2))/);t&&t[1]&&t[2]&&("H264/90000"===t[2]&&o.push(t[1]),"opus/48000/2"===t[2]&&i.push(t[1]))}));var n=[];return t.map((function(e){var t=!0,s=e.match(/((a=rtcp-fb:)|(a=rtpmap:)|(a=fmtp:))(\d+)/);if(s&&s[5]&&(r(o,i).some((function(e){return e==s[5]}))||(t=!1)),e.indexOf("m=video")>-1){var a=e.split(" ");e=r([a[0],a[1],a[2]],o).join(" ")}else e.indexOf("m=audio")>-1&&(a=e.split(" "),e=r([a[0],a[1],a[2]],i).join(" "));t&&n.push(e)})),n.join("\r\n")},e.getSDPByVideDecodeType=function(e,t,o){var i={str:"",arr:[],obj:{H264:[],H265:[],VP8:[],VP9:[],OTHER:[]}};if(!e.includes("m=video"))return e;var n=/m=video.+/.exec(e)[0];n=n.match(/[\s|\d]+/g)[1].replace(" ",""),i.str=n,i.arr=i.str.split(" "),i.arr.forEach((function(t){var r=new RegExp("a=rtpmap:"+t+".+").exec(e)[0];r.includes("H264")?i.obj.H264.push(t):r.includes("H265")?i.obj.H265.push(t):r.includes("VP8")?i.obj.VP8.push(t):r.includes("VP9")?i.obj.VP9.push(t):i.obj.OTHER.push(t)})),i.obj.OTHER.forEach((function(t){var r=new RegExp("a=fmtp:"+t+".+apt=(\\d+)").exec(e),o=r&&r[1];o&&(i.obj.H264.includes(o)?i.obj.H264.push(t):i.obj.H265.includes(o)?i.obj.H265.push(t):i.obj.VP8.includes(o)?i.obj.VP8.push(t):i.obj.VP9.includes(o)&&i.obj.VP9.push(t))}));var s=[];if("VP9"===t?s=r(i.obj.H265,i.obj.H264,i.obj.VP8):"VP8"===t?s=r(i.obj.H265,i.obj.H264,i.obj.VP9):"H264"===t?s=r(i.obj.H265,i.obj.VP8,i.obj.VP9):"H265"===t&&(s=r(i.obj.VP8,i.obj.H264,i.obj.VP9)),o&&"H264"==t){var a=[];i.obj.H264.forEach((function(t){var r=new RegExp("a=fmtp:"+t+".+\\s\\n","g").exec(e);(null==r?void 0:r.find((function(e){return e.includes("profile-level-id=42e01f")})))||a.push(t)})),a.length==i.obj.H264.length&&(a=[]),s=s.concat(a)}return s.forEach((function(t){var r=i.arr.indexOf(t);i.arr.splice(r,1);var o=new RegExp("a=rtpmap:"+t+".+\\s\\n","g"),n=new RegExp("a=rtcp-fb:"+t+".+\\s\\n","g"),s=new RegExp("a=fmtp:"+t+".+\\s\\n","g");e=(e=(e=e.replace(o,"")).replace(n,"")).replace(s,"")})),e=e.replace(n,i.arr.join(" "))},e}();t.SdpUtil=o},5321:function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoWebRTC=void 0;var s=r(6706),a=r(608),c=r(7325),l=r(1089),d=r(3529),u=r(908),h=r(3409),p=r(7560),g=r(1547),f=n(r(5515)),m=r(3770),_=r(4865),E=r(361),T=r(5019),S=r(9595),v=r(9595),R=function(){function e(e,t,r,o){var i=this;void 0===o&&(o=0),this.mediaEleSources=[],this.logger=e,this.dataReport=t,this.ac=new("undefined"!=typeof webkitAudioContext?webkitAudioContext:AudioContext),this.checkAudioContext(),this.stateCenter=new c.StateCenter(this.logger,this.dataReport),this.stateCenter.clientType="webrtc",this.stateCenter.type=2===o?"PRIVATE":"PUBLIC",this.RTM=r,this.streamCenter=new h.ZegoStreamCenterWeb(this.logger,this.stateCenter,this.dataReport,this.RTM,this.ac,this.mediaEleSources),this.rtcModules=new u.RTCModules(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.RTM,this.ac),this.stateCenter.getSeq=s.getSeq,this.stateCenter.getReportSeq=s.getReportSeq,this.stateCenter.networkState=navigator?navigator.onLine?s.ENUM_NETWORK_STATE.online:s.ENUM_NETWORK_STATE.offline:s.ENUM_NETWORK_STATE.online,this.stateCenter.browser=f.browserDetails.browser,this.stateCenter.settingConfig=new v.ZegoSettingConfig,this.RTM.cloudSetting.setEnvVariable("sdk_version",s.PROTO_VERSION),this.RTM.cloudSetting.getSettingCache(S.RTC).then((function(e){i.logger.info(l.ZEGO_WEBRTC_ACTION.CONSTRUCTOR+" streamConfig "+JSON.stringify(e));var t=s.getReportSeq();i.dataReport.newReport(t,d.ZegoRTCLogEvent.kZegoTaskCloudSettingCache.event),i.dataReport.addMsgInfo(t,{files:[{name:S.RTC,content:null==e?void 0:e.setting,versions:null==e?void 0:e.versions}]}),i.dataReport.uploadReport(t),i.stateCenter.settingConfig.setSetting(null==e?void 0:e.setting)})).catch((function(e){i.logger.warn(l.ZEGO_WEBRTC_ACTION.CONSTRUCTOR+" streamConfig "+JSON.stringify(e))}))}return e.prototype.checkAudioContext=function(){var e=this;if(this.ac&&"suspended"===this.ac.state){var t=function(){e.ac.resume(),window.removeEventListener("click",t),window.removeEventListener("touchstart",t)};window.addEventListener("click",t),window.addEventListener("touchstart",t)}},e.prototype.mutePublishStreamVideo=function(e,t,r){return!1},e.prototype.mutePublishStreamAudio=function(e,t){return!1},e.prototype.mutePlayStreamVideo=function(e,t){return new Promise((function(e,t){console.error("should install advanced module"),e(!1)}))},e.prototype.mutePlayStreamAudio=function(e,t){return new Promise((function(e,t){console.error("should install advanced module"),e(!1)}))},e.prototype.muteMicrophone=function(e){return!1},e.prototype.isMicrophoneMuted=function(){return!this.streamCenter.isMicEnabled},e.prototype.setAudioOutput=function(e,t){return this.logger.info(l.ZEGO_WEBRTC_ACTION.SET_AUDIO_OUTPUT+" call"),"string"!=typeof t?(this.logger.error("audiooutput is not string"),!1):this.rtcModules.playModule.setStreamAudioOutput(e,t)},e.prototype.setCustomSignalUrl=function(e){if(this.logger.info(l.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" call: "+e),e&&0!=e.length){var t=!0;e.forEach((function(e){return 0!=e.indexOf("wss://")&&(t=!1)})),t?this.stateCenter.customUrl=e:this.logger.error(l.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" url is not correct")}else this.logger.error(l.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" param error")},e.prototype.setQualityMonitorCycle=function(e){return"number"==typeof e&&e>=1e3?(this.streamCenter.setQualityMonitorCycle(e),!0):(this.logger.error("zc.sqmc.0 time must be number and bigger than 1000"),!1)},e.prototype.startPlayingStream=function(e,t,r){return this.logger.info(l.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" call by user"),this.rtcModules.playModule.startPlayingStream(e,t,r)},e.prototype.stopPlayingStream=function(e){this.logger.info(l.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call by user"),this.rtcModules.playModule.stopPlayingStream(e)},e.prototype.setTurnOverTcpOnly=function(e){this.logger.info(l.ZEGO_WEBRTC_ACTION.SET_TURN_OVER_TCP_ONLY+" call "+e),"boolean"==typeof e?this.stateCenter.turnOverTcpOnly=e:this.logger.error("zc.p.stoto.0 param must be param")},e.prototype.createStream=function(e){return this.rtcModules.publishModule.createStream(e)},e.prototype.destroyStream=function(e){this.rtcModules.publishModule.destroyStream(e)},e.prototype.startPublishingStream=function(e,t,r,o){return this.logger.info(l.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" call by user"),this.rtcModules.publishModule.startPublishingStream(e,t,r,o)},e.prototype.activateSEIInsert=function(e){return console.error("should install advanced module"),!1},e.prototype.stopPublishingStream=function(e){return this.logger.info(l.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" call by user"),this.rtcModules.publishModule.stopPublishingStream(e)},e.prototype.setVideoConfig=function(e,t){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.setVideoConfig(e,t):new Promise((function(e,t){console.error("should install advanced module"),e({errorCode:-1,extendedData:"should install advanced module"})}))},e.prototype.setAudioConfig=function(e,t){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.setAudioConfig(e,t):new Promise((function(e,t){console.error("should install advanced module"),e({errorCode:-1,extendedData:"should install advanced module"})}))},e.prototype.replaceTrack=function(e,t){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.replaceTrack(e,t):new Promise((function(e,t){console.error("should install advanced module"),e({errorCode:-1,extendedData:"should install advanced module"})}))},e.prototype.preloadEffect=function(e,t,r){void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.preloadEffect(e,t,r):console.error("未引入混音模块")},e.prototype.playEffect=function(e,t,r){void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.playEffect(e,t,r):console.error("未引入混音模块")},e.prototype.pauseEffect=function(e,t){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.pauseEffect(e,t):(console.error("未引入混音模块"),!1)},e.prototype.resumeEffect=function(e,t){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.resumeEffect(e,t):(console.error("未引入混音模块"),!1)},e.prototype.stopEffect=function(e,t){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.stopEffect(e,t):(console.error("未引入混音模块"),!1)},e.prototype.unloadEffect=function(e){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.unloadEffect(e):(console.error("未引入混音模块"),!1)},e.prototype.setEffectVolume=function(e,t,r){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.setEffectVolume(e,t,r):(console.error("未引入混音模块"),!1)},e.prototype.startMixingAudio=function(e,t){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.startMixingAudio(e,t):(console.error("未引入混音模块"),!1)},e.prototype.stopMixingAudio=function(e,t){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.stopMixingAudio(e,t):(console.error("未引入混音模块"),!1)},e.prototype.mixingBuffer=function(e,t,r,o){void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.mixingBuffer(e,t,r,o):console.error("未引入混音模块")},e.prototype.stopMixingBuffer=function(e,t){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.stopMixingBuffer(e,t):(console.error("未引入混音模块"),!1)},e.prototype.setMixingAudioVolume=function(e,t,r){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.setMixingAudioVolume(e,t,r):(console.error("未引入混音模块"),!1)},e.prototype.checkSystemRequirements=function(t,r){var o=this,i=navigator&&navigator.mediaDevices&&(e.screenShotReady||"getDisplayMedia"in navigator.mediaDevices);return this.logger.info(l.ZEGO_WEBRTC_ACTION.CHECK_SUPPORT+" call"+navigator.userAgent),new Promise((function(e){var n=s.getReportSeq();o.dataReport.newReport(n,d.ZegoRTCLogEvent.kZegoTaskCheckSystemRequirements.event);var c=r||"all",l=function(t){o.dataReport.addMsgInfo(n,{capability:d.ZegoRTCLogEvent.kZegoTaskCheckSystemRequirements.capability(t)}),o.dataReport.uploadReport(n);var r=o.stateCenter.checkList.indexOf(c);o.stateCenter.checkList.splice(r,1),e(t)};return["webRTC","customCapture","camera","microphone","screenSharing","H264","VP8","all"].includes(c)&&[0,1].includes(t)?o.stateCenter.checkList.includes(c)||o.stateCenter.checkList.includes("all")?l({result:!1,errInfo:{extendedDate:"The last test of the same type has not returned a result "}}):(o.stateCenter.checkList.push(c),void a.ClientUtil.supportDetection(i,l,t,r)):l({result:!1,errInfo:{extendedDate:"param error"}})}))},e.prototype.enumDevices=function(){var e=this;return this.logger.info("zc.ed.0 call"),new Promise((function(t,r){var o=s.getReportSeq();e.dataReport.newReport(o,d.ZegoRTCLogEvent.kZegoTaskEnumDevices.event),e.rtcModules.publishModule.recordDevices((function(r){var i=[];r.cameras.forEach((function(e){return i.push({device:e.deviceName,type:0})})),r.microphones.forEach((function(e){return i.push({device:e.deviceName,type:1})})),r.speakers.forEach((function(e){return i.push({device:e.deviceName,type:2})})),e.dataReport.addMsgInfo(o,{dev_list:d.ZegoRTCLogEvent.kZegoTaskEnumDevices.dev_list(i)}),e.dataReport.uploadReport(o),t(r)}),(function(t){e.dataReport.addMsgInfo(o,t),e.dataReport.uploadReport(o),r(t)}))}))},e.prototype.getAudioInfo=function(e,t,r){},e.prototype.getSoundLevel=function(e,t,r){this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.getSoundLevel(e,t,r):console.error("未引入混音模块")},e.prototype.stopSoundLevel=function(e){this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.stopSoundLevel(e):console.error("未引入混音模块")},e.handleDataAvailable=function(t){t.data&&t.data.size>0&&e.recordedBlobs.push(t.data)},e.prototype.startRecord=function(e){},e.prototype.stopRecord=function(){},e.prototype.resumeRecord=function(){},e.prototype.pauseRecord=function(){},e.prototype.saveRecord=function(e){},e.prototype.takeSnapShot=function(e,t){},e.prototype.saveSnapShot=function(e,t){},e.prototype.useVideoDevice=function(e,t){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.useVideoDevice(e,t):new Promise((function(e,t){e({errorCode:-1,extendedData:"should install advanced module"})}))},e.prototype.useAudioDevice=function(e,t){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.useAudioDevice(e,t):(console.error("should use advanced module first"),new Promise((function(e,t){e({errorCode:-1,extendedData:"should install advanced module"})})))},e.prototype.getElectronScreenSources=function(){return this.rtcModules.publishModule.getElectronScreenSources()},e.prototype.setSoundLevelDelegate=function(e,t){this.logger.info("zc.ssd.0 call"),"boolean"==typeof e?t&&(!this.stateCenter.checkInteger(t)||t<100||t>3e3)?this.logger.error("zc.ssd.0 soundLevel interval must be integer number which is between 100 and 3000"):this.streamCenter.setSoundLevelDelegate(e,t):this.logger.error("zc.ssd.0 param 1 must be boolean")},e.prototype.on=function(e,t){return this.rtcModules.bindListener(e,t)},e.prototype.off=function(e,t){return this.rtcModules.deleteListener(e,t)},e.prototype.getVersion=function(){return s.PROTO_VERSION},e.prototype.setStreamExtraInfo=function(e,t){return new Promise((function(e,t){console.error("should use advanced module first"),t()}))},e.prototype.addPublishCdnUrl=function(e,t){return this.logger.info("zg.cm.apu call ",e,t),this.rtcModules.advancedModule?this.rtcModules.advancedModule.publishTarget({type:"addpush",streamID:e,pushUrl:t}):new Promise((function(e,t){console.error("should install advanced module"),e({errorCode:-1,extendedData:"should install advanced module"})}))},e.prototype.removePublishCdnUrl=function(e,t){return this.logger.info("zg.cm.apu call ",e,t),this.rtcModules.advancedModule?this.rtcModules.advancedModule.publishTarget({type:"delpush",streamID:e,pushUrl:t}):new Promise((function(e,t){console.error("should install advanced module"),e({errorCode:-1,extendedData:"should install advanced module"})}))},e.prototype.startMixerTask=function(e){return new Promise((function(e,t){console.error("未引入混流模块"),t()}))},e.prototype.setMixerTaskConfig=function(e){return new Promise((function(e,t){console.error("未引入混流模块"),t()}))},e.prototype.stopMixerTask=function(e){return new Promise((function(e,t){console.error("未引入混流模块"),t()}))},e.prototype.setCaptureVolume=function(e,t){return this.rtcModules.publishModule.setCaptureVolume(e,t)},e.prototype.getRoomInfo=function(){var e=this.stateCenter.roomList[0];return null==e?void 0:e.streamHandler.getRoomInfo()},e.use=function(t){switch(t.type){case"AudioMix":t.install(u.RTCModules,g.ZegoPublish);break;case"MixStream":t.install(e,p.StreamHandler,u.RTCModules);break;case"Advance":t.install(e,u.RTCModules,p.StreamHandler,m.ZegoPreview,_.PlayModule,E.PublishModule,g.ZegoPublish,T.ZegoSignal);break;case"RangeAudio":case"DataChannel":t.install(e)}},e.prototype.createRangeAudioInstance=function(){throw new Error("should use rangeaudio module")},e.prototype.createRealTimeSequentialDataManager=function(e){throw new Error("should use datachannel module")},e.prototype.destroyRealTimeSequentialDataManager=function(e){throw new Error("should use datachannel module")},e.screenShotReady=!1,e}();t.ZegoWebRTC=R,window.addEventListener("message",(function(e){var t=e.data.type,r=e.origin;r!==window.location.origin&&console.warn("ScreenStream: you should discard foreign event from origin:",r),"SS_PING"===t&&(R.screenShotReady=!0)}))},4395:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.CheckModule=void 0;var n=r(4767),s=function(){function e(){var e=this;this.iceconnectionstatechangeTimes=0,this.isCheckAll=!1;var t=document.createElement("canvas");t.getContext("2d").fillStyle="rgba(255, 255, 255, 0)";try{this.localStream=t.captureStream()}catch(e){console.error("canvas captureStream error",e)}this.timer=setTimeout((function(){e.resolve("Detection timeout"),e.hangup()}),5e3)}return e.prototype.checkSupportByType=function(e){return o(this,void 0,void 0,(function(){var t,r,o=this;return i(this,(function(i){switch(i.label){case 0:return this.checkType=e,t={},this.localPc=new RTCPeerConnection(t),this.remotePc=new RTCPeerConnection(t),r=new Promise((function(e){return o.resolve=e})),this.localPc.addEventListener("icecandidate",(function(e){return o.onIceCandidate(o.localPc,e)})),this.remotePc.addEventListener("icecandidate",(function(e){return o.onIceCandidate(o.remotePc,e)})),this.remotePc.addEventListener("iceconnectionstatechange",(function(t){"connected"===o.remotePc.iceConnectionState&&(o.iceconnectionstatechangeResult=!0),2==++o.iceconnectionstatechangeTimes&&o.iceCandidate&&(clearTimeout(o.timer),"connected"===o.remotePc.iceConnectionState?o.resolve(!0):o.resolve("The browser does not support "+e+" format"),o.hangup())})),this.localStream.getTracks().forEach((function(e){return o.localPc.addTrack(e,o.localStream)})),[4,this.check(e)];case 1:return i.sent(),[4,r];case 2:return[2,i.sent()]}}))}))},e.prototype.check=function(e){return o(this,void 0,void 0,(function(){var t,r;return i(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.localPc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})];case 1:return(t=o.sent()).sdp=n.SdpUtil.getSDPByVideDecodeType(t.sdp,e),this.onCreateOfferSuccess(t),[3,3];case 2:return r=o.sent(),this.onCreateSessionDescriptionError(r),[3,3];case 3:return[2]}}))}))},e.prototype.onCreateOfferSuccess=function(e){return o(this,void 0,void 0,(function(){var t,r,o,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.localPc.setLocalDescription(e)];case 1:return i.sent(),[3,3];case 2:return t=i.sent(),this.onSetSessionDescriptionError(t),[2];case 3:return i.trys.push([3,5,,6]),[4,this.remotePc.setRemoteDescription(e)];case 4:return i.sent(),[3,6];case 5:return r=i.sent(),this.onSetSessionDescriptionError(r),[2];case 6:return i.trys.push([6,9,,10]),[4,this.remotePc.createAnswer()];case 7:return o=i.sent(),[4,this.onCreateAnswerSuccess(o)];case 8:return i.sent(),[3,10];case 9:return n=i.sent(),this.onCreateSessionDescriptionError(n),[2];case 10:return[2]}}))}))},e.prototype.onCreateAnswerSuccess=function(e){return o(this,void 0,void 0,(function(){var t,r;return i(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.remotePc.setLocalDescription(e)];case 1:return o.sent(),[3,3];case 2:return t=o.sent(),this.onSetSessionDescriptionError(t),[2];case 3:return o.trys.push([3,5,,6]),[4,this.localPc.setRemoteDescription(e)];case 4:return o.sent(),[3,6];case 5:return r=o.sent(),this.onSetSessionDescriptionError(r),[2];case 6:return[2]}}))}))},e.prototype.onIceCandidate=function(e,t){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.getOtherPc(e).addIceCandidate(t.candidate)];case 1:return o.sent(),[3,3];case 2:return r=o.sent(),console.error(this.checkType,this.getPcName(e)+" addIceCandidate error",r),clearTimeout(this.timer),this.hangup(),this.resolve(r),[3,3];case 3:return"remotePc"===this.getPcName(e)&&t.candidate&&(this.iceCandidate=!0),this.iceconnectionstatechangeResult&&"localPc"===this.getPcName(e)&&(clearTimeout(this.timer),this.hangup(),this.resolve(!0)),[2]}}))}))},e.prototype.getOtherPc=function(e){return e===this.localPc?this.remotePc:this.localPc},e.prototype.getPcName=function(e){return e===this.localPc?"localPc":"remotePc"},e.prototype.onCreateSessionDescriptionError=function(e){console.error("Failed to create session description: "+e.toString()),clearTimeout(this.timer),this.hangup(),this.resolve(e)},e.prototype.onSetSessionDescriptionError=function(e){console.error("Failed to set session description: "+e.toString()),clearTimeout(this.timer),this.hangup(),this.resolve(e)},e.prototype.hangup=function(){this.localPc.close(),this.remotePc.close(),this.iceconnectionstatechangeTimes=0,this.localStream.getTracks().forEach((function(e){return e.stop()}))},e}();t.CheckModule=s},8493:function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},o(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryDispatchHandler=void 0;var n=r(6502),s=r(6706),a=r(1089),c=r(3529),l=r(2752),d=function(e){function t(t,r,o,i){var n=e.call(this)||this;return n.retryActiveCount=1,n.RETRY_MAX_TIME=90,n.logger=t,n.stateCenter=r,n.rtm=o,n.streamCenter=i,n}return i(t,e),t.prototype.initStream=function(e,t,r){this.streamID=e,this.playOption=t,this.isPublish=r},t.prototype.active=function(e){var t=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" retry call "+this.streamID),this.stateCenter.networkState==s.ENUM_NETWORK_STATE.offline)return this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" has active, ignore"),!1;if(this.isOverTime)return this.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" retry over time, stop retry"),!1;this.rtm.isLogin()||(this.stopMaxTime(),this.invalid(),this.isPublish?this.streamCenter.publisherList[this.streamID].isReDispatch=!0:this.streamCenter.playerList[this.streamID].isReDispatch=!0);var r,o=this.retryActiveCount-1;if("PUBLIC"===this.stateCenter.type){var i=this.playOption&&2==this.playOption.resourceMode?1:0;r={stream_id:this.streamID,ptype:this.isPublish?"push":"pull",signals:this.streamCenter.getAllInUseUrl(),header_kvs:[{key:"grpc-metadata-push",value:this.playOption&&this.playOption.cdnUrl||""}],retry:o,center_ability:!0,dispatch_type:i}}else r={stream_id:this.streamID,dispatch_type:this.isPublish?1:2,stream_type:3,an_type:this.rtm.getAnType()};return this.retryTimer=setTimeout((function(){t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++;var e=t.streamCenter.getRoomByStreamID(t.streamID),o=t.rtm.service.sendMessage("webrtc_url",r,(function(e,r){t.handleFetchWebRtcUrlRsp(e)}),(function(e,r){t.handleFetchWebRtcUrlRsp(e)}),void 0,{sessionID:null==e?void 0:e.sessionID,roomID:null==e?void 0:e.roomID,roomSessionID:null==e?void 0:e.roomSessionID});t.isPublish&&o?t.streamCenter.publisherList[t.streamID]&&(t.streamCenter.publisherList[t.streamID].seq=o):o&&t.streamCenter.playerList[t.streamID]&&(t.streamCenter.playerList[t.streamID].seq=o)}),"number"==typeof e?e:1e3*this.retryActiveInterval),this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" call success"),!0},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout((function(){e.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_MAX_TIME+" "+e.streamID+" dispatch over max time "+e.RETRY_MAX_TIME+"s stop retry"),e.isOverTime=!0,e.invalid(),e.isPublish?e.streamCenter.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e.streamID,c.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError):e.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,e.streamID,c.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError)}),1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.handleFetchWebRtcUrlRsp=function(e){if(e.code&&[l.errorCodeList.TIMEOUT.code].includes(e.code))this.active();else{if(e.code&&[l.errorCodeList.SOCKET_CLOSE.code].includes(e.code))return this.stopMaxTime(),this.invalid(),void(this.isPublish?this.streamCenter.publisherList[this.streamID].isReDispatch=!0:this.streamCenter.playerList[this.streamID].isReDispatch=!0);var t=e,r=t.body.stream_id,o=!1;if(this.isPublish&&(!this.streamCenter.publisherList[r]||t.header.seq!==this.streamCenter.publisherList[this.streamID].seq))return this.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" seq is not match, ignore "+this.streamID),this.stopMaxTime(),void this.invalid();if(!(this.isPublish||this.streamCenter.playerList[this.streamID]&&t.header.seq===this.streamCenter.playerList[this.streamID].seq))return this.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" seq is not match, ignore "+this.streamID),this.stopMaxTime(),void this.invalid();if("PUBLIC"===this.stateCenter.type){if(this.stateCenter.clientIP=t.body.clientip||"",0!==t.body.err_code&&2==t.body.need_action)return this.retryActiveInterval=t.body.action_delay/1e3||Math.floor(3*Math.random())+3,void this.active();if(0!==t.body.err_code&&1!==t.body.need_action&&![3102].includes(t.body.err_code))return this.retryActiveInterval=Math.floor(3*Math.random())+3,void this.active();if(this.stopMaxTime(),this.invalid(),t.body.urls&&Array.isArray(t.body.urls)&&t.body.urls.length>0?o=!0:this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" signal url is empty"),"push"===t.body.ptype&&this.streamCenter.publisherList[r]){if(!o)return void this.streamCenter.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,r,c.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError);var i=this.streamCenter.publisherList[r];this.stateCenter.publishStreamList[r]?(i.ttl=t.body.hosts_ttl?(new Date).getTime()+1e3*t.body.hosts_ttl:0,i.isCenterNode="boolean"==typeof t.body.is_center_node&&t.body.is_center_node,i.serverUrls=t.body.urls,this.streamCenter.startPublishingStream(r)):this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" no streamid to publish")}else if("pull"==t.body.ptype&&this.streamCenter.playerList[r]){if(!o){var n=c.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError;return 3102===t.body.err_code&&(n=c.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayUnsupportedResourceMode),void this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,r,n)}(g=this.streamCenter.playerList[r]).ttl=t.body.hosts_ttl?(new Date).getTime()+1e3*t.body.hosts_ttl:0,g.isCenterNode="boolean"==typeof t.body.is_center_node&&t.body.is_center_node,g.serverUrls=t.body.urls,this.streamCenter.startPlayingStream(r,this.streamCenter.playSuccessCallBackList[r])}}else{this.stopMaxTime(),this.invalid();var d=[],u=t.body.stream_url_info&&t.body.stream_url_info.stream_url,h=t.body.stream_url_info&&t.body.stream_url_info.ip_infos,p=/^ws(s)?:\/\/(.*?)\//;if(t.body.stream_url_info&&u&&h?o=!0:this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" signal url is empty"),h&&h.forEach((function(e){var t=e.ip_address+":"+e.port;d.push(u.replace(p.exec(u)[2],t))})),this.isPublish&&this.streamCenter.publisherList[r]){if(!o)return void this.streamCenter.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,r,c.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError);i=this.streamCenter.publisherList[r],this.stateCenter.publishStreamList[r]?(i.serverUrls=d,this.streamCenter.startPublishingStream(r)):this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" no streamid to publish")}else if(!this.isPublish&&this.streamCenter.playerList[r]){if(!o)return void this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,r,c.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError);var g;(g=this.streamCenter.playerList[r]).serverUrls=d,this.streamCenter.startPlayingStream(r,this.streamCenter.playSuccessCallBackList[r])}}}},t}(n.RetryHandler);t.RetryDispatchHandler=d},6014:function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},o(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryStreamHandler=void 0;var n=r(6706),s=r(6502),a=r(3529),c=r(1089),l=r(608),d=function(e){function t(t,r,o,i){var n=e.call(this)||this;return n.logger=t,n.stateCenter=r,n.streamCenter=o,n.isPublish=i,n.serverUrls=[],n}return i(t,e),t.prototype.initStream=function(e,t){this.streamID=e,this.serverUrls=t},t.prototype.activePublish=function(e){var t=this;if(this.logger.info("zc.tsh.a retry call "+this.streamID),this.stateCenter.networkState==n.ENUM_NETWORK_STATE.offline)return this.logger.info("zc.tsh.a network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info("zc.tsh.a has active, ignore"),!1;if(this.isOverTime)return this.logger.warn("zc.tsh.a retry over time, stop retry"),!1;if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r}var o=this.streamCenter.publisherList[this.streamID].publisher,i=this.serverUrls,s=o.signal?o.signal.server:"";i.forEach((function(e,r){return r<=i.indexOf(s)&&t.serverUrls.push(e)})),i.splice(0,i.indexOf(s)+1);var a=this.serverUrls[this.retryActiveCount%this.serverUrls.length==0?this.serverUrls.length-1:this.retryActiveCount%this.serverUrls.length-1];return this.retryTimer=setTimeout((function(){t.logger.warn("zc.tsh.a stream "+t.streamID+" connect signal server "+a),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++,t.streamCenter.connectPublishServer(t.streamID,a)}),"number"==typeof e?e:1e3*this.retryActiveInterval),this.logger.info("zc.tsh.a call success"),!0},t.prototype.activePull=function(e,t){var r=this;if(this.logger.info("zc.tsh.a retry call "+this.streamID),t&&(this.playStreamSuccess=t),this.stateCenter.networkState==n.ENUM_NETWORK_STATE.offline)return this.logger.info("zc.tsh.a network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info("zc.tsh.a has active, ignore"),!1;if(this.isOverTime)return this.logger.warn("zc.tsh.a retry over time, stop retry"),!1;if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var o=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=o>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:o}var i=this.streamCenter.playerList[this.streamID].player,s=this.serverUrls,a=i.signal?i.signal.server:"";s.forEach((function(e,t){return t<=s.indexOf(a)&&r.serverUrls.push(e)})),s.splice(0,s.indexOf(a)+1);var c=this.serverUrls[this.retryActiveCount%this.serverUrls.length==0?this.serverUrls.length-1:this.retryActiveCount%this.serverUrls.length-1];return this.retryTimer=setTimeout((function(){r.logger.warn("zc.tsh.a stream "+r.streamID+" connect signal server "+c),r.retryTimer&&clearTimeout(r.retryTimer),r.retryTimer=null,r.retryActiveCount++,r.streamCenter.connectPlayServer(r.streamID,r.playStreamSuccess,c)}),"number"==typeof e?e:1e3*this.retryActiveInterval),this.logger.info("zc.tsh.a call success"),!0},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout((function(){if(e.logger.warn(e.streamID+" over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.invalid(),e.isPublish){if(!e.streamCenter.publisherList[e.streamID])return void e.logger.info("zc.tsh.smt streamID "+e.streamID+" publish no found");e.publishStateHandle(n.ENUM_PUBLISH_STATE_UPDATE.error,e.streamID,a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishRetryTimeoutError,!0)}else{if(!e.streamCenter.playerList[e.streamID])return void e.logger.info("zc.tsh.smt streamID "+e.streamID+" play no found");e.playStateHandle(n.ENUM_PLAY_STATE_UPDATE.error,e.streamID,a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRetryTimeoutError,!0)}}),1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.retryNextSignal=function(e){if(this.stateCenter.networkState==n.ENUM_NETWORK_STATE.offline)return!0;if(this.isPublish){var t=this.streamCenter.publisherList[this.streamID];if(t.publisher.state==n.ENUM_PUBLISH_STATE.stop&&[a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError.code,a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNegoTimeoutError.code].includes(e.code))return!0;if(t.isCenterNode&&t.publisher.signal&&t.publisher.signal.websocket&&1==t.publisher.signal.websocket.readyState)return!1;if(!t.isCenterNode&&[a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError.code].includes(e.code)){var r=(o=e.message.match(/reason:(\d+)/))?o[1]:"";return!["26"].includes(r)}return!0}var o,i=this.streamCenter.playerList[this.streamID];return!((i.player.state!=n.ENUM_PLAY_STATE.stop||![a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError.code,a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNegoTimeoutError.code].includes(e.code))&&(i.isCenterNode&&i.player.signal&&i.player.signal.websocket&&1==i.player.signal.websocket.readyState||!i.isCenterNode&&[a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError.code].includes(e.code)&&(r=(o=e.message.match(/reason:(\d+)/))?o[1]:"",["24","26","28"].includes(r))))},t.prototype.publishStateHandle=function(e,t,r,o){this.logger.info(c.ZEGO_WEBRTC_ACTION.PUBLISH_STATE_HANDLE+" call "+t+" "+(r?r.code+"":""));var i=o||this.RETRY_MAX_TIME<3;if(!i&&r&&(l.ClientUtil.isReDispatch(r)||0==this.serverUrls.length))return this.stopMaxTime(),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,void this.streamCenter.onPublishStateUpdate(e,t,r);var s=this.streamCenter.publisherList[t],d=s.publisher;if(!i&&r&&0!==r.code){!this.maxTimer&&!i&&this.startMaxTime(),this.stateCenter.publishStreamList[t].state=n.ENUM_PUBLISH_STREAM_STATE.retryPublish;var u=d.localStream,h=d.videoInfo,p=d.mediaStreamConfig,g=d.publishOption;if(0!=d.sessionId&&d.signal&&d.shouldSendCloseSession()&&(d.signal.sendCloseSession(n.getSeq(),d.sessionId,1),d.signal.removeSession(d.sessionId),d.closeSessionSignal=!0),d.resetPublish(),!i&&!this.retryNextSignal(r)){if(s.isCenterNode&&d.gwNodeTTL<(new Date).getTime()&&0!==d.gwNodeList.length)d.gwNode="",d.gwNodeList=[],d.gwNodeTTL=0;else if(s.isCenterNode){var f=d.gwNodeList.findIndex((function(e){return e==d.gwNode}));d.gwNode=d.gwNodeList[++f%d.gwNodeList.length]}return void setTimeout((function(){d.startPublish(t,u,h,p,g)}),3e3)}this.streamCenter.removeStreamFromSignal(!0,t)}if(i)return this.stopMaxTime(),this.invalid(),1===e&&d.resetPublish(),void this.streamCenter.onPublishStateUpdate(e,t,r);if(r&&0!==r.code&&this.activePublish(void 0)){var m=n.getReportSeq();this.streamCenter.dataReport.newReport(m),this.streamCenter.dataReport.addMsgInfo(m,{stream:a.ZegoRTCLogEvent.kZegoTaskRePublish.stream(this.streamID)}),this.streamCenter.dataReport.uploadReport(m,a.ZegoRTCLogEvent.kZegoTaskRePublish.event),this.streamCenter.onPublishStateUpdate(2,t,r)}this.logger.info(c.ZEGO_WEBRTC_ACTION.PUBLISH_STATE_HANDLE+" end "+t)},t.prototype.playStateHandle=function(e,t,r,o){this.logger.info(c.ZEGO_WEBRTC_ACTION.PLAY_STATE_HANDLE+" call "+t+" "+(r?r.code+"":""));var i=o||this.RETRY_MAX_TIME<3;if(!i&&r&&(l.ClientUtil.isReDispatch(r)||0==this.serverUrls.length))return this.stopMaxTime(),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,void this.streamCenter.onPlayStateUpdate(e,t,r);if(r&&0!==r.code){!this.maxTimer&&!i&&this.startMaxTime();var s=this.streamCenter.playerList[t],d=s.player,u=d.playOption;if(0!=d.sessionId&&d.signal&&d.shouldSendCloseSession()&&(d.signal.sendCloseSession(n.getSeq(),d.sessionId,1),d.signal.removeSession(d.sessionId),d.closeSessionSignal=!0),d.resetPlay(),!i&&!this.retryNextSignal(r)){if(s.isCenterNode&&d.gwNodeTTL<(new Date).getTime()&&0!==d.gwNodeList.length)d.gwNode="",d.gwNodeList=[],d.gwNodeTTL=0;else if(s.isCenterNode){var h=d.gwNodeList.findIndex((function(e){return e==d.gwNode}));d.gwNode=d.gwNodeList[++h%d.gwNodeList.length]}return void setTimeout((function(){d.startPlay(t,d.getRemoteStreamSuc,u)}),3e3)}this.streamCenter.removeStreamFromSignal(!1,t)}if(i)return this.stopMaxTime(),this.invalid(),void this.streamCenter.onPlayStateUpdate(e,t,r);if(r&&0!==r.code&&this.activePull(void 0)){var p=n.getReportSeq();this.streamCenter.dataReport.newReport(p),this.streamCenter.dataReport.addMsgInfo(p,{stream:a.ZegoRTCLogEvent.kZegoTaskRePlay.stream(this.streamID)}),this.streamCenter.dataReport.uploadReport(p,a.ZegoRTCLogEvent.kZegoTaskRePlay.event),this.streamCenter.onPlayStateUpdate(2,t,r)}this.logger.info(c.ZEGO_WEBRTC_ACTION.PLAY_STATE_HANDLE+" end "+t)},t}(s.RetryHandler);t.RetryStreamHandler=d},908:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.RTCModules=void 0;var n=r(6706),s=r(3529),a=r(608),c=r(7560),l=r(361),d=r(4865),u=r(1089),h=r(2752),p=r(9595),g=function(){function e(e,t,r,o,i,n){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=i,this.ac=n,this.mediaEleSources=[],this.publishModule=new l.PublishModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.playModule=new d.PlayModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.initAdvance(),this.initAudioMix(),this.init()}return e.prototype.init=function(){this.bindWindowListener(),this.bindRTMListener(),this.bindStreamCenterHandler()},e.prototype.initAudioMix=function(){},e.prototype.initAdvance=function(){},e.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),r=this.stateCenter.browser,o=t?"pagehide":"firefox"===r?"beforeunload":"unload";window.addEventListener(o,(function(){for(var t in window.event&&(window.event.cancelBubble=!0),e.streamCenter.publisherList)e.publishModule.stopPublishingStream(t);for(var t in e.streamCenter.playerList)e.playModule.stopPlayingStream(t)})),window.addEventListener("message",(function(t){var r=t.data,o=r.type,i=r.streamId,n=r.canRequestAudioTrack;"SS_DIALOG_SUCCESS"===o&&e.screenStreamFrom(i,n,a.ClientUtil.actionSuccessCallback("screenShare",e.stateCenter.callbackList)),"SS_DIALOG_CANCEL"===o&&a.ClientUtil.actionSuccessCallback("screenShare",e.stateCenter.callbackList)(!1,null,o)})),window.addEventListener("offline",(function(){for(var t in e.logger.info("zc.off.0 newtwork is broken"),e.stateCenter.networkState=n.ENUM_NETWORK_STATE.offline,e.streamCenter.publisherList)(r=e.streamCenter.publisherList[t].retryStreamHandler).startMaxTime(),r.invalid();for(var t in e.streamCenter.playerList){var r;(r=e.streamCenter.playerList[t].retryStreamHandler).startMaxTime(),r.invalid()}})),window.addEventListener("online",(function(t){for(var r in e.logger.info("zc.on.0 network is online"),e.stateCenter.networkState=n.ENUM_NETWORK_STATE.online,e.streamCenter.publisherList){var o=e.streamCenter.publisherList[r].publisher,i=e.streamCenter.publisherList[r].retryStreamHandler;o.state==n.ENUM_PUBLISH_STATE.stop||o.stateNego!==n.ENUM_PUBLISH_STATE_NEGO.iceConnected?!i.isOverTime&&i.publishStateHandle(n.ENUM_PUBLISH_STATE_UPDATE.error,r,s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNetworkBrokenError):o.state==n.ENUM_PUBLISH_STATE.publishing&&i.stopMaxTime()}for(var r in e.streamCenter.playerList){var a=e.streamCenter.playerList[r].player;i=e.streamCenter.playerList[r].retryStreamHandler,a.state==n.ENUM_PLAY_STATE.stop||a.stateNego!==n.ENUM_PLAY_STATE_NEGO.iceConnected?!i.isOverTime&&i.playStateHandle(n.ENUM_PLAY_STATE_UPDATE.error,r,s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNetworkBrokenError):a.state==n.ENUM_PLAY_STATE.playing&&i.stopMaxTime()}})),window.addEventListener("visibilitychange",(function(t){if(Object.keys(e.streamCenter.publisherList).length>0||Object.keys(e.streamCenter.playerList).length>0){var r=n.getReportSeq();e.dataReport.newReport(r,s.ZegoRTCLogEvent.kZegoVisibilityChange.event),e.dataReport.uploadReport(r)}}))},e.prototype.bindRTMListener=function(){var e,t,r=this;this.rtm._on("_settingCanFetch",(function(e){return o(r,void 0,void 0,(function(){var e=this;return i(this,(function(t){return this.rtm.cloudSetting.fetchSetting(p.RTC).then((function(t){e.logger.info("zc.scf stream config "+JSON.stringify(t)),e.rtm._on("_cloudSettingNotify",(function(t,r){var o=n.getReportSeq();e.dataReport.newReport(o,s.ZegoRTCLogEvent.kZegoTaskCloudSettingRefresh.event);var i=e.rtm.cloudSetting.getEnvVariables();e.dataReport.addMsgInfo(o,{params:i,files:[{name:t,content:r.setting,versions:r.versions}]}),e.dataReport.uploadReport(o),p.RTC}))})),[2]}))}))})),this.rtm._on("roomLoginResponse",(function(e){r.logger.info("zc.rlr call "+JSON.stringify(e));var t=e.header.room_id;r.stateCenter.appid=r.rtm.getAppID(),r.stateCenter.idName=r.rtm.getUserID(),r.stateCenter.testEnvironment=r.rtm.isTestEnvironment(),r.stateCenter.isMultiRoom=r.rtm.getMultiRoom(),r.streamCenter.setSessionInfo(r.stateCenter.appid,r.stateCenter.idName,r.stateCenter.testEnvironment);var o=r.rtm.getToken(t),i=r.rtm.getSessionId(t),n=r.rtm.getRoomSessionID(t),s=r.stateCenter.getRoomByRoomID(t);if(!s){var a=new c.StreamHandler(r.logger,r.stateCenter,r.rtm,r.streamCenter,t);r.bindStreamHandler(a),s={roomID:t,streamHandler:a,sessionID:i,roomSessionID:n,token:o,isResetRoom:!1,streamList:[],streamInfoList:[]},r.stateCenter.roomList.push(s)}s.sessionID=i,s.roomSessionID=n,s.streamHandler.handleStreamStart(e,s),r.logger.info("zc.rlr end "+t)})),this.rtm._on("HBResponse",(function(e){var t,o=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,i=r.stateCenter.getRoomByRoomID(o);"PUBLIC"===r.stateCenter.type&&(null==i||i.streamHandler.patchStreamList(e))})),this.rtm._on("_roomStateUpdate",(function(e,t,o,i){if("DISCONNECTED"==t){r.logger.info("zc.rsu "+e+" disconnected "+(o?o+" ":"")+(i||""));var n=r.stateCenter.getRoomByRoomID(e);if(n){var s=r.stateCenter.roomList.findIndex((function(t){return t.roomID==e}));n.isResetRoom=!0,n.streamHandler.reset(),r.streamCenter.reset(e),r.stateCenter.roomList.splice(s,1)}}else r.logger.info("zc.rsu "+e+" state: "+t)})),this.rtm._on("_tokenRenewed",(function(e,t){r.logger.info("zc.tr roomID:"+t+" "+e);var o=r.stateCenter.getRoomByRoomID(t);o&&(o.token=e)})),this.rtm._on("_tokenExpired",(function(e){var t,o;((null===(o=null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.stop_stream)||void 0===o?void 0:o.stream_id_list)||[]).forEach((function(e){r.publishModule.stopPublishingStream(e,h.errorCodeList.TOKEN_EXPIRED)}))})),this.rtm.service.on("stream",(function(e){var t,o=(null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id)||"",i=r.stateCenter.getRoomByRoomID(o);i?i.streamHandler.handleStreamUpdateRsp(e):r.logger.error(u.ZEGO_WEBRTC_ACTION.ON_STREAM+" room no found")})),null===(e=this.rtm.service)||void 0===e||e.on("push_stream_update",(function(e){var t,o=(null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id)||"",i=r.stateCenter.getRoomByRoomID(o);i?i.streamHandler.handlePushStreamUpdateMsg(e):r.logger.error(u.ZEGO_WEBRTC_ACTION.ON_PUSH_STREAM_UPDATE+" room no found")})),null===(t=this.rtm.service)||void 0===t||t.on("zegochat_js.push_room_stream_update_req",(function(e){var t,o=(null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id)||"",i=r.stateCenter.getRoomByRoomID(o);i?i.streamHandler.handlePriPushStreamUpdateMsg(e):r.logger.error(u.ZEGO_WEBRTC_ACTION.ON_STREAM+" room no found")}))},e.prototype.bindStreamCenterHandler=function(){var e=this;this.streamCenter.onPlayStateUpdate=function(t,r,o){var i=e.stateCenter.reportSeqList.startPlay[r],n=e.streamCenter.playerList[r];if(1==t&&n&&a.ClientUtil.isReDispatch(o)){var s=n.player,c=n.retryDispatchHandler,l=n.playOption;return 0!=s.sessionId&&s.signal&&s.shouldSendCloseSession()&&(s.signal.sendCloseSession(e.stateCenter.getSeq(),s.sessionId,1),s.signal.removeSession(s.sessionId),s.closeSessionSignal=!0),s.resetPlay(),c.stopMaxTime(),c.invalid(),c.initStream(r,l,!1),void(e.rtm.isLogin()?(c.startMaxTime(),c.active(0)):e.streamCenter.playerList[r].isReDispatch=!0)}n&&n.player&&(0==t||1==t)&&i&&(e.dataReport.eventEndWithMsgInfo(i,"PlayState",{type:t}),1==t&&o&&e.dataReport.addMsgInfo(i,o),e.dataReport.uploadReport(i),delete e.stateCenter.reportSeqList.startPlay[r]),1===t&&e.streamCenter.playErrorCallBackList[r]&&(e.streamCenter.playErrorCallBackList[r]({errorCode:o&&o.code,extendedData:o&&o.message}),delete e.streamCenter.playErrorCallBackList[r],e.logger.info("zc.opsu.1 stop play called by sdk"),e.playModule.stopPlayingStream(r)),e.stateCenter.actionListener("playerStateUpdate",{state:a.ClientUtil.getPlayerStateType(t),streamID:r,errorCode:o&&o.code,extendedData:o&&o.message})},this.streamCenter.onPublishStateUpdate=function(t,r,o){e.onPublishStateUpdateHandle(t,r,o)},this.streamCenter.onPublishQualityUpdate=function(t,r){e.stateCenter.actionListener("publishQualityUpdate",t,r)},this.streamCenter.onPlayQualityUpdate=function(t,r){e.stateCenter.actionListener("playQualityUpdate",t,r)},this.streamCenter.onRemoteCameraStatusUpdate=function(t,r,o){var i=n.getReportSeq();e.dataReport.newReport(i,s.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.event),e.dataReport.addMsgInfo(i,{stream:s.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.stream(t),status:s.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.status(r)}),e.dataReport.uploadReport(i),e.stateCenter.actionListener("remoteCameraStatusUpdate",t,r),e.stateCenter.actionListener("_remoteCameraStatusUpdate",t,o)},this.streamCenter.onRemoteMicStatusUpdate=function(t,r,o){var i=n.getReportSeq();e.dataReport.newReport(i,s.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.event),e.dataReport.addMsgInfo(i,{stream:s.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.stream(t),status:s.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.status(r)}),e.dataReport.uploadReport(i),e.stateCenter.actionListener("remoteMicStatusUpdate",t,r),e.stateCenter.actionListener("_remoteMicStatusUpdate",t,o)},this.streamCenter.onSoundLevelUpdate=function(t){e.stateCenter.actionListener("soundLevelUpdate",t)},this.streamCenter.onMicSoundLevelUpdate=function(t){e.stateCenter.actionListener("capturedSoundLevelUpdate",t)}},e.prototype.bindStreamHandler=function(e){var t=this;e.onStreamUpdated=function(e,r,o){var i;i="PRIVATE"===t.stateCenter.type?o.map((function(e){return{streamID:e.stream_id,user:{userID:e.user_id,userName:e.user_name},extraInfo:e.extra_info,title:e.title,streamVer:e.stream_ver}})):o.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo,urlsFLV:e.urlFlv,urlsRTMP:e.urlRtmp,urlsHLS:e.urlHls,urlsHttpsFLV:e.urlHttpsFlv,urlsHttpsHLS:e.urlHttpsHls}}));var c={};if(0===r){var l=o.map((function(e){return{stream_id:e.streamID,code:n.STREAM_DELETE_REASON[e.closeType]&&n.STREAM_DELETE_REASON[e.closeType].code||0,description:n.STREAM_DELETE_REASON[e.closeType]&&n.STREAM_DELETE_REASON[e.closeType].description||"unknown"}}));c.stream_delete_reason=l}var d=n.getReportSeq();if(t.dataReport.newReport(d,s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.event),t.dataReport.addMsgInfo(d,{stream_update_type:s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.stream_update_type(1===r?"added":"deleted"),update_stream:s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.update_stream(i)}),t.dataReport.uploadReport(d),t.stateCenter.actionListener("roomStreamUpdate",e,a.ClientUtil.getSteamUpdateType(r),i,Object.keys(c).length>0?JSON.stringify(c):""),t.stateCenter.actionListener("_streamUpdated",r,o),1===r){var u=[];i.forEach((function(e){e.extraInfo&&u.push({streamID:e.streamID,user:e.user,extraInfo:e.extraInfo})})),u.length>0&&t.stateCenter.actionListener("streamExtraInfoUpdate",e,u)}},e.onPublishStateUpdate=function(e,r,o){t.logger.info("zb.opsu ",r);var i=t.stateCenter.reportSeqList.startPublish[r],n=t.streamCenter.publisherList[r];n&&n.publisher&&(0==e||1==e)&&i&&(t.dataReport.eventEndWithMsgInfo(i,"PublishState",{type:e}),1==e&&t.dataReport.addMsgInfo(i,o),t.dataReport.uploadReport(i),delete t.stateCenter.reportSeqList.startPublish[r]),t.stateCenter.actionListener("publisherStateUpdate",{state:a.ClientUtil.getPublisherStateType(e),streamID:r,errorCode:o.code,extendedData:o.message})},e.onStreamExtraInfoUpdated=function(e,r){var o;o="PUBLIC"===t.stateCenter.type?r.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}})):r.map((function(e){return{streamID:e.stream_id,user:{userID:e.user_id,userName:e.user_name},extraInfo:e.extra_info,title:e.title,streamVer:e.stream_ver}}));var i=n.getReportSeq();t.dataReport.newReport(i,s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.event),t.dataReport.addMsgInfo(i,{update_stream:s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.update_stream(o)}),t.dataReport.uploadReport(i),t.stateCenter.actionListener("streamExtraInfoUpdate",e,o)}},e.prototype.screenStreamFrom=function(e,t,r){var o={};o.audio={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e}},o.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:window.screen.width,maxHeight:window.screen.height}},!t&&(o.audio=!1),navigator.mediaDevices.getUserMedia(o).then((function(e){r(!0,e)})).catch((function(e){r(!1,null,e)}))},e.prototype.onPublishStateUpdateHandle=function(e,t,r){var o=this;this.logger.info("zc.opsuh.0 call");var i=this.streamCenter.publisherList[t],s=i.room;if(s)if(0==e){if(this.stateCenter.publishStreamList[t])if([n.ENUM_PUBLISH_STREAM_STATE.tryPublish,n.ENUM_PUBLISH_STREAM_STATE.retryPublish].includes(this.stateCenter.publishStreamList[t].state)&&!s.streamList.find((function(e){return e.stream_id==t}))){this.stateCenter.publishStreamList[t].state=n.ENUM_PUBLISH_STREAM_STATE.update_info;var c;c="PUBLIC"===this.stateCenter.type?n.ENUM_STREAM_SUB_CMD.liveBegin:n.ENUM_STREAM_CMD_PRI.liveBegin,s.streamHandler.updateStreamInfo(t,c,this.stateCenter.publishStreamList[t].extra_info,(function(e){"PRIVATE"===o.stateCenter.type&&o.stateCenter.publishStreamList[t]&&o.stateCenter.publishStreamList[t].state==n.ENUM_PUBLISH_STREAM_STATE.update_info&&(o.stateCenter.publishStreamList[t].state=n.ENUM_PUBLISH_STREAM_STATE.stop,s.streamHandler.onPublishStateUpdate(1,t,e),o.publishModule.stopPublishingStream(t))}))}else this.stateCenter.publishStreamList[t].state=n.ENUM_PUBLISH_STREAM_STATE.publishing,this.WebrtcOnPublishStateUpdateHandle(e,t,r)}else{if(1==e&&i&&a.ClientUtil.isReDispatch(r)){var l=i.publisher,d=i.retryDispatchHandler,u=i.publishOption;return 0!=l.sessionId&&l.signal&&l.shouldSendCloseSession()&&(l.signal.sendCloseSession(this.stateCenter.getSeq(),l.sessionId,1),l.signal.removeSession(l.sessionId),l.closeSessionSignal=!0),l.resetPublish(),d.stopMaxTime(),d.invalid(),d.initStream(t,u,!0),void(this.rtm.isLogin()?(d.startMaxTime(),d.active(0)):this.streamCenter.publisherList[t].isReDispatch=!0)}s.streamHandler.onPublishStateUpdate(e,t,r),1==e&&(this.logger.info("zc.opsuh.0 stop publish called by sdk"),this.publishModule.stopPublishingStream(t,r))}else this.logger.error("zc.opsuh.0 room not exist")},e.prototype.WebrtcOnPublishStateUpdateHandle=function(e,t,r){if(this.stateCenter.publishStreamList[t].state==n.ENUM_PUBLISH_STREAM_STATE.publishing){var o=this.streamCenter.getRoomByStreamID(t);o&&o.streamHandler.onPublishStateUpdate(e,t,r)}},e.prototype.bindListener=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error("zc.o.0 listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error("zc.o.0 event "+e+" no found"),!1)},e.prototype.deleteListener=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error("zc.o.1 listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e}();t.RTCModules=g},4865:function(e,t,r){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayModule=void 0;var i=r(1089),n=r(6706),s=r(3529),a=r(608),c=function(){function e(e,t,r,o,i){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=i}return e.prototype.startPlayingStream=function(e,t,r){var o=this;return this.logger.info(i.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" call ",e),new Promise((function(i,n){return o._handlePlayStream(e,t,i,n,r)}))},e.prototype._handlePlayStream=function(e,t,r,c,l){var d=this,u=n.getReportSeq();this.stateCenter.reportSeqList.startPlay[e]=u,this.dataReport.newReport(u,s.ZegoRTCLogEvent.kZegoTaskPlayStart.event);var h,p=function(t,r){d.logger.error(i.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" "+(r||t.message)),d.dataReport.uploadReport(u,void 0,t,r),delete d.stateCenter.reportSeqList.startPlay[e],c&&c(o(o({},t),{errorCode:t.code,extendedData:t.message+(r?" "+r:"")}))};if(void 0===e||"string"!=typeof e||""===e)return p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayParamError,"stream id type error"),!1;if(e.length>n.MAX_STREAM_ID_LENGTH)return p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDToLongError,"stream id length limit "+n.MAX_STREAM_ID_LENGTH),!1;if(!a.ClientUtil.checkIllegalCharacters(e))return p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDInvalidCharacterError),!1;if(void 0!==t&&"object"!=typeof t)return p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayParamError,"playOption must be object"),!1;if(this.stateCenter.customUrl&&0!=this.stateCenter.customUrl.length)this.logger.info("zc.p.sps.1 customUrl "+JSON.stringify(this.stateCenter.customUrl)),h=this.stateCenter.customUrl;else{var g=this.stateCenter.settingConfig.getSetting("signal_nodes",!0);g&&g instanceof Array&&g.length>0&&(h=g,this.logger.info("zc.p.sps.1 setting config signal_nodes "+JSON.stringify(g)))}if(h)return this.streamCenter.setPlayStateStart(e,t,l)?(this.streamCenter.onPlayStateUpdate(n.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,message:""}),this.streamCenter.playerList[e].serverUrls=h,this.streamCenter.startPlayingStream(e,(function(e){r&&r(e)}))):(p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRepeatedPullError,"cannot start play"),!1);if(this.dataReport.addMsgInfo(u,{stream:s.ZegoRTCLogEvent.kZegoTaskPlayStart.stream(e),playOption:s.ZegoRTCLogEvent.kZegoTaskPlayStart.playOption(t)}),this.rtm.service.isDisConnect())return p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError),!1;this.stateCenter.pullLimited||(e=NaN+e),t&&t.videoCodec&&(t.videoCodec=t.videoCodec.toUpperCase());var f=this.stateCenter.settingConfig.getSetting("resource_mode",!0);if(f&&(this.logger.info(i.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM," setting resource_mode "+f),!t&&(t={}),t.resourceMode=f),!this.streamCenter.setPlayStateStart(e,t,l))return p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRepeatedPullError,"cannot start play"),!1;this.streamCenter.onPlayStateUpdate(n.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,message:""}),this.streamCenter.playSuccessCallBackList[e]=function(e){r&&r(e)},c&&(this.streamCenter.playErrorCallBackList[e]=c);var m=this.streamCenter.playerList[e].retryDispatchHandler;return m.stopMaxTime(),m.invalid(),m.initStream(e,t,!1),m.startMaxTime(),m.active(0)},e.prototype.stopPlayingStream=function(e){this.logger.info(i.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call",e);var t=n.getReportSeq();if(this.stateCenter.reportSeqList.stopPlay[e]=t,this.dataReport.newReport(t,s.ZegoRTCLogEvent.kZegoTaskPlayStop.event),this.dataReport.addMsgInfo(t,{stream:s.ZegoRTCLogEvent.kZegoTaskPlayStop.stream(e)}),"string"!=typeof e||""===e)return this.logger.error(i.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" streamid must be string and not empty"),this.dataReport.uploadReport(t,void 0,s.ZegoRTCLogEvent.kZegoTaskPlayStop.error.kParamError,"stream id type error"),void delete this.stateCenter.reportSeqList.stopPlay[e];var r=this.streamCenter.playerList[e],o=r&&r.player&&r.player.state!==n.ENUM_PLAY_STATE.stop;for(var a in this.streamCenter.stopPlayingStream(e),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[a]===e){delete this.stateCenter.streamUrlMap[a];break}this.dataReport.uploadReport(t),o&&this.streamCenter.onPlayStateUpdate(n.ENUM_PLAY_STATE_UPDATE.error,e,{code:0,message:""}),this.logger.debug(i.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call success")},e.prototype.mutePlayStream=function(e,t,r){return new Promise((function(e,t){e(!1)}))},e.prototype.setStreamAudioOutput=function(e,t){return!1},e}();t.PlayModule=c},5634:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayStreamQuality=void 0;var o=r(6706),i=r(1089),n=r(3529),s=r(608),a=function(){function e(e,t,r,i){this.player=t,this.logger=r,this.dataReport=i,this.playQualityList=[],this.maxQualityListCount=10,this.qualityTimer=null,this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,audioPacketsReceived:0,videoPacketsReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0},this.netQuality=0,this.probeTime=0,this.probeInterval=6e4,this.probeState=o.ENUM_PROBE_STATE.probed,this.probeTimer=null,this.probeTimeoutInterval=3e4,this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.p2pNetStats={p2pLostRate:0,p2pRTT:0},this.videoBreakTimes=0,this.audioBreakTimes=0,this.videoBreakDuration=0,this.audioBreakDuration=0,this.sampleTimes=0,this.qualitySampleInterval=1e3,this.qualityTimeInterval=e}return Object.defineProperty(e.prototype,"streamId",{get:function(){return this.player.streamId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this.player.sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"peerID",{get:function(){return this.player.peerID},enumerable:!1,configurable:!0}),e.prototype.getPlayStats=function(e,t){var r=this;if(null!=e){var a=this.sampleTimes%parseInt((this.qualityTimeInterval/this.qualitySampleInterval).toString())==0;a&&this.getP2PNetStats();for(var c,l=document.querySelectorAll("video, audio"),d=0;d<l.length;d++)l[d].srcObject===this.player.playStream&&(c=l[d]);var u={sampleTimeWindow:this.qualityTimeInterval,audioFractionLost:0,audioPacketsLost:0,audioPacketsLostRate:0,audioBitrate:0,audioLevel:0,audioSendLevel:0,audioSamplingRate:0,audioCodec:"opus",audioQuality:0,audioFPS:0,videoQuality:0,videoPacketsLost:0,videoPacketsLostRate:0,videoBitrate:0,videoFPS:0,playData:0,nackCount:0,pliCount:0,audioJitter:0,videoFractionLost:0,videoFramesDecoded:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,videoFramesDropped:0,totalRoundTripTime:0,currentRoundTripTime:0,googBandwidthLimitedResolution:void 0,videoCodecName:"",audioCodecName:"",googCpuLimitedResolution:void 0,googAvailableSendBandwidth:0,audioMuteState:this.player.audioMuteState,videoMuteState:this.player.videoMuteState,muted:c?c.muted:void 0,paused:c?c.paused:void 0,volume:c?c.volume:void 0,sinkId:c?c.sinkId:void 0},h=this.lastPlayStats.time,p=0,g=0,f=0,m=0,_=0,E=0,T=0;if(t&&t.result().forEach((function(e){if("ssrc"==e.type&&"video"==e.stat("mediaType")&&e.names().indexOf("googInterframeDelayMax")>=0){var t,o=0;(t=Number(e.stat("googInterframeDelayMax")))>500&&(o=Number.parseInt((t*(r.qualityTimeInterval/1e3)).toString()),r.videoBreakTimes++,r.videoBreakDuration=r.videoBreakDuration+o),a&&(r.videoBreakDuration=0,r.videoBreakTimes=0)}if("ssrc"==e.type&&"audio"==e.stat("mediaType")&&e.names().indexOf("googExpandRate")>=0){var i=Number(e.stat("googExpandRate")),n=0;i>=.2&&(n=Number.parseInt((1e3*i*(r.qualityTimeInterval/1e3)).toString()),r.audioBreakTimes++,r.audioBreakDuration=r.audioBreakDuration+n),a&&(r.audioBreakDuration=0,r.audioBreakTimes=0)}a&&("ssrc"==e.type&&(e.names().indexOf("googBandwidthLimitedResolution")>=0&&(u.googBandwidthLimitedResolution=e.stat("googBandwidthLimitedResolution")),e.names().indexOf("codecImplementationName")>=0&&(u.codecImplementationName=e.stat("codecImplementationName")),"video"==e.stat("mediaType")&&(e.names().indexOf("googCodecName")>=0&&(u.videoCodecName=e.stat("googCodecName")),e.names().indexOf("googCurrentDelayMs")>=0&&(T=e.stat("googCurrentDelayMs"))),"audio"==e.stat("mediaType")&&(e.names().indexOf("googCodecName")>=0&&(u.audioCodecName=e.stat("googCodecName")),e.names().indexOf("googCurrentDelayMs")>=0&&(E=e.stat("googCurrentDelayMs"))),e.names().indexOf("googCpuLimitedResolution")>=0&&(u.googCpuLimitedResolution=e.stat("googCpuLimitedResolution"))),"VideoBwe"==e.type&&e.names().indexOf("googAvailableSendBandwidth")>=0&&(u.googAvailableSendBandwidth=e.stat("googAvailableSendBandwidth")))})),a){e.forEach((function(e){if(("inbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesReceived)&&("audio"==e.mediaType||e.id.indexOf("AudioStream")>=0)){0!=h&&(u.audioBitrate=8*(e.bytesReceived-r.lastPlayStats.audioBytesReceived)/(e.timestamp-h),(i=e.packetsLost-r.lastPlayStats.audioPacketsLost)>0&&(g=i/(i+e.packetsReceived-r.lastPlayStats.audioPacketsReceived))),u.audioBitrate<0&&(u.audioBitrate=0),u.audioJitter=e.jitter,e.packetsLost>0&&(u.audioPacketsLost=e.packetsLost),u.audioFractionLost=e.fractionLost;var t=e.packetsLost-r.lastPlayStats.audioPacketsLost;u.audioFPS=(e.packetsReceived-r.lastPlayStats.audioPacketsReceived)/(e.timestamp-h)*1e3,u.audioPacketsLostRate=t>0?t/(e.packetsReceived-r.lastPlayStats.audioPacketsReceived+t):0,r.lastPlayStats.audioBytesReceived=e.bytesReceived,e.packetsLost>0&&(r.lastPlayStats.audioPacketsLost=e.packetsLost),r.lastPlayStats.audioPacketsReceived=e.packetsReceived,r.lastPlayStats.audioTime=e.timestamp,r.lastPlayStats.time=e.timestamp,r.lastPlayStats.audioBitrate=u.audioBitrate,m=e.jitter}else if(("inbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesReceived)&&("video"==e.mediaType||e.id.indexOf("VideoStream")>=0)){var i;0!=h&&(u.videoBitrate=8*(e.bytesReceived-r.lastPlayStats.videoBytesReceived)/(e.timestamp-h),u.videoFPS=1e3*(e.framesDecoded-r.lastPlayStats.framesDecoded)/(e.timestamp-h),(i=e.packetsLost-r.lastPlayStats.videoPacketsLost)>0&&(f=i/(i+e.packetsReceived-r.lastPlayStats.videoPacketsReceived))),u.videoBitrate<0&&(u.videoBitrate=0),u.videoFPS<0&&(u.videoFPS=0),u.nackCount=e.nackCount,u.pliCount=e.pliCount,u.videoFractionLost=e.fractionLost,u.videoFramesDecoded=e.framesDecoded,e.packetsLost>0&&(u.videoPacketsLost=e.packetsLost),t=e.packetsLost-r.lastPlayStats.videoPacketsLost,u.videoPacketsLostRate=t>0?t/(e.packetsReceived-r.lastPlayStats.videoPacketsReceived+t):0,r.lastPlayStats.videoBytesReceived=e.bytesReceived,r.lastPlayStats.framesDecoded=e.framesDecoded,e.packetsLost>0&&(r.lastPlayStats.videoPacketsLost=e.packetsLost),r.lastPlayStats.videoPacketsReceived=e.packetsReceived,r.lastPlayStats.videoTime=e.timestamp,r.lastPlayStats.time=e.timestamp,_=e.jitter}else if("track"==e.type&&("video"==e.kind||e.id.indexOf("video")>=0)||e.frameWidth){if(u.frameHeight=e.frameHeight,u.frameWidth=e.frameWidth,0===h||r.lastPlayStats.frameHeight===e.frameHeight&&r.lastPlayStats.frameWidth===e.frameWidth)0===h&&(r.lastPlayStats.frameHeight=e.frameHeight,r.lastPlayStats.frameWidth=e.frameWidth);else{var s=o.getReportSeq();r.dataReport.newReport(s,n.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.event),r.dataReport.addMsgInfo(s,{session_id:n.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.session_id(r.sessionId),w:n.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.w(e.frameWidth),h:n.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.h(e.frameHeight)}),!r.player.isProbe&&r.dataReport.uploadReport(s),r.lastPlayStats.frameHeight=e.frameHeight,r.lastPlayStats.frameWidth=e.frameWidth}0!=h&&(u.videoTransferFPS=1e3*(e.framesReceived-r.lastPlayStats.framesReceived)/(e.timestamp-h),u.videoFramesDropped=e.framesDropped-r.lastPlayStats.framesDropped),u.videoTransferFPS<0&&(u.videoTransferFPS=0),u.videoFramesDropped<0&&(u.videoFramesDropped=0),r.lastPlayStats.framesReceived=e.framesReceived,r.lastPlayStats.framesDropped=e.framesDropped}else"track"==e.type&&("audio"==e.kind||e.id.indexOf("audio")>=0)?(u.audioLevel=e.audioLevel,u.audioSendLevel=e.totalAudioEnergy,u.audioSamplingRate=e.totalSamplesDuration):"candidate-pair"==e.type&&(null!=e.totalRoundTripTime&&(u.totalRoundTripTime=e.totalRoundTripTime),null!=e.currentRoundTripTime&&(u.currentRoundTripTime=e.currentRoundTripTime,p=1e3*u.currentRoundTripTime))})),this.lastPlayStats.googCurrentDelayMs=Number(E)||Number(T)||0,f=isNaN(f)||f<0?0:f,_=isNaN(_)||_<0?0:_,g=isNaN(g)||g<0?0:g,m=isNaN(m)||m<0?0:m;var S=s.ClientUtil.getNetQuality(p,f,_),v=s.ClientUtil.getNetQuality(p,g,m);u.audioQuality=h>0?s.ClientUtil.quality2QualityGrade(S):0,u.videoQuality=h>0?s.ClientUtil.quality2QualityGrade(v):0;var R=Math.min(S,v);this.netQuality=R,u.peerToPeerDelay=isNaN(this.p2pNetStats.p2pRTT)?0:parseInt((this.p2pNetStats.p2pRTT/2+this.lastPlayStats.googCurrentDelayMs).toString()),u.peerToPeerPacketLostRate=100*this.p2pNetStats.p2pLostRate/256,h>0&&R<=o.QUALITY_CONSTANT.MiddleMinQuality&&(new Date).getTime()>this.probeTime+this.probeInterval&&(this.logger.info(i.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" netQuality "+R+" start net probe"),this.probeState=o.ENUM_PROBE_STATE.tryProbe,this.player.streamCenter.startNetProbe(!1,this.player,this.player.gwNodeList),this.probeTime=(new Date).getTime()),this.uploadPlayQuality(u);var C={video:{videoBitrate:u.videoBitrate,videoFPS:u.videoFPS,videoTransferFPS:u.videoTransferFPS,videoFramesDecoded:u.videoFramesDecoded,videoFramesDropped:u.videoFramesDropped,videoPacketsLost:u.videoPacketsLost,videoPacketsLostRate:u.videoPacketsLostRate,videoQuality:u.videoQuality,frameHeight:u.frameHeight,frameWidth:u.frameWidth,muteState:u.videoMuteState},audio:{audioBitrate:u.audioBitrate,audioCodec:u.audioCodec,audioJitter:u.audioJitter,audioLevel:u.audioLevel,audioPacketsLost:u.audioPacketsLost,audioPacketsLostRate:u.audioPacketsLostRate,audioQuality:u.audioQuality,audioSamplingRate:u.audioSamplingRate,audioSendLevel:u.audioSendLevel,muteState:u.audioMuteState,audioFPS:u.audioFPS},nackCount:u.nackCount,pliCount:u.pliCount,totalRoundTripTime:u.totalRoundTripTime,playData:u.playData,currentRoundTripTime:u.currentRoundTripTime,peerToPeerDelay:u.peerToPeerDelay,peerToPeerPacketLostRate:u.peerToPeerPacketLostRate,sampleTimeWindow:u.sampleTimeWindow};void 0!==u.muted&&(C.muted=u.muted,C.paused=u.paused,C.volume=u.volume,C.sinkId=u.sinkId),void 0!==u.videoCodecName&&(C.video.googCodecName=u.videoCodecName,C.audio.googCodecName=u.audioCodecName,C.codecImplementationName=u.codecImplementationName,C.googAvailableSendBandwidth=u.googAvailableSendBandwidth),0!=h&&this.player.onPlayQualityUpdate(this.streamId,C)}}},e.prototype.uploadPlayQuality=function(e){var t=this;if(this.qualityUpload){var r=Date.parse(new Date+"");(0==this.qualityUploadLastTime||r-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(e.stream_type="play",e.stream_id=this.streamId,e.timeStamp=r/1e3,this.logger.info(i.ZEGO_WEBRTC_ACTION.PLAYER_UPLOAD_PLAYER_QUALITY+" "+this.streamId+" upload"+JSON.stringify(e)),this.player.signal.QualityReport(o.getSeq(),this.sessionId,e,(function(e,r,o){void 0!==o.report&&(t.qualityUpload=o.report,t.qualityUploadInterval=o.report_interval_ms)}),(function(e){t.logger.info(i.ZEGO_WEBRTC_ACTION.PLAYER_UPLOAD_PLAYER_QUALITY+" "+t.streamId+" upload failed "+e)})),this.qualityUploadLastTime=r)}},e.prototype.getP2PNetStats=function(){var e=this;this.player.signal.getP2PNetStats(o.getSeq(),this.sessionId,this.peerID,(function(t,r,o){var i=o.p2p_lost_rate,n=o.p2p_rtt;e.p2pNetStats.p2pLostRate=i||0,e.p2pNetStats.p2pRTT=n||0}),(function(e){}))},e.prototype.setPlayQualityTimer=function(){var e=this;null==this.qualityTimer&&(this.logger.info(i.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" "+this.streamId+" startTimer"),this.clearPlayQualityTimer(),this.getP2PNetStats(),this.qualityTimer=setInterval((function(){e.sampleTimes++;var t=e.player.peerConnection;if(t){var r=[t.getStats(null)];"chrome"==e.player.stateCenter.browser&&r.push(new Promise((function(e,r){t.getStats((function(t){return e(t)}),(function(e){return r(e)}))}))),Promise.all(r).then((function(t){e.getPlayStats(t[0],t[1])})).catch((function(t){e.logger.info(i.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" "+e.streamId+" getStats error "+t.toString())}))}}),1e3),this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,videoPacketsReceived:0,audioPacketsReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0})},e.prototype.clearPlayQualityTimer=function(){null!=this.qualityTimer&&(clearInterval(this.qualityTimer),this.qualityTimer=null),this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,videoPacketsReceived:0,audioPacketsReceived:0,framesDecoded:0,framesDropped:0,framesReceived:0,audioBitrate:0}},e.prototype.startProbeTimeout=function(){var e=this;this.probeTimer=setTimeout((function(){e.logger.error(i.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" probe timeout"),e.player.playStateUpdateError(n.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kProbeTimeOutError)}),this.probeTimeoutInterval)},e.prototype.stopProbeTimeout=function(){this.probeTimer&&(clearTimeout(this.probeTimer),this.probeTimer=null)},e}();t.PlayStreamQuality=a},3849:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPlayWeb=void 0;var o=r(6706),i=r(4767),n=r(608),s=r(3529),a=r(1089),c=r(5634),l=function(){function e(e,t,r,i,n,s,a){this.state=o.ENUM_PLAY_STATE.stop,this.candidateInfo=[],this.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.stop,this.playQualityList=[],this.maxQualityListCount=10,this.reportSeq=NaN,this.streamReportSeq=o.getSeq(),this.videoSizeCallback=!1,this.remoteStream=null,this.playStream=null,this.playOption={},this.closeSessionSignal=!1,this.stateNego=o.ENUM_PLAY_STATE_NEGO.stop,this.negoTimer=null,this.negoInterval=25e3,this.cameraStatus=0,this.micStatus=0,this.hasSentStreamStatus=!1,this.playEvent=!1,this.gotStreamStatus=!1,this.soundLevel=0,this.mic=null,this.script=null,this.beginTime=0,this.firstFrameTime=0,this.resourceMode=0,this.gwNode="",this.gwNodeList=[],this.gwNodeTTL=0,this.isPeer=!1,this.peerFailCount=0,this.isProbe=!1,this.peerID=0,this.isRecvClientInfo=!1,this.audioMuteState="0",this.videoMuteState="0",this.first_pkt=!0,this.next_sn=[],this.pkt_list=[],this.onDataChannelList=[],this.iceDisconnectedMaxTime=15e3,this.logger=e,this.signal=t,this.dataReport=r,this.streamCenter=n,this.ac=s,this.stateCenter=a,this.dataReport.newReport(this.streamReportSeq),this.dataReport.addMsgInfo(this.streamReportSeq,{abs_time:Date.now()}),this.qualityHandler=new c.PlayStreamQuality(i,this,this.logger,this.dataReport),this.resourceMode=this.stateCenter.settingConfig.getSetting("resource_mode")}return Object.defineProperty(e.prototype,"probeState",{get:function(){return this.qualityHandler.probeState},set:function(e){this.qualityHandler.probeState=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"netQuality",{get:function(){return this.qualityHandler.netQuality},set:function(e){this.qualityHandler.netQuality=e},enumerable:!1,configurable:!0}),e.prototype.startPlay=function(e,t,r){var o=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" called ",e),this.playEvent=!1,this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),e){this.streamId=e,this.getRemoteStreamSuc=t,this.playOption=r||{},r&&r.videoCodec&&(this.playOption.videoCodec=r.videoCodec);var i=this.stateCenter.settingConfig.getSetting("play_video_codec",!0);i&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" setting play_video_codec "+i),this.playOption.videoCodec=i),this.dataReport.addMsgInfo(this.reportSeq,{audio_activate:s.ZegoRTCLogEvent.kZegoTaskPlayStart.audio_activate(1==this.playOption.audio?1:0==this.playOption.audio?0:1),video_activate:s.ZegoRTCLogEvent.kZegoTaskPlayStart.video_activate(1==this.playOption.video?1:0==this.playOption.video?0:1)}),this.isPeer?this.createOffer():this.createSession(),this.negoTimer=setTimeout((function(){o.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" waiting timeout"),o.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNegoTimeoutError)}),this.negoInterval),this.isProbe&&this.qualityHandler.startProbeTimeout()}else this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" streamId is null")},e.prototype.onCreatePlaySessionSuccess=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" success");var r=[];if(e.turn_server){var o=e.turn_server,i=this.stateCenter.turnOverTcpOnly,n=this.stateCenter.settingConfig.getSetting("udp_or_tcp",!0);n&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" setting udp_or_tcp "+n),i="tcp"===n),i&&(o=o.replace("udp","tcp")),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" turn over tcp "+o),r.push(o)}e.stun_server&&r.push(e.stun_server);var s={iceTransportPolicy:"relay",iceServers:[{urls:r,username:e.turn_username,credential:e.turn_auth_key}]};this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" username: "+e.turn_username),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" credential: "+e.turn_auth_key),this.createOffer(s),this.signal.registerPushCallback("MediaDescPush",this.sessionId,(function(e,r,o){t.onRecvMediaDesc(e,r,o)})),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,(function(e,r,o){t.onRecvCandidateInfo(e,r,o)})),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,(function(e,r,o){t.onRecvCloseSession(e,r,o)})),this.signal.registerPushCallback("SessionResetPush",this.sessionId,(function(e,r,o){t.onRecvResetSession(e,r,o)})),this.signal.registerPushCallback("StreamStatusNotifyPush",this.sessionId,(function(e,r,o){t.gotStreamStatus=!0,t.streamStatus=o,t.playStream&&t.onRecvStreamStatus(o)})),this.signal.registerPushCallback("PlayEventPush",this.sessionId,(function(e,r,o){t.onRecvPlayEvent(e,r,o)})),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,(function(e,r,o){t.onRecvClientInfo(e,r,o)})),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" call success")},e.prototype.createOffer=function(e){var t=this;this.peerConnection=new RTCPeerConnection(e),this.dataChannel=this.peerConnection.createDataChannel(this.streamId),this.peerConnection.onicecandidate=function(e){t.onIceCandidate(e)},this.peerConnection.onsignalingstatechange=function(e){t.onConnectionStateChange(e)},this.peerConnection.oniceconnectionstatechange=function(e){t.onIceConnectionStateChange(e)},this.peerConnection.ontrack=function(e){t.onGotRemoteStream(e.streams[0])},this.dataChannel.onopen=function(e){t.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+t.streamId+" data channel open")},this.dataChannel.onmessage=function(e){t.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+t.streamId+" data channel onmessage"),t.onReceivedDataChannel(e)};var r={offerToReceiveAudio:1,offerToReceiveVideo:1};this.playOption&&!1===this.playOption.video&&(r.offerToReceiveVideo=0),this.playOption&&!1===this.playOption.audio&&(r.offerToReceiveAudio=0),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" createOffer: "+JSON.stringify(r)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.dataReport.eventStart(this.streamReportSeq,"CreateOffer"),this.peerConnection.createOffer(r).then((function(e){t.dataReport.eventEnd(t.reportSeq,"CreateOffer"),t.dataReport.eventEnd(t.streamReportSeq,"CreateOffer"),t.onCreateOfferSuccess(e)}),(function(e){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateOffer",{error:e.toString()}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateOffer",{error:e.toString()}),t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+t.streamId+" create offer error "+e.toString()),t.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCreateOfferError,!0)}))},e.prototype.createSession=function(e){var t=this;this.sessionSeq=o.getSeq();var r=this.streamId;1==this.streamCenter.testEnvironment&&(r="zegotest-"+this.streamCenter.appid+"-"+this.streamId);var i=this.stateCenter.settingConfig.getSetting("gw_nodes");if(i&&i instanceof Array&&i.length>0&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" setting "+JSON.stringify(i)),this.gwNodeList=i,this.gwNode=this.gwNodeList[0]||this.gwNode),this.isPeer){this.dataReport.eventStart(this.reportSeq,"CreateSessionWithSdp"),this.dataReport.eventStart(this.streamReportSeq,"CreateSessionWithSdp");var n=this.stateCenter.settingConfig.getSetting("l3_play_buffer_ms");this.signal.createSessionWithSdp({seq:this.sessionSeq,type:this.isProbe?2:1,mode:0,streamId:r,strAuthParam:this.playOption&&this.playOption.streamParams||"",sdp:e.sdp,serverHost:this.gwNode,playBufLevel:2==this.resourceMode?n:void 0},(function(e,r,o){t.handleCreateSessionWithSdpResp(e,r,o)}),(function(r,i){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:r}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:r}),!t.isProbe&&r==o.SEND_MSG_TIMEOUT&&t.peerFailCount<2?(t.peerFailCount++,t.createSession(e)):!t.isProbe&&r==o.SEND_MSG_TIMEOUT&&t.peerFailCount>=2?(t.isPeer=!1,t.streamCenter.isPeer=!1,t.createSession()):t.playStateUpdateError(r==o.SEND_MSG_TIMEOUT?s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError:s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)}))}else this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.dataReport.eventStart(this.streamReportSeq,"CreateSession"),this.signal.createSession(this.sessionSeq,1,0,r,this.playOption&&this.playOption.streamParams,this.gwNode,(function(e,r,o){t.handleCreateSessionResp(e,r,o)}),(function(e,r){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:e}),t.playStateUpdateError(e==o.SEND_MSG_TIMEOUT?s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError:s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)}));this.state=o.ENUM_PLAY_STATE.waitingSessionRsp,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" called success"),this.stateNego=o.ENUM_PLAY_STATE_NEGO.start},e.prototype.handleCreateSessionResp=function(e,t,r){var o=r.turn_server,i=o.split("?")[0]&&o.split("?")[0].slice(5),n=this.streamCenter.server.split("?"),c=n[1]&&n[1].slice(2);this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+i+"/"+c+"/"+this.streamId}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+i+"/"+c+"/"+this.streamId}),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" sessionId:"+r.session_id),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,0!==r.result?(this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" create error"),this.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)):(this.sessionId=r.session_id,this.sessionToken=r.session_token,this.dataReport.addMsgInfo(this.reportSeq,{session_id:s.ZegoRTCLogEvent.kZegoTaskPlayStart.session_id(this.sessionId)}),this.onCreatePlaySessionSuccess(r))):this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" seq is not match.")},e.prototype.handleCreateSessionWithSdpResp=function(e,t,r){var o=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" sessionId:"+t),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSessionWithSdp",{sessionId:t}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSessionWithSdp",{sessionId:t}),0!==r.result?(this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" create session failed "+r.result),this.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)):(this.sessionId=t,this.sessionToken=r.session_token,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" create session success ",this.streamId),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,(function(e,t,r){o.onRecvCloseSession(e,t,r)})),this.signal.registerPushCallback("SessionResetPush",this.sessionId,(function(e,t,r){o.onRecvResetSession(e,t,r)})),this.signal.registerPushCallback("StreamStatusNotifyPush",this.sessionId,(function(e,t,r){o.gotStreamStatus=!0,o.streamStatus=r,o.playStream&&o.onRecvStreamStatus(r)})),this.signal.registerPushCallback("PlayEventPush",this.sessionId,(function(e,t,r){o.onRecvPlayEvent(e,t,r)})),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,(function(e,t,r){o.onRecvClientInfo(e,t,r)})),this.signal.registerPushCallback("NetQualityProbeRsp",this.sessionId,(function(e,t,r){o.onRecvPlayEvent(e,t,r)})),this.signal.registerPushCallback("NetQualityInfoPush",this.sessionId,(function(e,t,r){o.onRecvNetQualityInfo(e,t,r)})),this.onGetRemoteOfferSuccess(r.sdp))):this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" seq is not match.")},e.prototype.onCreateOfferSuccess=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp1 "+e.sdp.substr(0,e.sdp.length/2)),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp2 "+e.sdp.substr(e.sdp.length/2)),e.sdp=e.sdp.replace(/sendrecv/g,"recvonly"),e.sdp=e.sdp.replace(/useinbandfec=/,"stereo=1;useinbandfec=");var r=e.sdp.match(/m=video(.|\r|\n)*a=rtpmap(.|\r|\n)*(a=fmtp:(102).*)/);if(null!==r){var o=r[3];e.sdp=e.sdp.replace(o,o+";sps-pps-idr-in-keyframe=1")}this.playOption.videoCodec&&(e.sdp=i.SdpUtil.getSDPByVideDecodeType(e.sdp,this.playOption.videoCodec)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetLocalDescription"),this.peerConnection.setLocalDescription(e).then((function(){t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription"),t.dataReport.eventEnd(t.streamReportSeq,"SetLocalDescription"),t.onSetLocalDescriptionSuccess(e)}),(function(e){t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+t.streamId+" set error "+e.toString()),t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription",{error:e.toString()}),t.dataReport.eventEnd(t.streamReportSeq,"SetLocalDescription",{error:e.toString()}),t.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSetLocalDescError,!0)}))},e.prototype.onSetLocalDescriptionSuccess=function(e){var t=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" success"),this.isPeer)this.createSession(e);else{var r={sdp:e.sdp};2==this.resourceMode&&(r.min_play_buf_level_ms=500),this.answerSeq=o.getSeq(),this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.answerSeq,this.sessionId,0,r,(function(e,r,i){t.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" sendMediaDesc resp"),t.answerSeq==e&&t.sessionId==r?(t.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" send success stateNego:waiterAnswer"),t.stateNego=o.ENUM_PLAY_STATE_NEGO.waiterAnswer,t.dataReport.eventEnd(t.reportSeq,"SendMediaDesc"),t.dataReport.eventEnd(t.streamReportSeq,"SendMediaDesc"),t.state=o.ENUM_PLAY_STATE.waitingServerAnswer):t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" seq or sessionId is not equal "+t.answerSeq+" "+e,0+t.sessionId+" "+r)}),(function(e,r){t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" failed to send "+e),t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendMediaDesc",{error:e}),t.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kMediaDescError)})),this.state=o.ENUM_PLAY_STATE.waitingOffserRsp}},e.prototype.onRecvMediaDesc=function(e,t,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received ",r),this.stateNego=o.ENUM_PLAY_STATE_NEGO.waitingCandidate,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received stateNego:waitingCandidate"),this.state===o.ENUM_PLAY_STATE.waitingServerAnswer?(this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(e,this.sessionId,0),this.onGetRemoteOfferSuccess(r.sdp)):this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onGetRemoteOfferSuccess=function(e){var t,r=this,i={type:"answer",sdp:e,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetRemoteDescription");var n=this.stateCenter.turnOverTcpOnly,c=this.stateCenter.settingConfig.getSetting("udp_or_tcp",!0);c&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" setting udp_or_tcp "+c),n="tcp"===c),n&&(null===(t=i.sdp.match(/candidate.*/g))||void 0===t||t.forEach((function(e){var t=e.replace(/udp/,"tcp");i.sdp=i.sdp.replace(e,t)}))),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" remoteSdp ",i.sdp),this.peerConnection.setRemoteDescription(new RTCSessionDescription(i)).then((function(){r.dataReport.eventEnd(r.reportSeq,"SetRemoteDescription"),r.dataReport.eventEnd(r.streamReportSeq,"SetRemoteDescription"),r.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+r.streamId+" set success")}),(function(e){r.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+r.streamId+" set remote error "+e.toString()),r.dataReport.eventEndWithMsg(r.reportSeq,"SetRemoteDescription",{error:e.toString()}),r.dataReport.eventEndWithMsg(r.streamReportSeq,"SetRemoteDescription",{error:e.toString()}),r.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSetRemoteDescError,!0)})),this.state=o.ENUM_PLAY_STATE.waitingServerICE,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" call success")},e.prototype.onRecvCandidateInfo=function(e,t,r){var i=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" received "),this.state==o.ENUM_PLAY_STATE.waitingServerICE){this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.dataReport.addEvent(this.streamReportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(e,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var n=0;n<r.infos.length;n++){var c={sdpMid:r.infos[n].sdpMid,sdpMLineIndex:r.infos[n].sdpMLineIndex,candidate:r.infos[n].candidate};this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" candidate "+c.candidate),this.peerConnection.addIceCandidate(new RTCIceCandidate(c)).then((function(){i.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+i.streamId+" add success")}),(function(e){i.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+i.streamId+" add error "+e.toString()),i.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCandidateError,!0)}))}this.state=o.ENUM_PLAY_STATE.connecting,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" call success")}else this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onRecvPlayEvent=function(e,t,r){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_PLAY_EVENT+" "+this.streamId+" received"),!0===this.playEvent&&0==r.event){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_PLAY_EVENT+" "+this.streamId+" retry: "+this.streamId);var i=this.streamId,n=this.playOption;this.signal.sendCloseSession(o.getSeq(),this.sessionId,1),this.resetPlay(),this.startPlay(i,this.getRemoteStreamSuc,n)}else this.playEvent=!0},e.prototype.onRecvClientInfo=function(e,t,r){this.stateCenter.clientIP!==r.clientip&&this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CLIENT_INFO+" client ip changed "+this.stateCenter.clientIP+" "+r.clientip),this.stateCenter.clientIP=r.clientip,this.peerID=r.peer_id,this.isProbe&&this.stateNego==o.ENUM_PLAY_STATE_NEGO.iceConnected&&this.signal.sendNetProbe(o.getSeq(),this.sessionId,this.peerID,(function(){}),(function(){})),this.isRecvClientInfo=!0},e.prototype.onRecvNetQualityInfo=function(e,t,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_NET_QUALITY_INFO+" call"),this.qualityHandler.stopProbeTimeout();var i=0,s=r.lossrate,c=r.rtt;this.peerID===r.peer_id&&null!=typeof s&&null!=typeof c||(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_NET_QUALITY_INFO+" local peerID:"+this.peerID+" remote peerID:"+r.peer_id+" lossrate:"+s+" rtt:"+c),i=1),this.signal.sendNetQualityInfoPushAck(o.getSeq(),this.sessionId,this.peerID,i),0==i&&"number"==typeof s&&"number"==typeof c?this.onCalNetQualityResult(0,n.ClientUtil.getNetQuality(c,s)):this.onCalNetQualityResult(1)},e.prototype.onIceCandidate=function(e){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" called"),null!=e.candidate)if(this.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate "+e.candidate.candidate),this.state<o.ENUM_PLAY_STATE.connecting||this.state==o.ENUM_PLAY_STATE.stop)this.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" cached"),this.candidateInfo.push({candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex});else{this.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" send");var t={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};this.sendCandidateInfo([t])}},e.prototype.onConnectionStateChange=function(e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CONNECTION_STATE_CHANGE+" "+this.streamId+" called "+e.target.signalingState)},e.prototype.onIceConnectionStateChange=function(e){var t=this;if(this.state!=o.ENUM_PLAY_STATE.stop&&null!=this.peerConnection)if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateChanged "+this.peerConnection.iceConnectionState),"connected"===this.peerConnection.iceConnectionState){if(this.stateNego=o.ENUM_PLAY_STATE_NEGO.iceConnected,this.isProbe&&this.isPeer&&this.isRecvClientInfo)return this.signal.sendNetProbe(o.getSeq(),this.sessionId,this.peerID,(function(){}),(function(){})),void(null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null));for(var r in null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),null!=this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null),this.dataReport.addEvent(this.reportSeq,"IceConnected"),this.dataReport.addEvent(this.streamReportSeq,"IceConnected"),this.state!=o.ENUM_PLAY_STATE.playing&&(this.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.start,this.streamId,{code:0,message:""},!0),this.getRemoteStreamSuc&&this.getRemoteStreamSuc(this.playStream)),this.state=o.ENUM_PLAY_STATE.playing,this.dataReport.eventStart(this.reportSeq,"PlayState"),this.dataReport.eventStart(this.streamReportSeq,"PlayState"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[r].publisher.state==o.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.stop){this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),this.sessionId,1),this.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.start;break}if(!this.isProbe&&this.qualityHandler.setPlayQualityTimer(),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateNego:iceConnected"),this.isPeer&&(this.peerFailCount=0),0==this.firstFrameTime){this.firstFrameTime=(new Date).getTime()-this.beginTime;var i=o.getReportSeq();this.dataReport.newReport(i,s.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.event),this.dataReport.addMsgInfo(i,{session_id:s.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.session_id(this.sessionId),fft_consumed:s.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.fft_consumed(this.firstFrameTime)}),!this.isProbe&&this.dataReport.uploadReport(i)}}else"closed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.stateNego=o.ENUM_PLAY_STATE_NEGO.iceClosed,this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):"failed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.stateNego=o.ENUM_PLAY_STATE_NEGO.iceFailed,this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):"disconnected"===this.peerConnection.iceConnectionState&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.stateNego=o.ENUM_PLAY_STATE_NEGO.iceDisconnected,this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" ice disconnected"),this.iceDisconnectedTimer||(this.iceDisconnectedTimer=setTimeout((function(){t.checkPlayConnectionFailedState("disconnected")}),this.iceDisconnectedMaxTime)))},e.prototype.checkPlayConnectionFailedState=function(e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+"  state "+this.state+" connectionState "+e),this.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kMediaConnectionError)},e.prototype.resetPlay=function(){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_RESET_PLAY+" "+this.streamId+" call"),this.state=o.ENUM_PLAY_STATE.stop,this.playEvent=!1,this.isRecvClientInfo=!1,null!=this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),null!=this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null),this.qualityHandler.stopProbeTimeout(),this.qualityHandler.clearPlayQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId),this.signal.unregisterPushCallback("SessionResetPush",this.sessionId),this.signal.unregisterPushCallback("PublishEventPush",this.sessionId),this.signal.unregisterPushCallback("ClientInfoPush",this.sessionId),this.signal.unregisterPushCallback("NetQualityProbeRsp",this.sessionId),this.signal.unregisterPushCallback("NetQualityInfoPush",this.sessionId)),this.sessionSeq=0,this.answerSeq=0,this.videoSizeCallback=!1,this.stopSoundLevel()},e.prototype.onRecvResetSession=function(e,t,r){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_RESET_SESSION+" "+this.streamId+" received "),t==this.sessionId){this.signal.sendCloseSessionAck(e,this.sessionId,0);var o=JSON.parse(JSON.stringify(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError));this.negoTimer&&clearTimeout(this.negoTimer),this.playStateUpdateError(o)}else this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_RESET_SESSION+" "+this.streamId+" cannot find session")},e.prototype.onRecvCloseSession=function(e,t,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CLOSE_SESSION+" "+this.streamId+" "+JSON.stringify(r)),this.signal.sendCloseSessionAck(e,this.sessionId,0);var o=r.err_info?JSON.parse(r.err_info.toLowerCase()):{},i=o.action?o.action:null,n=1*r.reason,c=JSON.parse(JSON.stringify(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError));c.message+=" reason:"+n+" "+(i?" action:"+i:""),this.negoTimer&&clearTimeout(this.negoTimer);var l=![4,8,10,11,12,14,24,26,27,28].includes(n)&&![2,5,6].includes(i);this.playStateUpdateError(c,l)},e.prototype.onRecvStreamStatus=function(e){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" call"),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" status camera_status: "+e.camera_status+" mic_status: "+e.mic_status),(!this.hasSentStreamStatus||this.cameraStatus!==e.camera_status)&&this.onRemoteCameraStatusUpdate(this.streamId,this.getCameraMicStatus(e.camera_status),e.camera_status),(!this.hasSentStreamStatus||this.micStatus!==e.mic_status)&&this.onRemoteMicStatusUpdate(this.streamId,this.getCameraMicStatus(e.mic_status),e.mic_status),this.hasSentStreamStatus=!0,this.cameraStatus=e.camera_status,this.micStatus=e.mic_status,this.videoMuteState=0===e.camera_status?"0":"1",this.audioMuteState=0===e.mic_status?"0":"1","boolean"==typeof this.playOption.video)this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" has set video option, ignore stream status");else{var t=this.playStream;if(0!==e.camera_status&&20!==e.camera_status?t.getVideoTracks().forEach((function(e){e.enabled=!1,e.stop(),t.removeTrack(e)})):0===t.getVideoTracks().length&&t.addTrack(this.remoteStream.clone().getVideoTracks()[0]),"safari"===this.stateCenter.browser)for(var r=document.querySelectorAll("video, audio"),o=0;o<r.length;o++)r[o].srcObject===this.playStream&&(r[o].srcObject=this.playStream)}this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" call success")},e.prototype.onGotRemoteStream=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_GOT_REMOTE_STREAM+" "+this.streamId+" called "+e),e?(this.playStream?(this.playStream.getTracks().forEach((function(e){return t.playStream.removeTrack(e)})),e.clone().getTracks().forEach((function(e){return t.playStream.addTrack(e)}))):this.playStream=e.clone(),this.audioMuteState=this.playStream.getAudioTracks().length>0?"0":"1",this.videoMuteState=this.playStream.getVideoTracks().length>0?"0":"1",this.remoteStream=e,this.gotStreamStatus&&this.onRecvStreamStatus(this.streamStatus),this.dataReport.addEvent(this.reportSeq,"GetRemoteStream"),this.streamCenter.soundLevelDelegate&&!this.isProbe&&this.startSoundLevel()):this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_GOT_REMOTE_STREAM+" "+this.streamId+" remote stream is empty")},e.prototype.sendCandidateInfo=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" called"),!(e=e.filter((function(e){return!(e.candidate.indexOf("tcp")>0)&&(!!e.candidate||void 0)})))||e.length<1?this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.dataReport.eventStart(this.streamReportSeq,"SendIceCandidate"),this.stateNego!==o.ENUM_PLAY_STATE_NEGO.iceConnected&&(this.stateNego=o.ENUM_PLAY_STATE_NEGO.sendCandidate),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" stateNego:sendCandidate"),this.signal.sendCandidateInfo(o.getSeq(),this.sessionId,e,(function(e,r,o){t.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+t.streamId+" send success"),t.dataReport.eventEnd(t.reportSeq,"SendIceCandidate"),t.dataReport.eventEnd(t.streamReportSeq,"SendIceCandidate")}),(function(e,r){t.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+t.streamId+" failed to send: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SendIceCandidate",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendIceCandidate",{error:e}),t.playStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCandidateError)})))},e.prototype.shouldSendCloseSession=function(){return this.state!=o.ENUM_PLAY_STATE_UPDATE.stop&&this.state!=o.ENUM_PLAY_STATE.waitingSessionRsp},e.prototype.playStateUpdateError=function(e,t){this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_STATE_ERROR+" call ",this.streamId,JSON.stringify(e)),this.isProbe?this.onCalNetQualityResult(1):this.streamId&&this.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.error,this.streamId,e,t),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_STATE_ERROR+" "+this.streamId+" ended")},e.prototype.getCameraMicStatus=function(e){return 0==e?"OPEN":"MUTE"},e.prototype.onPlayStateUpdate=function(e,t,r,o){},e.prototype.onPlayQualityUpdate=function(e,t){},e.prototype.onRemoteCameraStatusUpdate=function(e,t,r){},e.prototype.onRemoteMicStatusUpdate=function(e,t,r){},e.prototype.stopPlay=function(){for(var e in this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_STOP_PLAY+" "+this.streamId+" called"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[e].publisher.state==o.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.start){this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),this.sessionId,0),this.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.stop;break}this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(o.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.streamReportSeq,"PlayState",{state:this.state+""}),this.dataReport.addEvent(this.streamReportSeq,"StopPlay"),this.dataReport.addMsgExt(this.streamReportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.dataReport.addMsgInfo(this.streamReportSeq,{itemtype:"RTCPlayStream"}),!this.isProbe&&this.dataReport.uploadReport(this.streamReportSeq,"RTCPlayStream"),this.resetPlay()},e.prototype.onDisconnect=function(e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_DISCONNECT+" "+this.streamId+" call"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),this.playStateUpdateError(e||s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kWebsocketDisconnectedError,!!e)},e.prototype.startSoundLevel=function(){var e=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" call streamID: "+this.streamId),!this.isProbe)if(this.remoteStream&&0!=this.remoteStream.getAudioTracks().length){this.script&&this.script.disconnect()&&(this.script=null),this.mic&&this.mic.disconnect()&&(this.mic=null);try{this.mic=this.ac.createMediaStreamSource(this.remoteStream),this.script=this.ac.createScriptProcessor(4096,1,1),this.mic.connect(this.script),this.script.connect(this.ac.destination),this.script.onaudioprocess=function(t){for(var r=t.inputBuffer.getChannelData(0),o=0,i=0;i<r.length;i++)o<r[i]&&(o=r[i]);e.soundLevel=100*o},this.ac.resume()}catch(e){this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" get sound level failed "+e)}}else this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" "+this.streamId+" remote stream no found")},e.prototype.stopSoundLevel=function(){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_STOP_SOUND_LEVEL+" call streamID: "+this.streamId),this.script&&this.script.disconnect(),this.mic&&this.mic.disconnect(),this.script=null,this.mic=null},e.prototype.onCalNetQualityResult=function(e,t){},e.prototype.onReceivedDataChannel=function(e){var t,r,o=this,i=new Uint8Array(e.data,0,10),n=e.data.byteLength-10,s=new Uint8Array(e.data,10,n);if(1==i[0]){var a=i[1],c=i[2]<<8|i[3],l=i[4]<<8|i[5],d=(new Date).getTime();if(this.first_pkt&&(this.next_sn[0]=c==l?c:l,this.first_pkt=!1),this.pkt_list.push({sn:c,sn0:l,recv_ts:d,flags:a,payload_len:n,payloadArray:s}),this.pkt_list.sort(this.compareShort),c==this.next_sn[0]){var u=this.pkt_list.filter((function(e){return e.sn0==l}));if(u.sort(this.compareShort),null!=u.find((function(e){return 1&e.flags}))&&u.length==this.compareShort(c,l)+1){for(var h=0,p=new ArrayBuffer(65536),g=0;g<u.length;g++)new Uint8Array(p).set(u[g].payloadArray,h),h+=u[g].payload_len;null===(t=this.onDataChannelList)||void 0===t||t.forEach((function(e){e(p,h,o.streamId)})),this.pkt_list=[],this.first_pkt=!0}this.next_sn[0]++}else for(var f=function(){var e=m.pkt_list.filter((function(e){return e.sn0==o.pkt_list[0].sn0}));if(e.sort(m.compareShort),null!=e.find((function(e){return 1&e.flags}))&&e.length==m.compareShort(e[e.length-1].sn,e[0].sn0)+1){for(var t=0,i=new ArrayBuffer(65536),n=0;n<e.length;n++)new Uint8Array(i).set(e[n].payloadArray,t),t+=e[n].payload_len;m.next_sn[0]=e[0].sn0+e.length,null===(r=m.onDataChannelList)||void 0===r||r.forEach((function(e){e(i,t,o.streamId)})),m.pkt_list=[],m.first_pkt=!0}else if(d-e[0].ts<4e3){var s=e[0].sn0;for(n=0;n<e.length&&s==e[n].sn;n++)s++;return m.next_sn[0]=s,"break"}for(n=0;n<e.length;n++)m.pkt_list.shift()},m=this;this.pkt_list.length>0&&"break"!==f(););}},e.prototype.compareShort=function(e,t){var r=new Uint16Array(1);r[0]=e-t;var o=new Int16Array(1);return o[0]=r[0],o[0]},e}();t.ZegoPlayWeb=l},361:function(e,t,r){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.PublishModule=void 0;var i=r(1089),n=r(6706),s=r(3529),a=r(608),c=r(2752),l=r(3770),d=r(5321),u=function(){function e(e,t,r,o,i){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=i,this.recordDevices()}return e.prototype.createStream=function(e){var t=this;return this.logger.info(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" call"),e&&e.camera&&e.camera.audioBitRate&&(e.camera.audioBitrate=e.camera.audioBitRate),e&&e.camera&&e.camera.bitrate&&(e.camera.bitRate=e.camera.bitrate),e&&e.screen&&"object"==typeof e.screen&&e.screen.bitrate&&(e.screen.bitRate=e.screen.bitrate),e&&e.custom&&e.custom.bitrate&&(e.custom.bitRate=e.custom.bitrate),new Promise((function(r,c){var l="camera",u=n.getReportSeq();t.dataReport.newReport(u,s.ZegoRTCLogEvent.kZegoTaskCreateStream.event);var h=function(e){if(0==e.getAudioTracks().length){var o=t.streamCenter.ac.createMediaStreamDestination(),i=o?o.stream:null,n=i?i.getAudioTracks()[0]:null;n&&e.addTrack(n)}t.dataReport.uploadReport(u),!t.stateCenter.deviceInfos&&t.recordDevices(),r(e),t.streamCenter.activeSoundLevel()},p=function(e,r){void 0===r&&(r=""),t.dataReport.addMsgInfo(u,{error:e.code,message:e.message+r}),t.dataReport.uploadReport(u),c({code:e.code,msg:e.message+r})};if("https:"!==window.location.protocol&&"file:"!==window.location.protocol&&-1==window.location.hostname.indexOf("127.0.0.1")&&-1==window.location.hostname.indexOf("localhost"))return t.logger.error(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" https or localhost required "),void p({code:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError.code,message:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError.message+" https or localhost required"});if(e&&e.screen){if(l="screen",!a.ClientUtil.checkScreenParams(e.screen,p))return;var g=t.stateCenter.browser,f=t.streamCenter.getScreenConstrains(e.screen);t.dataReport.addMsgInfo(u,{stream_type:s.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("screen"),screen:s.ZegoRTCLogEvent.kZegoTaskCreateStream.screen(f)});var m=function(e){t.streamCenter.createScreenPreviewer(e,f)&&h(e),e.getVideoTracks()[0].onended=function(){var r=n.getReportSeq();t.dataReport.newReport(r),t.dataReport.uploadReport(r,s.ZegoRTCLogEvent.kZegoTaskScreenSharingEnded),e&&t.stopPreview(e),t.stateCenter.actionListener("screenSharingEnded",e)}};"firefox"==g||"object"==typeof e.screen&&"firefox"==e.screen.type?t.startScreenShotFirFox("screen",f,(function(e,t,r){e?t&&m(t):r&&p(r)})):"chrome"==g&&d.ZegoWebRTC.screenShotReady||"object"==typeof e.screen&&"shot"==e.screen.type?t.startScreenShotChrome((function(r,o,n){r?(t.logger.info(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" using extension"),o&&m(o)):(n&&t.logger.error(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" extension "+n),"SS_DIALOG_CANCEL"===n||"object"==typeof e.screen&&"shot"==e.screen.type?n&&p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenCancelError):t.startScreenSharing(f,(function(e,r,o){e?r&&m(r):(t.logger.error(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" "+o),o&&p(o))})))})):"Electron"==g||"object"==typeof e.screen&&"Electron"==e.screen.type?t.startScreenShotElectron(f,(function(e,t,r){e?t&&m(t):r&&p(r)})):t.startScreenSharing(f,(function(e,t,r){e?t&&m(t):r&&p(r)}))}else{if(e&&"object"==typeof e.camera&&void 0!==e.camera.videoQuality&&!a.ClientUtil.checkInteger(e.camera.videoQuality))return t.logger.error(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" videoQuality must be integer number"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," videoQuality must be integer number");if(e&&e.camera&&e.camera.audioBitrate){if(!a.ClientUtil.checkInteger(e.camera.audioBitrate))return t.logger.error(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate must be integer number"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate must be integer number");if(e.camera.audioBitrate<6)return t.logger.error(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate cannot less 6 kbps"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot less 6 kbps");if(e.camera.audioBitrate>510)return t.logger.error(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate cannot greater than 510 kbps"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot greater than 510 kbps");t.stateCenter.audioBitRate=1e3*e.camera.audioBitrate}if(e&&e.camera&&e.camera.bitRate){if("number"!=typeof e.camera.bitRate)return t.logger.error(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate must be integer number"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number");if(e.camera.bitRate>10240)return t.logger.error(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate cannot greater than 10 Mbps"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps")}if(e&&e.camera&&void 0!==e.camera.channelCount&&!a.ClientUtil.checkInteger(e.camera.channelCount))return t.logger.error(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" channelCount must be integer number"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," channelCount must be integer number");if(e&&e.camera&&4===e.camera.videoQuality&&!a.ClientUtil.checkCameraParams(e.camera,p))return;if(e&&e.custom&&e.custom.bitRate){if(!a.ClientUtil.checkInteger(e.custom.bitRate))return t.logger.error(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate must be integer number"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number");if(e.custom.bitRate>10240)return t.logger.error(i.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate cannot greater than 10 Mbps"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps")}if(e&&e.custom&&e.custom.audioBitrate){if(!a.ClientUtil.checkInteger(e.custom.audioBitrate))return t.logger.error("ze.cs.0 audioBitrate must be integer number"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate must be integer number");if(e.custom.audioBitrate<6)return t.logger.error("ze.cs.0 audioBitrate cannot less 6 kbps"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot less 6 kbps");if(e.custom.audioBitrate>510)return t.logger.error("ze.cs.0 audioBitrate cannot greater than 510 kbps"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot greater than 510 kbps")}if(e&&e.custom&&void 0!==e.custom.channelCount&&1!==e.custom.channelCount&&2!==e.custom.channelCount)return t.logger.error("ze.cs.0 channelCount must number 1 or 2"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," channelCount must number 1 or 2");var _={};if(e&&e.camera)l="camera",_=e.camera,t.dataReport.addMsgInfo(u,{stream_type:s.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("camera"),camera:s.ZegoRTCLogEvent.kZegoTaskCreateStream.camera(e.camera)}),"boolean"!=typeof _.video&&(_.video=!0),"boolean"!=typeof _.audio&&(_.audio=!0);else if(e&&e.custom){l="custom",_=e.custom;var E=e.custom.source instanceof MediaStream?"MediaStream":"HTMLElement";t.dataReport.addMsgInfo(u,{stream_type:s.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("custom"),custom:s.ZegoRTCLogEvent.kZegoTaskCreateStream.custom(o(o({},e.custom),{source:E}))})}t.startPreview(_,l,h,p)}}))},e.prototype.destroyStream=function(e){this.logger.info(i.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" call");var t=n.getReportSeq();if(this.dataReport.newReport(t),!(e instanceof MediaStream))return this.logger.error(i.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" localStream is not mediaStream or tracks is null"),this.dataReport.addMsgInfo(t,s.ZegoRTCLogEvent.kZegoTaskDestroyStream.error.kLocalStreamError),void this.dataReport.uploadReport(t,s.ZegoRTCLogEvent.kZegoTaskDestroyStream.event);e instanceof MediaStream&&0==e.getTracks().length&&this.logger.info(i.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" tracks is null"),this.stopPreview(e),this.dataReport.uploadReport(t,s.ZegoRTCLogEvent.kZegoTaskDestroyStream.event)},e.prototype.startPublishingStream=function(e,t,r,o){this.logger.info(i.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" call ",e);var c,l=!0,d="",u=n.getReportSeq();if(this.stateCenter.reportSeqList.startPublish[e]=u,this.dataReport.newReport(u,s.ZegoRTCLogEvent.kZegoTaskPublishStart.event),l&&void 0===e&&(d="stream id required",this.logger.error(i.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+d),l=!1,c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),!l||e&&"string"==typeof e||(d="stream id type wrong",this.logger.error(i.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+d),l=!1,c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),l&&e.length>n.MAX_STREAM_ID_LENGTH&&(d="stream id length limit",this.logger.error(i.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+d),l=!1,c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),l&&!a.ClientUtil.checkIllegalCharacters(e)&&(d="stream ID contains illegal characters",this.logger.error(i.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+d),l=!1,c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),l&&(!t||t instanceof MediaStream&&0==t.getTracks().length)&&(d="localStream wrong",this.logger.error(i.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+d),l=!1,c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),l&&!this.streamCenter.checkPreview(t)&&(d="stream is not from zego",this.logger.error(i.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+d),l=!1,c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNoPreviewError),l&&void 0!==r&&"object"!=typeof r&&(l=!1,c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,d="publishOption must be object"),l&&void 0!==r&&void 0!==r.streamParams&&"string"!=typeof r.streamParams&&(this.logger.error(i.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption streamParams must be string"),l=!1,c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,d=" publishOption streamParams must be string"),l&&void 0!==r&&void 0!==r.extraInfo&&"string"!=typeof r.extraInfo&&(this.logger.error(i.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption extraInfo must be string"),l=!1,c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,d=" publishOption extraInfo must be string"),l&&void 0!==r&&void 0!==r.videoCodec&&"string"!=typeof r.videoCodec&&(this.logger.error(i.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption videoCodec must be string"),l=!1,c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,d=" publishOption videoCodec must be string"),!l||!this.stateCenter.isMultiRoom||r&&"string"==typeof r.roomID&&""!=r.roomID||(l=!1,c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,d=" roomID is need if set multi room"),r&&r.videoCodec&&(r.videoCodec=r.videoCodec.toUpperCase()),l&&this.rtm.service.isDisConnect()&&(this.logger.error("zc.p.sps.1 not login"),l=!1,c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNoLoginError),!l)return this.logger.error(i.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+d),this.dataReport.uploadReport(u,void 0,c,d),delete this.stateCenter.reportSeqList.startPublish[e],!1;r||(r={}),this.dataReport.addMsgInfo(u,{stream:s.ZegoRTCLogEvent.kZegoTaskPublishStart.stream(e),publishOption:s.ZegoRTCLogEvent.kZegoTaskPublishStart.publishOption(r)}),r.audioBitRate=this.stateCenter.audioBitRate;var h,p=r.roomID?r.roomID:this.stateCenter.roomList[0]?this.stateCenter.roomList[0].roomID:"",g=this.stateCenter.getRoomByRoomID(p);if(!g)return this.logger.error("zc.p.sps.1 room no found"),!1;if(this.dataReport.addMsgInfo(u,{publish_room_id:p,isMulti:this.stateCenter.isMultiRoom}),this.stateCenter.customUrl&&0!=this.stateCenter.customUrl.length)this.logger.info("zc.p.sps.1 customUrl "+JSON.stringify(this.stateCenter.customUrl)),h=this.stateCenter.customUrl;else{var f=this.stateCenter.settingConfig.getSetting("signal_nodes",!0);f&&f instanceof Array&&f.length>0&&(h=f,this.logger.info("zc.p.sps.1 setting config signal_nodes "+JSON.stringify(f)))}if(h)return this.stateCenter.publishStreamList[e]={state:n.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:r.extraInfo?r.extraInfo:null},this.streamCenter.setPublishStateStart(g,e,t,r,o)?(g.streamHandler.onPublishStateUpdate(n.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""}),this.streamCenter.publisherList[e].serverUrls=h,this.streamCenter.startPublishingStream(e)):(this.logger.info("zc.p.sps.1 cannot start publish"),!1);if(!this.streamCenter.setPublishStateStart(g,e,t,r,o))return this.logger.error("zc.p.sps.1 cannot start publish"),!1;this.stateCenter.publishStreamList[e]={state:n.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:r.extraInfo?r.extraInfo:null},this.logger.info("zc.p.sps.1 start publish"),g.streamHandler.onPublishStateUpdate(n.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""});var m=this.streamCenter.publisherList[e].retryDispatchHandler;return m.stopMaxTime(),m.invalid(),m.initStream(e,r,!0),m.startMaxTime(),m.active(0)},e.prototype.activateSEIInsert=function(e,t,r){return void 0===r&&(r=0),!1},e.prototype.stopPublishingStream=function(e,t){this.logger.info(i.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" call ",e+(t?t.toString():""));var r=n.getReportSeq();if(this.stateCenter.reportSeqList.stopPublish[e]=r,this.dataReport.newReport(r,s.ZegoRTCLogEvent.kZegoTaskPublishStop.event),this.dataReport.addMsgInfo(r,{streamID:s.ZegoRTCLogEvent.kZegoTaskPublishStop.stream(e)}),"string"!=typeof e||""==e)return this.logger.error(i.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" streamID must be string and not empty"),this.dataReport.uploadReport(r,void 0,s.ZegoRTCLogEvent.kZegoTaskPublishStop.error.kParamError,"stream id type error"),delete this.stateCenter.reportSeqList.stopPublish[e],!1;var o=this.streamCenter.publisherList[e],a=this.streamCenter.getRoomByStreamID(e),c=o&&o.publisher&&o.publisher.state!==n.ENUM_PUBLISH_STATE.stop;if(this.streamCenter.stopPublishingStream(e),this.stateCenter.publishStreamList[e]){if(this.stateCenter.publishStreamList[e].state>=n.ENUM_PUBLISH_STREAM_STATE.update_info&&a){if(!t||1102018!==t.code){var l;l="PUBLIC"===this.stateCenter.type?n.ENUM_STREAM_SUB_CMD.liveEnd:n.ENUM_STREAM_CMD_PRI.liveEnd,a.streamHandler.updateStreamInfo(e,l)}for(var d=0;d<a.streamList.length;d++)if(a.streamList[d].stream_id==e){a.streamList.splice(d--,1);break}}delete this.stateCenter.publishStreamList[e]}return this.dataReport.uploadReport(r),a&&c&&a.streamHandler.onPublishStateUpdate(n.ENUM_PUBLISH_STATE_UPDATE.error,e,t||{code:0,message:""}),!0},e.prototype.setCaptureVolume=function(e,t){var r=this;return new Promise((function(o){var n;r.logger.info(i.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" call");var a=function(e){r.logger.error(i.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" "+e),o({errorCode:s.ZegoRTCLogEvent.kZegoSetCaptureVolume.error.kParamError.code,extendedData:JSON.stringify({fail_reason:s.ZegoRTCLogEvent.kZegoSetCaptureVolume.error.kParamError.message+" "+e})})},c=r.streamCenter.ac,l=r.streamCenter.checkPreview(e);if(e instanceof MediaStream&&l)if(0!=e.getAudioTracks().length)if("number"!=typeof t||t<0||t>100)a(" volume must be number between 0 to 100");else{if(l.gainNode)l.gainNode.gain.value=t/100;else{var d=c.createMediaStreamSource(e),u=c.createGain(),h=c.createMediaStreamDestination();d.connect(u),u.connect(h);var p=h.stream.getAudioTracks()[0];for(var g in r.streamCenter.publisherList){var f=r.streamCenter.publisherList[g];if(f.localStream==e){var m=null===(n=f.publisher.peerConnection)||void 0===n?void 0:n.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));m&&(m.replaceTrack(p),f.localStream.removeTrack(f.publisher.localStream.getAudioTracks()[0]),f.localStream.addTrack(p));break}}e.removeTrack(e.getAudioTracks()[0]),e.addTrack(p),l.gainNode=u,l.gainNode.gain.value=t/100}c.resume(),o({errorCode:0,extendedData:""}),r.logger.info(i.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" call success")}else a(" stream audioTrack no found");else a(" stream must be created by zego")}))},e.prototype.getElectronScreenSources=function(){var e=this;return new Promise((function(t,r){var o=window.require("electron");o||(e.logger.error("zc.gess.0 Electron is not exist"),r({message:"Electron is not exist"})),o.desktopCapturer.getSources({types:["window","screen"]}).then((function(e){var r=e.map((function(e){return{id:e.id,name:e.name,thumbnail:e.thumbnail}}));t(r)})).catch((function(t){e.logger.error("zc.gess.0 "+t),r(t)}))}))},e.prototype.startScreenShotChrome=function(e){if(d.ZegoWebRTC.screenShotReady)window.postMessage({type:"SS_UI_REQUEST",text:"start"},"*"),a.ClientUtil.registerCallback("screenShare",{success:e},this.stateCenter.callbackList);else{var t='zc.b.ss Please install the extension:1. Go to chrome://extensions  2. Check: "Enable Developer mode   3. Click: "Load the unpacked extension... 4. Choose "extension" folder from the repository 5. Reload this page';this.logger.error(t),e(!1,null,{code:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+t})}},e.prototype.startScreenSharing=function(e,t){var r=this;"getDisplayMedia"in navigator.mediaDevices?navigator.mediaDevices.getDisplayMedia({audio:e.audio,video:{frameRate:e.frameRate,width:e.width,height:e.height}}).then((function(e){t(!0,e)})).catch((function(e){r.logger.error("zc.b.sss "+e),e.message&&"permission denied"==e.message.toLowerCase()?t(!1,null,s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenCancelError):t(!1,null,{code:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+e})})):(this.logger.error("zc.b.sss brower does not support getDisplayMedia"),t(!1,null,s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError))},e.prototype.startScreenShotFirFox=function(e,t,r){var o=this,i={video:{frameRate:t.frameRate,bitRate:t.bitRate,width:t.width,height:t.height,mediaSource:e},audio:t.audio};navigator.mediaDevices.getUserMedia(i).then((function(e){r(!0,e)})).catch((function(e){o.logger.error("ze.ssf.1 "+e),r(!1,null,{code:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+e})}))},e.prototype.startScreenShotElectron=function(e,t){var r=this;if(!window.require("electron"))return this.logger.error("ze.sse.1 Electron is not exist"),void t(!1,null,{code:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" Electron is not exist"});var o={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e.sourceID,maxWidth:window.screen.width,maxHeight:window.screen.height}},audio:!1};navigator.mediaDevices.getUserMedia(o).then((function(e){t(!0,e)})).catch((function(e){r.logger.error("ze.sse.1 "+e),t(!1,null,{code:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+e})}))},e.prototype.startPreview=function(e,t,r,o){var i=this,n=null;return n=new l.ZegoPreview(this.logger,this.streamCenter.ac,this.stateCenter,this.streamCenter,t),this.streamCenter.previewStreamList.push(n),n.startPreview(e,(function(o){i.streamCenter.soundLevelDelegate&&(null==n||n.startSoundLevel()),"camera"===t&&(null==n?void 0:n.micTrack)&&(n.micTrack.enabled=i.streamCenter.isMicEnabled),(null==e?void 0:e.videoOptimizationMode)&&i.streamCenter.setVideoTrackContentHint(o,null==e?void 0:e.videoOptimizationMode),i.logger.debug("zsc.sp.0 call success"),!i.stateCenter.deviceInfos&&i.recordDevices(),r&&r(o)}),(function(e){i.streamCenter.previewStreamList=i.streamCenter.previewStreamList.filter((function(e){return e!==n})),o&&o(e)})),!0},e.prototype.stopPreview=function(e){if(!e)return this.logger.warn("zsc.sp.0 localStream null"),!1;for(var t in this.streamCenter.publisherList)this.streamCenter.publisherList[t].localStream===e&&(this.streamCenter.publisherList[t].localStream=null);var r=this.streamCenter.checkPreview(e);return r?(r.previewSuc&&(r.stopPreview(),this.streamCenter.removePreview(r)),!0):(this.logger.warn("zsc.sp.0 no preview"),!1)},e.prototype.recordDevices=function(e,t){var r,o=this;this.logger.info("zsc.rd.0 call"),a.ClientUtil.getDevices((function(t){o.stateCenter.deviceInfos={microphones:t.microphones,speakers:t.speakers,cameras:t.cameras},e&&e(t)}),(function(e){o.logger.warn("zsc.rd.0 getDevices err:",e),t&&t(e)})),void 0!==(null===(r=navigator.mediaDevices)||void 0===r?void 0:r.ondevicechange)&&(navigator.mediaDevices.ondevicechange=null,navigator.mediaDevices.ondevicechange=function(e){o.logger.info("zsc.rd.0 devicechange"),o.stateCenter.deviceChangeTimer&&(clearTimeout(o.stateCenter.deviceChangeTimer),o.stateCenter.deviceChangeTimer=null),o.stateCenter.deviceChangeTimer=setTimeout((function(){a.ClientUtil.getDevices((function(e){for(var t=[],r=function(r){var i=o.stateCenter.deviceInfos.cameras[r];e.cameras.find((function(e){return e.deviceID===i.deviceID}))||t.push(i)},i=0;i<o.stateCenter.deviceInfos.cameras.length;i++)r(i);o.stateCenter.deviceStateOut=!1;var a=!1;t.length>0&&(a=!0),t.forEach((function(e){for(var t in o.streamCenter.publisherList){var r=o.streamCenter.publisherList[t],i=r.publisher;r.localStream&&r.cameraLabel===e.deviceName&&(a=!1,i.sendStreamStatus(-6,i.mic_status),o.stateCenter.actionListener("_deviceError",c.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,e.deviceName,"camera"),o.stateCenter.actionListener("deviceError",c.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,e.deviceName)),r.localStream&&0===r.localStream.getAudioTracks().length&&(a=!1)}var l=n.getReportSeq();o.dataReport.newReport(l,s.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),o.dataReport.addMsgInfo(l,{interrupt:0}),o.dataReport.uploadReport(l),o.stateCenter.actionListener("videoDeviceStateChanged","DELETE",e)})),a&&(o.stateCenter.deviceStateOut=!0),o.stateCenter.deviceInfos.microphones.filter((function(t){return!e.microphones.find((function(e){return e.deviceID===t.deviceID}))})).forEach((function(e){for(var t in o.streamCenter.publisherList){var r=o.streamCenter.publisherList[t],i=r.publisher;r.localStream&&(r.microLabel===e.deviceName||r.microLabel.includes(e.deviceName))&&(i.sendStreamStatus(i.camera_status,-6),o.stateCenter.actionListener("_deviceError",c.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,o.streamCenter.publisherList[t].microLabel,"micro"),o.stateCenter.actionListener("deviceError",c.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,o.streamCenter.publisherList[t].microLabel))}var a=n.getReportSeq();o.dataReport.newReport(a,s.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),o.dataReport.addMsgInfo(a,{interrupt:0}),o.dataReport.uploadReport(a),o.stateCenter.actionListener("audioDeviceStateChanged","DELETE","Input",e)}));var l=o.stateCenter.deviceInfos.speakers.filter((function(t){return!e.speakers.find((function(e){return e.deviceID===t.deviceID}))})),d=e.cameras.filter((function(e){return!o.stateCenter.deviceInfos.cameras.find((function(t){return t.deviceID===e.deviceID}))})),u=e.microphones.filter((function(e){return!o.stateCenter.deviceInfos.microphones.find((function(t){return t.deviceID===e.deviceID}))})),h=e.speakers.filter((function(e){return!o.stateCenter.deviceInfos.speakers.find((function(t){return t.deviceID===e.deviceID}))}));l.forEach((function(e){var t=n.getReportSeq();o.dataReport.newReport(t,s.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.event),o.dataReport.addMsgInfo(t,{reason:s.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.reason("delete"),device:s.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.device(e)}),o.dataReport.uploadReport(t),o.stateCenter.actionListener("audioDeviceStateChanged","DELETE","Output",e)})),d.forEach((function(e){var t=n.getReportSeq();o.dataReport.newReport(t,s.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),o.dataReport.addMsgInfo(t,{interrupt:1}),o.dataReport.uploadReport(t),o.stateCenter.actionListener("videoDeviceStateChanged","ADD",e)})),u.forEach((function(e){var t=n.getReportSeq();o.dataReport.newReport(t,s.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),o.dataReport.addMsgInfo(t,{interrupt:1}),o.dataReport.uploadReport(t),o.stateCenter.actionListener("audioDeviceStateChanged","ADD","Input",e)})),h.forEach((function(e){var t=n.getReportSeq();o.dataReport.newReport(t,s.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.event),o.dataReport.addMsgInfo(t,{reason:s.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.reason("add"),device:s.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.device(e)}),o.dataReport.uploadReport(t),o.stateCenter.actionListener("audioDeviceStateChanged","ADD","Output",e)})),o.stateCenter.deviceInfos={microphones:e.microphones,speakers:e.speakers,cameras:e.cameras}}),(function(e){o.logger.warn("zsc.rd.0 getDevices err:",e)}))}),500)})},e}();t.PublishModule=u},3770:function(e,t,r){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPreview=void 0;var s=r(6706),a=r(3529),c=r(1089),l=function(){function e(e,t,r,o,i){var n=this;this.logger=e,this.ac=t,this.stateCenter=r,this.streamCenter=o,this.previewType=i,this.localStream=null,this.videoInfo={},this.previewSuc=!1,this.soundLevel=0,this.script=null,this.mic=null,this.audioTrack=null,this.activateSEIConfig=null,this.isAudioEnabled=!0,this.gainNode=null,this.cameraMaxResolution={},this.enableMicrophoneOnly=function(e,t){var r;if(!n.localStream)return n.logger.error("zp.em.2 no localStream"),!1;var o=null===(r=t.checkPublish(n.localStream))||void 0===r?void 0:r.publisher;if(o){var i=o.camera_status,s=n.isAudioEnabled&&e?0:20;o.camera_status===i&&o.mic_status===s||o.sendStreamStatus(i,s)}return n.micTrack?(n.micTrack.enabled=n.isAudioEnabled&&e,n.logger.debug("zp.emo.2 call success"),!0):(n.logger.info("zp.emo.2 no micTrack"),!0)}}return Object.defineProperty(e.prototype,"micTrack",{get:function(){return"camera"===this.previewType&&this.audioTrack||null},enumerable:!1,configurable:!0}),e.prototype.getMediaStreamConstraints=function(e,t){var r={audio:null,video:null};if(r.audio=!0,r.video={width:640,height:480,frameRate:15,bitRate:this.stateCenter.settingConfig.getSetting("camera_video_bitrate")},e.audio?void 0===e.audioInput&&void 0===e.ANS&&void 0===e.AGC&&void 0===e.AEC&&void 0===e.channelCount?(r.audio={},r.audio.noiseSuppression=this.stateCenter.settingConfig.getSetting("ANS"),r.audio.autoGainControl=this.stateCenter.settingConfig.getSetting("AGC"),r.audio.echoCancellation=this.stateCenter.settingConfig.getSetting("AEC"),r.audio.channelCount=1):(r.audio={},void 0!==e.audioInput&&null!==e.audioInput&&(r.audio.deviceId={exact:e.audioInput}),void 0!==e.ANS&&(r.audio.noiseSuppression=e.ANS),void 0!==e.AGC&&(r.audio.autoGainControl=e.AGC),void 0!==e.AEC&&(r.audio.echoCancellation=e.AEC),void 0!==e.channelCount&&(r.audio.channelCount=e.channelCount)):!1===e.audio&&(r.audio=!1),e.video){var o=640,i=480,n=15,a=this.stateCenter.settingConfig.getSetting("camera_video_bitrate");if(1===e.videoQuality?(o=s.ENUM_RESOLUTION_TYPE.LOW.width,i=s.ENUM_RESOLUTION_TYPE.LOW.height,n=s.ENUM_RESOLUTION_TYPE.LOW.frameRate,a=s.ENUM_RESOLUTION_TYPE.LOW.bitRate):2===e.videoQuality?(o=s.ENUM_RESOLUTION_TYPE.MEDIUM.width,i=s.ENUM_RESOLUTION_TYPE.MEDIUM.height,n=s.ENUM_RESOLUTION_TYPE.MEDIUM.frameRate,a=s.ENUM_RESOLUTION_TYPE.MEDIUM.bitRate):3===e.videoQuality?(o=s.ENUM_RESOLUTION_TYPE.HIGH.width,i=s.ENUM_RESOLUTION_TYPE.HIGH.height,n=s.ENUM_RESOLUTION_TYPE.HIGH.frameRate,a=s.ENUM_RESOLUTION_TYPE.HIGH.bitRate):4===e.videoQuality?(o=e.width,i=e.height,n=e.frameRate,a=e.bitRate||this.stateCenter.settingConfig.getSetting("camera_video_bitrate")):this.logger.info("zp.gmsc.2 use default"),t&&(e.width&&(o=e.width),e.height&&(i=e.height),e.frameRate&&(n=e.frameRate),e.bitRate&&(a=e.bitRate)),!1===e.horizontal){var c=i;i=o,o=c}!0===e.isSwitch&&(c=i,i=o,o=c),r.video={width:o,height:i,frameRate:n,bitRate:a},null!=e.facingMode?r.video.facingMode=e.facingMode:null!=e.videoInput&&null!=e.videoInput&&""!=e.videoInput&&(r.video.deviceId={exact:e.videoInput}),this.logger.info("zp.gmsc.2 width: "+o+" height: "+i+" rate: "+n)}else!1===e.video&&(e.audioBitrate&&(r.video={}),r.video=!1);return r},e.prototype.startPreview=function(e,t,r){return i(this,void 0,void 0,(function(){var i,s,c,l,d,u,h,p=this;return n(this,(function(n){return this.logger.debug("zp.sv.2 called"),this.mediaStreamConfig=e,void 0===navigator.mediaDevices||null==navigator.mediaDevices.getUserMedia?(r&&r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError),[2]):e.source instanceof MediaStream?(i=e.source.getVideoTracks(),s=i.length>0?i[0].getSettings():{width:0,height:0,frameRate:0},this.logger.debug("zp.sv.2 use external media stream"),this.previewSuc=!0,this.localStream=e.source,e.source.getAudioTracks().length>0&&(this.audioTrack=e.source.getAudioTracks()[0]),this.videoInfo={width:s.width,height:s.height,frameRate:s.frameRate,bitRate:e.bitRate||this.stateCenter.settingConfig.getSetting("custom_video_bitrate"),startBitrate:e.startBitrate||this.stateCenter.settingConfig.getSetting("bitrate_mode"),channelCount:e.channelCount||(this.audioTrack&&this.audioTrack.getSettings?this.audioTrack.getSettings().channelCount:1),audioBitrate:1e3*e.audioBitrate||48e3},t&&t(this.localStream),[2]):e.source instanceof HTMLMediaElement?((c=this.captureStream(e.source,e))?(this.videoInfo.bitRate=e.bitRate||this.stateCenter.settingConfig.getSetting("custom_video_bitrate"),this.previewSuc=!0,c.getAudioTracks().length>0&&(this.audioTrack=c.getAudioTracks()[0]),t&&t(c)):r&&r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError),[2]):((l=this.getMediaStreamConstraints(e)).audio&&(d=this.stateCenter.settingConfig.getSetting("AEC",!0),u=this.stateCenter.settingConfig.getSetting("AGC",!0),h=this.stateCenter.settingConfig.getSetting("ANS",!0),"boolean"==typeof d&&(this.logger.info("zp.sv.2 setting AEC "+d),l.audio.echoCancellation=d),"boolean"==typeof u&&(this.logger.info("zp.sv.2 setting AGC "+u),l.audio.autoGainControl=u),"boolean"==typeof h&&(this.logger.info("zp.sv.2 setting ANS "+h),l.audio.noiseSuppression=h)),this.videoInfo=o({},l.video),this.videoInfo?(this.videoInfo.audioBitrate=1e3*e.audioBitrate||48e3,this.videoInfo.startBitrate=e.startBitrate||this.stateCenter.settingConfig.getSetting("bitrate_mode")):e.audioBitrate&&(this.videoInfo={audioBitrate:1e3*e.audioBitrate||48e3}),this.mediaStreamConfig.video=!!l.video,this.mediaStreamConfig.audio=!!l.audio,this.logger.info("zp.sv.2 ",JSON.stringify(l)),e.unlimitedCaptureResolution&&l.video.width&&(l.video.width={ideal:4096},l.video.height={ideal:2160},this.logger.info("zp.sv.2 ","capture max resolution of camera")),navigator.mediaDevices.getUserMedia(l).then((function(r){p.logger.info("zp.sv.2 success"),p.localStream=r,p.previewSuc=!0,r.getAudioTracks().length>0&&(p.audioTrack=p.localStream.getAudioTracks()[0]),p.videoInfo&&(p.videoInfo.channelCount=e.channelCount||(p.audioTrack&&p.audioTrack.getSettings?p.audioTrack.getSettings().channelCount:1)),t&&t(r)}),(function(e){if(p.logger.info("zp.sv.2 failed ",e.name," ",e.message),r){var t=a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kGetUserMediaError;t.message=t.message+" "+e.name+" "+e.message,"NotAllowedError"===e.name||"SecurityError"===e.name?(t=o({},a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kDeviceNoAllowedError)).message=e.name+": "+t.message:"NotReadableError"===e.name?(t=o({},a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kDeviceNoReadableError)).message=e.name+": "+t.message:"OverconstrainedError"===e.name&&((t=o({},a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kDeviceOverConstrainedError)).message=e.name+": "+t.message+(e.constraint?". such as "+e.constraint:"")),r(t)}})),[2])}))}))},e.prototype.captureStream=function(e,t){if(!e)return this.logger.info("zp.cs.2 no local video"),null;var r;if(e.captureStream)r=e.captureStream(),this.logger.debug("zp.cs.2 captureStream");else{if(!e.mozCaptureStream)return this.logger.info("zp.cs.2 don't support"),null;r=e.mozCaptureStream(),this.logger.debug("zp.cs.2 mozCaptureStream")}return 0==r.getTracks().length?(this.logger.error("zp.cs.2 external capture tracks no found"),null):(this.localStream=r,this.videoInfo={width:e.videoWidth,height:e.videoHeight,frameRate:0,bitRate:t.bitRate||this.stateCenter.settingConfig.getSetting("custom_video_bitrate"),channelCount:t.channelCount||(this.audioTrack&&this.audioTrack.getSettings?this.audioTrack.getSettings().channelCount:1),audioBitrate:1e3*t.audioBitrate||48e3,startBitrate:t.startBitrate||this.stateCenter.settingConfig.getSetting("bitrate_mode")},this.logger.debug("zp.cs.2 called success"),this.localStream)},e.prototype.stopPreview=function(){this.logger.info("zp.sv.2.1 called"),this.localStream&&(this.localStream.getTracks().reverse().forEach((function(e){return e.stop()})),this.audioTrack&&this.audioTrack.stop(),this.localStream=null,this.videoInfo={})},e.prototype.enableMicrophone=function(e,t){return!1},e.prototype.enableCamera=function(e,t,r){return!1},e.prototype.startSoundLevel=function(){var e=this;if(this.localStream&&0!=this.localStream.getAudioTracks().length){this.script&&this.script.disconnect()&&(this.script=null),this.mic&&this.mic.disconnect()&&(this.mic=null);try{this.mic=this.ac.createMediaStreamSource(this.localStream),this.script=this.ac.createScriptProcessor(4096,1,1),this.mic.connect(this.script),this.script.connect(this.ac.destination),this.script.onaudioprocess=function(t){for(var r=t.inputBuffer.getChannelData(0),o=0,i=0;i<r.length;i++)o<r[i]&&(o=r[i]);e.soundLevel=100*o},this.ac.resume()}catch(e){this.logger.error(c.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" get sound level failed "+e)}}},e.prototype.stopSoundLevel=function(){this.soundLevel=0,this.script&&this.script.disconnect(),this.mic&&this.mic.disconnect(),this.script=null,this.mic=null},e.prototype.restartSoundLevel=function(){this.streamCenter.soundLevelDelegate?(this.stopSoundLevel(),this.startSoundLevel()):this.stopSoundLevel()},e}();t.ZegoPreview=l},1547:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPublish=void 0;var o=r(6706),i=r(4767),n=r(608),s=r(3529),a=r(1089),c=function(){function e(e,t,r,i,n,s,a,c){this.state=o.ENUM_PUBLISH_STATE.stop,this.sessionId=0,this.sessionToken="",this.candidateInfo=[],this.qualityTimer=null,this.publishQualityList=[],this.maxQualityListCount=10,this.lastPublishStats={},this.reportSeq=NaN,this.streamReportSeq=o.getSeq(),this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.qualitySeq=0,this.videoInfo={width:0,height:0,frameRate:0,bitRate:0,channelCount:1,audioBitrate:48e3},this.mediaStreamConfig=null,this.offerSeq=0,this.audioMixList=[],this.arrayBufferMap={},this.effectList=[],this.peerConnection=null,this.qualityCount=0,this.closeSessionSignal=!1,this.channelCount=1,this.localSdpOrder=[],this.remoteSdpOrder=[],this.videoCodec="H264",this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.stop,this.negoInterval=25e3,this.publishEvent=!1,this.cameraState="on",this.microState="on",this.gwNode="",this.gwNodeList=[],this.gwNodeTTL=0,this.needIncMax=!1,this.probeCount=0,this.gotMax=!1,this.initFitCnt=0,this.targetRate=0,this.totalBitrateArray=[],this.totalTargetRateArray=[],this.totalRetransRateArray=[],this.isPeer=!1,this.peerFailCount=0,this.peerID=0,this.netQuality=0,this.probeTime=0,this.probeInterval=6e4,this.probeState=o.ENUM_PROBE_STATE.probed,this.iceDisconnectedMaxTime=15e3,this.toBeReplacedTracks={},this.send_seq=0,this.dataChannelState=0,this.first_pkt=!0,this.next_sn=[],this.pkt_list=[],this.camera_status=2,this.mic_status=2,this.streamId=e,this.logger=t,this.dataReport=r,this.qualityTimeInterval=i,this.ac=s,this.mediaEleSources=a,this.streamCenter=n,this.stateCenter=c,this.dataReport.newReport(this.streamReportSeq),this.videoCodec=this.stateCenter.settingConfig.getSetting("publish_video_codec")}return Object.defineProperty(e.prototype,"previewer",{get:function(){return this.streamCenter.checkPreview(this.localStream)},enumerable:!1,configurable:!0}),e.prototype.publishStateUpdateError=function(e,t){this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_STATE_ERROR+"  call ",this.streamId,JSON.stringify(e)),this.streamId&&this.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.error,this.streamId,e,t),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_STATE_ERROR+"  ended")},e.prototype.resetPublish=function(){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_RESET_PUBLISH+"   "+this.streamId+" call"),this.state=o.ENUM_PUBLISH_STATE.stop,this.publishEvent=!1,null==this.peerConnection&&null==this.peerConnection||(this.peerConnection.close(),this.peerConnection=null),null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),null!=this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null),this.clearPublishQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId),this.signal.unregisterPushCallback("SessionResetPush",this.sessionId),this.signal.unregisterPushCallback("PublishEventPush",this.sessionId),this.signal.unregisterPushCallback("ClientInfoPush",this.sessionId)),this.sessionSeq=0,this.offerSeq=0,this.candidateInfo=[],this.publishQualityList=[],this.qualityUploadLastTime=0,this.resetEncBitrate()},e.prototype.clearPublishQualityTimer=function(){null!=this.qualityTimer&&(clearInterval(this.qualityTimer),this.qualityTimer=null),this.lastPublishStats={},this.qualityCount=0},e.prototype.shouldSendCloseSession=function(){return this.state!=o.ENUM_PUBLISH_STATE.stop&&this.state!=o.ENUM_PUBLISH_STATE.waitingSessionRsp},e.prototype.startPublish=function(e,t,r,o,i){var n,c=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+e+" called"),this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),e){var l;this.localStream=t,this.mediaStreamConfig=o,this.channelCount=o.channelCount,this.publishOption=i||{},navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&o&&(o.externalCapture||o.externalMediaStream)&&(this.localStream.onaddtrack=function(){var e,t;c.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+c.streamId+" Track added");var r=c.localStream.getVideoTracks(),o=c.localStream.getAudioTracks();if(r.length>1)null==(i=null===(e=c.peerConnection)||void 0===e?void 0:e.getSenders().find((function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.kind)===r[1].kind})))||i.replaceTrack(r[1]),c.localStream.removeTrack(r[0]);else if(o.length>1){var i=null===(t=c.peerConnection)||void 0===t?void 0:t.getSenders().find((function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.kind)===o[1].kind}));null==i||i.replaceTrack(o[1]),c.localStream.removeTrack(o[0])}}),r&&(this.videoInfo=r),i&&i.videoCodec&&(this.videoCodec=i.videoCodec);var d=null===(n=this.previewer)||void 0===n?void 0:n.previewType;switch(d){case"camera":l=this.stateCenter.settingConfig.getSetting("camera_video_bitrate",!0);break;case"screen":l=this.stateCenter.settingConfig.getSetting("screen_video_bitrate",!0);break;case"custom":l=this.stateCenter.settingConfig.getSetting("custom_video_bitrate",!0)}l&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" setting "+d+" "+l),this.videoInfo.bitRate=l);var u=this.stateCenter.settingConfig.getSetting("bitrate_mode",!0);u&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" setting bitrate_mode "+u),this.videoInfo.startBitrate=u);var h=this.stateCenter.settingConfig.getSetting("publish_video_codec",!0);h&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" setting publish_video_codec "+h),this.videoCodec=h),this.dataReport.addMsgInfo(this.reportSeq,{video_en_codec_id:s.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_codec_id("VP8"==this.videoCodec?2:0),audio_c_channel_count:s.ZegoRTCLogEvent.kZegoTaskPublishStart.audio_c_channel_count(2==this.channelCount?2:1),audio_en_bps:s.ZegoRTCLogEvent.kZegoTaskPublishStart.audio_en_bps(this.videoInfo.audioBitrate),aec_level:s.ZegoRTCLogEvent.kZegoTaskPublishStart.aec_level(1==o.AEC?2:0==o.AEC?0:2),ans_level:s.ZegoRTCLogEvent.kZegoTaskPublishStart.ans_level(1==o.ANS?2:0==o.ANS?0:2),agc:s.ZegoRTCLogEvent.kZegoTaskPublishStart.agc(1==o.AGC?2:0==o.AGC?0:2),traffic_control_min_video_bitrate:s.ZegoRTCLogEvent.kZegoTaskPublishStart.traffic_control_min_video_bitrate(this.videoInfo.bitRate)}),this.isPeer?this.createOffer():this.createSession(),this.negoTimer=setTimeout((function(){c.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" waiting timeout"),c.publishStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNegoTimeoutError)}),this.negoInterval)}else this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+e+" streamId is null")},e.prototype.activateSEIInsert=function(e,t){return new Promise((function(e,t){e(!1)}))},e.prototype.createSession=function(e){var t=this;this.sessionSeq=o.getSeq();var r=this.streamId;1==this.streamCenter.testEnvironment&&(r="zegotest-"+this.streamCenter.appid+"-"+this.streamId);var i=this.stateCenter.settingConfig.getSetting("gw_nodes");i&&i instanceof Array&&i.length>0&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" setting "+JSON.stringify(i)),this.gwNodeList=i,this.gwNode=this.gwNodeList[0]||this.gwNode),this.isPeer?(this.dataReport.eventStart(this.reportSeq,"CreateSessionWithSdp"),this.dataReport.eventStart(this.streamReportSeq,"CreateSessionWithSdp"),this.signal.createSessionWithSdp({seq:this.sessionSeq,type:0,mode:0,streamId:r,videoInfo:this.videoInfo,strAuthParam:this.publishOption&&this.publishOption.streamParams||"",sdp:e.sdp,serverHost:this.gwNode},(function(e,r,o){t.handleCreateSessionWithSdpResp(e,r,o)}),(function(r,i){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:r}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:r}),r==o.SEND_MSG_TIMEOUT&&t.peerFailCount<2?(t.peerFailCount++,t.createSession(e)):r==o.SEND_MSG_TIMEOUT&&t.peerFailCount>=2?(t.isPeer=!1,t.streamCenter.isPeer=!1,t.createSession()):t.publishStateUpdateError(r==o.SEND_MSG_TIMEOUT?s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError:s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)}))):(this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.dataReport.eventStart(this.streamReportSeq,"CreateSession"),this.signal.createSession(this.sessionSeq,0,0,r,this.publishOption&&this.publishOption.streamParams,this.gwNode,(function(e,r,o){t.handleCreateSessionResp(e,r,o)}),(function(e,r){t.reportSeq,t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:e}),t.publishStateUpdateError(e==o.SEND_MSG_TIMEOUT?s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError:s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)}))),this.state=o.ENUM_PUBLISH_STATE.waitingSessionRsp,this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" called success"),this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.start},e.prototype.handleCreateSessionResp=function(e,t,r){var o=r.turn_server,i=o.split("?")[0]&&o.split("?")[0].slice(5),n=this.streamCenter.server.split("?"),c=n[1]&&n[1].slice(2);this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+i+"/"+c+"/"+this.streamId}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+i+"/"+c+"/"+this.streamId}),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" sessionId:"+r.session_id),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,0!==r.result?(this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" create session failed "+r.result),this.publishStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)):(this.sessionId=r.session_id,this.sessionToken=r.session_token,this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" create session success "+this.sessionId),this.dataReport.addMsgInfo(this.reportSeq,{session_id:s.ZegoRTCLogEvent.kZegoTaskPublishStart.session_id(this.sessionId)}),this.onCreatePublishSessionSuccess(r))):this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" seq is not match.")},e.prototype.handleCreateSessionWithSdpResp=function(e,t,r){var o=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" sessionId:"+t),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSessionWithSdp",{sessionId:t}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSessionWithSdp",{sessionId:t}),0!==r.result?(this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" create session failed "+r.result),this.publishStateUpdateError({code:s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError.code,message:s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError.message+" result:"+r.result})):(this.sessionId=t,this.sessionToken=r.session_token,this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" get remote session success "+this.streamId),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,(function(e,t,r){o.onRecvCloseSession(e,t,r)})),this.signal.registerPushCallback("SessionResetPush",this.sessionId,(function(e,t,r){o.onRecvResetSession(e,t,r)})),this.signal.registerPushCallback("PublishEventPush",this.sessionId,(function(e,t,r){o.onRecvPublishEvent(e,t,r)})),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,(function(e,t,r){o.onRecvClientInfo(e,t,r)})),this.onGetRemoteOfferSuccess(r.sdp))):this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" seq is not match.")},e.prototype.onCreatePublishSessionSuccess=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" called");var r=[];if(e.turn_server){var o=e.turn_server,i=this.stateCenter.turnOverTcpOnly,n=this.stateCenter.settingConfig.getSetting("udp_or_tcp",!0);n&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" setting udp_or_tcp "+n),i="tcp"===n),i&&(o=o.replace("udp","tcp")),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" over tcp "+o),r.push(o)}e.stun_server&&r.push(e.stun_server);var s={iceTransportPolicy:"relay",iceServers:[{urls:r,username:e.turn_username,credential:e.turn_auth_key}]};this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" username: "+e.turn_username),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" credential: "+e.turn_auth_key),this.createOffer(s),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,(function(e,r,o){t.onRecvCandidateInfo(e,r,o)})),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,(function(e,r,o){t.onRecvCloseSession(e,r,o)})),this.signal.registerPushCallback("MediaDescPush",this.sessionId,(function(e,r,o){t.onRecvMediaDescription(e,r,o)})),this.signal.registerPushCallback("SessionResetPush",this.sessionId,(function(e,r,o){t.onRecvResetSession(e,r,o)})),this.signal.registerPushCallback("PublishEventPush",this.sessionId,(function(e,r,o){t.onRecvPublishEvent(e,r,o)})),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,(function(e,r,o){t.onRecvClientInfo(e,r,o)})),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" call success")},e.prototype.createOffer=function(e){var t=this;this.peerConnection=new RTCPeerConnection(e),this.dataChannel=this.peerConnection.createDataChannel(this.streamId),this.peerConnection.onicecandidate=function(e){t.onIceCandidate(e)},this.peerConnection.onsignalingstatechange=function(e){t.onConnectionStateChange(e)},this.peerConnection.oniceconnectionstatechange=function(e){t.onIceConnectionStateChange(e)},this.dataChannel.onopen=function(e){t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+t.streamId+" data channel open"),t.dataChannelState=1},this.dataChannel.onclose=function(e){t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+t.streamId+" data channel close")};var r=[],o=[];this.localStream&&(this.localStream.getTracks().forEach((function(e){var r;null===(r=t.peerConnection)||void 0===r||r.addTrack(e,t.localStream)})),r=this.localStream.getVideoTracks(),o=this.localStream.getAudioTracks(),r.length>0&&this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" video device: "+r[0].label),o.length>0&&this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" audio device: "+o[0].label));var i={offerToReceiveAudio:o.length>0?1:0,offerToReceiveVideo:r.length>0?1:0};this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" createOffer: "+JSON.stringify(i)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.dataReport.eventStart(this.streamReportSeq,"CreateOffer"),this.peerConnection.createOffer(i).then((function(e){t.dataReport.eventEnd(t.reportSeq,"CreateOffer"),t.dataReport.eventEnd(t.streamReportSeq,"CreateOffer"),t.onCreateOfferSuccess(e)}),(function(e){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateOffer",{error:e.toString()}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateOffer",{error:e.toString()}),t.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+t.streamId+" create offer error "+e.toString()),t.publishStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCreateOfferError,!0)}))},e.prototype.onCreateOfferSuccess=function(e){var t,r=this;this.videoInfo.bitRate>0&&(e.sdp=this.updateBandwidthRestriction(e.sdp,this.videoInfo.bitRate)),e.sdp=e.sdp.replace(/sendrecv/g,"sendonly");var o=e.sdp.match(/m=application[\s\S]+datachannel[\s\S]+/)?e.sdp.match(/m=application[\s\S]+datachannel[\s\S]+/)[0]:null;if(o){var n=o.replace(/sendonly/,"sendrecv");e.sdp=e.sdp.replace(o,n)}e.sdp=e.sdp.replace(/useinbandfec=\d+/,(this.videoInfo.audioBitrate?"maxaveragebitrate="+this.videoInfo.audioBitrate:"")+(2===this.videoInfo.channelCount?";stereo=1":"")),this.localSdpOrder=e.sdp.match(/m=(.\w*)\s/g)||[],this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" local sdp revert "+this.localSdpOrder.join("")),e.sdp=i.SdpUtil.getSDPByVideDecodeType(e.sdp,this.videoCodec,!0),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp1 "+e.sdp.substr(0,e.sdp.length/2)),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp2 "+e.sdp.substr(e.sdp.length/2)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetLocalDescription"),null===(t=this.peerConnection)||void 0===t||t.setLocalDescription(e).then((function(){r.dataReport.eventEnd(r.reportSeq,"SetLocalDescription"),r.dataReport.eventEnd(r.streamReportSeq,"SetLocalDescription"),r.onSetLocalDescriptionSuccess(e)}),(function(e){r.dataReport.eventEndWithMsg(r.reportSeq,"SetLocalDescription",{error:e.toString()}),r.dataReport.eventEndWithMsg(r.streamReportSeq,"SetLocalDescription",{error:e.toString()}),r.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+r.streamId+" error "+e.toString()),r.publishStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSetLocalDescError,!0)}))},e.prototype.updateBandwidthRestriction=function(e,t){var r="AS";return"firefox"===this.stateCenter.browser&&(t=1e3*(t>>>0),r="TIAS"),-1===e.indexOf("b="+r+":")?e.replace(/(m=video.*\r\nc=IN.*\r\n)/g,"$1b="+r+":"+t+"\r\n"):(e=e.replace(new RegExp("b="+r+":.*\r\n","g"),"b="+r+":"+t+"\r\n")).replace("b="+r+":"+t+"\r\n","")},e.prototype.onSetLocalDescriptionSuccess=function(e){var t=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" success"),this.isPeer)this.createSession(e);else{var r={sdp:e.sdp,width:this.videoInfo.width,height:this.videoInfo.height,frameRate:this.videoInfo.frameRate,video_min_kpbs:this.videoInfo.bitRate,video_max_kpbs:this.videoInfo.bitRate,audio_kpbs:48,keyframe_intv:2};this.offerSeq=o.getSeq(),this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.offerSeq,this.sessionId,0,r,(function(e,i,n){t.offerSeq==e&&t.sessionId==i?(t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" send success"),t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{mediaDescription:{width:r.width,height:r.height,frameRate:r.frameRate,video_min_kpbs:r.video_min_kpbs,video_max_kpbs:r.video_max_kpbs,audio_kpbs:r.audio_kpbs,keyframe_intv:r.keyframe_intv}}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendMediaDesc",{mediaDescription:{width:r.width,height:r.height,frameRate:r.frameRate,video_min_kpbs:r.video_min_kpbs,video_max_kpbs:r.video_max_kpbs,audio_kpbs:r.audio_kpbs,keyframe_intv:r.keyframe_intv}}),t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" send success stateNego:waiterAnswer"),t.stateNego=o.ENUM_PUBLISH_STATE_NEGO.waiterAnswer,t.state=o.ENUM_PUBLISH_STATE.waitingServerAnswer):t.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" seq or sessionId is not equal")}),(function(e,r){t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendMediaDesc",{error:e}),t.publishStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaDescError)})),this.state=o.ENUM_PUBLISH_STATE.waitingOffserRsp,this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" call success")}},e.prototype.onRecvMediaDescription=function(e,t,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received"),this.state==o.ENUM_PUBLISH_STATE.waitingServerAnswer?(this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.waitingCandidate,this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received stateNego:waitingCandidate"),this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(e,this.sessionId,0),1==r.type?this.onGetRemoteOfferSuccess(r.sdp):this.publishStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaDescError)):this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onGetRemoteOfferSuccess=function(e){var t,r,i,n,c,l,d=this;this.videoInfo.audioBitrate&&48e3!==this.videoInfo.audioBitrate&&(e=e.replace(/maxaveragebitrate=(\d+)/,"maxaveragebitrate="+this.videoInfo.audioBitrate)),this.remoteSdpOrder=e.match(/m=(.\w*)\s/g)||[],this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+NaN+this.remoteSdpOrder.join(""));var u=this.stateCenter.turnOverTcpOnly,h=this.stateCenter.settingConfig.getSetting("udp_or_tcp",!0);if(h&&(this.logger.info("zp.oro.0 setting udp_or_tcp "+h),u="tcp"===h),u&&(null===(t=e.match(/candidate.*/g))||void 0===t||t.forEach((function(t){var r=t.replace(/udp/,"tcp");e=e.replace(t,r)}))),this.logger.info("zp.oro.0 "+this.streamId+" sdp revert "+this.localSdpOrder.join("")+" "+this.remoteSdpOrder.join("")),this.localSdpOrder.join()!==this.remoteSdpOrder.join()){var p=new RegExp("[\\s\\S]*"+this.remoteSdpOrder[0]).exec(e)[0].replace(this.remoteSdpOrder[0],""),g=[],f="";this.localSdpOrder.forEach((function(t){var r=d.remoteSdpOrder.findIndex((function(e){return e==t})),o=new RegExp(t+"[\\s\\S]*"+(d.remoteSdpOrder[r+1]||"")).exec(e)[0].replace(d.remoteSdpOrder[r+1],""),i=/a=mid:(\w)/.exec(o)[1];g.push(i),f+=o||""})),e=p.replace(/a=group:BUNDLE.*/,"a=group:BUNDLE "+g.join(" "))+f,this.localSdpOrder=[],this.remoteSdpOrder=[]}var m=e.match(/m=video(.|\r|\n)*a=rtpmap(.|\r|\n)*(a=fmtp:(\d+).*)/);if("chrome"==this.stateCenter.browser){var _=0;if(this.videoInfo.bitRate&&"target"===this.videoInfo.startBitrate&&(_=this.videoInfo.bitRate),null!==m&&_){var E=m[3];e=-1!==E.indexOf("apt=")?e.replace(E,"a=fmtp:96 x-google-start-bitrate="+_+"\n"+E):e.replace(E,E+";x-google-start-bitrate="+_)}}if(this.videoInfo.bitRate>0){var T=/b=AS.*(\r\n|\n)/.test(e);e=T?e.replace(/AS:(\d+)/,"AS:"+this.videoInfo.bitRate):e.replace(/m=video.*(\r\n|\n)c=.*(\r\n|\n)/,"$&b=AS:"+this.videoInfo.bitRate+"\n");var S=null===(r=this.peerConnection)||void 0===r?void 0:r.getSenders().find((function(e){return e.track&&"video"===e.track.kind}));if(S&&S.getParameters&&S.setParameters){var v=S.getParameters();v.encodings||(v.encodings=[{}]),v.encodings[0].maxBitrate=1e3*this.videoInfo.bitRate;var R=this.lastPublishStats.frameWidth,C=(null===(n=null===(i=this.previewer)||void 0===i?void 0:i.cameraMaxResolution)||void 0===n?void 0:n.maxWidth)||0,y=null===(c=this.previewer)||void 0===c?void 0:c.videoInfo.width,I=R?Math.min(C,R):C;if(C&&y){var L=Math.max(I/y,1);v.encodings[0].scaleResolutionDownBy=L}S.setParameters(v)}}this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+" remoteSdp:",e);var O={type:"answer",sdp:e,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetRemoteDescription"),null===(l=this.peerConnection)||void 0===l||l.setRemoteDescription(new RTCSessionDescription(O)).then((function(){d.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+d.streamId+" set success"),d.dataReport.eventEnd(d.reportSeq,"SetRemoteDescription"),d.dataReport.eventEnd(d.streamReportSeq,"SetRemoteDescription")}),(function(e){d.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+d.streamId+" failed: "+e.toString()),d.dataReport.eventEndWithMsg(d.reportSeq,"SetRemoteDescription",{error:e.toString()}),d.dataReport.eventEndWithMsg(d.streamReportSeq,"SetRemoteDescription",{error:e.toString()}),d.publishStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSetRemoteDescError,!0)})),this.state=o.ENUM_PUBLISH_STATE.waitingServerICE,this.logger.debug(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+" call success")},e.prototype.onIceConnectionStateChange=function(e){var t=this;this.state!=o.ENUM_PUBLISH_STATE.stop&&null!=this.peerConnection&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateChanged "+this.peerConnection.iceConnectionState),"connected"===this.peerConnection.iceConnectionState?(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" connected state "+this.state),this.dataReport.eventEnd(this.reportSeq,"IceConnected"),this.dataReport.eventEnd(this.streamReportSeq,"IceConnected"),this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.iceConnected,this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateNego:iceConnected"),this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),null!=this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null),this.publishEvent?this.publishSuccess():(this.firstGetStatsTimer&&clearTimeout(this.firstGetStatsTimer),this.firstGetStatsTimer=null,this.firstGetStatsTimer=setTimeout((function(){var e;t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" get first stats state "+t.state),t.state!==o.ENUM_PUBLISH_STATE.publishing&&(null===(e=t.peerConnection)||void 0===e||e.getStats().then((function(e){t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" get first stats suc"),e.size>0&&t.publishSuccess()})))}),1e3))):"closed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.iceClosed,this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):"failed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.iceFailed,this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):"disconnected"===this.peerConnection.iceConnectionState&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.logger.warn(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" ice disconnected "),this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.iceDisconnected,this.iceDisconnectedTimer||(this.iceDisconnectedTimer=setTimeout((function(){t.checkPublishConnectionFailedState("disconnected")}),this.iceDisconnectedMaxTime))))},e.prototype.onIceCandidate=function(e){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate"+e.candidate),e.candidate)if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate"+e.candidate.candidate),this.state<o.ENUM_PUBLISH_STATE.connecting||this.state==o.ENUM_PUBLISH_STATE.stop)this.candidateInfo.push({candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex});else{var t={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};this.sendCandidateInfo([t])}},e.prototype.sendCandidateInfo=function(e){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" called"),!(e=e.filter((function(e){return e.candidate.indexOf("relay")>0})))||e.length<1?this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.dataReport.eventStart(this.streamReportSeq,"SendIceCandidate"),this.stateNego!==o.ENUM_PUBLISH_STATE_NEGO.iceConnected&&(this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.sendCandidate),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" stateNego:sendCandidate"),this.signal.sendCandidateInfo(o.getSeq(),this.sessionId,e,(function(e,r,o){t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+t.streamId+" send success"),t.dataReport.eventEnd(t.reportSeq,"SendIceCandidate"),t.dataReport.eventEnd(t.streamReportSeq,"SendIceCandidate")}),(function(e,r){t.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+t.streamId+" failed to send: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SendIceCandidate",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendIceCandidate",{error:e}),t.publishStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCandidateError)})))},e.prototype.onConnectionStateChange=function(e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CONNECTION_STATE_CHANGE+" "+this.streamId+" called "+e.target.signalingState)},e.prototype.onRecvCandidateInfo=function(e,t,r){var i,n=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" received "+JSON.stringify(r.infos)),this.state==o.ENUM_PUBLISH_STATE.waitingServerICE){this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.dataReport.addEvent(this.streamReportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(e,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var c=0;c<r.infos.length;c++){var l={sdpMid:r.infos[c].sdpMid,sdpMLineIndex:r.infos[c].sdpMLineIndex,candidate:r.infos[c].candidate};this.logger.debug(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+""+this.streamId+" candidate "+l.candidate),null===(i=this.peerConnection)||void 0===i||i.addIceCandidate(new RTCIceCandidate(l)).then((function(){n.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+n.streamId+" add success")}),(function(e){n.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+n.streamId+" add error "+e.toString()),n.publishStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCandidateError,!0)}))}this.state=o.ENUM_PUBLISH_STATE.connecting,this.dataReport.eventStart(this.reportSeq,"IceConnected"),this.dataReport.eventStart(this.streamReportSeq,"IceConnected")}else this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onRecvCloseSession=function(e,t,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CLOSE_SESSION+""+this.streamId+" "+JSON.stringify(r)),this.dataReport.addEvent(this.reportSeq,"RecvCloseSession"),this.signal.sendCloseSessionAck(e,this.sessionId,0);var o=r.err_info?JSON.parse(r.err_info.toLowerCase()):{},i=o.action?o.action:null,n=1*r.reason,c=JSON.parse(JSON.stringify(s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError));c.message+=" reason:"+n+" "+(i?" action:"+i:""),1011===o.err&&(c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaServerForbidError),1014===o.err&&(c=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishTokenExpiredError),this.negoTimer&&clearTimeout(this.negoTimer);var l=![4,8,10,11,12,14,26,27].includes(n)&&![2,5,6].includes(i);this.publishStateUpdateError(c,l)},e.prototype.onRecvResetSession=function(e,t,r){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_RESET_SESSION+" "+this.streamId+" received "),t==this.sessionId){this.signal.sendCloseSessionAck(e,this.sessionId,0);var o=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError;this.negoTimer&&clearTimeout(this.negoTimer),this.publishStateUpdateError(o)}else this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_RESET_SESSION+" "+this.streamId+" cannot find session")},e.prototype.onRecvPublishEvent=function(e,t,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_PUBLISH_EVENT+" "+this.streamId+" received"),this.publishEvent=!0,this.firstGetStatsTimer&&(clearTimeout(this.firstGetStatsTimer),this.firstGetStatsTimer=null),this.stateNego===o.ENUM_PUBLISH_STATE_NEGO.iceConnected&&0==r.event&&this.publishSuccess()},e.prototype.onRecvClientInfo=function(e,t,r){this.stateCenter.clientIP!==r.clientip&&this.logger.warn(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CLIENT_INFO+" client ip changed "+this.stateCenter.clientIP+" "+r.clientip),this.stateCenter.clientIP=r.clientip,this.peerID=r.peer_id;var o=this.previewer;if(o&&null!==o.activateSEIConfig){var i=null==o?void 0:o.activateSEIConfig,n=i.action,s=i.infoType;this.activateSEIInsert(n,s)}},e.prototype.checkPublishConnectionFailedState=function(e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" streamID "+this.streamId," state "+this.state+" connectionState "+e),this.publishStateUpdateError(s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaConnectionError)},e.prototype.setPublishQualityTimer=function(){var e=this;null==this.qualityTimer&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_PLAYER_QUALITY_TIMER+" "+this.streamId+" called"),this.clearPublishQualityTimer(),this.qualityTimer=setInterval((function(){e.peerConnectionGetStats()}),this.qualityTimeInterval),this.lastPublishStats={audioPacketsLost:0,videoPacketsLost:0,videoPacketsSent:0,audioPacketsSent:0,audioRetransmittedPacketsSent:0,videoTime:(new Date).getTime(),audioTime:(new Date).getTime(),time:0,audioBytesSent:0,videoBytesSent:0,framesEncoded:0,framesSent:0,videoRetransmittedPacketsSent:0},this.qualitySeq=o.getSeq(),this.qualityCount=0)},e.prototype.peerConnectionGetStats=function(e){var t=this;if(this.peerConnection){var r=[this.peerConnection.getStats(null)];"chrome"==this.stateCenter.browser&&r.push(new Promise((function(e,r){var o;null===(o=t.peerConnection)||void 0===o||o.getStats((function(t){return e(t)}),(function(e){return r(e)}))}))),Promise.all(r).then((function(r){var o=t.getPublishStats(r[0],r[1]);e&&e(o,r[0],r[1])})).catch((function(e){t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_PLAYER_QUALITY_TIMER+" "+t.streamId+" getStats error "+e.toString())}))}},e.prototype.getPublishStats=function(e,t){var r=this;if(e){for(var i,c=document.querySelectorAll("video, audio"),l=0;l<c.length;l++)c[l].srcObject===this.localStream&&(i=c[l]);var d={audioCodec:"opus",audioTargetBitrate:this.videoInfo.audioBitrate/1e3||0,audioBitrate:0,videoTargetBitrate:this.videoInfo.bitRate||0,videoTargetFPS:this.videoInfo.frameRate||0,videoBitrate:0,audioFPS:0,audioLevel:0,audioInputLevel:0,audioPacketsLost:0,audioPacketsLostRate:0,sendLevel:0,samplingRate:0,videoFPS:0,nackCount:0,pliCount:0,audioQuality:0,videoQuality:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,videoPacketsLost:0,videoPacketsLostRate:0,totalRoundTripTime:0,currentRoundTripTime:0,googBandwidthLimitedResolution:void 0,videoCodecName:"",audioCodecName:"",googCpuLimitedResolution:void 0,googAvailableSendBandwidth:0,googActualEncBitrate:0,googTargetEncBitrate:0,googFrameWidthInput:0,googFrameHeightInput:0,googFrameRateInput:0,codecImplementationName:"",videoMuteState:this.localStream.getVideoTracks().length>0&&this.localStream.getVideoTracks()[0].enabled?"0":"1",audioMuteState:this.localStream.getAudioTracks().length>0&&this.localStream.getAudioTracks()[0].enabled?"0":"1",muted:i?i.muted:void 0,paused:i?i.paused:void 0,volume:i?i.volume:void 0,sinkId:i?i.sinkId:void 0},u=this.lastPublishStats.time,h=0,p=0,g=0,f=0,m=0,_=0;e.forEach((function(e){if(("outbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesSent)&&"audio"==e.mediaType)0!=u&&(d.audioBitrate=8*(e.bytesSent-r.lastPublishStats.audioBytesSent)/(e.timestamp-u),d.audioFPS=(e.packetsSent-(e.retransmittedPacketsSent-r.lastPublishStats.audioRetransmittedPacketsSent)-r.lastPublishStats.audioPacketsSent)/(e.timestamp-u)*1e3,g=(e.retransmittedPacketsSent-r.lastPublishStats.audioRetransmittedPacketsSent)/(e.packetsSent-r.lastPublishStats.audioPacketsSent)),d.audioBitrate<0&&(d.audioBitrate=0),r.lastPublishStats.audioBytesSent=e.bytesSent,r.lastPublishStats.time=e.timestamp,r.lastPublishStats.audioPacketsSentTimeStamp=e.packetsSent-r.lastPublishStats.audioPacketsSent,r.lastPublishStats.audioPacketsSent=e.packetsSent,r.lastPublishStats.audioRetransmittedPacketsSent=e.retransmittedPacketsSent;else if(("outbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesSent)&&"video"==e.mediaType)0!=u&&(d.videoBitrate=8*(e.bytesSent-r.lastPublishStats.videoBytesSent)/(e.timestamp-u),d.videoFPS=1e3*(e.framesEncoded-r.lastPublishStats.framesEncoded)/(e.timestamp-u),f=(e.retransmittedPacketsSent-r.lastPublishStats.videoRetransmittedPacketsSent)/(e.packetsSent-r.lastPublishStats.videoPacketsSent)),d.videoBitrate<0&&(d.videoBitrate=0),d.videoFPS<0&&(d.videoFPS=0),d.nackCount=e.nackCount,d.pliCount=e.pliCount,r.lastPublishStats.videoBytesSent=e.bytesSent,r.lastPublishStats.framesEncoded=e.framesEncoded,r.lastPublishStats.time=e.timestamp,r.lastPublishStats.videoPacketsSentTimeStamp=e.packetsSent-r.lastPublishStats.videoPacketsSent,r.lastPublishStats.videoPacketsSent=e.packetsSent,r.lastPublishStats.videoRetransmittedPacketsSent=e.retransmittedPacketsSent;else if("remote-inbound-rtp"==e.type&&"video"==e.kind){e.packetsLost>0&&(d.videoPacketsLost=e.packetsLost);var t=e.packetsLost-r.lastPublishStats.videoPacketsLost;d.videoPacketsLostRate=t>0?t/r.lastPublishStats.videoPacketsSentTimeStamp:0,e.packetsLost>0&&(r.lastPublishStats.videoPacketsLost=e.packetsLost),r.lastPublishStats.videoTime=e.timestamp,p=1e3*e.roundTripTime,_=e.jitter}else if("remote-inbound-rtp"==e.type&&"audio"==e.kind){e.packetsLost>0&&(d.audioPacketsLost=e.packetsLost);var i=e.packetsLost-r.lastPublishStats.audioPacketsLost;d.audioPacketsLostRate=i>0?i/r.lastPublishStats.audioPacketsSentTimeStamp:0,e.packetsLost>0&&(r.lastPublishStats.audioPacketsLost=e.packetsLost),r.lastPublishStats.audioTime=e.timestamp,h=1e3*e.roundTripTime,m=e.jitter}else if("media-source"==e.type&&("audio"==e.kind||e.id.toLowerCase().indexOf("audio")>=0))d.audioLevel=e.audioLevel,d.sendLevel=e.totalAudioEnergy,d.audioInputLevel=32767*e.totalAudioEnergy,d.samplingRate=e.totalSamplesDuration;else if("track"==e.type&&("video"==e.kind||e.id.indexOf("video")>=0||e.frameWidth)){if(d.frameHeight=e.frameHeight,d.frameWidth=e.frameWidth,0===u||r.lastPublishStats.frameHeight===e.frameHeight&&r.lastPublishStats.frameWidth===e.frameWidth)0===u&&(r.lastPublishStats.frameHeight=e.frameHeight,r.lastPublishStats.frameWidth=e.frameWidth);else{var n=o.getReportSeq();r.dataReport.newReport(n,s.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.event),r.dataReport.addMsgInfo(n,{session_id:s.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.session_id(r.sessionId),w:s.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.w(e.frameWidth),h:s.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.h(e.frameHeight)}),r.dataReport.uploadReport(n),r.lastPublishStats.frameHeight=e.frameHeight,r.lastPublishStats.frameWidth=e.frameWidth}0!=u&&(d.videoTransferFPS=1e3*(e.framesSent-r.lastPublishStats.framesSent)/(e.timestamp-u)),d.videoTransferFPS<0&&(d.videoTransferFPS=0),r.lastPublishStats.framesSent=e.framesSent}else"candidate-pair"==e.type&&(null!=e.totalRoundTripTime&&(d.totalRoundTripTime=e.totalRoundTripTime),null!=e.currentRoundTripTime&&(d.currentRoundTripTime=e.currentRoundTripTime))})),t&&t.result().forEach((function(e){"ssrc"==e.type&&e.names().indexOf("googBandwidthLimitedResolution")>=0&&(d.googBandwidthLimitedResolution=e.stat("googBandwidthLimitedResolution")),"ssrc"==e.type&&"video"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(d.videoCodecName=e.stat("googCodecName")),"ssrc"==e.type&&"audio"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(d.audioCodecName=e.stat("googCodecName")),"ssrc"==e.type&&e.names().indexOf("googCpuLimitedResolution")>=0&&(d.googCpuLimitedResolution=e.stat("googCpuLimitedResolution")),"ssrc"==e.type&&e.names().indexOf("googFrameWidthInput")>=0&&(d.googFrameWidthInput=e.stat("googFrameWidthInput")),"ssrc"==e.type&&e.names().indexOf("googFrameHeightInput")>=0&&(d.googFrameHeightInput=e.stat("googFrameHeightInput")),"ssrc"==e.type&&e.names().indexOf("googFrameRateInput")>=0&&(d.googFrameRateInput=e.stat("googFrameRateInput")),"ssrc"==e.type&&e.names().indexOf("codecImplementationName")>=0&&(d.codecImplementationName=e.stat("codecImplementationName")),"VideoBwe"==e.type&&e.names().indexOf("googAvailableSendBandwidth")>=0&&(d.googAvailableSendBandwidth=e.stat("googAvailableSendBandwidth")),"VideoBwe"==e.type&&e.names().indexOf("googActualEncBitrate")>=0&&(d.googActualEncBitrate=e.stat("googActualEncBitrate")),"VideoBwe"==e.type&&e.names().indexOf("googTargetEncBitrate")>=0&&(d.googTargetEncBitrate=e.stat("googTargetEncBitrate")),"VideoBwe"==e.type&&e.names().indexOf("googRetransmitBitrate")>=0&&(d.googRetransmitBitrate=e.stat("googRetransmitBitrate"))})),"chrome"===this.stateCenter.browser&&this.handleEncBitrate(Number.parseInt(d.googTargetEncBitrate),Number.parseInt(d.googActualEncBitrate),Number.parseInt(d.googRetransmitBitrate)),p=isNaN(p)||p<0?0:p,f=isNaN(f)||f<0?0:f,_=isNaN(_)||_<0?0:_,h=isNaN(h)||h<0?0:h,g=isNaN(g)||g<0?0:g,m=isNaN(m)||m<0?0:m;var E=n.ClientUtil.getNetQuality(p,f,_),T=n.ClientUtil.getNetQuality(h,g,m);d.videoQuality=u>0?n.ClientUtil.quality2QualityGrade(E):0,d.audioQuality=u>0?n.ClientUtil.quality2QualityGrade(T):0;var S=Math.min(E,T);this.netQuality=S,u>0&&S<=o.QUALITY_CONSTANT.MiddleMinQuality&&(new Date).getTime()>this.probeTime+this.probeInterval&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" netQuality "+S+" start net probe"),this.probeState=o.ENUM_PROBE_STATE.tryProbe,this.streamCenter.startNetProbe(!0,this,this.gwNodeList),this.probeTime=(new Date).getTime()),0!==u&&this.uploadPublishQuality(d);var v={video:{videoBitrate:d.videoBitrate,videoFPS:d.videoFPS,videoTransferFPS:d.videoTransferFPS,frameHeight:d.frameHeight,frameWidth:d.frameWidth,muteState:d.videoMuteState,videoQuality:d.videoQuality,videoPacketsLost:d.videoPacketsLost,videoPacketsLostRate:d.videoPacketsLostRate},audio:{audioBitrate:d.audioBitrate,audioCodec:d.audioCodec,muteState:d.audioMuteState,audioQuality:d.audioQuality,audioPacketsLost:d.audioPacketsLost,audioPacketsLostRate:d.audioPacketsLostRate,audioFPS:d.audioFPS},nackCount:d.nackCount,pliCount:d.pliCount,totalRoundTripTime:d.totalRoundTripTime,currentRoundTripTime:d.currentRoundTripTime};return void 0!==d.videoPacketsLost&&(v.video.videoPacketsLost=d.videoPacketsLost,v.video.videoPacketsLostRate=d.videoPacketsLostRate,v.audio.audioPacketsLost=d.audioPacketsLost,v.audio.audioPacketsLostRate=d.audioPacketsLostRate),void 0!==d.muted&&(v.muted=d.muted,v.paused=d.paused,v.volume=d.volume,v.sinkId=d.sinkId),void 0!==d.googBandwidthLimitedResolution&&(v.googBandwidthLimitedResolution=d.googBandwidthLimitedResolution,v.video.googCodecName=d.videoCodecName,v.audio.googCodecName=d.audioCodecName,v.googCpuLimitedResolution=d.googCpuLimitedResolution,v.googFrameWidthInput=d.googFrameWidthInput,v.googFrameHeightInput=d.googFrameHeightInput,v.googFrameRateInput=d.googFrameRateInput,v.codecImplementationName=d.codecImplementationName,v.googAvailableSendBandwidth=d.googAvailableSendBandwidth,v.googActualEncBitrate=d.googActualEncBitrate,v.googTargetEncBitrate=d.googTargetEncBitrate),0!==u&&this.onPublishQualityUpdate(this.streamId,v,e,t),v}},e.prototype.uploadPublishQuality=function(e){var t=this;if(this.qualityUpload){var r=Date.parse(new Date+"");(0==this.qualityUploadLastTime||r-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(e.stream_type="publish",e.stream_id=this.streamId,e.timeStamp=r/1e3,this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_UPLOAD_PUBLISH_QUALITY+" "+this.streamId+" upload"+JSON.stringify(e)),this.signal.QualityReport(o.getSeq(),this.sessionId,e,(function(e,r,o){void 0!==o.report&&(t.qualityUpload=o.report,t.qualityUploadInterval=o.report_interval_ms)}),(function(e,r){t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_UPLOAD_PUBLISH_QUALITY+" "+t.streamId+" upload failed "+e)})),this.qualityUploadLastTime=r)}},e.prototype.stopPublish=function(){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_PUBLISH+"  .1 "+this.streamId+" called"),Object.keys(this.streamCenter.publisherList).length=1)for(var e in this.streamCenter.playerList){var t=this.streamCenter.playerList[e].player;t.state==o.ENUM_PLAY_STATE.playing&&t.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.start&&(this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),t.sessionId,0),t.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.stop)}this.stopMixingAudio(),this.stopMixingBuffer(),this.stopEffect(),this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(o.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.streamReportSeq,"PublishState",{state:this.state+""}),this.dataReport.addEvent(this.streamReportSeq,"StopPublish"),this.dataReport.addMsgExt(this.streamReportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.dataReport.addMsgInfo(this.streamReportSeq,{itemtype:"RTCPublishStream"}),this.dataReport.uploadReport(this.streamReportSeq,"RTCPublishStream"),this.resetPublish()},e.prototype.onPublishStateUpdate=function(e,t,r,o){},e.prototype.onPublishQualityUpdate=function(e,t,r,o){},e.prototype.onDisconnect=function(e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_DISCONNECT+" "+this.streamId+" call"),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_DISCONNECT+" "+this.streamId+" websocket disconnect"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),this.publishStateUpdateError(e||s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kWebsocketDisconnectedError,!!e)},e.prototype.playEffect=function(e,t,r,o){},e.prototype.pauseEffect=function(e){},e.prototype.resumeEffect=function(e){},e.prototype.stopEffect=function(e){},e.prototype.setEffectVolume=function(e,t){},e.prototype.startMixingAudio=function(e){},e.prototype.stopMixingAudio=function(e){},e.prototype.mixingBuffer=function(e,t,r){},e.prototype.stopMixingBuffer=function(e){},e.prototype.setMixingAudioVolume=function(e,t){},e.prototype.publishSuccess=function(){var e=this;for(var t in this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_PUBLISH_SUCCESS+" call"),this.state!=o.ENUM_PUBLISH_STATE.publishing&&this.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.start,this.streamId,{code:0,message:""},!0),this.isPeer&&(this.peerFailCount=0),this.state=o.ENUM_PUBLISH_STATE.publishing,this.dataReport.eventStart(this.reportSeq,"PublishState"),this.dataReport.eventStart(this.streamReportSeq,"PublishState"),this.streamCenter.playerList){var r=this.streamCenter.playerList[t].player;r.state==o.ENUM_PLAY_STATE.playing&&r.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.stop&&(this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),r.sessionId,1),r.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.start)}this.setPublishQualityTimer();var i=2,n=2,s=0!==this.localStream.getVideoTracks().length&&this.localStream.getVideoTracks()[0],c=0!==this.localStream.getAudioTracks().length&&this.localStream.getAudioTracks()[0];s&&!0===s.enabled&&(i=0),c&&"MediaStreamAudioDestinationNode"!==c.label&&!0===c.enabled&&(n=0),this.sendStreamStatus(i,n),this.streamCenter.soundLevelDelegate&&this.previewer&&this.previewer.startSoundLevel(),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_PUBLISH_SUCCESS+" call success"),["video","audio"].forEach((function(t){var r=e.toBeReplacedTracks[t];r&&e.replaceTrack(r)}))},e.prototype.startSoundLevel=function(){var e;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" call streamID: "+this.streamId),this.localStream&&0!=this.localStream.getAudioTracks().length)try{null===(e=this.previewer)||void 0===e||e.startSoundLevel()}catch(e){this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" "+this.streamId+" get sound level failed "+e)}else this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" "+this.streamId+" local stream no found")},e.prototype.stopSoundLevel=function(){var e;this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_SOUND_LEVEL+" call streamID: "+this.streamId),null===(e=this.previewer)||void 0===e||e.stopSoundLevel()},e.prototype.rebackMic=function(){var e,t=this;if(this.peerConnection&&this.micTrack instanceof MediaStreamTrack&&0==this.audioMixList.length&&0==Object.keys(this.arrayBufferMap).length&&0==this.effectList.length){var r=null===(e=this.peerConnection)||void 0===e?void 0:e.getSenders().find((function(e){var r,o;return(null===(r=e.track)||void 0===r?void 0:r.kind)===(null===(o=t.micTrack)||void 0===o?void 0:o.kind)}));r&&(r.replaceTrack(this.micTrack),this.localStream.removeTrack(this.localStream.getAudioTracks()[0]),this.localStream.addTrack(this.micTrack))}},e.prototype.handleEncBitrate=function(e,t,r){var o,i=this,s=1e3*this.videoInfo.bitRate,c=0;if(t>0){this.needIncMax||this.gotMax||(this.probeCount++,t>=.75*e?(this.probeCount>=10&&this.initFitCnt>=.6*this.probeCount&&(this.gotMax=!0,this.targetRate=s),this.initFitCnt++):this.probeCount>=10&&this.initFitCnt/this.probeCount<.3&&(this.needIncMax=!0));var l=n.ClientUtil.arrAvg(this.totalBitrateArray,t,10);if(this.needIncMax)if(l>=1.05*s){if(this.targetRate>s){var d=void 0;l>e?(d=l-e,this.targetRate-=d):(d=l-s,this.targetRate-=d),this.targetRate=Math.max(this.targetRate,s),this.targetRate=Math.min(this.targetRate,2*s),c=this.targetRate}}else l<.8*s&&(0===this.targetRate&&(this.targetRate=e),this.targetRate>=s?this.targetRate=this.targetRate+.08*s:this.targetRate=1.05*this.targetRate,this.targetRate=Math.min(this.targetRate,2*s),c=this.targetRate)}if(r>0&&r<s){var u=n.ClientUtil.arrAvg(this.totalRetransRateArray,r,5);this.needIncMax?u+t>1.05*s&&(d=u+t-s,this.targetRate-=d,this.targetRate=Math.max(this.targetRate,s-u),c=this.targetRate):c=this.targetRate-u}else this.targetRate<s&&(this.targetRate=s,c=this.targetRate);if(c>0){c=n.ClientUtil.arrAvg(this.totalTargetRateArray,c,5);var h=null===(o=this.peerConnection)||void 0===o?void 0:o.getSenders().find((function(e){return e.track&&"video"===e.track.kind}));if(!h)return;var p=h.getParameters();p.encodings||(p.encodings=[{}]),p.encodings[0].maxBitrate=c,h.setParameters(p).catch((function(e){i.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_HANDLE_ENC_BITRATE+" "+e)}))}},e.prototype.resetEncBitrate=function(){this.needIncMax=!1,this.probeCount=0,this.gotMax=!1,this.initFitCnt=0,this.targetRate=0,this.totalBitrateArray=[],this.totalTargetRateArray=[],this.totalRetransRateArray=[]},e.prototype.replaceTrack=function(e){return{errorCode:-1,extendedData:"should install advanced module first"}},e.prototype.sendStreamStatus=function(e,t,r){var i=this;void 0===r&&(r=0),this.camera_status=e,this.mic_status=t,r++,this.signal.sendStreamStatus(o.getSeq(),this.sessionId,e,t,this.streamId,(function(){i.camera_status===e&&i.mic_status===t&&r<=1&&i.sendStreamStatus(e,t,r)}))},e}();t.ZegoPublish=c},5019:function(e,t,r){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSignal=void 0;var i=r(6706),n=r(1089),s=r(2752),a=function(){function e(e,t){this.sendDataMap={},this.sendDataList=new i.LinkedList,this.sendDataCheckOnceCount=100,this.signalSeq=0,this.pushCallback={},this.sessionInfos={},this.tryHeartbeatCount=0,this.heartbeatInterval=1e4,this.sendDataTimeout=5e3,this.sendDataDropTimeout=1e4,this.sendDataCheckTimer=null,this.sendDataCheckInterval=2e3,this.checkMessageList=["ActivateVideoPlayStreamReq","ActivateAudioPlayStreamReq","CreateSessionReq","CreateSessionWithSdpReq","ActivateSEIInsertReq","StreamStatusNotify"],this.tryConnectCount=1,this.tryConnectTimer=null,this.tryConnectInterval=3e3,this.state=i.ENUM_CONNECT_STATE.disconnect,this.tokenType=0,this.browser=this.getBrowserAndVersion(),this.platform=navigator.platform,this.negoInterval=25e3,this.negoTryCount=1,this.negoTryMaxCount=2,this.logger=e,this.stateCenter=t,this.stateCenter.streamConnectTime&&(this.tryConnectInterval=this.stateCenter.streamConnectTime)}return e.prototype.getBrowserAndVersion=function(){var e,t=navigator.userAgent,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(r[1])?{name:"IE",version:(e=/\brv[ :]+([\d\.]+)/g.exec(t)||[])[1]||""}:"Chrome"===r[1]&&null!=(e=t.match(/\bOPR|Edge\/([\d\.]+)/))?{name:"Opera",version:e[1]}:(r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/([\d+\.]+)/i))&&r.splice(1,1,e[1]),{name:r[0],version:r[1]})},e.prototype.setSessionInfo=function(e,t){this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_SET_SESSION_INFO+" call"),this.appid=e+"",this.userid=t},e.prototype.onDisconnect=function(e,t){},e.prototype.onUpdateHeartBeatInterval=function(e){},e.prototype.resetConnectTimer=function(){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_RESET_CONNECT_TIMER+" call"),clearTimeout(this.tryConnectTimer),this.tryConnectTimer=null,this.tryConnectCount=0},e.prototype.bindWebSocketHandle=function(){var e=this;this.tryHeartbeatCount=0,this.tryConnectInterval=this.stateCenter.streamConnectTime?this.stateCenter.streamConnectTime:3e3,this.websocket.onmessage=function(t){var r=JSON.parse(t.data);e.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" signmsg= ",r.header.cmd),e.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" signmsg= "+JSON.stringify(r)),r.header.appid==e.appid&&r.header.user_id===e.userid?e.handleServerPush(r):e.logger.warn(n.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" check header failed")},this.websocket.onclose=function(t){e.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" close msg = "+JSON.stringify(t.code?t.code:t)),e.state!=i.ENUM_CONNECT_STATE.disconnect&&(e.resetConnectTimer(),e.startConnectTimer((function(t){1008===t&&e.disconnectCallback(s.errorCodeList.TOKEN_EXPIRED)})),e.resetCheckMessage())},this.websocket.onerror=function(t){e.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" msg = "+JSON.stringify(t))}},e.prototype.resetCheckMessage=function(){this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_RESET_CHECK_MESSAGE+" call"),clearTimeout(this.sendDataCheckTimer),this.sendDataCheckTimer=null;for(var e=this.sendDataList.getFirst();null!=e;)this.sendDataList.remove(e),e._data.error&&e._data.error(i.SEND_MSG_RESET,e._data.seq),e=this.sendDataList.getFirst();this.sendDataMap={}},e.prototype.handleServerPush=function(e){switch(e.header.cmd){case"LoginRsp":this.handleRespondData("LoginReq",e);break;case"CreateSessionRsp":this.handleRespondData("CreateSessionReq",e),0===e.body.result&&this.addSession(e.header.session_id,e.body.session_token);break;case"CreateSessionWithSdpRsp":this.handleRespondData("CreateSessionWithSdpReq",e),0===e.body.result&&this.addSession(e.header.session_id,e.body.session_token);break;case"MediaDescRsp":this.handleRespondData("MediaDescReq",e);break;case"CandidateInfoRsp":this.handleRespondData("CandidateInfoReq",e);break;case"CloseSessionRsp":this.handleRespondData("CloseSessionReq",e),this.removeSession(e.header.session_id);break;case"ClientHBRsp":this.handleRespondData("ClientHBReq",e);break;case"MediaDescPush":case"CandidateInfoPush":case"StreamStatusNotifyPush":case"PublishEventPush":case"PlayEventPush":case"ClientInfoPush":case"NetQualityInfoPush":this.handlePushData(e);break;case"CloseSessionPush":this.handlePushData(e),this.removeSession(e.header.session_id);break;case"QualityReportRsp":this.handleRespondData("QualityReportReq",e);break;case"SessionResetPush":this.handlePushResetSessionData(e);break;case"ActivateVideoPlayStreamRsp":this.handleRespondData("ActivateVideoPlayStreamReq",e);break;case"ActivateAudioPlayStreamRsp":this.handleRespondData("ActivateAudioPlayStreamReq",e);break;case"NetQualityProbeRsp":this.handleRespondData("NetQualityProbeReq",e);break;case"ActivateSEIInsertRsp":this.handleRespondData("ActivateSEIInsertReq",e);break;case"StreamStatusNotifyAck":this.handleRespondData("StreamStatusNotify",e);break;case"Peer2PeerNetStatsGetRsp":this.handleRespondData("Peer2PeerNetStatsGetReq",e)}},e.prototype.disconnectCallback=function(e){this.connectCallback&&(this.connectCallback(-1,this.server,void 0),this.connectCallback=null);var t=this.server;this.disconnectServer(),this.onDisconnect(t,e)},e.prototype.updateToken=function(){var e=this;this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_UPDATE_TOKEN+" call");var t={token:this.token,tokenType:this.tokenType,roomid:this.stateCenter.roomList[0].roomID,anchorname:this.stateCenter.anchor_info.anchor_id,sdkversion:i.PROTO_VERSION,osinfo:navigator.appVersion};if(0!=Object.keys(this.sessionInfos).length){var r=[];for(var o in this.sessionInfos){var s=parseInt(o);r.push({session_id:s,session_token:this.sessionInfos[s].token})}t.sessions=r}this.sendMessageWithCallback("LoginReq",this.stateCenter.getSeq(),0,t,(function(t,r,o){if(0==o.result){e.token=o.token,e.tokenType=o.tokenType;var i={report:o.report,report_interval:o.report_interval_ms};o.negoInterval&&(e.negoInterval=o.negoInterval),o.negoTryCount&&(e.negoTryCount=o.negoTryCount),o.negoTryMaxCount&&(e.negoTryMaxCount=o.negoTryMaxCount),null!=e.connectCallback&&(e.connectCallback(0,e.server,i),e.connectCallback=null),e.checkMessageTimeout()}else{var n={error:o.strError};null!=e.connectCallback&&(e.connectCallback(o.result,e.server,n),e.connectCallback=null)}}),(function(){null!=e.connectCallback&&(e.connectCallback(-1,e.server,void 0),e.connectCallback=null)}))},e.prototype.sendMessageWithCallback=function(e,t,r,o,s,a){if(this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" call "+e),!this.websocket||1!==this.websocket.readyState)return this.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" connect not establish"),void(a&&a(i.SEND_MSG_TIMEOUT,t));var c={header:this.getHeader(e,t,r),body:o};null==s&&(s=null),null==a&&(a=null);var l={seq:t,deleted:!1,cmd:e,time:Date.parse(new Date+""),success:s,error:a},d=this.sendDataList.push(l);this.sendDataMap[l.seq]=d;var u=JSON.stringify(c);this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" "+u),this.websocket.send(u),this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" success")},e.prototype.getHeader=function(e,t,r){return this.globalHeader={version:"1.0.1",cmd:e,appid:this.appid+"",seq:t,user_id:this.userid,session_id:r},this.globalHeader},e.prototype.connectServer=function(e,t,r){var o=this;if(this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" "+t),this.token=e,this.server=t,this.state=i.ENUM_CONNECT_STATE.connecting,this.connectCallback=r,this.websocket&&1===this.websocket.readyState)this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket is connected"),this.resetConnectTimer(),this.state=i.ENUM_CONNECT_STATE.connected;else{this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" need new websocket");try{this.websocket&&(this.logger.warn(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" close error websocket"),this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),this.websocket=new WebSocket(this.server),this.websocket.onopen=function(){o.resetConnectTimer(),o.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket open call"),o.bindWebSocketHandle(),o.updateToken(),o.state=i.ENUM_CONNECT_STATE.connected},this.websocket.onclose=function(e){o.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket close call  "+JSON.stringify(e))},this.websocket.onerror=function(e){o.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket onerror call  "+JSON.stringify(e))}}catch(e){this.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket error "+e)}}this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" "+this.tryConnectInterval),this.tryConnectTimer=setTimeout((function(){o.startConnectTimer(r)}),this.tryConnectInterval)},e.prototype.startConnectTimer=function(e){if(this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" call"),this.tryConnectCount>=i.MAX_TRY_CONNECT_COUNT)return this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" beyond "+this.server+"max limit"),void this.disconnectCallback();this.websocket&&1===this.websocket.readyState?(this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" websocket is connected"),this.resetConnectTimer()):(this.tryConnectCount+=1,this.connectServer(this.token,this.server,e))},e.prototype.disconnectServer=function(){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_DISCONNECT_SERVER+" call"),this.connectCallback=null,this.resetCheckMessage(),this.resetConnectTimer(),this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),this.token="",this.sessionInfos={},this.tokenType=0,this.tryHeartbeatCount=0,this.tryConnectCount=0,this.state=i.ENUM_CONNECT_STATE.disconnect},e.prototype.isServerConnected=function(){return!(!this.websocket||1!==this.websocket.readyState)},e.prototype.createSession=function(e,t,r,o,s,a,c,l){void 0===s&&(s=""),void 0===a&&(a=""),this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CREATE_SESSION+" call: "+o);var d="";i.PROTO_VERSION.split(".").forEach((function(e,t){return 1==e.length&&1==t?d+="0"+e:d+=e}));var u={type:t,stream_id:o,platform:this.platform,browser:this.browser.name,version:this.browser.version,app_id:this.appid,negotiate_mode:r,strAuthParam:s,sdk_version:1*d,turn_server_host:"string"==typeof a?a:""};this.sendMessageWithCallback("CreateSessionReq",e,0,u,c,l)},e.prototype.createSessionWithSdp=function(e,t,r){var o=e.seq,s=e.type,a=e.streamId,c=e.strAuthParam,l=e.sdp,d=e.serverHost,u=e.playBufLevel;this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CREATE_SESSION+" call: "+a);var h="";i.PROTO_VERSION.split(".").forEach((function(e,t){return 1==e.length&&1==t?h+="0"+e:h+=e}));var p={type:s,app_id:this.appid,stream_id:a,sdp:l,user_id:this.userid,platform:this.platform,browser:this.browser.name,sdk_vers:parseInt(h),clientIp:"",media_server_host:"string"==typeof d?d:"",strAuthParam:c};u&&(p.min_play_buf_level_ms=u),this.sendMessageWithCallback("CreateSessionWithSdpReq",o,0,p,t,r)},e.prototype.removeSession=function(e){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_REMOVE_SESSION+" call"+e),this.sessionInfos[e]&&delete this.sessionInfos[e]},e.prototype.sendCloseSession=function(e,t,r,o,i){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_REMOVE_SESSION+" call: "+t);var s={reason:r};this.removeSession(t),this.sendMessageWithCallback("CloseSessionReq",e,t,s,o,i)},e.prototype.sendMessage=function(e,t,r,o){if(this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" call "+e),this.websocket&&1===this.websocket.readyState){var i={header:this.getHeader(e,t,r),body:o},s=JSON.stringify(i);this.websocket.send(s),this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" success")}else this.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" connect not establish")},e.prototype.handleRespondData=function(e,t){this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" call");var r=this.sendDataMap[t.header.seq];if(null!=r){var o=r._data;o.cmd!==e?this.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" command is not match"):o.success&&o.success(t.header.seq,t.header.session_id,t.body),delete this.sendDataMap[t.header.seq],this.sendDataList.remove(r)}else{if("CloseSessionRsp"==t.header.cmd)return;this.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" cannot find data "+e)}},e.prototype.addSession=function(e,t){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_ADD_SESSION+" call"+e),this.sessionInfos[e]={token:t}},e.prototype.handlePushData=function(e){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_DATA+" call "+e.header.cmd+" session "+e.header.session_id);var t=this.pushCallback[e.header.cmd+e.header.session_id];t?t.callback&&t.callback(e.header.seq,e.header.session_id,e.body):this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_DATA+" no callbackData "+e.header.cmd+" session: "+e.header.session_id)},e.prototype.handlePushResetSessionData=function(e){this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" call ");var t=[];if(0==e.body.cResetType)t=Object.keys(this.sessionInfos);else if(1==e.body.cResetType)for(var r=0;r<e.body.session_ids.length;r++)t.push(e.body.session_ids[r]);if(this.sendResetSessionAck(e.header.seq,0,0),0!=t.length)for(var o=0;o<t.length;o++){var i=this.pushCallback[e.header.cmd+t[o]];null==i?this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" no callbackData "+t[o]):i.callback&&i.callback(e.header.seq,t[o],e.body)}else this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" no session to callback")},e.prototype.sendMediaDesc=function(e,t,r,o,i,s){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MEDIA_DESC+" call: "+t);var a={type:r,sdp:o.sdp};null!=o.width&&(a.width=o.width),null!=o.height&&(a.height=o.height),null!=o.frameRate&&(a.framerate=o.frameRate),null!=o.video_min_kpbs&&(a.video_min_kpbs=o.video_min_kpbs),null!=o.video_max_kpbs&&(a.video_max_kpbs=o.video_max_kpbs),null!=o.audio_kpbs&&(a.audio_kpbs=o.audio_kpbs),null!=o.keyframe_intv&&(a.keyframe_intv=o.keyframe_intv),null!=o.min_play_buf_level_ms&&(a.min_play_buf_level_ms=o.min_play_buf_level_ms),this.sendMessageWithCallback("MediaDescReq",e,t,a,i,s)},e.prototype.sendCandidateInfo=function(e,t,r,o,i){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CANDIDATE_INFO+" call: "+t);for(var s=[],a=0;a<r.length;a++){var c={candidate:r[a].candidate,sdpMid:r[a].sdpMid,sdpMLineIndex:r[a].sdpMLineIndex};s.push(c)}var l={infos:s};this.sendMessageWithCallback("CandidateInfoReq",e,t,l,o,i)},e.prototype.sendMediaDescAck=function(e,t,r){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MEDIA_DESC_ACK+" call: "+t);var o={result:r};this.sendMessage("MediaDescAck",e,t,o)},e.prototype.sendCandidateInfoAck=function(e,t,r){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CANDIDATE_INFO_ACK+" call: "+t);var o={result:r};this.sendMessage("CandidateInfoAck",e,t,o)},e.prototype.sendCloseSessionAck=function(e,t,r){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CLOSE_SESSION_ACK+" call: "+t);var o={result:r};this.sendMessage("CloseSessionAck",e,t,o)},e.prototype.sendResetSessionAck=function(e,t,r){this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_RESET_SESSION_ACK+" call: "+t);var o={result:r};this.sendMessage("SessionResetAck",e,t,o)},e.prototype.registerPushCallback=function(e,t,r){r&&"function"==typeof r&&(this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_REGISTER_PUSH_CALLBACK+" set callback "+t),this.pushCallback[e+t]={callback:r})},e.prototype.unregisterPushCallback=function(e,t){delete this.pushCallback[e+t]},e.prototype.checkMessageTimeout=function(){for(var e=this,t=this.sendDataList.getFirst(),r=Date.parse(new Date+""),o=0,s=0,a=0;null!=t&&!(t._data.time+this.sendDataTimeout>r);)if(delete this.sendDataMap[t._data.seq],this.sendDataList.remove(t),++s,-1!=this.checkMessageList.indexOf(t._data.cmd)){if(null==t._data.error||this.sendDataDropTimeout>0&&t._data.time+this.sendDataDropTimeout<r?++a:(this.logger.warn(n.ZEGO_WEBRTC_ACTION.SIGNAL_CHECK_MESSAGE_TIMEOUT+" error cmd = "+t._data.cmd),t._data.error&&t._data.error(i.SEND_MSG_TIMEOUT,t._data.seq)),++o>=this.sendDataCheckOnceCount)break;t=this.sendDataList.getFirst()}else t=this.sendDataList.getFirst();this.sendDataCheckTimer=setTimeout((function(){e.checkMessageTimeout()}),this.sendDataCheckInterval),0==s&&0==a||this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_CHECK_MESSAGE_TIMEOUT+" call success, state: timeout="+s+" drop="+a)},e.prototype.sendHeartbeat=function(){var e=this;if(this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+"call tryHeartbeatCount:"+this.tryHeartbeatCount),0!=Object.keys(this.sessionInfos).length)if(this.state===i.ENUM_CONNECT_STATE.connected){if(++this.tryHeartbeatCount>i.MAX_TRY_HEARTBEAT_COUNT)return this.logger.error(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" heartbeat try limit"),void this.disconnectCallback();var t=[];for(var r in this.sessionInfos)t.push(parseInt(r));var o={session_ids:t};this.sendMessageWithCallback("ClientHBReq",this.stateCenter.getSeq(),0,o,(function(t,r,o){e.heartbeatInterval!=o.hb_interval&&(e.heartbeatInterval=o.hb_interval,e.onUpdateHeartBeatInterval(o.hb_interval)),e.tryHeartbeatCount=0}),(function(e,t){}))}else this.logger.warn(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" state error");else this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" no need to heartbeat")},e.prototype.QualityReport=function(e,t,r,i,s){this.logger.debug(n.ZEGO_WEBRTC_ACTION.SIGNAL_QUALITY_REPORT+" call");var a={streams:[o(o({},r),{aid:t})]};this.sendMessageWithCallback("QualityReportReq",e,t,a,i,s)},e.prototype.sendStreamStatus=function(e,t,r,o,s,a){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_STREAM_STATUS+" call "+t);var c={mic_status:o,camera_status:r};this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_STREAM_STATUS+" stream "+(s||"")+" status "+JSON.stringify(c)),this.sendMessageWithCallback("StreamStatusNotify",e,t,c,(function(){}),(function(e){e===i.SEND_MSG_TIMEOUT&&a&&a()}))},e.prototype.ActivatePlayVideoStream=function(e,t,r,o,i){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM+" call");var s={active:r?0:1,layer:0};this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM+" activate video "+JSON.stringify(s)),this.sendMessageWithCallback("ActivateVideoPlayStreamReq",e,t,s,o,i)},e.prototype.ActivatePlayAudioStream=function(e,t,r,o,i){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM+" call");var s={active:r?0:1,layer:0};this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM+" activate audio "+JSON.stringify(s)),this.sendMessageWithCallback("ActivateAudioPlayStreamReq",e,t,s,o,i)},e.prototype.sendBroadcasterStatus=function(e,t,r){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_BROADCAST_STATUS+" call "+t);var o={status:r};this.sendMessage("BroadcasterStatusNotify",e,t,o)},e.prototype.sendNetProbe=function(e,t,r,o,i){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_NET_PROBE+" call "+t);var s={peer_id:r,action:1};this.sendMessageWithCallback("NetQualityProbeReq",e,t,s,o,i)},e.prototype.sendNetQualityInfoPushAck=function(e,t,r,o){this.logger.info(n.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_NET_PROBE+" call "+t);var i={peer_id:r,result:o};this.sendMessage("NetQualityInfoAck",e,t,i)},e.prototype.activateSEIInsert=function(e,t,r,o,i,n,s){},e.prototype.getP2PNetStats=function(e,t,r,o,i){var n={peer_id:r};this.sendMessageWithCallback("Peer2PeerNetStatsGetReq",e,t,n,o,i)},e}();t.ZegoSignal=a},3409:function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},o(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStreamCenterWeb=void 0;var s=r(6706),a=r(3770),c=r(1547),l=r(5740),d=r(6706),u=r(5019),h=r(3849),p=r(6014),g=r(8493),f=r(2752),m=r(3529),_=function(e){function t(t,r,o,i,n,s){var a=e.call(this)||this;return a.testEnvironment=!1,a.heartbeatTimer=null,a.heartbeatInterval=1e4,a.qualityTimerInterval=3e3,a.previewStreamList=[],a.signalList={},a.chargeInfos={itemtype:"ChargeInfos",timestamp_begin:0,timestamp_end:0,timestamp_diff_flag:0,timestamp_diff:0,infos:[]},a.chargeInfosTimer=null,a.chargeInfosInterval=6e4,a.chargeInfoSeq=0,a.soundLevelDelegate=!1,a.soundLevelInterval=1e3,a.isPeer=!0,a.probeList={},a.isMicEnabled=!0,a.playerList={},a.publisherList={},a.playSuccessCallBackList={},a.playErrorCallBackList={},a.tryCountConnectInterval=3e3,a.checkMessageTimeout=function(){for(var e in a.signalList)a.signalList[e].signal&&a.signalList[e].signal.checkMessageTimeout()},a.getAllInUseUrl=function(){var e=[];for(var t in a.signalList)e.push(t);return e},a.onDisconnectHandle=function(e,t){if(a.logger.info("zsc.od.0 call"),a.signalList[e]){for(var r=a.signalList[e],o=0;o<r.publishConnectedList.length;o++){var i=a.publisherList[r.publishConnectedList[o]];i&&i.publisher&&i.publisher.onDisconnect(t)}for(o=0;o<r.playConnectedList.length;o++){var n=a.playerList[r.playConnectedList[o]];n&&n.player&&n.player.onDisconnect(t)}delete a.signalList[e],a.stopSignalHeartbeat(),a.stopChargeInfosUpload(),a.stopSoundLevel()}},a.logger=t,a.stateCenter=r,a.dataReport=o,a.rtm=i,a.ac=n,a.mediaEleSources=s,"PRIVATE"==a.stateCenter.type&&(a.isPeer=!1),a}return i(t,e),Object.defineProperty(t.prototype,"cameraPreviewStream",{get:function(){return this.previewStreamList.find((function(e){return"camera"===e.previewType}))},enumerable:!1,configurable:!0}),t.prototype.onSignalDisconnected=function(e){},t.prototype.setQualityMonitorCycle=function(e){var t=this;return this.logger.debug("zsc.qmc.0 timeInterval "+e),0==Object.keys(this.publisherList).length?this.qualityTimerInterval=e:Object.keys(this.publisherList).forEach((function(r){t.publisherList[r].publisher.qualityTimeInterval=e,t.publisherList[r].publisher.setPublishQualityTimer()})),!0},t.prototype.setSessionInfo=function(e,t,r){this.logger.debug("zsc.ssi.0 called"),this.appid=e,this.userid=t,this.testEnvironment=r},t.prototype.onPlayStateUpdate=function(e,t,r){},t.prototype.onPlayQualityUpdate=function(e,t){},t.prototype.onPublishStateUpdate=function(e,t,r){},t.prototype.onPublishQualityUpdate=function(e,t){},t.prototype.onUpdateHeartBeatIntervalHandle=function(e){e!=this.heartbeatInterval&&(this.logger.debug("zsc.uhb.0 update "+e),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatInterval=e,this.startSignalHeartbeat())},t.prototype.setPublishStateStart=function(e,t,r,o,i){var n=this;if(this.logger.info("zsc.pss.0 call "+t),this.stateCenter.networkState==s.ENUM_NETWORK_STATE.offline)return this.logger.error("zsc.pss.0 network offline"),!1;var a=this.publisherList[t],l=this.stateCenter.reportSeqList.startPublish[t];if(this.dataReport.eventStart(l,"setPublishState"),a)return this.logger.error("zsc.pss.0 publisher already exist"),this.dataReport.eventEndWithMsgInfo(l,"setPublishState",{message:"publisher already exist"}),this.dataReport.uploadReport(l,void 0,m.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kIsPublishing),delete this.stateCenter.reportSeqList.startPublish[t],!1;var u=new c.ZegoPublish(t,this.logger,this.dataReport,this.qualityTimerInterval,this,this.ac,this.mediaEleSources,this.stateCenter);u.state=d.ENUM_PUBLISH_STATE.start,u.isPeer=this.isPeer,u.reportSeq=this.stateCenter.reportSeqList.startPublish[t];var h=r.getVideoTracks()[0]&&r.getVideoTracks()[0].label,f=r.getAudioTracks()[0]&&r.getAudioTracks()[0].label,_=r.getVideoTracks()[0]&&r.getVideoTracks()[0].getSettings().deviceId,E=r.getAudioTracks()[0]&&r.getAudioTracks()[0].getSettings().deviceId,T=new p.RetryStreamHandler(this.logger,this.stateCenter,this,!0);return this.publisherList[t]={seq:0,room:e,localStream:r,publisher:u,serverUrls:[],ttl:0,isCenterNode:!1,streamID:t,publishOption:o,cameraLabel:h||"",microLabel:f||"",cameraDeviceId:_||"",microDeviceId:E||"",deviceStateCount:0,retryStreamHandler:T,retryDispatchHandler:new g.RetryDispatchHandler(this.logger,this.stateCenter,this.rtm,this),isDataChannel:i},u.onPublishStateUpdate=function(e,r,o,i){var s=n.publisherList[r];s?T.publishStateHandle(e,s.streamID,o,i):n.logger.error("zsc.psuh.0 cannot find publish "+t)},u.onPublishQualityUpdate=function(e,r){var o=n.publisherList[e];o?(n.stateCenter.deviceStateOut&&0===r.audio.audioBitrate?(o.deviceStateCount++,o.deviceStateCount>=2&&(o.deviceStateCount=0,n.stateCenter.deviceStateOut=!1,n.logger.warn("zsc.pss.0 publish audio error by device"))):o.deviceStateCount=0,n.onPublishQualityUpdate(o.streamID,r)):n.logger.error("zsc.psuh.0 cannot find publish "+t)},this.dataReport.eventStart(u.reportSeq,"GetSignalUrl"),this.dataReport.eventStart(u.streamReportSeq,"GetSignalUrl"),!0},t.prototype.startPublishingStream=function(e){this.logger.info("zsc.sps.0 call");var t=this.publisherList[e];if(!t)return this.logger.error("zsc.sps.0 publisher don't exist"),!1;var r=t.publisher;if(this.dataReport.eventEndWithMsg(r.reportSeq,"GetSignalUrl",{urls:t.serverUrls,is_center:t.isCenterNode}),this.dataReport.eventEndWithMsg(r.streamReportSeq,"GetSignalUrl",{urls:t.serverUrls,is_center:t.isCenterNode}),!t.serverUrls||0===t.serverUrls.length)return t.retryStreamHandler.publishStateHandle(d.ENUM_PUBLISH_STATE_UPDATE.error,e,f.errorCodeList.DISPATCH_ERROR),this.logger.info("zsc.sps.0 server don't have signal url"),!1;var o=t.serverUrls.indexOf(this.server);-1!==o&&(t.serverUrls.splice(o,1),t.serverUrls.unshift(this.server));var i=t.retryStreamHandler;return i.invalid(),i.init(this.stateCenter.streamRetryTime),i.initStream(e,t.serverUrls),i.activePublish(0)},t.prototype.updateWaitingList=function(e,t,r,o,i){t?e.publishWaitingList.push({streamID:r,success:o,error:i}):e.playWaitingList.push({streamID:r,success:o,error:i})},t.prototype.publishStream=function(e){var t=this.publisherList[e].publisher;if(t){var r=null,o=null,i=this.publisherList[e].publishOption,n=this.checkPreview(this.publisherList[e].localStream);if(n){r=n.localStream,o=n.videoInfo;var s=this.stateCenter.reportSeqList.startPublish[e];this.dataReport.addMsgInfo(s,{cap_w:m.ZegoRTCLogEvent.kZegoTaskPublishStart.cap_w(n.videoInfo.width),cap_h:m.ZegoRTCLogEvent.kZegoTaskPublishStart.cap_h(n.videoInfo.height),w:m.ZegoRTCLogEvent.kZegoTaskPublishStart.w(n.videoInfo.width),h:m.ZegoRTCLogEvent.kZegoTaskPublishStart.h(n.videoInfo.height),video_en_fps:m.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_fps(n.videoInfo.frameRate),video_en_bps:m.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_bps(n.videoInfo.bitRate)}),r?(this.logger.info("zsc.ps.0 call success"),t.gwNodeTTL<(new Date).getTime()&&(t.gwNode="",t.gwNodeList=[],t.gwNodeTTL=0),t.startPublish(e,r,o,n.mediaStreamConfig,i)):this.logger.error("zsc.ps.0 no localStream found")}else this.logger.error("zsc.ps.0 no preview found")}else this.logger.info("zsc.ps.0 publisher don't exist")},t.prototype.connectPublishServer=function(e,t){var r=this,o=this.publisherList[e];return o?(this.dataReport.eventStart(o.publisher.reportSeq,"ConnectServer"),this.dataReport.eventStart(o.publisher.streamReportSeq,"ConnectServer"),this.connectWithReuseSignalServer(e,!0,t,(function(e,t,o){var i=r.publisherList[e];if(i){var n=i.publisher;if(n){r.dataReport.eventEndWithMsg(n.reportSeq,"ConnectServer",{result:0,server:o}),r.dataReport.eventEndWithMsg(n.streamReportSeq,"ConnectServer",{result:0,server:o});var s=t.tokenInfo;r.logger.info("zsc.cps.0 update token success"),s&&s.report&&(n.qualityUpload=s.report,n.qualityUploadInterval=s.report_interval),n.signal=t.signal,r.server=o,r.publishStream(e),r.getTokenSuccess()}else r.logger.info("zsc.cps.1 check publisher don't exist")}else r.logger.info("zsc.cps.0 after connect publisher don't exist")}),(function(e,t){r.logger.error("zsc.cps.0 "+e+" connect fail "+t);var o=r.publisherList[e];if(o){var i=o.publisher;if(i){r.dataReport.eventEndWithMsg(i.reportSeq,"ConnectServer",{result:t}),r.dataReport.uploadReport(i.reportSeq),delete r.stateCenter.reportSeqList.startPublish[e];var s=n({},f.errorCodeList.CONNECT_FAILED);s.message=s.message+" "+t,1008===t&&(s=f.errorCodeList.TOKEN_EXPIRED),o.retryStreamHandler.publishStateHandle(d.ENUM_PUBLISH_STATE_UPDATE.error,e,s,1008==t)}else r.logger.info("zsc.cps.1 check publisher don't exist")}else r.logger.info("zsc.cps.0 after connect publisher don't exist")})),!0):(this.logger.error("zsc.cps.0 publisher don't exist"),!1)},t.prototype.getTokenSuccess=function(){this.logger.debug("zsc.gts.0 call")},t.prototype.stopPublishingStream=function(e){var t=this.publisherList[e];if(t){var r=t.retryStreamHandler;for(var o in r&&(r.stopMaxTime(),r.invalid()),this.signalList)this.signalList[o].publishWaitingList=this.signalList[o].publishWaitingList.filter((function(t){return t.streamID!==e}));delete this.publisherList[e],t.publisher&&(t.publisher.stopPublish(),delete t.publisher),this.removeStreamFromSignal(!0,e),this.stopSignalHeartbeat(),this.stopChargeInfosUpload(),this.stopSoundLevel(),this.logger.debug("zsc.sps.0.1 call success")}else this.logger.warn("zsc.sps.0.1 publisher don't exist")},t.prototype.connectWithReuseSignalServer=function(e,t,r,o,i){var n=this;this.logger.info("zsc.crss.0 begin "+r);var s=null;if(this.signalList[r])(s=this.signalList[r]).state==d.ENUM_SIGNAL_STATE.connected?(this.logger.info("zsc.crss.0 already connected "+r+" streamId: "+e),t?s.publishConnectedList.push(e):s.playConnectedList.push(e),o(e,s,r)):s.state==d.ENUM_SIGNAL_STATE.connecting&&(this.logger.info("zsc.crss.0 signal is connecting "+r+" streamId: "+e),this.updateWaitingList(s,t,e,o,i));else{this.logger.info("zsc.crss.0 new signal "+r+" streamId: "+e);var a=new u.ZegoSignal(this.logger,this.stateCenter);a.setSessionInfo(this.appid,this.userid),a.onUpdateHeartBeatInterval=this.onUpdateHeartBeatIntervalHandle.bind(this),a.onDisconnect=this.onDisconnectHandle;var c=this.publisherList[e]?this.publisherList[e].retryStreamHandler:this.playerList[e]?this.playerList[e].retryStreamHandler:null;if(this.stateCenter.streamConnectTime)a.tryConnectInterval=this.stateCenter.streamConnectTime;else if(c&&c.retryActiveCount){var l=c.retryActiveCount*(c.retryActiveCount-1)/2+2;l=l>d.MAX_RETRY_CONNECT_INTERVAL?d.MAX_RETRY_CONNECT_INTERVAL:l,a.tryConnectInterval=1e3*l}this.signalList[r]={signal:a,state:d.ENUM_SIGNAL_STATE.connecting,publishWaitingList:[],playWaitingList:[],publishConnectedList:[],playConnectedList:[],tokenInfo:null},this.updateWaitingList(this.signalList[r],t,e,o,i),a.connectServer(this.stateCenter.roomList[0].token,r,(function(e,t,o){s=n.signalList[r];var i,a,c=0;if(0!=e){for(n.logger.info("zsc.crss.0 connect failed "+t),c=0;c<s.publishWaitingList.length;c++)(i=s.publishWaitingList[c]).error&&i.error(i.streamID,e);for(c=0;c<s.playWaitingList.length;c++)(a=s.playWaitingList[c]).error&&a.error(a.streamID,e);delete n.signalList[r]}else{for(n.logger.debug("zsc.crss.0 connected success "+t),s.state=d.ENUM_SIGNAL_STATE.connected,s.tokenInfo=o,c=0;c<s.publishWaitingList.length;c++)(i=s.publishWaitingList[c]).success&&i.success(i.streamID,s,t),s.publishConnectedList.push(i.streamID);for(c=0;c<s.playWaitingList.length;c++)(a=s.playWaitingList[c]).success&&a.success(a.streamID,s,t),s.playConnectedList.push(a.streamID);s.publishWaitingList=[],s.playWaitingList=[],null==n.heartbeatTimer&&n.startSignalHeartbeat(),null==n.chargeInfosTimer&&n.startChargeInfosUpload(),n.activeSoundLevel()}}))}},t.prototype.setPlayStateStart=function(e,t,r){var o=this;if(this.logger.info("zsc.pss.1 call "+e),this.stateCenter.networkState==s.ENUM_NETWORK_STATE.offline)return this.logger.error("zsc.pss.1 network offline"),!1;var i=this.playerList[e],n=this.stateCenter.reportSeqList.startPlay[e];if(this.dataReport.eventStart(n,"setPlayState"),i)return this.logger.error("zsc.pss.1 player already exist"),this.dataReport.eventEndWithMsgInfo(n,"setPlayState",{message:"player already exist"}),this.dataReport.uploadReport(n,void 0,m.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kIsPlaying),delete this.stateCenter.reportSeqList.startPlay[e],!1;var a=this.getPlayRoom(e)||this.stateCenter.roomList[0];if(!a)return this.logger.error("zsc.pss.1 not login room"),this.dataReport.eventEndWithMsgInfo(n,"setPlayState",{message:"not login room"}),this.dataReport.uploadReport(n,void 0,m.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError),!1;var c=new h.ZegoPlayWeb(this.logger,null,this.dataReport,this.qualityTimerInterval,this,this.ac,this.stateCenter);t&&[0,2,3].includes(t.resourceMode)&&(c.resourceMode=t.resourceMode),this.dataReport.addMsgInfo(n,{resourceMode:c.resourceMode,play_room_id:a.roomID,isMulti:this.stateCenter.isMultiRoom}),c.state=d.ENUM_PLAY_STATE.start,c.isPeer=this.isPeer,c.reportSeq=this.stateCenter.reportSeqList.startPlay[e],c.beginTime=(new Date).getTime();var l=new p.RetryStreamHandler(this.logger,this.stateCenter,this,!1);return this.playerList[e]={seq:0,room:a,player:c,signal:null,serverUrls:[],ttl:0,isCenterNode:!1,streamID:e,playOption:t,retryStreamHandler:l,retryDispatchHandler:new g.RetryDispatchHandler(this.logger,this.stateCenter,this.rtm,this),isDataChannel:r},c.onPlayStateUpdate=function(e,t,r,i){var n=o.playerList[t];n?l.playStateHandle(e,n.streamID,r,i):o.logger.error("zsc.pss.1 cannot find play "+t)},c.onPlayQualityUpdate=function(e,t){var r=o.playerList[e];r?o.onPlayQualityUpdate(r.streamID,t):o.logger.error("zsc.pss.1 cannot find play "+e)},c.onRemoteCameraStatusUpdate=function(e,t,r){var i=o.playerList[e];i?o.onRemoteCameraStatusUpdate(i.streamID,t,r):o.logger.error("zsc.pss.1 cannot find play "+e)},c.onRemoteMicStatusUpdate=function(e,t,r){var i=o.playerList[e];i?o.onRemoteMicStatusUpdate(i.streamID,t,r):o.logger.error("zsc.pss.1 cannot find play "+e)},this.dataReport.eventStart(c.reportSeq,"GetSignalUrl"),this.dataReport.eventStart(c.streamReportSeq,"GetSignalUrl"),!0},t.prototype.onRemoteMicStatusUpdate=function(e,t,r){},t.prototype.onRemoteCameraStatusUpdate=function(e,t,r){},t.prototype.startPlayingStream=function(e,t){this.logger.info("zsc.sps.1 start play called");var r=this.playerList[e];if(!r)return this.logger.error("zsc.sps.1 player don't exist"),!1;var o=r.player;if(this.dataReport.eventEndWithMsg(o.reportSeq,"GetSignalUrl",{urls:r.serverUrls}),this.dataReport.eventEndWithMsg(o.streamReportSeq,"GetSignalUrl",{urls:r.serverUrls}),0==r.serverUrls.length)return r.retryStreamHandler.playStateHandle(d.ENUM_PLAY_STATE_UPDATE.error,e,f.errorCodeList.DISPATCH_ERROR),this.logger.info("zsc.sps.1 server don't have signal url"),!1;var i=r.serverUrls.indexOf(this.server);-1!==i&&(r.serverUrls.splice(i,1),r.serverUrls.unshift(this.server));var n=r.retryStreamHandler;return n.invalid(),n.init(this.stateCenter.streamRetryTime),n.initStream(e,r.serverUrls),n.activePull(0,t)},t.prototype.connectPlayServer=function(e,t,r){var o=this,i=this.playerList[e];return i?(this.dataReport.eventStart(i.player.reportSeq,"ConnectServer"),this.dataReport.eventStart(i.player.streamReportSeq,"ConnectServer"),this.connectWithReuseSignalServer(e,!1,r,(function(e,r,i){var n=o.playerList[e];if(n){var s=n.player;if(s){o.dataReport.eventEndWithMsg(s.reportSeq,"ConnectServer",{result:0,server:i}),o.dataReport.eventEndWithMsg(s.streamReportSeq,"ConnectServer",{result:0,server:i});var a=r.tokenInfo;o.logger.info("zsc.cps.1 update token success"),a&&a.report&&(s.qualityHandler.qualityUpload=a.report,s.qualityHandler.qualityUploadInterval=a.report_interval),s.signal=r.signal,o.server=i,o.playStream(e,t),o.getTokenSuccess()}else o.logger.error("zsc.cps.1 checkplayer don't exist")}else o.logger.error("zsc.cps.1 after connect player don't exist")}),(function(t,r){var i=o.playerList[t];if(i){o.dataReport.eventEndWithMsg(i.player.reportSeq,"ConnectServer",{result:r}),!i.player.isProbe&&o.dataReport.uploadReport(i.player.reportSeq),delete o.stateCenter.reportSeqList.startPlay[e];var s=n({},f.errorCodeList.CONNECT_FAILED);s.message=s.message+" "+r,1008===r&&(s=f.errorCodeList.TOKEN_EXPIRED),i.retryStreamHandler.playStateHandle(d.ENUM_PLAY_STATE_UPDATE.error,t,s,1008==r)}else o.logger.error("zsc.cps.1 after connect player don't exist")})),!0):(this.logger.error("zsc.cps.1 player don't exist"),!1)},t.prototype.playStream=function(e,t){var r=this.playerList[e].player;r?(this.logger.info("zsc.ps.1 call success"),r.gwNodeTTL<(new Date).getTime()&&(r.gwNode="",r.gwNodeList=[],r.gwNodeTTL=0),r.startPlay(e,t,this.playerList[e].playOption)):this.logger.warn("zsc.ps.1 player don't exist")},t.prototype.stopSignalHeartbeat=function(){this.logger.debug("zsc.ssh.1 call");var e=0;for(var t in this.signalList)e+=1;this.heartbeatTimer&&0==e&&(this.logger.info("zsc.ssh.1 stop"),clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},t.prototype.removeStreamFromSignal=function(e,t){var r=[];for(var o in this.signalList){var i=this.signalList[o];if(e){for(var n=0;n<i.publishConnectedList.length;n++)if(i.publishConnectedList[n]===t){this.logger.debug("zsc.rsfs.0 found from publish"),i.publishConnectedList.splice(n,1);break}for(n=0;n<i.publishWaitingList.length;n++)if(i.publishWaitingList[n].streamID===t){this.logger.debug("zsc.rsfs.0 found from publish"),i.publishWaitingList.splice(n,1);break}}else{for(var s=0;s<i.playConnectedList.length;s++)if(i.playConnectedList[s]===t){this.logger.debug("zsc.rsfs.0 found from play"),i.playConnectedList.splice(s,1);break}for(s=0;s<i.playWaitingList.length;s++)if(i.playWaitingList[s].streamID===t){this.logger.debug("zsc.rsfs.0 found from play"),i.playWaitingList.splice(s,1);break}}0==i.publishConnectedList.length&&0==i.playConnectedList.length&&0==i.publishWaitingList.length&&0==i.playWaitingList.length&&(i.signal.disconnectServer(),r.push(o))}for(var a=0;a<r.length;a++)delete this.signalList[r[a]],this.server==r[a]&&(this.server="")},t.prototype.stopPlayingStream=function(e){var t=this.playerList[e];if(t){var r=t.retryStreamHandler;for(var o in r&&(r.stopMaxTime(),r.invalid()),this.signalList)this.signalList[o].playWaitingList=this.signalList[o].playWaitingList.filter((function(t){return t.streamID!==e}));delete this.playerList[e],t.player&&(t.player.stopPlay(),delete t.player),this.removeStreamFromSignal(!1,e),this.stopSignalHeartbeat(),this.stopChargeInfosUpload(),this.stopSoundLevel(),delete this.playSuccessCallBackList[e],delete this.playErrorCallBackList[e],this.logger.debug("zsc.sps.1.1 call success")}else this.logger.info("zsc.sps.1.1 player don't exist")},t.prototype.reset=function(e){for(var t in this.publisherList)(this.publisherList[t].room.roomID==e||!e)&&this.stopPublishingStream(t);var r=function(t){var r=o.playerList[t].room;if(r.roomID!=e||!r.streamList.find((function(e){return e.stream_id==t}))&&1!=o.stateCenter.roomList.length){if(r.roomID==e&&o.stateCenter.roomList.length>1){var i=o.stateCenter.roomList.find((function(t){return t.roomID!==e}));i?o.playerList[t].room=i:o.stopPlayingStream(t)}}else o.stopPlayingStream(t)},o=this;for(var i in this.playerList)r(i);0==Object.keys(this.publisherList).length&&0==Object.keys(this.playerList).length&&(this.probeList={})},t.prototype.startSignalHeartbeat=function(){var e=this;this.logger.debug("zsc.ssh.0 call"),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatTimer=setTimeout((function(){e.checkSignalHeartbeat()}),this.heartbeatInterval)},t.prototype.startChargeInfosUpload=function(){var e=this;this.logger.debug("zsc.sciu.0 call"),this.chargeInfosTimer&&(clearTimeout(this.chargeInfosTimer),this.chargeInfosTimer=null),this.chargeInfosTimer=setTimeout((function(){e.checkChargeInfos()}),this.chargeInfosInterval)},t.prototype.checkChargeInfos=function(){this.logger.debug("zsc.cci.0 call");var e={is_publishing:0,play_max_audio_bitrate:0,play_stream_resolution_infos:[]};for(var t in this.chargeInfos.timestamp_begin=(new Date).getTime(),this.publisherList){this.publisherList[t].publisher.state===d.ENUM_PUBLISH_STATE.publishing&&(e.is_publishing=1);break}e.play_max_audio_bitrate=0;var r=function(t){var r=o.playerList[t].player.playStream,i=r&&0!==r.getVideoTracks().length?r.getVideoTracks()[0].getSettings():void 0,n={video_width:i&&i.width?i.width:0,video_height:i&&i.height?i.height:0,count:1};if(!e.play_stream_resolution_infos.find((function(e){return e.video_width==n.video_width&&e.video_height==n.video_height&&(e.count++,!0)}))&&e.play_stream_resolution_infos.push(n),0==n.video_width&&0==n.video_height){var s=1e3*o.playerList[t].player.qualityHandler.lastPlayStats.audioBitrate;s>e.play_max_audio_bitrate&&(e.play_max_audio_bitrate=s)}},o=this;for(var i in this.playerList)r(i);0!==this.chargeInfos.timestamp_end?(this.chargeInfos.timestamp_diff=this.chargeInfos.timestamp_begin-this.chargeInfos.timestamp_end,this.chargeInfos.timestamp_diff_flag=1):(this.chargeInfos.timestamp_diff=0,this.chargeInfos.timestamp_diff_flag=0),this.chargeInfos.timestamp_end=(new Date).getTime(),this.chargeInfos.infos=[e],0!==e.play_stream_resolution_infos.length&&this.logger.report(this.chargeInfos),this.chargeInfosTimer&&this.startChargeInfosUpload()},t.prototype.checkSignalHeartbeat=function(){for(var e in this.logger.debug("zsc.csh.0 call"),this.signalList)this.signalList[e].signal&&this.signalList[e].signal.sendHeartbeat();this.heartbeatTimer&&this.startSignalHeartbeat()},t.prototype.stopChargeInfosUpload=function(){this.logger.debug("zsc.sciu.0 call");var e=0;for(var t in this.signalList)e+=1;this.chargeInfosTimer&&0==e&&(this.logger.info("zsc.sciu.0 stop"),clearTimeout(this.chargeInfosTimer),this.chargeInfosTimer=null)},t.prototype.getPublisher=function(e){var t=null;return this.publisherList[e]&&this.publisherList[e].publisher&&(t=this.publisherList[e].publisher),t},t.prototype.checkPreview=function(e){for(var t=0;t<this.previewStreamList.length;t++)if(this.previewStreamList[t].localStream===e)return this.previewStreamList[t];return null},t.prototype.checkPublish=function(e){for(var t in this.publisherList)if(this.publisherList[t].localStream==e)return this.publisherList[t];return null},t.prototype.removePreview=function(e){for(var t=0;t<this.previewStreamList.length;t++)if(this.previewStreamList[t]===e){this.previewStreamList.splice(t,1);break}},t.prototype.onPlayerStreamUrlUpdate=function(e,t,r){},t.prototype.getScreenConstrains=function(e){var t={};if("boolean"==typeof e&&e)t={audio:!1,frameRate:d.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate,bitRate:this.stateCenter.settingConfig.getSetting("screen_video_bitrate")||d.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate};else if("object"==typeof e){switch(e.videoQuality){case 1:t={frameRate:d.ENUM_SCREEM_RESOLUTION_TYPE.LOW.frameRate,bitRate:d.ENUM_SCREEM_RESOLUTION_TYPE.LOW.bitRate};break;case 3:t={frameRate:d.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.frameRate,bitRate:d.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.bitRate};break;case 4:t={frameRate:e.frameRate,bitRate:e.bitRate,width:e.width,height:e.height};break;case 2:t={frameRate:d.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate,bitRate:d.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate};break;default:t={frameRate:d.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate,bitRate:this.stateCenter.settingConfig.getSetting("screen_video_bitrate")||d.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate}}t.audio="boolean"==typeof e.audio&&e.audio,t=n(n({},e),t)}return t},t.prototype.createScreenPreviewer=function(e,t){var r=new a.ZegoPreview(this.logger,this.ac,this.stateCenter,this,"screen"),o=e.getVideoTracks()[0].getSettings();return this.previewStreamList.push(r),r.mediaStreamConfig=t,e.getAudioTracks().length>0&&(r.audioTrack=e.getAudioTracks()[0]),r.localStream=e,r.videoInfo={width:o.width,height:o.height,frameRate:o.frameRate||15,bitRate:(null==t?void 0:t.bitRate)||1e3,startBitrate:(null==t?void 0:t.startBitrate)||this.stateCenter.settingConfig.getSetting("bitrate_mode")},r.previewSuc=!0,r.previewType="screen",(null==t?void 0:t.videoOptimizationMode)&&this.setVideoTrackContentHint(e,null==t?void 0:t.videoOptimizationMode),r},t.prototype.setSoundLevelDelegate=function(e,t){for(var r in this.logger.info("zsc.ssd.0 call"),t&&(this.soundLevelInterval=t),this.soundLevelDelegate=e,this.previewStreamList){var o=this.previewStreamList[r];e?o.startSoundLevel():o.stopSoundLevel()}for(var r in this.playerList){var i=this.playerList[r].player;e?i.startSoundLevel():i.stopSoundLevel()}e?(this.logger.info("zsc.ssd.0 start getting sound"),this.activeSoundLevel()):(this.logger.info("zsc.ssd.0 stop getting sound"),this.soundLevelTimer&&clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null,this.soundLevelInterval=1e3)},Object.defineProperty(t.prototype,"hasRemoteStream",{get:function(){return Object.keys(this.signalList).length>0},enumerable:!1,configurable:!0}),t.prototype.activeSoundLevel=function(){!this.soundLevelTimer&&this.soundLevelDelegate&&this.startSoundLevel()},t.prototype.startSoundLevel=function(){var e=this;this.soundLevelTimer&&(clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null),this.soundLevelDelegate&&(this.hasRemoteStream&&this.checkSoundLevel(),this.checkMicSoundLevel(),this.soundLevelTimer=setTimeout((function(){e.startSoundLevel()}),this.soundLevelInterval))},t.prototype.checkSoundLevel=function(){this.logger.debug("zsc.csl.0 call");var e=[];for(var t in this.publisherList){var r=0,o=this.publisherList[t].publisher,i=o.previewer;i&&(r=i.soundLevel),e.push({streamID:this.getBackStreamId(o.streamId),soundLevel:r,type:"push"})}for(var t in this.playerList){var n=this.playerList[t].player;n.streamId&&!n.isProbe&&e.push({streamID:this.getBackStreamId(n.streamId),soundLevel:n.soundLevel,type:"pull"})}this.soundLevelDelegate&&e.length>0&&this.onSoundLevelUpdate(e)},t.prototype.checkMicSoundLevel=function(){if(this.cameraPreviewStream&&this.soundLevelDelegate){var e=this.cameraPreviewStream.soundLevel;this.onMicSoundLevelUpdate(e)}},t.prototype.getBackStreamId=function(e){return this.testEnvironment&&e?e.replace("zegotest-"+this.appid+"-",""):e},t.prototype.onSoundLevelUpdate=function(e){},t.prototype.onMicSoundLevelUpdate=function(e){},t.prototype.stopSoundLevel=function(){var e=this.previewStreamList.length;this.soundLevelTimer&&!this.hasRemoteStream&&0===e&&(this.logger.info("zsc.ssl.0 stop"),clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null)},t.prototype.startNetProbe=function(e,t,r){var o=this,i=s.getReportSeq();if(this.dataReport.newReport(i,m.ZegoRTCLogEvent.kZegoNetProbe.event),this.isPeer){var n=!0;0==r.length&&(n=!1,r=e?this.publisherList[t.streamId].serverUrls:this.playerList[t.streamId].serverUrls),r.forEach((function(r){if(!(o.probeList[r]&&o.probeList[r].timeStamp+9e5<(new Date).getTime()||t.probeState==d.ENUM_PROBE_STATE.probed)){var i="zegoprobe-"+(new Date).getTime();o.setPlayStateStart(i);var s=o.playerList[i]?o.playerList[i].player:null;s&&(s.isProbe=!0,n?(s.gwNode=r,s.signal=t.signal,s.startPlay(i,(function(){}))):o.connectPlayServer(i,(function(){}),r),s.onCalNetQualityResult=function(n,a){o.logger.info("zc.ocnqr.0 "+s.gwNode+" "+n+" "+a),o.probeList[r]={result:n,netQuality:a,timeStamp:(new Date).getTime()},t.gwNode==r||t.signal.server==r?t.netQuality=a:o.handleCalNetQualityResult(e,n,a,t,r),o.stopPlayingStream(i)})}})),this.dataReport.addMsgInfo(i,{netQuality:t.netQuality,nodeList:r}),this.dataReport.uploadReport(i)}else this.dataReport.uploadReport(i,void 0,{code:-1,message:"not support peer"})},t.prototype.handleCalNetQualityResult=function(e,t,r,o,i){if(this.logger.info("zc.hcqr.0 "+o.netQuality+" probe "+r+" "+i),0===t){var n=s.getReportSeq();this.dataReport.newReport(n,m.ZegoRTCLogEvent.kZegoNetProbeResult.event);var a=!1;if(r>Math.max(75,o.netQuality+20)&&o.probeState==d.ENUM_PROBE_STATE.tryProbe)if(a=!0,e){var c=o,l=c.streamId,u=c.localStream,h=c.videoInfo,p=c.mediaStreamConfig,g=c.publishOption;0!=c.sessionId&&c.signal&&c.shouldSendCloseSession()&&(c.signal.sendCloseSession(this.stateCenter.getSeq(),c.sessionId,1),c.signal.removeSession(c.sessionId),c.closeSessionSignal=!0),c.resetPublish(),this.publisherList[l].isCenterNode?(c.gwNode=i,c.startPublish(l,u,h,p,g)):this.connectPublishServer(l,i)}else{var f=o,_=(l=f.streamId,f.getRemoteStreamSuc),E=f.playOption;0!=f.sessionId&&f.signal&&f.shouldSendCloseSession()&&(f.signal.sendCloseSession(this.stateCenter.getSeq(),f.sessionId,1),f.signal.removeSession(f.sessionId),f.closeSessionSignal=!0),f.resetPlay(),this.playerList[l].isCenterNode?(f.gwNode=i,f.startPlay(l,_,E)):this.connectPlayServer(l,_,i)}else a=!1,this.logger.warn("zc.hcqr.0 "+o.netQuality+" probe "+r+" "+i);this.dataReport.addMsgInfo(n,{isSwitch:a,isPublish:e,streamID:o.streamId,result:t,node:i,netQuality:o.netQuality,probeNetQuality:r}),this.dataReport.uploadReport(n),o.probeState=d.ENUM_PROBE_STATE.probed}},t.prototype.getRoomByStreamID=function(e){return this.publisherList[e]?this.publisherList[e].room:this.playerList[e]?this.playerList[e].room:void 0},t.prototype.setVideoTrackContentHint=function(e,t){if("string"==typeof t){var r=t.toLowerCase();if(["default","motion","detail","text"].includes(r)){var o=e.getVideoTracks()[0];o?"contentHint"in o?(this.logger.info("zc.svtch "+r),o.contentHint="default"==r?"":r):this.logger.warn("zc.svtch mediaStreamTrack contentHint attribute not supported"):this.logger.warn("zc.svtch video track no found")}else this.logger.warn("zc.svtch videoOptimizationMode wrong")}else this.logger.warn("zc.svtch videoOptimizationMode type wrong")},t.prototype.getPlayRoom=function(e){return this.stateCenter.roomList.find((function(t){return!!t.streamList.find((function(t){return t.stream_id==e}))}))},t}(l.ZegoStreamCenter);t.ZegoStreamCenterWeb=_},5515:function(e){e.exports=function e(t,r,o){function i(s,a){if(!r[s]){if(!t[s]){if(n)return n(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,(function(e){return i(t[s][1][e]||e)}),l,l.exports,e,t,r,o)}return r[s].exports}for(var n=void 0,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,r){"use strict";var o=(0,e("./adapter_factory.js").adapterFactory)({window:window});t.exports=o},{"./adapter_factory.js":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=o.log,l=o.detectBrowser(e),d={browserDetails:l,commonShim:c,extractVersion:o.extractVersion,disableLog:o.disableLog,disableWarnings:o.disableWarnings};switch(l.browser){case"chrome":if(!i||!i.shimPeerConnection||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),d;r("adapter.js shimming chrome."),d.browserShim=i,i.shimGetUserMedia(e),i.shimMediaStream(e),i.shimPeerConnection(e),i.shimOnTrack(e),i.shimAddTrackRemoveTrack(e),i.shimGetSendersWithDtmf(e),i.shimGetStats(e),i.shimSenderReceiverGetStats(e),i.fixNegotiationNeeded(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;case"firefox":if(!s||!s.shimPeerConnection||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),d;r("adapter.js shimming firefox."),d.browserShim=s,s.shimGetUserMedia(e),s.shimPeerConnection(e),s.shimOnTrack(e),s.shimRemoveStream(e),s.shimSenderGetStats(e),s.shimReceiverGetStats(e),s.shimRTCDataChannel(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"edge":if(!n||!n.shimPeerConnection||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),d;r("adapter.js shimming edge."),d.browserShim=n,n.shimGetUserMedia(e),n.shimGetDisplayMedia(e),n.shimPeerConnection(e),n.shimReplaceTrack(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"safari":if(!a||!t.shimSafari)return r("Safari shim is not included in this adapter release."),d;r("adapter.js shimming safari."),d.browserShim=a,a.shimRTCIceServerUrls(e),a.shimCreateOfferLegacy(e),a.shimCallbacksAPI(e),a.shimLocalStreamsAPI(e),a.shimRemoteStreamsAPI(e),a.shimTrackEventTransceiver(e),a.shimGetUserMedia(e),c.shimRTCIceCandidate(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;default:r("Unsupported browser!")}return d};var o=l(e("./utils")),i=l(e("./chrome/chrome_shim")),n=l(e("./edge/edge_shim")),s=l(e("./firefox/firefox_shim")),a=l(e("./safari/safari_shim")),c=l(e("./common_shim"));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var n=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return n.shimGetDisplayMedia}}),r.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(o){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===o.track.id})):{track:o.track};var n=new Event("track");n.track=o.track,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],r.dispatchEvent(n)})),t.stream.getTracks().forEach((function(o){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===o.id})):{track:o};var n=new Event("track");n.track=o,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],r.dispatchEvent(n)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else s.wrapPeerConnectionEvent(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))},r.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,o){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((function(e){r._senders.push(t(r,e))}))};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],s.apply(this,[e]),e.getTracks().forEach((function(e){var r=t._senders.find((function(t){return t.track===e}));r&&t._senders.splice(t._senders.indexOf(r),1)}))}}else if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},r.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,o){var i=this,n=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof arguments[0]))return t.apply(this,[]);var s=function(e){var t={};return e.result().forEach((function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){r[t]=e.stat(t)})),t[r.id]=r})),t},a=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){n[1](a(s(e)))};return t.apply(this,[c,arguments[0]])}return new Promise((function(e,r){t.apply(i,[function(t){e(a(s(t)))},r])})).then(r,o)}}},r.shimSenderReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return s.filterStats(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),s.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return s.filterStats(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,o=void 0,i=void 0;return this.getSenders().forEach((function(e){e.track===t&&(r?i=!0:r=e)})),this.getReceivers().forEach((function(e){return e.track===t&&(o?i=!0:o=e),e.track===t})),i||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}}},r.shimAddTrackRemoveTrackWithNative=a,r.shimAddTrackRemoveTrack=function(e){if(e.RTCPeerConnection){var t=s.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return a(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(r.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}o.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var o=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((function(e){return e.track===t})))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var n=this._streams[r.id];if(n)n.addTrack(t),Promise.resolve().then((function(){o.dispatchEvent(new Event("negotiationneeded"))}));else{var s=new e.MediaStream([t]);this._streams[r.id]=s,this._reverseStreams[s.id]=r,this.addStream(s)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[function(r){var o=l(e,r);t[0].apply(null,[o])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then((function(t){return l(e,t)}))}}));var n=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=d(this,arguments[0]),n.apply(this,arguments)):n.apply(this,arguments)};var c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=c.get.apply(this);return""===e.type?e:l(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var r=void 0;Object.keys(this._streams).forEach((function(o){t._streams[o].getTracks().find((function(t){return e.track===t}))&&(r=t._streams[o])})),r&&(1===r.getTracks().length?this.removeStream(this._reverseStreams[r.id]):r.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function l(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var o=e._reverseStreams[t],i=e._streams[o.id];r=r.replace(new RegExp(i.id,"g"),o.id)})),new RTCSessionDescription({type:t.type,sdp:r})}function d(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var o=e._reverseStreams[t],i=e._streams[o.id];r=r.replace(new RegExp(o.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})}},r.shimPeerConnection=function(e){if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}}));var t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},r.fixNegotiationNeeded=function(e){s.wrapPeerConnectionEvent(e,"negotiationneeded",(function(e){if("stable"===e.target.signalingState)return e}))};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js"));function a(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var o=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(o)&&this._shimmedLocalStreams[r.id].push(o):this._shimmedLocalStreams[r.id]=[r,o],o};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var o=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===o.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],o.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(r){var o=t._shimmedLocalStreams[r].indexOf(e);-1!==o&&t._shimmedLocalStreams[r].splice(o,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]})),i.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((function(t){var o=r.video&&r.video.width,i=r.video&&r.video.height,n=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:n||3}},o&&(r.video.mandatory.maxWidth=o),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices){var r=i.detectBrowser(e),s=function(e){if("object"!==(void 0===e?"undefined":o(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i="object"===o(e[r])?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var s={};"number"==typeof i.ideal?(s[n("min",r)]=i.ideal,t.optional.push(s),(s={})[n("max",r)]=i.ideal,t.optional.push(s)):(s[n("",r)]=i.ideal,t.optional.push(s))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[n("",r)]=i.exact):["min","max"].forEach((function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,r)]=i[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,i){if(r.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===o(e.audio)){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=s(e.audio)}if(e&&"object"===o(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":o(c))?c:{ideal:c});var l=r.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||l)){delete e.video.facingMode;var d=void 0;if("environment"===c.exact||"environment"===c.ideal?d=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(d=["front"]),d)return t.mediaDevices.enumerateDevices().then((function(t){var r=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return d.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!r&&t.length&&d.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=c.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=s(e.video),n("chrome: "+JSON.stringify(e)),i(e)}))}e.video=s(e.video)}return n("chrome: "+JSON.stringify(e)),i(e)},c=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,r,o){a(e,(function(e){t.webkitGetUserMedia(e,r,(function(e){o&&o(c(e))}))}))}.bind(t),t.mediaDevices.getUserMedia){var l=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return a(e,(function(e){return l(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(c(e))}))}))}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js"));var n=i.log},{"../utils.js":15}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=function(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),i=n.default.parseCandidate(e.candidate),s=Object.assign(r,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,s.wrapPeerConnectionEvent(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}},r.shimMaxMessageSize=function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=s.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(e){if(!e||!e.sdp)return!1;var t=n.default.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=n.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},o=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r},i=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},a=function(e,r){var o=65536;"firefox"===t.browser&&57===t.version&&(o=65535);var i=n.default.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?o=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(o=2147483637),o},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r(arguments[0])){var e=o(arguments[0]),t=i(e),n=a(arguments[0],e),s=void 0;s=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return s}}),this._sctp=l}return c.apply(this,arguments)}}},r.shimSendThrowTypeError=function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},s.wrapPeerConnectionEvent(e,"datachannel",(function(e){return r(e.channel,e.target),e}))}function r(e,t){var r=e.send;e.send=function(){var o=arguments[0],i=o.length||o.size||o.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}},r.shimConnectionState=function(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}},r.removeAllowExtmapMixed=function(e){if(e.RTCPeerConnection){var t=s.detectBrowser(e);if(!("chrome"===t.browser&&t.version>=71)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n")),r.apply(this,arguments)}}}};var i,n=(i=e("sdp"))&&i.__esModule?i:{default:i},s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./utils"))},{"./utils":15,sdp:17}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var o=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimPeerConnection=function(e){var t=s.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var o=(0,c.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,a.filterIceServers)(e.iceServers,t.version),s.log("ICE servers after filtering:",e.iceServers)),new o(e)},e.RTCPeerConnection.prototype=o.prototype},r.shimReplaceTrack=function(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var n,s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils")),a=e("./filtericeservers"),c=(n=e("rtcpeerconnection-shim"))&&n.__esModule?n:{default:n}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&o.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof t;return i&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!r?(r=!0,!0):t&&!r})),delete e.url,e.urls=i?t[0]:t,!!t.length}}))};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var n=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return n.shimGetDisplayMedia}}),r.shimOnTrack=function(e){"object"===(void 0===e?"undefined":o(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimPeerConnection=function(e){var t=s.detectBrowser(e);if("object"===(void 0===e?"undefined":o(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}}));var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,o){return n.apply(this,[e||null]).then((function(e){if(t.version<53&&!r)try{e.forEach((function(e){e.type=i[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,r){e.set(r,Object.assign({},t,{type:i[t.type]||t.type}))}))}return e})).then(r,o)}}},r.shimSenderGetStats=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},r.shimReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r}),s.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},r.shimRemoveStream=function(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;s.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)}))})},r.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Promise.reject(o)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=i.detectBrowser(e),r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,o){i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,o)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var s=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":o(e))&&"object"===o(e.audio)&&(e=JSON.parse(JSON.stringify(e)),s(e.audio,"autoGainControl","mozAutoGainControl"),s(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},n&&n.prototype.getSettings){var c=n.prototype.getSettings;n.prototype.getSettings=function(){var e=c.apply(this,arguments);return s(e,"mozAutoGainControl","autoGainControl"),s(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var l=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":o(e))&&(e=JSON.parse(JSON.stringify(e)),s(e,"autoGainControl","mozAutoGainControl"),s(e,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[e])}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimLocalStreamsAPI=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getTracks().forEach((function(o){return t.call(r,o,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var o=e.getTracks();this.getSenders().forEach((function(e){o.includes(e.track)&&t.removeTrack(e)}))}})}},r.shimRemoteStreamsAPI=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}}))}),t.apply(e,arguments)}}},r.shimCallbacksAPI=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,n=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var o=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[o]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],o=i.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o};var c=function(e,t,r){var o=n.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o};t.setLocalDescription=c,c=function(e,t,r){var o=s.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o},t.setRemoteDescription=c,c=function(e,t,r){var o=a.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o},t.addIceCandidate=c}},r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,o=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return o(n(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,o){t.mediaDevices.getUserMedia(e).then(r,o)}.bind(t))},r.shimConstraints=n,r.shimRTCIceServerUrls=function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var o=[],n=0;n<e.iceServers.length;n++){var s=e.iceServers[n];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(s=JSON.parse(JSON.stringify(s))).urls=s.url,delete s.url,o.push(s)):o.push(e.iceServers[n])}e.iceServers=o}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},r.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":o(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var o=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0!==e.offerToReceiveVideo||o||this.addTransceiver("video")}return t.apply(this,arguments)}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"));function n(e){return e&&void 0!==e.video?Object.assign({},e,{video:i.compactObject(e.video)}):e}},{"../utils":15}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.extractVersion=s,r.wrapPeerConnectionEvent=function(e,t,r){if(e.RTCPeerConnection){var o=e.RTCPeerConnection.prototype,i=o.addEventListener;o.addEventListener=function(e,o){if(e!==t)return i.apply(this,arguments);var n=function(e){var t=r(e);t&&o(t)};return this._eventMap=this._eventMap||{},this._eventMap[o]=n,i.apply(this,[e,n])};var n=o.removeEventListener;o.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return n.apply(this,arguments);var o=this._eventMap[r];return delete this._eventMap[r],n.apply(this,[e,o])},Object.defineProperty(o,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},r.disableLog=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":o(e))+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},r.disableWarnings=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":o(e))+". Please use a boolean."):(n=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},r.log=function(){if("object"===("undefined"==typeof window?"undefined":o(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},r.deprecated=function(e,t){n&&console.warn(e+" is deprecated, please use "+t+" instead.")},r.detectBrowser=function(e){var t=e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=s(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=s(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=s(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=s(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r},r.compactObject=function e(t){return"object"!==(void 0===t?"undefined":o(t))?t:Object.keys(t).reduce((function(r,i){var n="object"===o(t[i]),s=n?e(t[i]):t[i],a=n&&!Object.keys(s).length;return void 0===s||a?r:Object.assign(r,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},i,s))}),{})},r.walkStats=a,r.filterStats=function(e,t,r){var o=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var n=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&n.push(e)})),n.forEach((function(t){e.forEach((function(r){r.type===o&&r.trackId===t.id&&a(e,r,i)}))})),i};var i=!0,n=!0;function s(e,t,r){var o=e.match(t);return o&&o.length>=r&&parseInt(o[r],10)}function a(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((function(o){o.endsWith("Id")?a(e,e.get(t[o]),r):o.endsWith("Ids")&&t[o].forEach((function(t){a(e,e.get(t),r)}))})))}},{}],16:[function(e,t,r){"use strict";var o=e("sdp");function i(e,t,r,i,n){var s=o.writeRtpDescription(e.kind,t);if(s+=o.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=o.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":n||"active"),s+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(i?i.id:"-")+" "+a+"\r\n";s+="a="+c,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+o.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+o.localCName+"\r\n"),s}function n(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},o=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var n=o(e.parameters.apt,r),s=o(t.parameters.apt,i);return n&&s&&n.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach((function(o){for(var n=0;n<t.codecs.length;n++){var s=t.codecs[n];if(o.name.toLowerCase()===s.name.toLowerCase()&&o.clockRate===s.clockRate){if("rtx"===o.name.toLowerCase()&&o.parameters&&s.parameters.apt&&!i(o,s,e.codecs,t.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(o.numChannels,s.numChannels),r.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter((function(e){for(var t=0;t<o.rtcpFeedback.length;t++)if(o.rtcpFeedback[t].type===e.type&&o.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var o=0;o<t.headerExtensions.length;o++){var i=t.headerExtensions[o];if(e.uri===i.uri){r.headerExtensions.push(i);break}}})),r}function s(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function a(e,t){var r=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return r||e.addRemoteCandidate(t),!r}function c(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}t.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function l(t,r,o,i){var n=new Event("track");n.track=r,n.receiver=o,n.transceiver={receiver:o},n.streams=i,e.setTimeout((function(){t._dispatchEvent("track",n)}))}var d=function(r){var i=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=n[e].bind(n)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var o=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof o;return i&&(o=[o]),o=o.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)})),delete e.url,e.urls=i?o[0]:o,!!o.length}}))}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var s=r.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=o.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(d.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(d.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),d.prototype.onicecandidate=null,d.prototype.onaddstream=null,d.prototype.ontrack=null,d.prototype.onremovestream=null,d.prototype.onsignalingstatechange=null,d.prototype.oniceconnectionstatechange=null,d.prototype.onconnectionstatechange=null,d.prototype.onicegatheringstatechange=null,d.prototype.onnegotiationneeded=null,d.prototype.ondatachannel=null,d.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},d.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},d.prototype.getConfiguration=function(){return this._config},d.prototype.getLocalStreams=function(){return this.localStreams},d.prototype.getRemoteStreams=function(){return this.remoteStreams},d.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,o={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)o.iceTransport=this.transceivers[0].iceTransport,o.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();o.iceTransport=i.iceTransport,o.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(o),o},d.prototype.addTrack=function(t,r){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var o;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(o=this.transceivers[i]);return o||(o=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),o.track=t,o.stream=r,o.rtpSender=new e.RTCRtpSender(t,o.dtlsTransport),o.rtpSender},d.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach((function(t){r.addTrack(t,e)}));else{var o=e.clone();e.getTracks().forEach((function(e,t){var r=o.getTracks()[t];e.addEventListener("enabled",(function(e){r.enabled=e.enabled}))})),o.getTracks().forEach((function(e){r.addTrack(e,o)}))}},d.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find((function(e){return e.rtpSender===t}));if(!r)throw c("InvalidAccessError","Sender was not created by this connection.");var o=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(o)&&this.localStreams.indexOf(o)>-1&&this.localStreams.splice(this.localStreams.indexOf(o),1),this._maybeFireNegotiationNeeded()},d.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var r=t.getSenders().find((function(t){return t.track===e}));r&&t.removeTrack(r)}))},d.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},d.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},d.prototype._createIceGatherer=function(t,r){var o=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==o.transceivers[t].bufferedCandidateEvents&&o.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},d.prototype._gather=function(t,r){var i=this,n=this.transceivers[r].iceGatherer;if(!n.onlocalcandidate){var s=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,n.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),n.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:r};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==n.state&&"gathering"!==n.state||(n.state="completed");else{"new"===n.state&&(n.state="gathering"),a.component=1,a.ufrag=n.getLocalParameters().usernameFragment;var l=o.writeCandidate(a);s.candidate=Object.assign(s.candidate,o.parseCandidate(l)),s.candidate.candidate=l,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var d=o.getMediaSections(i._localDescription.sdp);d[s.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",i._localDescription.sdp=o.getDescription(i._localDescription.sdp)+d.join("");var u=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",s),u&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){s.forEach((function(e){n.onlocalcandidate(e)}))}),0)}},d.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var o=new e.RTCDtlsTransport(r);return o.ondtlsstatechange=function(){t._updateConnectionState()},o.onerror=function(){Object.defineProperty(o,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:o}},d.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var o=this.transceivers[e].dtlsTransport;o&&(delete o.ondtlsstatechange,delete o.onerror,delete this.transceivers[e].dtlsTransport)},d.prototype._transceive=function(e,r,i){var s=n(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(s.encodings=e.sendEncodingParameters,s.rtcp={cname:o.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(s.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(s)),i&&e.rtpReceiver&&s.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?s.encodings=e.recvEncodingParameters:s.encodings=[{}],s.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(s.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(s.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(s))},d.prototype.setLocalDescription=function(e){var t,r,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=o.splitSections(e.sdp),r=t.shift(),t.forEach((function(e,t){var r=o.parseRtpParameters(e);i.transceivers[t].localCapabilities=r})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=o.splitSections(i._remoteDescription.sdp),r=t.shift();var a=o.matchPrefix(r,"a=ice-lite").length>0;t.forEach((function(e,t){var s=i.transceivers[t],c=s.iceGatherer,l=s.iceTransport,d=s.dtlsTransport,u=s.localCapabilities,h=s.remoteCapabilities;if(!(o.isRejected(e)&&0===o.matchPrefix(e,"a=bundle-only").length||s.rejected)){var p=o.getIceParameters(e,r),g=o.getDtlsParameters(e,r);a&&(g.role="server"),i.usingBundle&&0!==t||(i._gather(s.mid,t),"new"===l.state&&l.start(c,p,a?"controlling":"controlled"),"new"===d.state&&d.start(g));var f=n(u,h);i._transceive(s,f.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},d.prototype.setRemoteDescription=function(i){var d=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!s("setRemoteDescription",i.type,d.signalingState)||d._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+d.signalingState));var u={};d.remoteStreams.forEach((function(e){u[e.id]=e}));var h=[],p=o.splitSections(i.sdp),g=p.shift(),f=o.matchPrefix(g,"a=ice-lite").length>0,m=o.matchPrefix(g,"a=group:BUNDLE ").length>0;d.usingBundle=m;var _=o.matchPrefix(g,"a=ice-options:")[0];return d.canTrickleIceCandidates=!!_&&_.substr(14).split(" ").indexOf("trickle")>=0,p.forEach((function(s,c){var l=o.splitLines(s),p=o.getKind(s),_=o.isRejected(s)&&0===o.matchPrefix(s,"a=bundle-only").length,E=l[0].substr(2).split(" ")[2],T=o.getDirection(s,g),S=o.parseMsid(s),v=o.getMid(s)||o.generateIdentifier();if(_||"application"===p&&("DTLS/SCTP"===E||"UDP/DTLS/SCTP"===E))d.transceivers[c]={mid:v,kind:p,protocol:E,rejected:!0};else{var R,C,y,I,L,O,b,N,P;!_&&d.transceivers[c]&&d.transceivers[c].rejected&&(d.transceivers[c]=d._createTransceiver(p,!0));var A,M,k=o.parseRtpParameters(s);_||(A=o.getIceParameters(s,g),(M=o.getDtlsParameters(s,g)).role="client"),b=o.parseRtpEncodingParameters(s);var U=o.parseRtcpParameters(s),D=o.matchPrefix(s,"a=end-of-candidates",g).length>0,w=o.matchPrefix(s,"a=candidate:").map((function(e){return o.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!_&&m&&c>0&&d.transceivers[c]&&(d._disposeIceAndDtlsTransports(c),d.transceivers[c].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[c].iceTransport=d.transceivers[0].iceTransport,d.transceivers[c].dtlsTransport=d.transceivers[0].dtlsTransport,d.transceivers[c].rtpSender&&d.transceivers[c].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[c].rtpReceiver&&d.transceivers[c].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport)),"offer"!==i.type||_)"answer"!==i.type||_||(C=(R=d.transceivers[c]).iceGatherer,y=R.iceTransport,I=R.dtlsTransport,L=R.rtpReceiver,O=R.sendEncodingParameters,N=R.localCapabilities,d.transceivers[c].recvEncodingParameters=b,d.transceivers[c].remoteCapabilities=k,d.transceivers[c].rtcpParameters=U,w.length&&"new"===y.state&&(!f&&!D||m&&0!==c?w.forEach((function(e){a(R.iceTransport,e)})):y.setRemoteCandidates(w)),m&&0!==c||("new"===y.state&&y.start(C,A,"controlling"),"new"===I.state&&I.start(M)),!n(R.localCapabilities,R.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&R.sendEncodingParameters[0].rtx&&delete R.sendEncodingParameters[0].rtx,d._transceive(R,"sendrecv"===T||"recvonly"===T,"sendrecv"===T||"sendonly"===T),!L||"sendrecv"!==T&&"sendonly"!==T?delete R.rtpReceiver:(P=L.track,S?(u[S.stream]||(u[S.stream]=new e.MediaStream),r(P,u[S.stream]),h.push([P,L,u[S.stream]])):(u.default||(u.default=new e.MediaStream),r(P,u.default),h.push([P,L,u.default]))));else{(R=d.transceivers[c]||d._createTransceiver(p)).mid=v,R.iceGatherer||(R.iceGatherer=d._createIceGatherer(c,m)),w.length&&"new"===R.iceTransport.state&&(!D||m&&0!==c?w.forEach((function(e){a(R.iceTransport,e)})):R.iceTransport.setRemoteCandidates(w)),N=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(N.codecs=N.codecs.filter((function(e){return"rtx"!==e.name}))),O=R.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var B,G=!1;"sendrecv"===T||"sendonly"===T?(G=!R.rtpReceiver,L=R.rtpReceiver||new e.RTCRtpReceiver(R.dtlsTransport,p),G&&(P=L.track,S&&"-"===S.stream||(S?(u[S.stream]||(u[S.stream]=new e.MediaStream,Object.defineProperty(u[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(P,"id",{get:function(){return S.track}}),B=u[S.stream]):(u.default||(u.default=new e.MediaStream),B=u.default)),B&&(r(P,B),R.associatedRemoteMediaStreams.push(B)),h.push([P,L,B]))):R.rtpReceiver&&R.rtpReceiver.track&&(R.associatedRemoteMediaStreams.forEach((function(t){var r=t.getTracks().find((function(e){return e.id===R.rtpReceiver.track.id}));r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)})),R.associatedRemoteMediaStreams=[]),R.localCapabilities=N,R.remoteCapabilities=k,R.rtpReceiver=L,R.rtcpParameters=U,R.sendEncodingParameters=O,R.recvEncodingParameters=b,d._transceive(d.transceivers[c],!1,G)}}})),void 0===d._dtlsRole&&(d._dtlsRole="offer"===i.type?"active":"passive"),d._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?d._updateSignalingState("have-remote-offer"):d._updateSignalingState("stable"),Object.keys(u).forEach((function(t){var r=u[t];if(r.getTracks().length){if(-1===d.remoteStreams.indexOf(r)){d.remoteStreams.push(r);var o=new Event("addstream");o.stream=r,e.setTimeout((function(){d._dispatchEvent("addstream",o)}))}h.forEach((function(e){var t=e[0],o=e[1];r.id===e[2].id&&l(d,t,o,[r])}))}})),h.forEach((function(e){e[2]||l(d,e[0],e[1],[])})),e.setTimeout((function(){d&&d.transceivers&&d.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},d.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},d.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},d.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},d.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},d.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},d.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var n=r.transceivers.filter((function(e){return"audio"===e.kind})).length,s=r.transceivers.filter((function(e){return"video"===e.kind})).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(n=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(s=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(r.transceivers.forEach((function(e){"audio"===e.kind?--n<0&&(e.wantReceive=!1):"video"===e.kind&&--s<0&&(e.wantReceive=!1)}));n>0||s>0;)n>0&&(r._createTransceiver("audio"),n--),s>0&&(r._createTransceiver("video"),s--);var l=o.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach((function(i,n){var s=i.track,a=i.kind,c=i.mid||o.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=r._createIceGatherer(n,r.usingBundle));var l=e.RTCRtpSender.getCapabilities(a);t<15019&&(l.codecs=l.codecs.filter((function(e){return"rtx"!==e.name}))),l.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),l.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var d=i.sendEncodingParameters||[{ssrc:1001*(2*n+1)}];s&&t>=15019&&"video"===a&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,a)),i.localCapabilities=l,i.sendEncodingParameters=d})),"max-compat"!==r._config.bundlePolicy&&(l+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",r.transceivers.forEach((function(e,t){l+=i(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),l+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,l+="a="+o.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(l+="a=end-of-candidates\r\n"))}));var d=new e.RTCSessionDescription({type:"offer",sdp:l});return Promise.resolve(d)},d.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var s=o.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(s+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n";var a=o.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach((function(e,o){if(!(o+1>a)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?s+="m=application 0 DTLS/SCTP 5000\r\n":s+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?s+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(s+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(s+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var l=n(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,s+=i(e,l,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(s+="a=rtcp-rsize\r\n")}}));var l=new e.RTCSessionDescription({type:"answer",sdp:s});return Promise.resolve(l)},d.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,n){if(!r._remoteDescription)return n(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var s=e.sdpMLineIndex;if(e.sdpMid)for(var l=0;l<r.transceivers.length;l++)if(r.transceivers[l].mid===e.sdpMid){s=l;break}var d=r.transceivers[s];if(!d)return n(c("OperationError","Can not add ICE candidate"));if(d.rejected)return i();var u=Object.keys(e.candidate).length>0?o.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return i();if(u.component&&1!==u.component)return i();if((0===s||s>0&&d.iceTransport!==r.transceivers[0].iceTransport)&&!a(d.iceTransport,u))return n(c("OperationError","Can not add ICE candidate"));var h=e.candidate.trim();0===h.indexOf("a=")&&(h=h.substr(2)),(t=o.getMediaSections(r._remoteDescription.sdp))[s]+="a="+(u.type?h:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=o.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var p=0;p<r.transceivers.length&&(r.transceivers[p].rejected||(r.transceivers[p].iceTransport.addRemoteCandidate({}),(t=o.getMediaSections(r._remoteDescription.sdp))[p]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=o.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));p++);i()}))},d.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)})),!r)throw c("InvalidAccessError","Invalid selector.");return r.getStats()}var o=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&o.push(e[t].getStats())}))})),Promise.all(o).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var o=r.prototype.getStats;r.prototype.getStats=function(){return o.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(r){var o;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(o=e[r]).type]||o.type,t.set(r,e[r])})),t}))}}}));var u=["createOffer","createAnswer"];return u.forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(u=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),d}},{sdp:17}],17:[function(e,t,r){"use strict";var o={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};o.localCName=o.generateIdentifier(),o.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},o.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},o.getDescription=function(e){var t=o.splitSections(e);return t&&t[0]},o.getMediaSections=function(e){var t=o.splitSections(e);return t.shift(),t},o.matchPrefix=function(e,t){return o.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},o.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},o=8;o<t.length;o+=2)switch(t[o]){case"raddr":r.relatedAddress=t[o+1];break;case"rport":r.relatedPort=parseInt(t[o+1],10);break;case"tcptype":r.tcpType=t[o+1];break;case"ufrag":r.ufrag=t[o+1],r.usernameFragment=t[o+1];break;default:r[t[o]]=t[o+1]}return r},o.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},o.parseIceOptions=function(e){return e.substr(14).split(" ")},o.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},o.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},o.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},o.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},o.parseFmtp=function(e){for(var t,r={},o=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<o.length;i++)r[(t=o[i].trim().split("="))[0].trim()]=t[1];return r},o.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var o=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?o.push(t+"="+e.parameters[t]):o.push(t)})),t+="a=fmtp:"+r+" "+o.join(";")+"\r\n"}return t},o.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},o.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},o.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},o=e.indexOf(":",t);return o>-1?(r.attribute=e.substr(t+1,o-t-1),r.value=e.substr(o+1)):r.attribute=e.substr(t+1),r},o.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},o.getMid=function(e){var t=o.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},o.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},o.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:o.matchPrefix(e+t,"a=fingerprint:").map(o.parseFingerprint)}},o.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},o.getIceParameters=function(e,t){var r=o.splitLines(e);return{usernameFragment:(r=r.concat(o.splitLines(t))).filter((function(e){return 0===e.indexOf("a=ice-ufrag:")}))[0].substr(12),password:r.filter((function(e){return 0===e.indexOf("a=ice-pwd:")}))[0].substr(10)}},o.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},o.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=o.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var n=r[i],s=o.matchPrefix(e,"a=rtpmap:"+n+" ")[0];if(s){var a=o.parseRtpMap(s),c=o.matchPrefix(e,"a=fmtp:"+n+" ");switch(a.parameters=c.length?o.parseFmtp(c[0]):{},a.rtcpFeedback=o.matchPrefix(e,"a=rtcp-fb:"+n+" ").map(o.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return o.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(o.parseExtmap(e))})),t},o.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){r+=o.writeRtpMap(e),r+=o.writeFmtp(e),r+=o.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){r+=o.writeExtmap(e)})),r},o.parseRtpEncodingParameters=function(e){var t,r=[],i=o.parseRtpParameters(e),n=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=o.matchPrefix(e,"a=ssrc:").map((function(e){return o.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=a.length>0&&a[0].ssrc,l=o.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));l.length>0&&l[0].length>1&&l[0][0]===c&&(t=l[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var o={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(o.rtx={ssrc:t}),r.push(o),n&&((o=JSON.parse(JSON.stringify(o))).fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},r.push(o))}})),0===r.length&&c&&r.push({ssrc:c});var d=o.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=d}))),r},o.parseRtcpParameters=function(e){var t={},r=o.matchPrefix(e,"a=ssrc:").map((function(e){return o.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=o.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var n=o.matchPrefix(e,"a=rtcp-mux");return t.mux=n.length>0,t},o.parseMsid=function(e){var t,r=o.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var i=o.matchPrefix(e,"a=ssrc:").map((function(e){return o.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},o.generateSessionId=function(){return Math.random().toString().substr(2,21)},o.writeSessionBoilerplate=function(e,t,r){var i=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||o.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},o.writeMediaSection=function(e,t,r,i){var n=o.writeRtpDescription(e.kind,t);if(n+=o.writeIceParameters(e.iceGatherer.getLocalParameters()),n+=o.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),n+="a=mid:"+e.mid+"\r\n",e.direction?n+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?n+="a=sendrecv\r\n":e.rtpSender?n+="a=sendonly\r\n":e.rtpReceiver?n+="a=recvonly\r\n":n+="a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";n+="a="+s,n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,n+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+o.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+o.localCName+"\r\n"),n},o.getDirection=function(e,t){for(var r=o.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?o.getDirection(t):"sendrecv"},o.getKind=function(e){return o.splitLines(e)[0].split(" ")[0].substr(2)},o.isRejected=function(e){return"0"===e.split(" ",2)[1]},o.parseMLine=function(e){var t=o.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},o.parseOLine=function(e){var t=o.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},o.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=o.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=o)},{}]},{},[1])(1)},9194:function(e){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(o,i,function(t){return e[t]}.bind(null,i));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=19)}([function(e,t,r){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoWebSocket=t.LoggerStateCenter=t.ZegoDataReport=t.ZegoLogger=t.MODULE_TIPS=t.LinkedList=t.ListNode=t.getReportSeq=t.getSeq=t.REPORT_ACTION=t.E_CLIENT_TYPE=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.ENUM_NETWORK_STATE=t.ENUM_RUN_STATE=t.MAX_MIX_TASK_ID_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.ENUM_CONNECT_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.PROTO_VERSION="1.11.0",t.ROOMVERSION="V1",function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]="disable",e[e.websocket=1]="websocket",e[e.https=2]="https"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152},function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1200},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=1,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MIX_TASK_ID_LENGTH=256,function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online"}(t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={})),t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.SERVER_ERROR_CODE=1e4,function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallProgram=2]="ClientType_SmallProgram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={})),t.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},t.getSeq=(o=1,function(){return o++}),t.getReportSeq=function(){var e=1;return function(){return e++}}();var i=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=i;var n=function(){function e(){this.start=new i,this.end=new i,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new i(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this._numNodes>0?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=n,t.MODULE_TIPS={MESSAGE:"未引入消息模块"};var s=r(21);Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return s.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return s.ZegoDataReport}}),Object.defineProperty(t,"LoggerStateCenter",{enumerable:!0,get:function(){return s.LoggerStateCenter}}),Object.defineProperty(t,"createZegoWebSocket",{enumerable:!0,get:function(){return s.createZegoWebSocket}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},NETWORK_RECOVERY:{code:1002051,msg:"network recovery"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},REPEATEDLY_ENTER_ROOM:{code:1002057,msg:"user repeatedly enter room"},ALREADY_LOGIN:{code:1002058,msg:"user already logged in"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=void 0;var o=r(22),i=r(0),n=r(1),s=function(){function e(){}return e.checkConfigParam=function(e,t,r){return e&&"number"==typeof e&&this.checkInteger(e)?!(!t||"string"!=typeof t&&!Array.isArray(t)||""==t)||(r.error("ccp.0 server must be string or string array and not empty"),!1):(r.error("ccp.0 appid must be positive integer number and not empty"),!1)},e.checkPriConfigParam=function(e,t,r,o,i){return e&&"number"==typeof e&&this.checkInteger(e)?t&&"string"==typeof t?"object"!=typeof r||"string"!=typeof r.deviceID?(i.error("ccp.0 deviceID must be string and not empty"),!1):1===o||0===o||(i.error("ccp.0 anType must be 0 or 1"),!1):(i.error("ccp.0 dispatchServer must be string and not empty"),!1):(i.error("ccp.0 appid must be positive integer number and not empty"),!1)},e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},e.registerCallback=function(e,t,r){var o,i;t.success&&(o=t.success,r[e+"SuccessCallback"]=o),t.error&&(i=t.error,r[e+"ErrorCallback"]=i)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.logReportCallback=function(t,r,o,i){e.registerCallback(t,{success:function(t,i){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];e.dataReportEvent(r,o,t,i,n)}},i)},e.proxyRes=function(t,r,o,i){return{interResolve:function(e){t.uploadReport(r),o(e)},interReject:function(o,n){var s;void 0===n&&(n=""),(s=o.code<2e9&&o.code>1e9?e.decodeServerError(o.code,o.msg):{code:o.code,message:o.msg})&&t.addMsgInfo(r,{error:s.code,message:s.message+n}),t.uploadReport(r),i({errorCode:o.code})}}},e.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};if(0===e)return n.errorCodeList.SUCCESS;var r=n.errorCodeList.ROOM_INNER_ERROR;if(r.code=e,e>1e9){var o=t[e];r.msg=o?"liveroom cmd error, code: "+e+", message: "+o:t[1e9]+e}else r.msg=t[e]?t[e]+" code:"+e:"unknown error code:"+e;return r},e.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},e.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return r.code=e>1e9?e-1e9+52e6:e+2002e6,t&&(r.message=t),r},e.getLiveRoomError=function(e){return e>1e9?{1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR"}[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},e.getKickoutError=function(e){var t={code:e,message:"kickout reason = "+e};switch(e){case 1:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:t.code=63000002,t.message="zpush manual kickout",t.name="MANUAL_KICKOUT";break;case 3:t.code=63000003,t.message="kickout reason = "+e;break;case 4:t.code=63000004,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 5:t.code=63000005,t.message="zpush token expired",t.name="TOKEN_EXPIRED";break;default:t.code=e,t.message="kickout reason = "+e}return t},e.dataReportEvent=function(e,t,r,o,i){switch(r){case"eventStart":e.eventStart(t,o);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,o,i[0]);break;case"addEventMsg":e.addEventMsg(t,o,i[0],i[1]);break;case"addEvent":e.addEvent(t,o);break;case"eventEnd":e.eventEnd(t,o);break;case"addMsgInfo":e.addMsgInfo(t,i[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeUserList=function(e,t,r,o){e.debug("msl.0 call");var i,n=[],s=[];r||(r=[]);for(var a=0;a<r.length;a++){i=!1;for(var c=0;c<t.length;c++)if(r[a].userID===t[c].userID){i=!0;break}i||n.push(r[a])}for(var l=0;l<t.length;l++){i=!1;for(var d=0;d<r.length;d++)if(t[l].userID===r[d].userID){i=!0;break}i||s.push(t[l])}for(t.splice(0),a=0;a<r.length;a++)t.push(t[a]);o(n,s),e.debug("msl.0 call success")},e.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=r},e.generateRandumNumber=function(e){return parseInt(Math.random()*(e+1)+"",10)},e.uuid=function(e,t){var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(t=t||o.length,e)for(r=0;r<e;r++)i[r]=o[0|Math.random()*t];else{var n=void 0;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;r<36;r++)i[r]||(n=0|16*Math.random(),i[r]=o[19==r?3&n|8:n])}return i.join("")},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var o=0;o<r;o++){var i=parseInt(e[o]),n=parseInt(t[o]);if(i>n)return 1;if(i<n)return-1}return 0},e.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),o=null!=window.opr,i=e.indexOf("Chrome")&&window.chrome,n=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return t?"IE":r?"Firefox":o?"Opera":i?"Chrome":n?"Safari":"Unkown"},e.isTestEnv=function(e){return-1!=e.indexOf("wss://wssliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://test2-wsliveroom-api.zego.im/ws")||-1!=e.indexOf("wss://wsliveroom-test.zegocloud.com/ws")||-1!=e.indexOf("wss://wsliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test-bak.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-hk-test.zegocloud.com/ws")||-1!=e.indexOf("wss://webliveroom-hk-test-bak.zegocloud.com/ws")},e.getLogLevel=function(e){return i.LOG_LEVEL[e]},e.getUint64=function(e,t,r){var o=r.getUint32(e,t),i=r.getUint32(e+4,t),n=t?o+Math.pow(2,32)*i:Math.pow(2,32)*o+i;return Number.isSafeInteger(n)||console.warn(n,"exceeds MAX_SAFE_INTEGER. Precision may be lost"),n},e.decodeTokenExpire=function(t){try{var r,i=Uint8Array.from(o.Base64.base64decode(t),(function(e){return e.charCodeAt(0)})),n=new DataView(i.buffer);return r="function"==typeof n.getBigInt64?n.getBigUint64(0):e.getUint64(0,!1,n),Number(r>0?r:n.getBigUint64(0,!0))}catch(e){console.error("token error")}return-1},e}();t.ClientUtil=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_RTM_ACTION=void 0,function(e){e.ZEGOEXPRESSWEBRTM_CONSTRUCTOR="zm.0",e.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER="zm.wl",e.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG="zm.slf",e.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE="zm.sdv",e.ZEGOEXPRESSWEBRTM_LOGIN_ROOM="zm.lg",e.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM="zm.lo",e.ZEGOEXPRESSWEBRTM_SET_CLOUD_SETTING_URLS="zm.scsu",e.ZEGOEXPRESSWEBRTM_ON="zm.on",e.ZEGOEXPRESSWEBRTM_OFF="zm.off",e.ZEGOEXPRESSWEBRTM_RENEWTOKEN="zm.rntk",e.ZEGOEXPRESSWEBRTM_RESETTOKENTIMER="zm.rstt",e.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM="zm.emr",e.ZEGOEXPRESSWEBRTM_SEND_PB="zm.spb",e.ZEGOEXPRESSWEBRTM_GET_HEADER="zm.gh",e.ROOM_LOGIN_ROOM="zm.rm.lg",e.ROOM_TRY_LOGIN="zm.rm.tl",e.ROOM_OPEN_HANDLER="zm.rm.op",e.ROOM_HANDLE_LOGINRSP="zm.rm.lgr",e.ROOM_CLOSEHANDLER="zm.rm.clh",e.ROOM_LOGOUT="zm.rm.lo",e.ROOM_RESET_ROOM="zm.rm.rr",e.ROOM_DISCONNECT="zm.rm.dcn",e.ROOM_KICK_OUT="zm.rm.kco",e.ROOM_STATUS_CALLBACK="zm.rm.scb",e.ROOM_RESETTOKEN_TIMER="zm.rm.rst",e.HEARTBEAT_START="zm.hb.st",e.HEARTBEAT_HEARTBEAT_RSP="zm.hb.rsp",e.HEARTBEAT_RESET="zm.hb.rst",e.SERVICE_PUSH="zm.sv.ps",e.SERVICE_SEND="zm.sv.sd",e.USER_LOGIN_RSP="zm.us.lgr",e.USER_FETCH_USER="zm.us.ftu",e.USER_FETCH_USER_RSP="zm.us.urp",e.USER_USER_PUSH="zm.us.uph",e.USER_MERGE_SEQ="zm.us.mg",e.USER_MERGE_TIMEOUT="zm.us.mto",e.USER_MERGE="zm.us.mg",e.USER_HB_PATCH="zm.us.pt",e.STATE_ACTION="zm.st.at",e.ON_LISTENER="ON_LISTENER"}(t.ZEGO_RTM_ACTION||(t.ZEGO_RTM_ACTION={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRTMLogEvent=void 0;var o=r(1),i=function(e){return e};t.ZegoRTMLogEvent={kZegoTaskInitSetting:{event:"/sdk/init",error:{kInvalidParamError:o.errorCodeList.INPUT_PARAM},system_info:navigator?navigator.appVersion:""},kZegoTaskSetDebug:{event:"/sdk/set_debug",debug:i},kZegoTaskSetLog:{event:"/sdk/set_log_config",error:{kInvalidParamError:o.errorCodeList.INPUT_PARAM},log_level:function(e){return e},remote_log_level:i,log_url:i},kZegoTaskLoginRoom:{event:"/sdk/login",user_update:i,max_member_count:i,message:i,token:i,error:{ROOM_ID_NULL:o.errorCodeList.ROOM_ID_NULL,INPUT_PARAM:o.errorCodeList.INPUT_PARAM,ROOM_ID_TOO_LONG:o.errorCodeList.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:o.errorCodeList.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:o.errorCodeList.USER_ID_NULL,USER_ID_TOO_LONG:o.errorCodeList.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:o.errorCodeList.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:o.errorCodeList.USER_NAME_NULL,USER_NAME_TOO_LONG:o.errorCodeList.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:o.errorCodeList.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:o.errorCodeList.LOGIN_TIMEOUT,INNER_ERROR:o.errorCodeList.ROOM_INNER_ERROR,NETWORK_BROKEN:o.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:i,try_cnt:i},liveroom_login:{event:"liveroom_login",server:i,respond_info:i}}},kZegoTaskReNewToken:{event:"/sdk/reNewToken",error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,NOT_LOGIN:o.errorCodeList.NOT_LOGIN}},kZegoTaskLogoutRoom:{event:"/sdk/logout",error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,ROOM_NOT_EXIST:o.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskReLoginRoom:{event:"/sdk/relogin",error:{ROOM_ID_NULL:o.errorCodeList.ROOM_ID_NULL,ROOM_DISCONNECT:o.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:i,try_cnt:i},liveroom_login:{event:"liveroom_login",server:i,respond_info:i}}},kZegoTaskKickout:{event:"/sdk/kickout",user_id:i,error:{}},kZegoTaskRoomKickout:{event:"/sdk/room_kickout",user_id:i,room_id:i,message:i},kZegoTaskLiveRoomHB:{event:"/liveroom/hb",room_sid:i,error:{NOT_LOGIN:o.errorCodeList.NOT_LOGIN,HB_TIMEOUT:o.errorCodeList.TIMEOUT}},kZegoTaskLiveRoomGetUserUpdateInfo:{event:"/liveroom/get_user_update_info",user_update_type:i},kZegoListener:{event:"/sdk/listener"},kZegoEnableMultiRoom:{event:"sdk/enable_multi_room",error:{kInvalidParamError:o.errorCodeList.INPUT_PARAM,kAlreadyLoginError:o.errorCodeList.ALREADY_LOGIN}},kZegoTaskCloudSettingCache:{event:"/cloud_setting/cache"},kZegoTaskCloudSettingRefresh:{event:"/cloud_setting/refresh"},kZegoTaskCloudSettingRequest:{event:"/cloud_setting/request"}}},,,,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeartBeatHandler=void 0;var o=r(0),i=r(2),n=r(1),s=r(3),a=r(4),c=3,l=function(){function e(e,t,r,o,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=i,this.tryHeartbeatCount=0,this.heartbeatTimer=null,this.loginHeartbeatTimer=null,this.initCount=0}return e.prototype.init=function(e){var t,r=this;if("PRIVATE"==this.stateCenter.type){t=e.body.hb_interval<o.MINIUM_HEARTBEAT_INTERVAL?o.MINIUM_HEARTBEAT_INTERVAL:e.body.hb_interval;var i=e.body.hb_timeout||4e4;c=i/t+1}else t=e.body.hearbeat_interval<o.MINIUM_HEARTBEAT_INTERVAL?o.MINIUM_HEARTBEAT_INTERVAL:e.body.hearbeat_interval;this.tryHeartbeatCount=0,this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.loginHeartbeatTimer=setTimeout((function(){r.start(t)}),t),this.initCount++},e.prototype.start=function(e){var t=this;this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_START+" call");var r=o.getReportSeq();if(this.dataReport.newReport(r,a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.event),this.dataReport.addMsgInfo(r,{room_sid:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.room_sid(this.room.sessionID)}),!this.room.isLogin())return this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_START+" state error"),this.dataReport.addMsgInfo(r,{error:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.NOT_LOGIN.code,message:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.NOT_LOGIN.msg}),void this.dataReport.uploadReport(r);if(++this.tryHeartbeatCount>c)return this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_START+" come to try limit"),this.dataReport.addMsgInfo(r,{error:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.code,message:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.msg}),this.dataReport.uploadReport(r),void this.hbLogout(n.errorCodeList.HEARTBEAT_TIMEOUT);var l=function(e){var o="PRIVATE"==t.stateCenter.type?e.body&&e.body.code:e.body&&e.body.err_code;if(e.header&&e.body){if(0!==o){var s=i.ClientUtil.decodeServerError(e.body.err_code||e.body.code,e.body.err_message||e.body.message);t.dataReport.addMsgInfo(r,{error:s.code,message:s.message+e.body.err_code})}}else t.dataReport.addMsgInfo(r,{error:e.code>0?e.code:n.errorCodeList.ROOM_INNER_ERROR.code,message:e.msg?e.msg:n.errorCodeList.ROOM_INNER_ERROR});t.dataReport.uploadReport(r),"PRIVATE"==t.stateCenter.type?t.handlePrivateHeartbeatRsp(e):t.handleHeartbeatRsp(e)};this.service.heartBeat(l,l,this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.heartbeatInterval=e;var d=this.heartbeatInterval;this.initCount>=2?(d=Math.round(Math.random()*(this.heartbeatInterval+1)),this.initCount=1):d=this.heartbeatInterval,this.heartbeatTimer=setTimeout((function(){t.start(t.heartbeatInterval)}),d),this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_START+" call success")},e.prototype.handleHeartbeatRsp=function(e){return e.body&&e.body.err_code&&0!==e.body.err_code?(this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, server error=",e.body.err_code),e.body.err_code==o.ERROR_CODES.ROOM_SESSION_ID_ERR?void this.hbLogout(n.errorCodeList.HEARTBEAT_TIMEOUT):void this.hbLogout(i.ClientUtil.getServerError(e.body.err_code))):e.header&&e.body?(this.tryHeartbeatCount=0,this.heartbeatInterval=e.body.hearbeat_interval,this.heartbeatInterval<o.MINIUM_HEARTBEAT_INTERVAL&&(this.heartbeatInterval=o.MINIUM_HEARTBEAT_INTERVAL),this.heartbeatRspNotiFy(e),void this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" call success")):(this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, error=",JSON.stringify(e)),void this.hbLogout(e))},e.prototype.handlePrivateHeartbeatRsp=function(e){if(0!==e.body.code)return this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, server error=",e.body.code),e.body.code==o.ERROR_CODES.ROOM_SESSION_ID_ERR?void this.hbLogout(n.errorCodeList.HEARTBEAT_TIMEOUT):void this.hbLogout(i.ClientUtil.getServerError(e.body.code));this.tryHeartbeatCount=0,this.heartbeatInterval=e.body.hb_interval,this.heartbeatInterval<o.MINIUM_HEARTBEAT_INTERVAL&&(this.heartbeatInterval=o.MINIUM_HEARTBEAT_INTERVAL),this.heartbeatRspNotiFy(e),this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" call success")},e.prototype.heartbeatRspNotiFy=function(e){},e.prototype.hbLogout=function(e){},e.prototype.resetHeartbeat=function(){clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null,clearTimeout(this.loginHeartbeatTimer),this.loginHeartbeatTimer=null,this.tryHeartbeatCount=0,this.initCount=0,this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_RESET+" call success")},e}();t.HeartBeatHandler=l},function(e,t,r){"use strict";var o=this&&this.__spreadArray||function(e,t){for(var r=0,o=t.length,i=e.length;r<o;r++,i++)e[i]=t[r];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.UserHandler=void 0;var i=r(0),n=r(2),s=r(3),a=r(4),c=function(){function e(e,t,r,o,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=i,this.userQuerying=!1,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=[],this.userSeqMergeMap={},this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}return e.prototype.loginRsp=function(e,t){this.anchor_info=e.body.anchor_info||this.anchor_info,this.userListInterval=e.body.userlist_interval||this.userListInterval,this.userListMergeInterval=e.body.userlist_merge_timeout||this.userListMergeInterval,e.body.anchor_info&&(this.stateCenter.actionListener("getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name),this.stateCenter.actionListener("_getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name)),e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count),this.logger.info(s.ZEGO_RTM_ACTION.USER_LOGIN_RSP+"  userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList(t)},e.prototype.patchUserList=function(e){var t=this;e.body.server_user_seq!==this.userSeq&&this.stateCenter.userStateUpdate&&!this.userSeqMergeMap&&(this.logger.info(s.ZEGO_RTM_ACTION.USER_HB_PATCH+" call update user "+this.userSeq+" server "+e.body.server_user_seq),this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout((function(){t.handleMergeTimeout()}),this.userListMergeInterval)),this.minUserSeq=e.body.server_user_seq,null!=e.body.online_count&&0!=e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count)},e.prototype.resetUserHandler=function(){this.userQuerying=!1,this.lastUserQueryTime=0,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=void 0,this.userSeqMergeMap={},this.userSeqMergeTimer=void 0,this.userQueryTimer=void 0,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},e.prototype.fetchUserList=function(e){this.userQuerying?this.logger.warn(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" is already querying"):(this.userQuerying=!0,this.userTempList=[],this.fetchUserListWithPage(0,e||0),this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" the first time call"))},e.prototype.fetchUserListWithPage=function(e,t){var r,o=this,n=function(e){"PRIVATE"==o.stateCenter.type?o.handleFetchUserListPrivateRsp(e):o.handleFetchUserListRsp(e,t)};r="PRIVATE"==this.stateCenter.type?{room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid,room_user_session_id:this.room.roomSessionID},mark:"0"}:{user_index:e,sort_type:0},"V1"===i.ROOMVERSION?this.service.fetchUserList(r,n,n,this.room.sessionID,this.room.roomID,this.room.roomSessionID):this.service.fetchUserListV2({marker:0===e?"":e+"",mode:0,limit:100},n,n,this.room.sessionID,this.room.roomID,this.room.roomSessionID)},e.prototype.handleFetchUserListRsp=function(e,t){var r=this;if(e.body&&0!=e.body.err_code)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch error "+e.body.err_code);if(!e.header||!e.body)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch error "+e);if(this.stateCenter.userStateUpdate){this.userTempList=o(o([],this.userTempList),e.body.user_baseinfos);var a=e.body.ret_user_index;if(a!=e.body.server_user_index)return this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch another page"),void this.fetchUserListWithPage(a+1,t);this.userSeq=e.body.server_user_seq;for(var c=[],l=[],d=0;d<this.userTempList.length;d++){var u={userID:this.userTempList[d].id_name,userName:this.userTempList[d].nick_name,role:this.userTempList[d].role};c.push(u),l.push({idName:this.userTempList[d].id_name,nickName:this.userTempList[d].nick_name,role:this.userTempList[d].role})}this.stateCenter.actionListener("_getTotalUserList",this.room.roomID,l),t==i.ENUM_RUN_STATE.login?(this.userList&&n.ClientUtil.mergeUserList(this.logger,this.userList,c,(function(e,t){0!==e.length&&r.onUserStateUpdate(r.room.roomID,"ADD",e),0!==t.length&&r.onUserStateUpdate(r.room.roomID,"DELETE",t)})),this.userList=c):(this.userList=c,0!==c.length&&this.onUserStateUpdate(this.room.roomID,"ADD",c)),this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.userTempList=[],this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" call success user_list "+c+" count "+c.length)}},e.prototype.handlePushUserStateUpdateMsg=function(e){if(this.logger.info(s.ZEGO_RTM_ACTION.USER_USER_PUSH+" call"),this.stateCenter.userStateUpdate)if(this.userSeq!==e.body.user_list_seq)if(this.userSeq+e.body.user_actions.length===e.body.user_list_seq){this.userSeq=e.body.user_list_seq;var t,r,o=[];if("PRIVATE"==this.stateCenter.type){t=0,r=1;for(var i=0;i<e.body.user_actions.length;i++){var n={action:e.body.user_actions[i].action,idName:e.body.user_actions[i].user_id,nickName:e.body.user_actions[i].user_name,role:e.body.user_actions[i].role,loginTime:e.body.user_actions[i].login_time};o.push(n)}}else{for(t=1,r=2,i=0;i<e.body.user_actions.length;i++)n={action:e.body.user_actions[i].Action,idName:e.body.user_actions[i].IdName,nickName:e.body.user_actions[i].NickName,role:e.body.user_actions[i].Role,loginTime:e.body.user_actions[i].LoginTime},o.push(n);this.stateCenter.actionListener("_userStateUpdate",e.body.room_id,o)}var a=[],c=[];o.forEach((function(e){e.action==t?a.push({userID:e.idName,userName:e.nickName,role:e.role}):e.action==r&&c.push({userID:e.idName,userName:e.nickName,role:e.role})})),this.userList&&(this.userList=this.userList.concat(a).filter((function(e){return!c.some((function(t){return t.userID==e.userID}))}))),0!==a.length&&this.onUserStateUpdate(e.body.room_id||e.body.room_pushheader.room_id,"ADD",a),0!==c.length&&this.onUserStateUpdate(e.body.room_id||e.body.room_pushheader.room_id,"DELETE",c),this.logger.info(s.ZEGO_RTM_ACTION.USER_USER_PUSH+" call success")}else this.mergeUserByUserSeq(e.body.user_list_seq,e.body.user_actions);else this.logger.warn(s.ZEGO_RTM_ACTION.USER_USER_PUSH+" user_list_seq is the same with local seq");else this.logger.info(s.ZEGO_RTM_ACTION.USER_USER_PUSH+" userStateUpdate is false")},e.prototype.onUserStateUpdate=function(e,t,r){var o=this,n=i.getReportSeq();this.dataReport.newReport(n,a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.event);var s=r.filter((function(e){return e.userID!==o.stateCenter.idName}));0!=s.length&&("PRIVATE"!==this.stateCenter.type&&(s=s.map((function(e){return{userID:e.userID,userName:e.userName}}))),this.stateCenter.actionListener("roomUserUpdate",e,t,s),this.dataReport.addMsgInfo(n,{user_update_type:"ADD"==t?a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.user_update_type("added"):a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.user_update_type("deleted")}),this.dataReport.uploadReport(n))},e.prototype.mergeUserByUserSeq=function(e,t){var r=this;this.userSeqMergeMap||(this.logger.warn(s.ZEGO_RTM_ACTION.USER_MERGE_SEQ+" new merge userlist "+this.userSeq+" server "+e),this.userSeqMergeMap={},this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout((function(){r.handleMergeTimeout()}),this.userListMergeInterval)),this.userSeqMergeMap[e]=t,this.logger.warn(s.ZEGO_RTM_ACTION.USER_MERGE_SEQ+"  merge userlist "+this.userSeq+" server "+e+" userlist "+t.length)},e.prototype.mergeUser=function(e){var t=this;this.logger.info(s.ZEGO_RTM_ACTION.USER_MERGE+" merge userlist "+this.userSeq+" userSeqList "+e.join(",")),this.userSeq=e[e.length-1],this.lastUserQueryTime=Date.now()+this.userListInterval;var r={};e.forEach((function(e){t.userSeqMergeMap&&t.userSeqMergeMap[e].forEach((function(e){r[e.IdName]=e}))})),this.userSeqMergeMap=null;var o=Object.values(r).map((function(e){return{action:e.Action,idName:e.IdName,nickName:e.NickName,role:e.Role,loginTime:e.LoginTime?String(e.LoginTime):""}}));o.sort((function(e,t){return e.loginTime.localeCompare(t.loginTime)}));var i=[],n=[];o.forEach((function(e){1==e.action?i.push({userID:e.idName,userName:e.nickName,role:e.role}):2==e.action&&n.push({userID:e.idName,userName:e.nickName,role:e.role})})),this.userList=this.userList&&this.userList.concat(i).filter((function(e){return!n.some((function(t){return t.userID==e.userID}))})),0!==i.length&&this.onUserStateUpdate(this.room.roomID,"ADD",i),0!==n.length&&this.onUserStateUpdate(this.room.roomID,"DELETE",n),this.stateCenter.actionListener("_userStateUpdate",this.room.roomID,o)},e.prototype.handleMergeTimeout=function(){var e=this,t=Object.keys(this.userSeqMergeMap).map((function(e){return+e})).sort((function(e,t){return e-t}));if(t[t.length-1]-t[0]+1===t.length||t[t.length-1]>=this.minUserSeq)this.mergeUser(t);else{this.userSeqMergeMap=null;var r=this.lastUserQueryTime-Date.now();this.logger.info(s.ZEGO_RTM_ACTION.USER_MERGE_TIMEOUT+"  fetch merge userlist "+this.userSeq+" userSeqList "+t.join(",")+" wait "+r),r>0?(this.userQueryTimer&&clearTimeout(this.userQueryTimer),this.userQueryTimer=setTimeout((function(){e.fetchUserList()}),r)):this.fetchUserList()}},e.prototype.loginPrivateRsp=function(e){this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER," userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList()},e.prototype.handleFetchUserListPrivateRsp=function(e){if(this.logger.debug(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" call"),e.body.code&&0!==e.body.code)return this.userQuerying=!1,void this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" fetch error "+e.body.code+" "+e.body.message);if(this.stateCenter.userStateUpdate){this.userTempList=o(o([],this.userTempList),e.body.users),this.userSeq=e.body.userlist_seq,this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" set user Seq "+this.userSeq);for(var t=[],r=0;r<this.userTempList.length;r++){var i={userID:this.userTempList[r].user_id,userName:this.userTempList[r].user_name,role:this.userTempList[r].role};t.push(i)}this.userQuerying=!1,this.onUserStateUpdate(this.room.roomID,"ADD",t),this.userTempList=[],this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" call success user_list "+t+" count "+t.length)}},e}();t.UserHandler=c},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__spreadArray||function(e,t){for(var r=0,o=t.length,i=e.length;r<o;r++,i++)e[i]=t[r];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomService=void 0;var n=r(0),s=r(12),a=r(3),c=r(1),l=function(){function e(e,t,r){this.stateCenter=e,this.logger=t,this.rtm=r,this.service=new s.ZegoSocketService(this.stateCenter.ENV),this.cmdSeq=0,this.responseRouters={}}return e.prototype.checkResponse=function(e){return e.header.appid!==this.stateCenter.appid||e.header.user_id!==this.stateCenter.userid},e.prototype.handleSendCommandMsgRsp=function(e){var t=this,r=this.service.sendCommandMap[e.header.seq];if(null!=r){var o=r._data;delete this.service.sendCommandMap[e.header.seq],this.service.sendCommandList.remove(r),0===e.body.err_code?setTimeout((function(){o&&null!=o.success&&o.success(e,t.cmdSeq)}),0):setTimeout((function(){o&&null!=o.error&&o.error(e,t.cmdSeq)}),0)}},e.prototype.onPush=function(){var e=this;this.service.onMessage=function(t){t instanceof ArrayBuffer?e.stateCenter.actionListener("_protobufResponse",t):t.header?(0!==t.body.err_code?t.body.err_message&&e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", err_code="+t.body.err_code+", err_message="+t.body.err_message+" "):e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", msg="+JSON.stringify(t)+" "),["login","logout"].indexOf(t.header.cmd)>-1?e.handleSendCommandMsgRsp(t):e.checkResponse(t)?e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+"  check session fail."):(e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+",function="+!!e.responseRouters[t.header.cmd]),e.handleSendCommandMsgRsp(t),e.responseRouters[t.header.cmd]&&e.responseRouters[t.header.cmd](t,e.cmdSeq))):e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" msg type error ")}},e.prototype.handlePushKickout=function(e){var t,r,o,n;if(void 0===(null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.protocol)||1===(null===(r=null==e?void 0:e.body)||void 0===r?void 0:r.protocol))i([],this.stateCenter.roomModulesList).forEach((function(t){return t.roomHandler.handlePushKickout(e,!0)}));else{var s=null===(o=null==e?void 0:e.header)||void 0===o?void 0:o.room_id,c=this.stateCenter.roomModulesList.find((function(e){return e.roomID==s}));if(!c)return void this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(null===(n=e.header)||void 0===n?void 0:n.room_id));c.roomHandler.handlePushKickout(e)}},e.prototype.handlePushCustomMsg=function(e){},e.prototype.handlePushRoomMsg=function(e){},e.prototype.handlePushUserStateUpdateMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find((function(e){return e.roomID==r}));o?o.userHandler.handlePushUserStateUpdateMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushMergeMsg=function(e){},e.prototype.handlePushTransMsg=function(e){},e.prototype.handleBigImMsgRsp=function(e){},e.prototype.handlePushSignalMsg=function(e){},e.prototype.handlePushTokenExpire=function(e){this.stateCenter.actionListener("_tokenExpired",e)},e.prototype.closeHandler=function(e){this.service.closeHandler(e)},e.prototype.openHandler=function(e){this.service.openHandler(e)},e.prototype.errorHandler=function(e){this.service.errorHandler(e)},e.prototype.getHeader=function(e,t,r,o){return{Protocol:"V1"===n.ROOMVERSION?"req":"req_v2",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:t||"",room_id:r||"",room_session_id:o||"",biz_version:this.stateCenter.bizVersion||""}},e.prototype.startCheck=function(){this.service.startCheck()},e.prototype.stopCheck=function(){this.service.stopCheck()},e.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},e.prototype.createSocket=function(e){var t=this;this.service.createSocket(e),this.responseRouters=o(o({},this.responseRouters),{push_kickout:function(e){t.handlePushKickout(e)},push_custommsg:function(e){t.handlePushCustomMsg(e)},push_im_chat:function(e){t.handlePushRoomMsg(e)},push_userlist_update:function(e){t.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){t.handlePushMergeMsg(e)},push_trans:function(e){t.handlePushTransMsg(e)},push_signal:function(e){t.handlePushSignalMsg(e)},push_token_expire:function(e){t.handlePushTokenExpire(e)}})},e.prototype.closeSocket=function(){this.service.closeSocket()},e.prototype.sendMessage=function(e,t,r,o,i,n){var s,l,d;if(this.service.isDisConnect())return this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_SEND+" socket is disconnect"),o(c.errorCodeList.SOCKET_CLOSE),0;var u=(null==n?void 0:n.roomID)?n.roomID:null===(s=this.stateCenter.roomModulesList[0])||void 0===s?void 0:s.roomID,h=(null==n?void 0:n.roomSessionID)?n.roomSessionID:null===(l=this.stateCenter.roomModulesList[0])||void 0===l?void 0:l.roomSessionID,p=(null==n?void 0:n.sessionID)?n.sessionID:null===(d=this.stateCenter.roomModulesList[0])||void 0===d?void 0:d.sessionID,g=i||this.getHeader(e,p,u,h);return this.logger.info(a.ZEGO_RTM_ACTION.SERVICE_SEND+" sendMsg:"+JSON.stringify({header:g,body:t})),this.service.sendMessage(g,t,r,o)},e.prototype.on=function(e,t){this.responseRouters[e]=t},e.prototype.login=function(e,t,r){var o=this.getHeader(e.isMulti?"enter":"login",e.sessionID,e.roomID,e.roomSessionID),i={id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,role:this.stateCenter.role,token:e.token,version:this.stateCenter.sdKVersion,room_name:e.roomID,user_state_flag:this.stateCenter.userStateUpdate?1:0,room_create_flag:this.stateCenter.roomCreateFlag,client_type:0===this.stateCenter.ENV?n.E_CLIENT_TYPE.ClientType_Webrtc:n.E_CLIENT_TYPE.ClientType_SmallProgram,third_token:e.thirdToken,user_count_limit:this.stateCenter.maxMemberCount,relate_service:this.stateCenter.relateService.join()||"",login_logic:this.stateCenter.isMultiRoom?3:1,proto_format:this.stateCenter.protoFormat};return this.sendMessage("",i,t,r,o)},e.prototype.logout=function(e,t,r){var o=e.isMulti?"quit":"logout",i={reserve:0};return"logout"==o&&(i.login_logic=this.stateCenter.isMultiRoom?3:1),this.sendMessage(o,i,t,r,void 0,{sessionID:e.sessionID,roomID:e.roomID,roomSessionID:e.roomSessionID})},e.prototype.heartBeat=function(e,t,r,o,i){return this.sendMessage("hb",{reserve:0},e,t,void 0,{sessionID:r,roomID:o,roomSessionID:i})},e.prototype.fetchUserList=function(e,t,r,o,i,n){return this.sendMessage("user_list",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.fetchUserListV2=function(e,t,r,o,i,n){return this.sendMessage("user_list_v2",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.fetchReliableMessage=function(e,t,r,o,i,n){return this.sendMessage("trans_fetch",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendReliableMessage=function(e,t,r,o,i,n){return this.sendMessage("trans",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendRoomMsg=function(e,t,r,o,i,n){return this.sendMessage("im_chat",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendCustomCommand=function(e,t,r,o,i,n){return this.sendMessage("custommsg",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendBigRoomMessage=function(e,t,r,o,i,n){return this.sendMessage("bigim_chat",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendRelayMessage=function(e,t,r,o,i,n){return this.sendMessage("relay",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendSignalCmd=function(e,t,r,o,i,n){return this.sendMessage("signal",e,t,r,void 0,{sessionID:o,roomID:i,roomSessionID:n})},e.prototype.sendPB=function(e){return this.service.isDisConnect()||this.stateCenter.networkState==n.ENUM_NETWORK_STATE.offline?(this.logger.error(a.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_PB+" socket is disconnected"),!1):this.service.sendPB(e)},e}();t.LiveRoomService=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSocketService=void 0;var o=r(0),i=r(1),n=function(){function e(e){this.socket=null,this.sendCommandList=new o.LinkedList,this.sendCommandMap={},this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=1e4,this.sendDataCheckInterval=2e3,this.ENV=e}return e.prototype.createSocket=function(e){this.socket=o.createZegoWebSocket(e,this.ENV%2)},e.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},e.prototype.isDisConnect=function(){return!this.socket||1!==this.socket.readyState},e.prototype.sendMessage=function(e,t,r,o,i){void 0===r&&(r=null),void 0===o&&(o=null),void 0===i&&(i={timeOut:6e3});var n={header:e,body:t},s={data:n,seq:e.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeOut:i.timeOut,success:r,error:o},a=this.sendCommandList.push(s);return this.sendCommandMap[s.seq]=a,this.socket&&this.socket.send(JSON.stringify(n)),e.seq},e.prototype.sendPB=function(e){return this.socket&&this.socket.send(e),!0},e.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)e.remove(t),t._data&&t._data.error&&setTimeout((function(){t&&t._data&&t._data.error&&t._data.error(i.errorCodeList.TIMEOUT,t._data.data.header.seq,t._data.data.body.custom_msg)}),0),t=e.getFirst()},e.prototype.checkMessageListTimeout=function(e,t){for(var r=e.getFirst(),o=Date.parse(new Date+""),n=0;!(null==r||r._data&&r._data.sendTime+r._data.timeOut>o||(r._data&&delete t[r._data.data.header.seq],e.remove(r),r._data&&null==r._data.error||r._data&&r._data.sendTime+this.sendDataDropTimeout<o||setTimeout((function(){r&&r._data&&r._data.error&&r._data.error(i.errorCodeList.TIMEOUT,r._data.data.header.seq,r._data.data.body.custom_msg)}),0),++n>=this.sendDataCheckOnceCount));)r=e.getFirst()},e.prototype.startCheck=function(){var e=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout((function(){e.startCheck()}),this.sendDataCheckInterval)},e.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},e.prototype.openHandler=function(e){var t=this;this.socket&&(this.socket.onopen=function(r){t.socket.binaryType="arraybuffer",t.responseHandler(),e(r)})},e.prototype.responseHandler=function(){var e=this;this.socket&&(this.socket.onmessage=function(t){var r="string"==typeof t.data?JSON.parse(t.data):t.data;e.onMessage(r)})},e.prototype.closeHandler=function(e){this.socket&&(this.socket.onclose=function(t){e(t)})},e.prototype.errorHandler=function(e){this.socket&&(this.socket.onerror=e)},e.prototype.onMessage=function(e){},e}();t.ZegoSocketService=n},,,,,,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTM=t.ZegoDataReport=t.ZegoLogger=t.getSeq=t.getReportSeq=t.ZegoExpressWebRTMEngine=void 0;var o=r(20);Object.defineProperty(t,"ZegoExpressWebRTM",{enumerable:!0,get:function(){return o.ZegoExpressWebRTM}});var i=r(33),n=r(0),s=function(){function e(t,r,s){void 0===s&&(s=0),this.logger=new n.ZegoLogger(s),this.dataReport=new n.ZegoDataReport(this.logger),this.cloudSetting=new i.ZegoSetting,this.zegoWebRTM=new o.ZegoExpressWebRTM(t,r,this.logger,this.dataReport,this.cloudSetting,e.version,s)}return e.prototype.enableMultiRoom=function(e){return this.zegoWebRTM.enableMultiRoom(e)},e.prototype.loginRoom=function(e,t,r,o){return this.zegoWebRTM.loginRoom(e,t,r,o)},e.prototype.logoutRoom=function(e){return this.zegoWebRTM.logoutRoom(e)},e.prototype.renewToken=function(e,t){return this.zegoWebRTM.renewToken(e,t)},e.prototype.sendBarrageMessage=function(e,t){return this.zegoWebRTM.sendBarrageMessage(e,t)},e.prototype.sendBroadcastMessage=function(e,t){return this.zegoWebRTM.sendBroadcastMessage(e,t)},e.prototype.sendCustomCommand=function(e,t,r){return this.zegoWebRTM.sendCustomCommand(e,t,r)},e.prototype.setRoomExtraInfo=function(e,t,r){return this.zegoWebRTM.setRoomExtraInfo(e,t,r)},e.prototype.setLogConfig=function(e){return this.zegoWebRTM.setLogConfig(e)},e.prototype.setDebugVerbose=function(e){return this.zegoWebRTM.setDebugVerbose(e)},e.prototype.on=function(e,t){return this.zegoWebRTM.on(e,t)},e.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},e.prototype.off=function(e,t){return this.zegoWebRTM.off(e,t)},e.prototype.loginHall=function(e,t,r){return this.zegoWebRTM.loginHall(e,t,r)},e.prototype.logoutHall=function(){return this.zegoWebRTM.logoutHall()},e.prototype.enterRoom=function(e,t){return this.zegoWebRTM.enterRoom(e,t)},e.prototype.leaveRoom=function(){return this.zegoWebRTM.leaveRoom()},e.use=function(e){o.ZegoExpressWebRTM.use(e)},e.version=n.PROTO_VERSION,e}();t.ZegoExpressWebRTMEngine=s;var a=r(0);Object.defineProperty(t,"getReportSeq",{enumerable:!0,get:function(){return a.getReportSeq}}),Object.defineProperty(t,"getSeq",{enumerable:!0,get:function(){return a.getSeq}}),Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return a.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return a.ZegoDataReport}})},function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},n=this&&this.__spreadArray||function(e,t){for(var r=0,o=t.length,i=e.length;r<o;r++,i++)e[i]=t[r];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTM=void 0;var s=r(0),a=r(1),c=r(2),l=r(0),d=r(23),u=r(24),h=r(26),p=r(27),g=r(28),f=r(30),m=r(3),_=r(4),E=r(11),T=r(31),S=r(32),v=function(){function e(e,t,r,o,i,n,a){var u=this;this.logger=r,this.dataReport=o,this.cloudSetting=i,this.version=n,this.stateCenter=new p.StateCenter(this.logger,this.dataReport),this.stateCenter.ENV=a,this.getReportSeq=l.getReportSeq,this.getSeq=s.getSeq,this.proxyRes=c.ClientUtil.proxyRes,this.actionSuccessCallback=c.ClientUtil.actionSuccessCallback,this.actionErrorCallback=c.ClientUtil.actionErrorCallback,this.getServerError=c.ClientUtil.getServerError,this.generateRandumNumber=c.ClientUtil.generateRandumNumber,this.unregisterCallback=c.ClientUtil.unregisterCallback,this.logReportCallback=c.ClientUtil.logReportCallback,this.registerCallback=c.ClientUtil.registerCallback;var h=l.getReportSeq();if(this.dataReport.newReport(h),(0==a||1==a)&&this.setDebug(t),c.ClientUtil.checkConfigParam(e,t,this.logger)){if(this.stateCenter.appid=e,this.stateCenter.configOK=!0,this.stateCenter.sdKVersion=this.version,0==a||1==a){this.stateCenter.settingConfig=new S.ZegoSettingConfig,this.cloudSetting.setLog(this.logger),this.cloudSetting.init({product:d.CLOUD_SETTING.product,appID:e,urls:d.CLOUD_SETTING.URL,pollingFreq:d.CLOUD_SETTING.POLLING_FREQ,env:a,pollingNotify:function(e,t){u.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR," setting file changed "+e+" "+JSON.stringify(t)),u.stateCenter.actionListener("_cloudSettingNotify",e,t)},reportNotify:this.cloudReportNotify.bind(this),online:!this.stateCenter.testEnvironment});var g="";0===a?g="rtc":1===a&&(g="xcx"),this.cloudSetting.setEnvVariable("environment",g);var v=this.cloudSetting.getSettingCache(d.INIT),R=this.cloudSetting.getSettingCache(d.ROOM_BASIC);Promise.all([v,R]).then((function(e){var t=null==e?void 0:e[0];u.stateCenter.settingConfig.setSetting(null==t?void 0:t.setting);var r=u.stateCenter.settingConfig.getSetting("remote_log_level",!0);r&&(u.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+"  setting remote_log_level "+r),u.logger.setRemoteLogLevel(r));var o=null==e?void 0:e[1];u.stateCenter.settingConfig.setSetting(null==o?void 0:o.setting);var i=l.getReportSeq();u.dataReport.newReport(i,_.ZegoRTMLogEvent.kZegoTaskCloudSettingCache.event),u.dataReport.addMsgInfo(i,{files:[{name:d.INIT,content:null==t?void 0:t.setting,versions:null==t?void 0:t.versions},{name:d.ROOM_BASIC,content:null==o?void 0:o.setting,versions:null==o?void 0:o.versions}]}),u.dataReport.uploadReport(i)})).catch((function(e){u.logger.warn(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+"  initConfig "+JSON.stringify(e))})),"string"==typeof t?(this.stateCenter.server=t,this.stateCenter.serverBak=t):Array.isArray(t)&&t.length>0&&(this.stateCenter.server=t[0],this.stateCenter.serverBak=t[1]||t[0]),this.service=new E.LiveRoomService(this.stateCenter,this.logger,this)}else 2!=a&&3!=a||(this.service=new T.LiveRoomPrivateService(this.stateCenter,this.logger,this),this.module=new f.LiveRoomModules(this.stateCenter,this.logger,this.dataReport,this.service,this),this.stateCenter.priModules=this.module,this.module._dispatchServer=t,this.stateCenter.type="PRIVATE");if(0==a||2==a)this.bindWindowListener(),this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+"  "+navigator.appVersion),this.stateCenter.networkState=navigator?navigator.onLine?s.ENUM_NETWORK_STATE.online:s.ENUM_NETWORK_STATE.offline:s.ENUM_NETWORK_STATE.online,this.dataReport.addMsgInfo(h,{system_info:_.ZegoRTMLogEvent.kZegoTaskInitSetting.system_info});else if(1==a||3==a){this.bindWxListener();try{var C=wx.getSystemInfoSync(),y={brand:C.brand,model:C.model,system:C.system,platform:C.platform,version:C.version,SDKVersion:C.SDKVersion};this.dataReport.addMsgInfo(h,{system_info:y})}catch(e){this.logger.warn(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" get system info error")}}this.logger.setSessionInfo(this.stateCenter.appid,"","","","",this.version)}else this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" init sdk error"),this.dataReport.addMsgInfo(h,_.ZegoRTMLogEvent.kZegoTaskInitSetting.error.kInvalidParamError);this.dataReport.uploadReport(h,_.ZegoRTMLogEvent.kZegoTaskInitSetting.event)}return Object.defineProperty(e.prototype,"modules",{get:function(){return{service:this.service}},enumerable:!1,configurable:!0}),e.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),r=c.ClientUtil.getBrowser(),o=t?"pagehide":"Firefox"===r?"beforeunload":"unload";window.addEventListener(o,(function(){e.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" "+o),"PUBLIC"===e.stateCenter.type?e.logoutRoom():e.leaveRoom(),e.logoutRoom()})),window.addEventListener("offline",(function(){e.netOffLineHandle()})),window.addEventListener("online",(function(){e.netOnLineHandle()}))},e.prototype.bindWxListener=function(){var e=this;wx.onNetworkStatusChange((function(t){t.isConnected?e.netOnLineHandle():e.netOffLineHandle()}))},e.prototype.netOnLineHandle=function(){var e=this;this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+"network is online"),this.stateCenter.networkState=s.ENUM_NETWORK_STATE.online,this.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&e.service.isDisConnect()?t.roomTryHandler.active():t.roomTryHandler&&(t.roomTryHandler.stopMaxTime(),t.roomHandler.roomStateHandle("CONNECTED",{code:0,msg:""}))}))},e.prototype.netOffLineHandle=function(){this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" network is broken"),this.stateCenter.networkState=s.ENUM_NETWORK_STATE.offline,this.stateCenter.roomModulesList.forEach((function(e){e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.onactive=function(t,r){e.roomHandler.disconnectedHandle(r)},e.roomTryHandler.startMaxTime(),e.roomHandler.roomStateHandle("CONNECTING",a.errorCodeList.NETWORK_BROKEN))}))},e.prototype.setLogConfig=function(e){this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call");var t=l.getReportSeq();if(this.dataReport.newReport(t),e.logLevel&&["debug","info","warn","error","report","disable"].includes(e.logLevel)&&(this.logger.setLogLevel(e.logLevel),this.dataReport.addMsgInfo(t,{log_level:_.ZegoRTMLogEvent.kZegoTaskSetLog.log_level(e.logLevel)})),e.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(e.remoteLogLevel)&&this.dataReport.addMsgInfo(t,{remote_log_level:_.ZegoRTMLogEvent.kZegoTaskSetLog.remote_log_level(e.remoteLogLevel)}),"string"==typeof e.logURL&&(e.logURL.startsWith("wss://")||e.logURL.startsWith("https://")))this.logger.setLogServer(e.logURL),this.dataReport.addMsgInfo(t,{log_url:_.ZegoRTMLogEvent.kZegoTaskSetLog.log_url(e.logURL)}),this.dataReport.uploadReport(t,_.ZegoRTMLogEvent.kZegoTaskSetLog.event);else if(e.logURL)return this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+"log url must be a wss or https url"),this.dataReport.addMsgInfo(t,_.ZegoRTMLogEvent.kZegoTaskSetLog.error.kInvalidParamError),this.dataReport.uploadReport(t,_.ZegoRTMLogEvent.kZegoTaskSetLog.event),!1;return this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call success"),!0},e.prototype.setDebugVerbose=function(e){var t=l.getReportSeq();this.dataReport.newReport(t),"boolean"==typeof e&&(this.stateCenter.debug=e,this.stateCenter.debugCustom=!0,this.dataReport.addMsgInfo(t,{debug:_.ZegoRTMLogEvent.kZegoTaskSetDebug.debug(e?"true":"false")})),this.dataReport.uploadReport(t,_.ZegoRTMLogEvent.kZegoTaskSetDebug.event),this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE+" call success")},e.prototype.setDebug=function(e){"string"==typeof e&&e.indexOf("wss")>-1?this.stateCenter.debug=c.ClientUtil.isTestEnv(e):Array.isArray(e)&&e.length>0&&e.every((function(e){return"string"==typeof e&&e.indexOf("wss")>-1}))?this.stateCenter.debug=c.ClientUtil.isTestEnv(e[0])||c.ClientUtil.isTestEnv(e[1]):this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" server wrong"),this.stateCenter.testEnvironment=this.stateCenter.debug},e.prototype.renewToken=function(e,t){var r=this,o=l.getReportSeq();if(this.dataReport.newReport(o),void 0!==t&&("string"!=typeof t||""==t))return this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" roomID must be string and no empty"),!1;var i=this.getRoomModules(t)||this.stateCenter.roomModulesList[0];return i?"string"==typeof e&&i.roomTryHandler?(e===i.roomTryHandler.token?this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" token has not changed"):(this.service.sendMessage("renew_token",{token:e},(function(t){var o,n;null===(o=i.roomTryHandler)||void 0===o||o.renewLocalToken(e,null===(n=null==t?void 0:t.body)||void 0===n?void 0:n.token_remain_time),r.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" "+JSON.stringify(t))}),(function(e){r.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" "+JSON.stringify(e))}),void 0,{sessionID:i.sessionID,roomID:t,roomSessionID:i.roomSessionID}),this.cloudSetting.setToken(e)),this.dataReport.uploadReport(o,_.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!0):"string"!=typeof e||i.roomTryHandler?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" token must be string and not empty"),this.dataReport.addMsgInfo(o,{error:_.ZegoRTMLogEvent.kZegoTaskReNewToken.error.INPUT_PARAM.code,message:_.ZegoRTMLogEvent.kZegoTaskReNewToken.error.INPUT_PARAM.msg+" param token error"}),this.dataReport.uploadReport(o,_.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1):(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(o,{error:_.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:_.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.msg}),this.dataReport.uploadReport(o,_.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1):(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(o,{error:_.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:_.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.msg}),this.dataReport.uploadReport(o,_.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1)},e.prototype.setCloudSettingURLs=function(e){var t=this;this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_CLOUD_SETTING_URLS+" call "),Array.isArray(e)&&e.length>0&&e.every((function(e){return"string"==typeof e&&e.indexOf("http")>-1}))&&this.cloudSetting.init({product:d.CLOUD_SETTING.product,appID:this.stateCenter.appid,urls:e,pollingFreq:d.CLOUD_SETTING.POLLING_FREQ,env:this.stateCenter.ENV,pollingNotify:function(e,r){t.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_CLOUD_SETTING_URLS," setting file changed "+e+" "+JSON.stringify(r)),t.stateCenter.actionListener("_cloudSettingNotify",e,r)},reportNotify:this.cloudReportNotify.bind(this),online:!this.stateCenter.testEnvironment})},e.prototype.loginRoom=function(e,t,r,a){var c=this;return new Promise((function(l,d){return o(c,void 0,void 0,(function(){var o,c,p,f,E,T,S=this;return i(this,(function(i){switch(i.label){case 0:return 1!==this.stateCenter.ENV?[3,2]:[4,new Promise((function(e){wx.getNetworkType({success:function(t){S.stateCenter.networkState="none"===t.networkType?s.ENUM_NETWORK_STATE.offline:s.ENUM_NETWORK_STATE.online,e()},fail:function(t){S.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" network "+JSON.stringify(t)),S.stateCenter.networkState=s.ENUM_NETWORK_STATE.online,e()}})}))];case 1:i.sent(),i.label=2;case 2:return o=this.loginReport(l,d,t,a),c=o.interResolve,p=o.interReject,!(a=a||{}).maxMemberCount&&(a.maxMemberCount=0),(f=h.checkParams({roomID:{order:0,value:e,rules:[{name:h.RULE_PARAM_NAME.NOT_EMPTY,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_NULL},{name:h.RULE_PARAM_NAME.TYPE_STRING,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:"roomID must be string"},{name:h.RULE_PARAM_NAME.MAX_LENGTH_128,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_TOO_LONG},{name:h.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:t,rules:[{name:h.RULE_PARAM_NAME.NOT_EMPTY,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM},{name:h.RULE_PARAM_NAME.TYPE_STRING,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM}]},user:{order:2,value:r,rules:[{name:h.RULE_PARAM_NAME.NOT_EMPTY,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."},{name:h.RULE_PARAM_NAME.TYPE_OBJECT,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:r.userID,rules:[{name:h.RULE_PARAM_NAME.NOT_EMPTY,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_NULL,extMsg:" param user error."},{name:h.RULE_PARAM_NAME.TYPE_STRING,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param userID error."},{name:h.RULE_PARAM_NAME.MAX_LENGTH_100,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_TOO_LONG},{name:h.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:r.userName,rules:[{name:h.RULE_PARAM_NAME.TYPE_STRING,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" userName must be string."},{name:h.RULE_PARAM_NAME.MAX_LENGTH_256,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_NAME_TOO_LONG}]},config:{order:5,value:a,rules:[]},"config.maxMemberCount":{order:6,value:a.maxMemberCount,rules:[{name:h.RULE_PARAM_NAME.TYPE_INTEGER,error:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM,logger:this.logger}))!==h.RULE_SUCCESS?(p(f.error,f.extMsg),[2]):(this.cloudSetting.setUserID(r.userID),this.cloudSetting.setToken(t),this.cloudSetting.activePolling(),this.stateCenter.settingFetched||(this.getCloudSetting(),this.stateCenter.actionListener("_settingCanFetch"),this.stateCenter.settingFetched=!0),(E=this.getRoomModules(e))?(p(_.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.REPEATEDLY_LOGIN),[2]):(E=new g.LiveRoomModules(e,this.stateCenter,this.logger,this.dataReport,this.service,this),this.stateCenter.roomModulesList.length>0&&1==this.stateCenter.isMultiRoom?E.isMulti=!0:n([],this.stateCenter.roomModulesList).forEach((function(e){return e.roomHandler.logout()})),this.stateCenter.roomModulesList.push(E),E.roomTryHandler||(E.roomTryHandler=new u.RetryRoomHandler(this.logger,this.stateCenter,E)),T=this.stateCenter.settingConfig.getSetting("room_server",!0),Array.isArray(T)&&T.length>0&&(this.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM," setting room_server "+T),this.stateCenter.server=T[0],this.stateCenter.serverBak=T[1]||T[0]),E.roomTryHandler.init(this.stateCenter.roomRetryTime),E.roomTryHandler.initRoom(E.roomHandler,e,t,r,this.stateCenter.server,this.stateCenter.serverBak,a),E.roomTryHandler.setLoginRoomCallback(c,p),E.roomTryHandler.active(!0),this.stateCenter.setMultiRoom=!0,[2]))}}))}))}))},e.prototype.getCloudSetting=function(){var e=this;this.cloudSetting.fetchMultiSetting([d.INIT,d.ROOM_BASIC]).then((function(t){var r;e.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM," settingConfig "+JSON.stringify(t)),e.stateCenter.settingConfig.setSetting(null===(r=null==t?void 0:t[d.INIT])||void 0===r?void 0:r.setting,["remote_log_level"]);var o=e.stateCenter.settingConfig.getSetting("remote_log_level",!0);o&&(e.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+"  setting remote_log_level "+o),e.logger.setRemoteLogLevel(o))})).catch((function(t){e.logger.warn(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM," settingConfig "+JSON.stringify(t))})),this.stateCenter.onListener("_cloudSettingNotify",(function(t,r){var o=l.getReportSeq();e.dataReport.newReport(o,_.ZegoRTMLogEvent.kZegoTaskCloudSettingRefresh.event);var i=e.cloudSetting.getEnvVariables();if(e.dataReport.addMsgInfo(o,{params:i,files:[{name:t,content:r.setting,versions:r.versions}]}),e.dataReport.uploadReport(o),t===d.INIT){e.stateCenter.settingConfig.setSetting(null==r?void 0:r.setting,["remote_log_level"]);var n=e.stateCenter.settingConfig.getSetting("remote_log_level");n&&(e.logger.info(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM," setting remote_log_level "+n),e.logger.setRemoteLogLevel(n))}}))},e.prototype.cloudReportNotify=function(e,t,r){if("request_start"===t){var o=l.getReportSeq();this.dataReport.newReport(o,_.ZegoRTMLogEvent.kZegoTaskCloudSettingRequest.event),this.stateCenter.settingConfig.requestList[e]=o}else if("request_end"===t){var i=this.stateCenter.settingConfig.requestList[e];i&&(this.dataReport.addMsgInfo(i,{request_detail:null==r?void 0:r.reportData,files:null==r?void 0:r.files,error:null==r?void 0:r.code,request_params:null==r?void 0:r.params}),this.dataReport.uploadReport(i))}},e.prototype.loginReport=function(e,t,r,o){var i=this;0!==this.stateCenter.reportSeqList.login&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.login),this.stateCenter.reportSeqList.login=0,c.ClientUtil.unregisterCallback(_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.stateCenter.reportList));var n=l.getReportSeq();this.stateCenter.reportSeqList.login=n,this.dataReport.newReport(n,_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event);var s=this.cloudSetting.getEnvVariable("deviceid");return this.dataReport.addMsgInfo(n,{deviceid:s}),"string"==typeof r&&this.dataReport.addMsgInfo(n,{token:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.token(r),isMulti:this.stateCenter.isMultiRoom}),o&&(o.userUpdate&&"boolean"==typeof o.userUpdate&&this.dataReport.addMsgInfo(n,{user_update:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.user_update(o.userUpdate+"")}),o.maxMemberCount&&"number"==typeof o.maxMemberCount&&this.dataReport.addMsgInfo(n,{max_member_count:_.ZegoRTMLogEvent.kZegoTaskLoginRoom.max_member_count(o.maxMemberCount+"")})),c.ClientUtil.logReportCallback(_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.dataReport,n,this.stateCenter.reportList),{interResolve:function(t){i.dataReport.uploadReport(n),i.stateCenter.reportSeqList.login=0,c.ClientUtil.unregisterCallback(_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,i.stateCenter.reportList),e(t)},interReject:function(e,r){var o,s;void 0===r&&(r=""),e.code<2e9&&e.code>1e9||e.code<1e6?(o=c.ClientUtil.decodeServerError(e.code,e.msg),s=c.ClientUtil.getLiveRoomError(e.code)):o={code:e.code,message:e.msg},o&&i.dataReport.addMsgInfo(n,{error:o.code,message:o.message+r}),i.dataReport.uploadReport(n),i.stateCenter.reportSeqList.login=0,c.ClientUtil.unregisterCallback(_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,i.stateCenter.reportList),s&&a.errorCodeList[s]&&(e.code=a.errorCodeList[s].code),e.code&&e.msg&&""!==r?t({code:e.code,msg:e.msg+r}):t(e)}}},e.prototype.logoutRoom=function(e){var t=l.getReportSeq();if(this.dataReport.newReport(t),this.dataReport.addMsgInfo(t,{roomid:e,isMulti:this.stateCenter.isMultiRoom}),void 0===e)n([],this.stateCenter.roomModulesList).forEach((function(e){return e.roomHandler.logout(!0)})),this.cloudSetting.uninit();else{if("string"!=typeof e||""==e)return this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" roomID must be string and not empty"),this.dataReport.addMsgInfo(t,{error:_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.code,message:_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.msg+" param roomID error"}),void this.dataReport.uploadReport(t,_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event);var r=this.getRoomModules(e);r?(r.roomHandler.logout(),0===this.stateCenter.roomModulesList.length&&this.cloudSetting.uninit(),this.dataReport.uploadReport(t,_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event)):(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" room not exist"),this.dataReport.addMsgInfo(t,{error:_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.code,message:_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.msg}),this.dataReport.uploadReport(t,_.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event))}},e.prototype.loginHall=function(e,t,r){var n=this;return new Promise((function(e,t){return o(n,void 0,void 0,(function(){return i(this,(function(e){return[2]}))}))}))},e.prototype.loginHallReport=function(e,t,r,o){},e.prototype.logoutHall=function(){},e.prototype.enterRoom=function(e,t){return new Promise((function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()}))},e.prototype.leaveRoom=function(){return new Promise((function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()}))},e.prototype.sendCustomCommand=function(e,t,r){return new Promise((function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()}))},e.prototype._sendCustomCommand=function(e,t,r){return new Promise((function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()}))},e.prototype.sendBroadcastMessage=function(e,t){return new Promise((function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()}))},e.prototype._sendBroadcastMessage=function(e,t,r,o){return void 0===r&&(r=1),void 0===o&&(o=1),new Promise((function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()}))},e.prototype.setRoomExtraInfo=function(e,t,r){return new Promise((function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()}))},e.prototype._setRoomExtraInfo=function(e,t,r){return new Promise((function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()}))},e.prototype.sendBarrageMessage=function(e,t){return new Promise((function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()}))},e.prototype._sendBarrageMessage=function(e,t,r,o){return void 0===r&&(r=1),void 0===o&&(o=1),new Promise((function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()}))},e.prototype.sendRelayMessage=function(e,t,r,o,i){console.error(s.MODULE_TIPS.MESSAGE)},e.prototype.requestJoinLive=function(e,t,r,o,i){return console.error(s.MODULE_TIPS.MESSAGE),!1},e.prototype.inviteJoinLive=function(e,t,r,o,i){return console.error(s.MODULE_TIPS.MESSAGE),!1},e.prototype.endJoinLive=function(e,t,r,o){return console.error(s.MODULE_TIPS.MESSAGE),!1},e.prototype.respondJoinLive=function(e,t,r,o,i){return console.error(s.MODULE_TIPS.MESSAGE),!1},e.prototype.getVersion=function(){return this.version},e.prototype.setSdkBizVersion=function(e){"string"==typeof e&&""!==e&&(this.stateCenter.bizVersion=e)},e.prototype.on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+e+" no found"),!1)},e.prototype.off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype._on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+e+" no found"),!1)},e.prototype._off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype.isTestEnvironment=function(){return this.stateCenter.testEnvironment},e.prototype.isLogin=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return!!t&&t.isLogin()},e.prototype.getMultiRoom=function(){return this.stateCenter.isMultiRoom},e.prototype.getAppID=function(){return this.stateCenter.appid},e.prototype.getUserID=function(){return this.stateCenter.idName},e.prototype.getToken=function(e){return(this.getRoomModules(e)||this.stateCenter.roomModulesList[0]).token},e.prototype.getAnType=function(){return this.module.anType},e.prototype.getRoomSid=function(){return this.module.roomSid},e.prototype.setRoomCreateFlag=function(e){this.stateCenter.roomCreateFlag=e},e.prototype.setRole=function(e){this.stateCenter.role=e},e.prototype.getSessionId=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return t?t.sessionID:"0"},e.prototype.getRoomSessionID=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return t?t.roomSessionID:"0"},e.prototype.enableMultiRoom=function(e){var t=l.getReportSeq();return this.dataReport.newReport(t,_.ZegoRTMLogEvent.kZegoEnableMultiRoom.event),this.dataReport.addMsgInfo(t,{isMulti:e}),"boolean"!=typeof e?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM+" param must be boolean"),this.dataReport.uploadReport(t,void 0,_.ZegoRTMLogEvent.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):this.stateCenter.roomModulesList.length>0||this.stateCenter.setMultiRoom?(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM+" multi room can only be set once before first login"),this.dataReport.uploadReport(t,void 0,_.ZegoRTMLogEvent.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):(this.dataReport.uploadReport(t),this.stateCenter.isMultiRoom=e,this.stateCenter.setMultiRoom=!0,!0)},e.prototype.getRoomModules=function(e){return this.stateCenter.roomModulesList.find((function(t){return t.roomID==e}))},e.prototype.dispatchBodyData=function(){return{seq:1,timestamp:(new Date).getTime,app_id:this.stateCenter.appid,user_id:this.stateCenter.idName,user_name:this.stateCenter.nickName,net_type:2,device_id:this.module.deviceID,login_token:this.module.hallToken,an_type:this.module.anType}},e.use=function(t){switch(t.type){case"message":t.install(e,g.LiveRoomModules,E.LiveRoomService,f.LiveRoomModules,T.LiveRoomPrivateService);break;case"live":t.install(e,g.LiveRoomModules,E.LiveRoomService);break;case"privates":t.install(e,f.LiveRoomModules,T.LiveRoomPrivateService)}},e.prototype.resetRoomTokenTimer=function(e,t){var r=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];r&&t&&t>0&&r.roomHandler.resetTokenTimer(1e3*t-this.stateCenter.local_time_deviation)},e.prototype.setProtoFormat=function(e){if(void 0===e&&(e="json"),!["json","pb"].includes(e))throw new Error("Failed to execute 'setProtoFormat': Arguments 'format' must be 'json' or 'pb'.");this.stateCenter.protoFormat=e},e.prototype.setSdkLoginRelateService=function(e){Array.isArray(e)&&e.every((function(e){return"string"==typeof e}))&&(this.stateCenter.relateService=e)},e.prototype.sendMessageByService=function(e,t,r,o,i,n){return this.service.sendMessage(e,t,r,o,i,n)},e.prototype.getHeader=function(e){var t=this.stateCenter.roomModulesList[0];if(t&&t.isLogin()){var r=t.roomID,o=t.sessionID,i=t.roomSessionID;return this.service.getHeader(e,o,r,i)}this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_GET_HEADER+" room no found or no login")},e.prototype.sendPB=function(e){return e instanceof Uint8Array?this.service.sendPB(e):(this.logger.error(m.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_PB+" type error"),!1)},e.prototype.onPushBizChannel=function(e){e&&this.service.on("push_biz_channel",e)},e.prototype.getRoomID=function(){return this.stateCenter.roomid},e.prototype.getServerTimeOffset=function(){return this.stateCenter.serverTimeOffset},e}();t.ZegoExpressWebRTM=v},function(e,t,r){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(o,i,function(t){return e[t]}.bind(null,i));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.E_CLIENT_TYPE=t.ENUM_LOG_LEVEL=t.ENUM_REMOTE_TYPE=t.ZEGO_ENV=t.ZEGO_BROWSER_TYPE=void 0,function(e){e[e.IE=0]="IE",e[e.FIREFOX=1]="FIREFOX",e[e.CHROME=2]="CHROME",e[e.SAFARI=3]="SAFARI",e[e.OPERA=4]="OPERA",e[e.WEIXIN=5]="WEIXIN",e[e.WEIXINMINI=6]="WEIXINMINI",e[e.UNKOWN=7]="UNKOWN"}(t.ZEGO_BROWSER_TYPE||(t.ZEGO_BROWSER_TYPE={})),function(e){e[e.BROWSER=0]="BROWSER",e[e.WEIXINMINI=1]="WEIXINMINI"}(t.ZEGO_ENV||(t.ZEGO_ENV={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.WEBSOCKET=1]="WEBSOCKET",e[e.HTTPS=2]="HTTPS"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.ENUM_LOG_LEVEL={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=void 0;var o=function(){function e(){this._testEnvironment=!0,this._ENV=0,this._debug=!0}return e.getInstance=function(){return e.instance||(e.instance=new e,e.instance.init()),e.instance},e.prototype.init=function(){},Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this._ENV},set:function(e){this._ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e},enumerable:!1,configurable:!0}),e.instance=new e,e}();t.LoggerStateCenter=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoWebSocket=t.ZegoWeiXinMiniWebSocket=void 0;var o=r(0),i=function(){function e(e,t){this.url=e,this.readyState=3,this._websocket=wx.connectSocket({url:e}),this.init()}return e.prototype.init=function(){var e=this;this._websocket&&(this.readyState=0,this._websocket.onOpen((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onopen&&(e.onopen(t),e._websocket.onClose((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onclose&&e.onclose(t)})),e._websocket.onMessage((function(t){"function"==typeof e.onmessage&&e.onmessage(t)})))})),this._websocket.onError((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onerror&&e.onerror(t)})))},e.prototype.onopen=function(e){},e.prototype.onerror=function(e){},e.prototype.onclose=function(e){},e.prototype.onmessage=function(e){},e.prototype.send=function(e){this._websocket&&this._websocket.send({data:e})},e.prototype.close=function(){this._websocket&&this._websocket.close()},e}();t.ZegoWeiXinMiniWebSocket=i,t.createZegoWebSocket=function(e,t){return t%2===o.ZEGO_ENV.BROWSER?new WebSocket(e):new i(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=t.createZegoWebSocket=t.ZegoDataReport=t.ZegoLogger=void 0;var o=r(1);Object.defineProperty(t,"LoggerStateCenter",{enumerable:!0,get:function(){return o.LoggerStateCenter}});var i=r(2);Object.defineProperty(t,"createZegoWebSocket",{enumerable:!0,get:function(){return i.createZegoWebSocket}});var n=r(4);Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return n.ZegoDataReport}});var s=r(5);Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return s.ZegoLogger}})},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoDataReport=void 0;var i=function(){function e(e){this.dataStatistics={},this.logger=e}return e.prototype.newReport=function(e,t){this.dataStatistics[e]={event_time:Date.now(),time_consumed:0,seq:e,error:0,message:"success",event:t,events:[]}},e.prototype.addMsgExt=function(e,t){this.dataStatistics[e]?this.dataStatistics[e].msg_ext=t:console.warn(e+" not exist")},e.prototype.addMsgInfo=function(e,t){this.dataStatistics[e]?Object.assign(this.dataStatistics[e],t):console.warn(e+" not exist")},e.prototype.eventStart=function(e,t){this.dataStatistics[e]?null!=this.dataStatistics[e].events?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},e.prototype.eventEnd=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o&&0!==o.length){for(var i=o.length-1;i>=0;i--)if(o[i].event==t&&0==o[i].time_consumed){o[i].time_consumed=Date.now()-o[i].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},e.prototype.eventEndWithMsg=function(e,t,r){if(this.dataStatistics[e]){var i=this.dataStatistics[e].events;if(i){for(var n=i.length-1;n>=0;n--)if(i[n].event==t&&0==i[n].time_consumed){i[n].time_consumed=Date.now()-i[n].event_time,null==i[n].msg_ext&&(i[n].msg_ext={}),i[n].msg_ext=o({},r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.eventEndWithMsgInfo=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o){for(var i=o.length-1;i>=0;i--)if(o[i].event==t&&0==o[i].time_consumed){o[i].time_consumed=Date.now()-o[i].event_time,Object.assign(o[i],r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.addEventInfo=function(e,t,r,o){if(this.dataStatistics[e]){var i=this.dataStatistics[e].events;if(null!=i){for(var n=i.length-1;n>=0;n--)if(i[n].event==t&&null!=i[n].time_consumed){null==i[n].msg_ext?i[n].msg_ext={}:i[n].msg_ext&&(i[n].msg_ext[r]=o);break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},e.prototype.addEventMsg=function(e,t,r,o){if(this.dataStatistics[e]){var i=this.dataStatistics[e].events;if(null!=i){for(var n=i.length-1;n>=0;n--)if(i[n].event==t){i[n][r]=o;break}}else this.logger.warn("zd.aem.0 no events")}else this.logger.warn("zd.aem.0 no seq match")},e.prototype.addEvent=function(e,t,r){this.dataStatistics[e]?this.dataStatistics[e].events&&(r?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),msg_ext:r}):this.dataStatistics[e].events.push({event:t,event_time:Date.now()})):this.logger.warn("zd.ae.0 no seq match")},e.prototype.uploadReport=function(e,t,r,o){var i=this.dataStatistics[e];null!=i&&(t&&(i.event=t),i.time_consumed=Date.now()-i.event_time,r&&this.addMsgInfo(e,{error:r.code,message:r.message||r.msg+" "+(o||"")}),this.logger.report(i),delete this.dataStatistics[e])},e}();t.ZegoDataReport=i},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoLogger=void 0;var i=r(0),n=r(2),s=r(1),a=r(6),c=function(){function e(e){this.logLevel=i.ENUM_LOG_LEVEL.INFO,this.logRemoteLevel=0,this.websocket=null,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCache=[],this.logCacheSend=[],this.logCacheMax=100,this.existUserID=!1,this.stateCenter=s.LoggerStateCenter.getInstance(),this.env=e}return e.prototype.setLogLevel=function(e){var t=i.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logLevel=t,!0)},e.prototype.setRemoteLogLevel=function(e){var t=i.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logRemoteLevel=t,!0)},e.prototype.setSessionInfo=function(e,t,r,o,i,n){this.appid=e,this.roomid=t,this.sessionid=r,this.userid=o,this.userName=i,this.version=n},e.prototype.report=function(e){var t=this.logReportParamList(i.ENUM_LOG_LEVEL.REPORT,e);this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=i.ENUM_LOG_LEVEL.REPORT&&console.debug(t),this.RemoteLog(i.ENUM_LOG_LEVEL.REPORT,t,!0)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(i.ENUM_LOG_LEVEL.DEBUG,e.join(""));this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=i.ENUM_LOG_LEVEL.DEBUG&&console.debug(r),this.log(i.ENUM_LOG_LEVEL.DEBUG,r)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(i.ENUM_LOG_LEVEL.INFO,e.join(""));this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=i.ENUM_LOG_LEVEL.INFO&&console.info(r),this.log(i.ENUM_LOG_LEVEL.INFO,r)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(i.ENUM_LOG_LEVEL.WARN,e.join(""));this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=i.ENUM_LOG_LEVEL.WARN&&console.warn(r),this.log(i.ENUM_LOG_LEVEL.WARN,r)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(i.ENUM_LOG_LEVEL.ERROR,e.join(""));this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=i.ENUM_LOG_LEVEL.ERROR&&(console.error(r),window?this.stateCenter.debug&&window.alert(e.join("").substr(e.join("").indexOf(" ")+1,4500)):wx&&this.stateCenter.debug&&wx.showModal({title:"",content:e.join("").substr(e.join("").indexOf(" ")+1,4500)})),this.log(i.ENUM_LOG_LEVEL.ERROR,r)},e.prototype.log=function(e,t){this.logRemoteLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logRemoteLevel<=e&&this.RemoteLog(e,t)},e.prototype.setLogServer=function(e){try{return e.startsWith("wss:")?(this.logType=i.ENUM_REMOTE_TYPE.WEBSOCKET,this.openWebSocketLogServer(e)):e.startsWith("https:")?(this.logType=i.ENUM_REMOTE_TYPE.HTTPS,this.openHttpsLogServer(e)):this.logType=i.ENUM_REMOTE_TYPE.DISABLE,!0}catch(e){return this.error(JSON.stringify(e)),!1}},e.prototype.stopLogServer=function(){this.logType==i.ENUM_REMOTE_TYPE.WEBSOCKET?this.stopWebSocketServer():this.logType==i.ENUM_REMOTE_TYPE.HTTPS&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=i.ENUM_REMOTE_TYPE.DISABLE},e.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},e.prototype.openHttpsLogServer=function(e){var t=this;this.url=e,e&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval((function(){t.SendHttpsLog()}),this.logUploadInterval)))},e.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},e.prototype.RemoteLog=function(e,t,r){if(void 0===r&&(r=!1),""!=this.url)if(this.logType==i.ENUM_REMOTE_TYPE.WEBSOCKET)this.RemoteWebSocketLog(e,t);else if(this.logType==i.ENUM_REMOTE_TYPE.HTTPS)this.RemoteHttpsLog(e,t,r);else if(this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=e)for(this.logCacheSend.push(t);this.logCacheSend.length>this.logCacheMax;)this.logCacheSend.shift()},e.prototype.RemoteWebSocketLog=function(e,t){if("string"==typeof t&&t.length>4e3)console.info("log over maximum, ignore");else if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState){var r=this.url;this.url="",this.setLogServer(r),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)}else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var i="",n=0;n<this.logCacheSend.length;n++){(i+this.logCacheSend[n]).length>4e3&&(this.websocket.send(i),i="");var s=JSON.parse(this.logCacheSend[n]);s=o(o({},s),{userid:s.userid||this.userid,roomid:s.roomid||this.roomid,userName:s.roomid||this.userName}),i=i+JSON.stringify(s)+"\n"}t=i+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else console.warn("wrong socket state:"+this.websocket.readyState),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},e.prototype.RemoteHttpsLog=function(e,t,r){this.logCacheSend.push(t),(this.logCacheSend.length>=this.logCacheMax||!0===r)&&this.SendHttpsLog()},e.prototype.logParamList=function(e,t){var r=a.getCurrentTime(),o=[t.substr(0,t.indexOf(" "))||t,t.substr(t.indexOf(" ")+1,4500)||t],i={time:r,level:e,action:o[0],content:o[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(i)},e.prototype.logReportParamList=function(e,t){var r=a.getCurrentTime();return t=o(o({},t),{time:r,level:e,console:this.env%2===i.ZEGO_ENV.BROWSER?"rtc":"xcx",appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+t.event_time+"_"+t.seq}),JSON.stringify(t)},e.prototype.openWebSocketLogServer=function(e){if(this.url!=e){if(this.url=e,!e)return;this.stopWebSocketServer(),this.websocket=n.createZegoWebSocket(e,this.env),this.websocket.onopen=function(){},this.websocket.onclose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn("onclose   websocket error:",e)},this.websocket.onmessage=function(){},this.websocket.onerror=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn("open log websocket error:",e)}}},e.prototype.SendHttpsLog=function(){0!=this.logCacheSend.length&&(this.env%2===i.ZEGO_ENV.BROWSER?this.SendHttpsLogWeb():this.SendHttpsLogWeChatMini())},e.prototype.SendHttpsLogWeb=function(){var e=this,t=this.logCacheSend.join("\n"),r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){if(0==r.responseText.length)return;try{var t=JSON.parse(r.responseText).interval;"number"==typeof t&&e.logUploadInterval!==t&&(e.timeInterval=t,e.openHttpsLogServer(e.url))}catch(e){console.log("send result failed "+e)}}else console.log("send failed "+r.status)},r.open("POST",this.url,!0),0==this.env?r.send(t):2==this.env&&(r.setRequestHeader("content-type","application/json"),r.send(JSON.stringify({user_id:this.userid,log:t}))),this.logCacheSend=[]},e.prototype.SendHttpsLogWeChatMini=function(){var e=this;!this.existUserID&&this.userid&&this.logCacheSend.forEach((function(t){Array.isArray(t)&&t.forEach((function(r,o){var i=JSON.parse(r);i&&""==JSON.parse(r).userid?(i.userid=e.userid,i.id_name=e.userid,t[o]=JSON.stringify(i)):e.existUserID=!0}))}));var t=this.logCacheSend.join("\n"),r=1==this.env?t:JSON.stringify({user_id:this.userid,log:t});wx.request({url:this.url,data:r,method:"POST",success:function(t){if(0!=t.data.length){var r=t&&t.data&&t.data.interval;"number"==typeof r&&e.logUploadInterval!==r&&(e.timeInterval=r,e.openHttpsLogServer(e.url))}},fail:function(e){console.log("send failed "+e.statusCode)}}),this.logCacheSend=[]},e}();t.ZegoLogger=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTime=t.getCurrentEnv=t.getBrowser=void 0;var o=r(0);t.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),i=null!=window.opr,n=e.indexOf("Chrome")&&window.chrome,s=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version"),a=e.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===e.toLowerCase().match(/MicroMessenger/i)[0];return t?o.ZEGO_BROWSER_TYPE.IE:r?o.ZEGO_BROWSER_TYPE.FIREFOX:i?o.ZEGO_BROWSER_TYPE.OPERA:n?o.ZEGO_BROWSER_TYPE.CHROME:s?o.ZEGO_BROWSER_TYPE.SAFARI:a?o.ZEGO_BROWSER_TYPE.WEIXIN:o.ZEGO_BROWSER_TYPE.UNKOWN},t.getCurrentEnv=function(){var e=window.navigator.userAgent;return new Promise((function(t){-1==e.indexOf("MicroMessage")?t(o.ZEGO_ENV.BROWSER):wx.miniProgram.getEnv((function(e){e.miniprogram}))}))};var i=["00","01","02","03","04","05","06","07","08","09"];t.getCurrentTime=function(){var e=new Date;return[e.getFullYear()+"/",(i[e.getMonth()+1]||e.getMonth()+1)+"/",(i[e.getDate()]||e.getDate())+" ",(i[e.getHours()]||e.getHours())+":",(i[e.getMinutes()]||e.getMinutes())+":",i[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")}}])},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Base64=void 0;var o=function(){function e(){}return e.base64encode=function(t){var r,o,i,n,s,a;for(i=t.length,o=0,r="";o<i;){if(n=255&t.charCodeAt(o++),o==i){r+=e.base64EncodeChars.charAt(n>>2),r+=e.base64EncodeChars.charAt((3&n)<<4),r+="==";break}if(s=t.charCodeAt(o++),o==i){r+=e.base64EncodeChars.charAt(n>>2),r+=e.base64EncodeChars.charAt((3&n)<<4|(240&s)>>4),r+=e.base64EncodeChars.charAt((15&s)<<2),r+="=";break}a=t.charCodeAt(o++),r+=e.base64EncodeChars.charAt(n>>2),r+=e.base64EncodeChars.charAt((3&n)<<4|(240&s)>>4),r+=e.base64EncodeChars.charAt((15&s)<<2|(192&a)>>6),r+=e.base64EncodeChars.charAt(63&a)}return r},e.base64decode=function(t){var r,o,i,n,s,a,c;for(a=t.length,s=0,c="";s<a;){do{r=e.base64DecodeChars[255&t.charCodeAt(s++)]}while(s<a&&-1==r);if(-1==r)break;do{o=e.base64DecodeChars[255&t.charCodeAt(s++)]}while(s<a&&-1==o);if(-1==o)break;c+=String.fromCharCode(r<<2|(48&o)>>4);do{if(61==(i=255&t.charCodeAt(s++)))return c;i=e.base64DecodeChars[i]}while(s<a&&-1==i);if(-1==i)break;c+=String.fromCharCode((15&o)<<4|(60&i)>>2);do{if(61==(n=255&t.charCodeAt(s++)))return c;n=e.base64DecodeChars[n]}while(s<a&&-1==n);if(-1==n)break;c+=String.fromCharCode((3&i)<<6|n)}return c},e.utf16to8=function(e){var t,r,o,i;for(t="",o=e.length,r=0;r<o;r++)(i=e.charCodeAt(r))>=1&&i<=127?t+=e.charAt(r):i>2047?(t+=String.fromCharCode(224|i>>12&15),t+=String.fromCharCode(128|i>>6&63),t+=String.fromCharCode(128|i>>0&63)):(t+=String.fromCharCode(192|i>>6&31),t+=String.fromCharCode(128|i>>0&63));return t},e.utf8to16=function(e){var t,r,o,i,n,s;for(t="",o=e.length,r=0;r<o;)switch((i=e.charCodeAt(r++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(r-1);break;case 12:case 13:n=e.charCodeAt(r++),t+=String.fromCharCode((31&i)<<6|63&n);break;case 14:n=e.charCodeAt(r++),s=e.charCodeAt(r++),t+=String.fromCharCode((15&i)<<12|(63&n)<<6|(63&s)<<0)}return t},e.base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e.base64DecodeChars=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],e}();t.Base64=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROOM_BASIC=t.INIT=t.CLOUD_SETTING=void 0,t.CLOUD_SETTING={product:"Web_SDK",URL:["https://cloud-setting-api.zego.im/cloud-setting/get","https://cloud-setting-api.zegocloud.com/cloud-setting/get"],POLLING_FREQ:300,ONLINE:!1},t.INIT="init",t.ROOM_BASIC="room"},function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryRoomHandler=void 0;var n=r(25),s=r(0),a=r(3),c=r(1),l=r(2),d=function(e){function t(t,r,o){var i=e.call(this,t,r)||this;return i.logger=t,i.stateCenter=r,i.room=o,i.loginRoomCallback={},i}return i(t,e),t.prototype.renewLocalToken=function(e,t){if(this.token=e,this.room.token=this.token,"03"===e.substr(0,2)&&void 0!==t){var r=(new Date).getTime();t=t?1e3*t:1e3*l.ClientUtil.decodeTokenExpire(e.substr(2))-r,this.roomHandler.resetTokenTimer(t-this.stateCenter.local_time_deviation)}this.stateCenter.actionListener("_tokenRenewed",e,this.room.roomID)},t.prototype.initRoom=function(e,t,r,o,i,n,s){this.roomHandler=e,this.roomID=t,this.renewLocalToken(r),this.user=o,this.server=i,this.serverBak=n||i,this.config=s},t.prototype.active=function(e){var t=this;if(this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry call"),this.roomHandler.setRunState(s.ENUM_RUN_STATE.trylogin),this.room.isMulti&&this.room.service.isDisConnect())this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" service is disconnected, multi room stop retry");else if(this.stateCenter.networkState!=s.ENUM_NETWORK_STATE.offline)if(this.retryTimer)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" has actived, ignore");else if(this.isOverTime)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry over time, stop retry");else{if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r}this.retryTimer=setTimeout((function(){t.roomHandler.login(t.retryActiveCount%2==1?t.server:t.serverBak,t.roomID,t.token,t.user,t.config,(function(e){t.handleLoginFinish(e)}),(function(e,r){t.handleLoginFinish(!1,e,r)})),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++}),e?0:1e3*this.retryActiveInterval)}else this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" network is broken, stop retry")},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout((function(){e.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.roomHandler.resetRoom(),e.stopMaxTime(),e.invalid(),e.onactive(!1,c.errorCodeList.LOGIN_TIMEOUT),e.loginRoomCallback.fail&&(e.loginRoomCallback.fail(c.errorCodeList.LOGIN_TIMEOUT),e.loginRoomCallback.fail=void 0)}),1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(e,t){},t.prototype.handleError=function(e,t){if(this.RETRY_MAX_TIME<3)return!1;if(t){var r=e.code+"";return!["1000002002","1000005030","1000005035","1010","1011","1013","1014","1015","1016","1017","1018","1019","1020","1021","1023"].includes(r)&&(!!["1100040001","1100040100"].includes(r)||this.room.lastRunState==s.ENUM_RUN_STATE.login&&(this.room.sessionID="",this.invalid(),!0))}return!0},t.prototype.setLoginRoomCallback=function(e,t){this.loginRoomCallback.success=e,this.loginRoomCallback.fail=t},t.prototype.handleLoginFinish=function(e,t,r){t?this.handleError(t,r)?(!this.maxTimer&&this.startMaxTime(),this.active()):(this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(e,t),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(t),this.loginRoomCallback.fail=void 0)):(this.stopMaxTime(),this.invalid(),this.onactive(e,{code:0,msg:""}),this.loginRoomCallback.success&&(this.loginRoomCallback.success(e),this.loginRoomCallback.fail=void 0))},t}(n.TryHandler);t.RetryRoomHandler=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TryHandler=void 0;var o=function(){function e(e,t){this.logger=e,this.stateCenter=t,this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}return e.prototype.init=function(e,t,r,o){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof r&&(this.RETRY_CONTINUE_COUNT=r),"number"==typeof o&&(this.RETRY_MAX_TIME_INTERVAL=o)},e.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},e}();t.TryHandler=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkParams=t.RULE_SUCCESS=t.RULE_PARAM_NAME=void 0;var o,i=r(2);!function(e){e.NOT_EMPTY="NOT_EMPTY",e.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",e.TYPE_STRING="TYPE_STRING",e.TYPE_INTEGER="TYPE_INTEGER",e.TYPE_OBJECT="TYPE_OBJECT",e.MAX_LENGTH_10="MAX_LENGTH_10",e.MAX_LENGTH_64="MAX_LENGTH_64",e.MAX_LENGTH_100="MAX_LENGTH_100",e.MAX_LENGTH_128="MAX_LENGTH_128",e.MAX_LENGTH_256="MAX_LENGTH_256",e.MAX_LENGTH_1024="MAX_LENGTH_1024"}(o=t.RULE_PARAM_NAME||(t.RULE_PARAM_NAME={})),t.RULE_SUCCESS={error:{code:0,msg:"suc"}};var n={NOT_EMPTY:function(e,r,o,i,n){return void 0===r||""===r||null===r?(i.error(o+" "+e+" is empty"),n):t.RULE_SUCCESS},ILLEGAL_CHARACTERS:function(e,r,o,n,s){return i.ClientUtil.checkIllegalCharacters(r)?t.RULE_SUCCESS:(n.error(o+" "+e+" contains illegal characters"),s)},TYPE_STRING:function(e,r,o,i,n){return"string"!=typeof r?(i.error(o+" "+e+" must be string"),n):t.RULE_SUCCESS},TYPE_INTEGER:function(e,r,o,n,s){return i.ClientUtil.checkInteger(r,!1)?t.RULE_SUCCESS:(n.error(o+" "+e+"  must be integer number"),s)},TYPE_OBJECT:function(e,r,o,i,n){return r&&"object"==typeof r?t.RULE_SUCCESS:(i.error(o+" "+e+"  must be object"),n)},MAX_LENGTH_10:function(e,r,o,i,n){return r.length>10?(i.error(o+" "+e+" is too long"),n):t.RULE_SUCCESS},MAX_LENGTH_64:function(e,r,o,i,n){return r.length>64?(i.error(o+" "+e+" is too long"),n):t.RULE_SUCCESS},MAX_LENGTH_100:function(e,r,o,i,n){return r.length>100?(i.error(o+" "+e+" is too long"),n):t.RULE_SUCCESS},MAX_LENGTH_128:function(e,r,o,i,n){return r.length>128?(i.error(o+" "+e+" is too long"),n):t.RULE_SUCCESS},MAX_LENGTH_256:function(e,r,o,i,n){return r.length>256?(i.error(o+" "+e+" is too long"),n):t.RULE_SUCCESS},MAX_LENGTH_1024:function(e,r,o,i,n){return r.length>1024?(i.error(o+" "+e+" is too long"),n):t.RULE_SUCCESS}};t.checkParams=function(e,r){var i=[],s={};for(var a in e)s[e[a].order]=e[a],e[a].key=a;for(var c in s)i.push(s[c]);for(var l=0;l<i.length;l++)for(var d=i[l].rules,u=0;u<d.length;u++){var h={key:i[l].key,value:i[l].value,action:r.action,logger:r.logger},p=h.key,g=h.value,f=h.action,m=h.logger,_=d[u].name?""+d[u].name:"";if((void 0===g&&_===o.NOT_EMPTY||void 0!==g)&&n[_]){var E=n[_](p,g,f,m,d[u]);if(E!=t.RULE_SUCCESS)return E}}return t.RULE_SUCCESS}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StateCenter=void 0;var o=r(0),i=r(3),n=r(4),s=function(){function e(e,t){this.logger=e,this.dataReport=t,this._debug=!1,this._testEnvironment=!1,this._env=0,this.type="PUBLIC",this.debugCustom=!1,this.configOK=!1,this.role=2,this.relateService=[],this.maxMemberCount=0,this.roomCreateFlag=1,this.local_time_deviation=0,this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[],_kickout:[],tokenWillExpire:[],_tokenExpired:[],hallStateUpdate:[],_hallStateUpdate:[],roomTokenWillExpire:[],_tokenRenewed:[],_protobufResponse:[],_cloudSettingNotify:[],_settingCanFetch:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=o.ENUM_NETWORK_STATE.offline,this.roomRetryTime=300,this.roomModulesList=[],this.isMultiRoom=!1,this.setMultiRoom=!1,this.protoFormat="json",this.settingFetched=!1,this._sdkVersion="unknown"}return Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,o.LoggerStateCenter.getInstance().debug=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e,o.LoggerStateCenter.getInstance().testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this._env},set:function(e){this._env=e,o.LoggerStateCenter.getInstance().ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roomid",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].roomID:""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverTimeOffset",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].messageHandler.serverTimeOffset:0},enumerable:!1,configurable:!0}),e.prototype.getRequestId=function(){return this.idName+"-"+o.getSeq()},e.prototype.actionListener=function(e){for(var t=this,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];if(this.listenerList[e]){var a=o.getReportSeq();this.dataReport.newReport(a,n.ZegoRTMLogEvent.kZegoListener.event),this.dataReport.addMsgInfo(a,{listener:e,params:r}),this.dataReport.uploadReport(a)}this.listenerList[e]&&this.listenerList[e].forEach((function(o){try{o.apply(void 0,r)}catch(r){t.logger.error(i.ZEGO_RTM_ACTION.STATE_ACTION+" ",e," ",JSON.stringify(r))}}))},e.prototype.onListener=function(e,t){return this.listenerList[e]?"function"!=typeof t?(this.logger.error(i.ZEGO_RTM_ACTION.ON_LISTENER+" listener callBack must be funciton"),!1):(-1==this.listenerList[e].indexOf(t)&&this.listenerList[e].push(t),!0):(this.logger.error(i.ZEGO_RTM_ACTION.ON_LISTENER+" event "+e+" no found"),!1)},Object.defineProperty(e.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(e){this._sdkVersion=e},enumerable:!1,configurable:!0}),e}();t.StateCenter=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomModules=void 0;var o=r(0),i=r(9),n=r(29),s=r(10),a=r(2),c=r(1),l=function(){function e(e,t,r,a,c,l){this.roomID=e,this.stateCenter=t,this.logger=r,this.dataReport=a,this.service=c,this.rtm=l,this.runState=o.ENUM_RUN_STATE.logout,this.lastRunState=o.ENUM_RUN_STATE.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.roomSessionID="0",this.sessionID="0",this.isMulti=!1,this.token="",this.thirdToken="",this.roomHandler=new n.RoomHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.heartBeatHandler=new i.HeartBeatHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.userHandler=new s.UserHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.initMessageHandler(),this.initLiveHandler(),this.init()}return e.prototype.initMessageHandler=function(){},e.prototype.initLiveHandler=function(){},e.prototype.init=function(){this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},e.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(t){e.roomHandler.handleHbLogout(t)},this.heartBeatHandler.heartbeatRspNotiFy=function(t){e.messageHandler&&e.messageHandler.loginRsp(t),e.userHandler.patchUserList(t),e.HBResponse(t)}},e.prototype.bindRoomHandler=function(){var e=this;this.roomHandler.loginSuccessCallBack=function(t,r){e.heartBeatHandler.init(r),e.service.startCheck(),e.userHandler.loginRsp(r,t),e.messageHandler&&e.messageHandler.loginRsp(r),e.isMulti||e.handleMultiRoom(),e.roomLoginResponse(r)},this.roomHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.liveHandler&&e.liveHandler.resetLiveHandler(),e.messageHandler&&e.messageHandler.resetMessageInfo(),e.userHandler.resetUserHandler(),e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.stopMaxTime(),e.roomTryHandler=void 0)}},e.prototype.bindUserHandler=function(){},e.prototype.bindMessageHandler=function(){},e.prototype.bindLiveHandler=function(){},e.prototype.HBResponse=function(e){this.stateCenter.actionListener("HBResponse",e)},e.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},e.prototype.handleMultiRoom=function(){this.stateCenter.roomModulesList.forEach((function(e){e.runState!==o.ENUM_RUN_STATE.login&&e.roomTryHandler&&1==e.isMulti&&(e.roomTryHandler.onactive=function(t,r){if(r&&0!==r.code){if(0!==r.code){var o=a.ClientUtil.getLiveRoomError(r.code);o&&c.errorCodeList[o]&&(r=c.errorCodeList[o])}e.roomHandler.roomStateHandle("DISCONNECTED",r,r.msg)}else e.roomHandler.roomStateHandle("CONNECTED",r)},e.roomTryHandler.startMaxTime(),e.roomTryHandler.active())}))},e.prototype.isLogin=function(){return this.runState===o.ENUM_RUN_STATE.login},e}();t.LiveRoomModules=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomHandler=void 0;var o=r(0),i=r(2),n=r(3),s=r(1),a=r(4),c=function(){function e(e,t,r,o,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=i,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4,this.tokenTimer=null,this.beforeExpire=30,this.loginCallback={}}return e.prototype.resetTokenTimer=function(e){var t=this;e=(e=(e-=3e4)<0?0:e)>2147483648?2147483648:e,this.logger.info(n.ZEGO_RTM_ACTION.ROOM_RESETTOKEN_TIMER+"  call: "+e),this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=setTimeout((function(){t.stateCenter.actionListener("tokenWillExpire",t.room.roomID),t.stateCenter.actionListener("roomTokenWillExpire",t.room.roomID)}),e)},e.prototype.stopTokenTimer=function(){this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=null},e.prototype.setRunState=function(e){this.room.runState!==e&&(this.room.lastRunState=this.room.runState,this.room.runState=e)},e.prototype.resetTryLogin=function(){this.tryLoginTimer&&clearTimeout(this.tryLoginTimer),this.tryLoginTimer=null},e.prototype.resetRoom=function(e){var t=this;if(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call"),this.stateCenter.roomModulesList.length>1&&!e&&(this.room.isMulti=!0),this.resetTryLogin(),"0"!==this.room.sessionID&&this.room.runState!==o.ENUM_RUN_STATE.logout&&!this.service.isDisConnect()){var r=function(e){t.handleLogoutRsp(e)};this.service.logout(this.room,r,r)}this.setRunState(o.ENUM_RUN_STATE.logout),this.room.sessionID="",this.room.roomSessionID="",this.room.isMulti||(this.stateCenter.userid="",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.service.closeSocket()),this.resetRoomCallBack(),this.stateCenter.roomModulesList=this.stateCenter.roomModulesList.filter((function(e){return e!==t.room}));var i=this.stateCenter.roomModulesList[0];i&&(i.isMulti=!1,i.runState!==o.ENUM_RUN_STATE.login&&i.roomTryHandler&&(i.roomTryHandler.startMaxTime(),i.roomTryHandler.active())),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.handlePushKickout=function(e,t){var r=this;this.logger.info(n.ZEGO_RTM_ACTION.ROOM_KICK_OUT+"  call "+JSON.stringify(e));var c=o.getReportSeq();this.dataReport.newReport(c,a.ZegoRTMLogEvent.kZegoTaskKickout.event),this.dataReport.addMsgInfo(c,{user_id:a.ZegoRTMLogEvent.kZegoTaskKickout.user_id(this.stateCenter.idName)});var l=i.ClientUtil.getKickoutError(e.body.reason);this.dataReport.addMsgInfo(c,{error:l.code,message:l.message}),this.dataReport.uploadReport(c);var d=this.room.roomTryHandler;if(d)if(d.onactive=function(e,t){r.disconnectedHandle(t),r.stateCenter.actionListener("_kickout",t)},e.body.need_relogin&&1==e.body.need_relogin)this.room.sessionID="",d.startMaxTime(),d.active();else{this.setRunState(o.ENUM_RUN_STATE.logout),this.resetRoom(t);var u={};e&&e.body.custom_reason?u.custom_kickout_message=e.body.custom_reason:l.name&&s.errorCodeList[l.name]&&(u.custom_kickout_message=s.errorCodeList[l.name].msg+"; kickout reason: "+e.body.reason),l.name&&s.errorCodeList[l.name]?this.disconnectedHandle(s.errorCodeList[l.name],JSON.stringify(u)):this.disconnectedHandle(s.errorCodeList.ROOM_INNER_ERROR,JSON.stringify(u)),this.stateCenter.actionListener("_kickout",{code:s.errorCodeList.MANUAL_KICKOUT.code,msg:s.errorCodeList.MANUAL_KICKOUT.msg+e.body.reason})}else this.logger.info(n.ZEGO_RTM_ACTION.ROOM_KICK_OUT+" try handler no found")},e.prototype.handleHbLogout=function(e){var t=this,r=this.room.roomTryHandler;r&&(r.onactive=function(e,r){t.disconnectedHandle(r)},[s.errorCodeList.HEARTBEAT_TIMEOUT,s.errorCodeList.SOCKET_CLOSE,s.errorCodeList.TIMEOUT].includes(e)||e.msg.endsWith("1000002001")||e.msg.endsWith("1000000152")||e.msg.endsWith("1000000105")?(r.startMaxTime(),r.active()):(r.stopMaxTime(),r.invalid(),this.resetRoom(),this.disconnectedHandle(e)))},e.prototype.onDisconnect=function(e){var t=this;if(this.logger.error(n.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" "+e.msg),"string"==typeof e.code&&"Error.Network"===e.code)this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.code,message:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.msg});else if("number"==typeof e.code){var r;(r=e.code<2e9&&e.code>1e9||e.code<1e6?i.ClientUtil.decodeServerError(e.code,e.msg):{code:e.code,message:e.msg})&&this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:r.code,message:r.message})}this.dataReport.uploadReport(this.stateCenter.reportSeqList.relogin),this.stateCenter.reportSeqList.relogin=0,i.ClientUtil.unregisterCallback(a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.stateCenter.reportList);var o=this.room.roomTryHandler;o?(o.onactive=function(e,r){r&&0!==r.code?t.roomStateHandle("DISCONNECTED",r):t.roomStateHandle("CONNECTED",r)},o.startMaxTime(),o.active()):this.logger.error(n.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" try handler no found")},e.prototype.onConnecting=function(e){this.roomStateHandle("CONNECTING",e)},e.prototype.disconnectedHandle=function(e,t){e&&0!==e.code?(this.stopTokenTimer(),this.roomStateHandle("DISCONNECTED",e,t)):this.roomStateHandle("CONNECTED",e,t)},e.prototype.roomStateHandle=function(e,t,r){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_STATUS_CALLBACK+" "+e+" "+JSON.stringify(t)),this.room.lastRoomState=this.room.roomState,this.room.roomState=e,this.room.roomState!==this.room.lastRoomState&&(this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,t?t.code:0,r),this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,e,t?t.code:0,r))},e.prototype.login=function(e,t,r,c,l,d,u){if(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call:",t,r),!this.room.isMulti&&this.logger.setSessionInfo(this.stateCenter.appid,t,"",c.userID,"",this.stateCenter.sdKVersion),l&&(l.userUpdate&&"boolean"==typeof l.userUpdate&&(this.stateCenter.userStateUpdate=l.userUpdate),l.maxMemberCount&&"number"==typeof l.maxMemberCount&&(this.stateCenter.maxMemberCount=l.maxMemberCount)),!this.stateCenter.configOK)return this.logger.error(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" init sdk wrong"),void u(s.errorCodeList.INIT);if(this.room.runState!==o.ENUM_RUN_STATE.trylogin&&this.setRunState(o.ENUM_RUN_STATE.trylogin),this.room.roomID=t,this.room.token=r,this.room.thirdToken=r,this.stateCenter.idName=c.userID,this.stateCenter.nickName=c.userName||c.userID,this.loginCallback.success=d,this.loginCallback.fail=u,0===this.stateCenter.reportSeqList.login){var h=o.getReportSeq();this.stateCenter.reportSeqList.relogin=h,this.dataReport.newReport(h,a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event),this.dataReport.addMsgInfo(h,{server:e}),i.ClientUtil.logReportCallback(a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.dataReport,h,this.stateCenter.reportList)}this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLogin(e),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call success")},e.prototype.tryLogin=function(e){var t=this;if(this.room.runState===o.ENUM_RUN_STATE.trylogin){var r=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(this.service.isDisConnect())try{this.service.closeSocket(),this.logger.debug(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" new websocket"),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&(this.tryLoginCount>1&&i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.eventEnd,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.addEventMsg,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.server("server"),e)),this.service.createSocket(e),this.service.openHandler((function(){t.openHandler()})),this.service.closeHandler((function(e){t.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" close "+JSON.stringify(e.code?e.code:e)),t.service.closeSocket(),t.closeHandler(e)})),this.service.errorHandler((function(e){t.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" error "+JSON.stringify(e.code?e.code:e)),t.service.closeSocket(),t.closeHandler(e)}))}catch(e){this.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+"  websocket err:"+JSON.stringify(e))}else{this.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" use current websocket and sent login"),i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var s=function(e,r){t.handleLoginRsp(e,r)};this.service.login(this.room,s,s)}this.tryLoginTimer=setTimeout((function(){t.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" over time no response, login timeout"),t.loginCallback.fail&&t.loginCallback.fail(a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT)}),this.tryLoginInterval),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" call success")}else this.logger.error("zb.rh.tl state error")},e.prototype.openHandler=function(){var e=this;this.logger.info(n.ZEGO_RTM_ACTION.ROOM_OPEN_HANDLER+" websocket.onpen call");var t=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;i.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(o.REPORT_ACTION.eventEndWithMsgInfo,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,{try_cnt:this.tryLoginCount}),this.service.onPush(),i.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(o.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var r=function(t,r){e.handleLoginRsp(t,r)};this.service.login(this.room,r,r)},e.prototype.handleLoginRsp=function(e,t){var r=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(o.REPORT_ACTION.eventEndWithMsgInfo,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event),this.room.runState===o.ENUM_RUN_STATE.trylogin)if(e.header&&e.body){if(e.header.seq!==t&&0==this.room.isMulti)return void this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" in wrong seq, local=",t+"",",recv=",e.header.seq);0!==e.body.err_code?(this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" server error=",e.body.err_code),this.handleLoginFail(e)):(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" call success."),this.handleLoginSuccess(e))}else this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" "+JSON.stringify(e)),this.handleLoginFail(e);else this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" state error")},e.prototype.handleLoginFail=function(e){this.resetTryLogin();var t=a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INNER_ERROR;e.header&&e.body?t=i.ClientUtil.getServerError(e.body.err_code):e.code&&e.msg&&(t=e),this.loginCallback.fail&&this.loginCallback.fail(t,!0)},e.prototype.handleLoginSuccess=function(e){var t,r={},n=this.room.lastRunState;if(this.setRunState(o.ENUM_RUN_STATE.login),this.stateCenter.userid=e.body.user_id,this.room.sessionID=e.body.session_id,this.room.roomSessionID=e.body.room_session_id,e.body.ret_timestamp&&"03"===this.room.token.substr(0,2)){var s=(new Date).getTime(),c=s-e.body.ret_timestamp;this.stateCenter.local_time_deviation=c<5e3?0:c;var l=(null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.token_remain_time)?1e3*e.body.token_remain_time:1e3*i.ClientUtil.decodeTokenExpire(this.room.token.substr(2))-s;this.resetTokenTimer(l-this.stateCenter.local_time_deviation)}if(!this.room.isMulti&&this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),e.body.config_info){var d=this.stateCenter.settingConfig.getSetting("remote_log_level",!0)||e.body.config_info.log_level;this.logger.setRemoteLogLevel(d),r.log_level=d,""==e.body.config_info.log_url||this.logger.url||(this.logger.setLogServer(e.body.config_info.log_url),r.log_url=e.body.config_info.log_url)}e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,r.test_environment="true",!this.stateCenter.debugCustom&&(this.stateCenter.debug=!0));var u=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;i.ClientUtil.actionSuccessCallback(u,this.stateCenter.reportList)&&i.ClientUtil.actionSuccessCallback(u,this.stateCenter.reportList)(o.REPORT_ACTION.addEventMsg,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.respond_info("respond_info"),r),this.resetTryLogin(),this.loginSuccessCallBack(n,e),this.loginCallback.success&&this.loginCallback.success(!0),this.roomStateHandle("CONNECTED",{code:0,msg:""})},e.prototype.closeHandler=function(e){this.logger.error(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" room websocket close "+JSON.stringify(e.code?e.code:e)),this.room.runState!==o.ENUM_RUN_STATE.logout?this.room.runState===o.ENUM_RUN_STATE.trylogin?(this.resetTryLogin(),this.loginCallback.fail&&this.loginCallback.fail(1006==e.code?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT:e)):this.room.runState===o.ENUM_RUN_STATE.login&&(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" is called because of network broken"),this.resetTryLogin(),this.onDisconnect(a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.NETWORK_BROKEN)):this.logger.info(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" onclose logout flow call websocket.close")},e.prototype.logout=function(e){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call"),this.room.runState!==o.ENUM_RUN_STATE.logout?(this.resetRoom(e),this.roomStateHandle("DISCONNECTED",{code:0,msg:""}),this.stopTokenTimer(),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call success")):this.logger.warn("zb.rh.lo at logout")},e.prototype.handleLogoutRsp=function(e){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+" result=",e.body&&e.body.err_code?e.body.err_code:"-1")},e}();t.RoomHandler=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomModules=void 0;var o=r(0),i=r(9),n=r(10),s=function(){function e(e,t,r,s,a){this.stateCenter=e,this.logger=t,this.dataReport=r,this.service=s,this.rtm=a,this.roomID="",this._dispatchServer="",this.deviceID="",this.deviceType="",this.anType=0,this.sessionExpire="",this.pri_roomID="",this.roomSid="0",this.roomFlag=1,this.timeStamp=0,this.netType=2,this.userSeq=0,this.hallRunState=o.ENUM_RUN_STATE.logout,this.hallToken="",this.roomSessionID="",this.lastHallRunState=o.ENUM_RUN_STATE.logout,this.runRoomState=o.ENUM_RUN_STATE.logout,this.lastRunRoomState=o.ENUM_RUN_STATE.logout,this.lastHallState="DISCONNECTED",this.hallState="DISCONNECTED",this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.sessionID="",this.initHandler(),this.heartBeatHandler=new i.HeartBeatHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.userHandler=new n.UserHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.initMessageHandler(),this.init()}return e.prototype.initMessageHandler=function(){},e.prototype.initHandler=function(){},e.prototype.init=function(){this.bindSocketHandler(),this.bindHeatBeatHandler(),this.bindMessageHandler(),this.bindLiveHandler()},e.prototype.bindSocketHandler=function(){var e=this;this.service.handlePushUserStateUpdateMsg=function(t){e.userHandler.handlePushUserStateUpdateMsg(t)}},e.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(e){},this.heartBeatHandler.heartbeatRspNotiFy=function(t){e.HBResponse(t)}},e.prototype.bindHallHandler=function(){},e.prototype.bindUserHandler=function(){},e.prototype.bindMessageHandler=function(){},e.prototype.bindLiveHandler=function(){},e.prototype.bindRoomHandler=function(){},e.prototype.handleHbLogout=function(e){},e.prototype.HBResponse=function(e){this.stateCenter.actionListener("HBResponse",e)},e.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},e.prototype.isLogin=function(){return this.hallRunState===o.ENUM_RUN_STATE.login},e}();t.LiveRoomModules=s},function(e,t,r){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomPrivateService=void 0;var n=r(12),s=r(0),a=function(e){function t(t,r,o){var i=e.call(this,t,r,o)||this;return i.stateCenter=t,i.logger=r,i.service=new n.ZegoSocketService(i.stateCenter.ENV),i.cmdSeq=0,i.responseRouters={},i}return i(t,e),t.prototype.checkResponse=function(e){return e.header.app_id!==this.stateCenter.appid||e.header.user_uid!==this.stateCenter.userid||this.stateCenter.priModules.hallRunState!==s.ENUM_RUN_STATE.login},t.prototype.handleHallKickout=function(e){},t.prototype.handlePushKickout=function(e){},t.prototype.handlePushCustomMsg=function(e){},t.prototype.handlePushRoomMsg=function(e){},t.prototype.handlePushUserStateUpdateMsg=function(e){},t.prototype.handlePushMergeMsg=function(e){},t.prototype.handlePushTransMsg=function(e){},t.prototype.handleBigImMsgRsp=function(e){},t.prototype.handlePushSignalMsg=function(e){},t.prototype.closeHandler=function(e){this.service.closeHandler(e)},t.prototype.openHandler=function(e){this.service.openHandler(e)},t.prototype.errorHandler=function(e){this.service.errorHandler(e)},t.prototype.getHeader=function(e){return{cmd:e,seq:++this.cmdSeq,timestamp:Math.ceil((new Date).getTime()/1e3)+"",app_id:this.stateCenter.appid,user_uid:this.stateCenter.userid||"0",session_id:this.stateCenter.priModules.sessionID||"0"}},t.prototype.startCheck=function(){this.service.startCheck()},t.prototype.stopCheck=function(){this.service.stopCheck()},t.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},t.prototype.closeSocket=function(){this.service.closeSocket()},t.prototype.on=function(e,t){this.responseRouters[e]=t},t}(r(11).LiveRoomService);t.LiveRoomPrivateService=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSettingConfig=void 0;var o=function(){function e(){this.defaultSetting={remote_log_level:"info"},this.requestList={},this.setting=JSON.parse(JSON.stringify(this.defaultSetting))}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setSetting=function(e,t){var r=Array.isArray(t)&&t.length>0;for(var o in e)for(var i in e[o])if(!i.endsWith("_ctrlmode")){if(r&&-1==t.indexOf(i))continue;var n=e[o][i+"_ctrlmode"];1===n||2===n?this.setting[i]=e[o][i]:this.defaultSetting[i]&&(this.setting[i]=this.defaultSetting[i]),"number"==typeof n&&(this.setting[i+"_ctrlmode"]=e[o][i+"_ctrlmode"])}},e.prototype.getSetting=function(e,t){return void 0===t&&(t=!1),t?2==this.setting[e+"_ctrlmode"]?this.setting[e]:void 0:this.setting[e]},e}();t.ZegoSettingConfig=o},function(e,t,r){"undefined"!=typeof self&&self,e.exports=function(e){return o={},t.m=r=[function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_SETTING_ACTION=void 0,(t=t.ZEGO_SETTING_ACTION||(t.ZEGO_SETTING_ACTION={})).CONSTRUCTOR="zs.0",t.SETTING_INIT="zs.ii.0",t.SETTING_FETCH_SETTING="zs.fs.0",t.SETTING__FETCH_SETTING="zs.fs.1",t.SETTING_GET_CLOUD_SETTING="zs.gcs.0",t.SETTING_POLLING_SETTING="zs.ps.0",t.SETTINGCACHEHANDLER_GET_CACHE_SETTING="zs.sch.gcs.0",t.SETTINGCACHEHANDLER_STORE_SETTING="zs.sch.ss.0",t.SETTINGFETCHHANDLER_FETCHSETTING="zs.sfh.fs.0"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorList=void 0,t.errorList={NOT_INIT:{code:1001,msg:"not init"},FILE_REQUEST_FAIL:{code:1002,msg:"fetch request fail"},INFLATE_DATA_FAIL:{code:1003,msg:"inflate fail"},MULTI_FILE_NOT_EXIST:{code:1004,msg:"get multi file fail"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateUUID=t.checkValidNumber=t.analyzeKey=t.getCurrentTime=t.getBrowser=void 0,t.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),o=null!=window.opr,i=e.indexOf("Chrome")&&window.chrome,n=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return e=e.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===e.toLowerCase().match(/MicroMessenger/i)[0],t?"IE":r?"FIREFOX":o?"OPERA":i?"CHROME":n?"SAFARI":e?"WEIXIN":"UNKOWN"};var o=["00","01","02","03","04","05","06","07","08","09"];t.getCurrentTime=function(){var e=new Date;return[e.getFullYear()+"/",(o[e.getMonth()+1]||e.getMonth()+1)+"/",(o[e.getDate()]||e.getDate())+" ",(o[e.getHours()]||e.getHours())+":",(o[e.getMinutes()]||e.getMinutes())+":",o[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")},t.analyzeKey=function(e){return e=e.split("_"),{level:Number(e[0]),timestamp:e[1],seq:e[2]}},t.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&t<=e&&e<=r},t.generateUUID=function(e){if(0===(e=void 0===e?0:e)?r=localStorage.getItem("z_deviceID"):wx.getStorageSync("z_deviceID"),r)return r;var t=(new Date).getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(36)}));return 0===e?localStorage.setItem("z_deviceID",r):wx.setStorageSync("z_deviceID",r),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSetting=void 0;var o=r(4);Object.defineProperty(t,"ZegoSetting",{enumerable:!0,get:function(){return o.ZegoSetting}})},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,o){return new(r=r||Promise)((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,o,i,n={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,(s=i?[2&s[0],i.value]:s)[0]){case 0:case 1:i=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,o=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(!(i=0<(i=n.trys).length&&i[i.length-1])&&(6===s[0]||2===s[0])){n=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(6===s[0]&&n.label<i[1]){n.label=i[1],i=s;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(s);break}i[2]&&n.ops.pop(),n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e],o=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSetting=void 0;var s=r(5),a=r(6),c=r(10),l=r(0),d=r(12),u=r(1),h=r(2);function p(){this.fileList=[],this.publicEnvVariable={},this.proEnvVariable={},this.pollingTimer=null,this.inited=!1,this.log=new s.ZegoLog}Object.defineProperty(p.prototype,"envVariable",{get:function(){return Object.assign({},this.publicEnvVariable,this.proEnvVariable)},enumerable:!1,configurable:!0}),p.prototype.init=function(e){var t=this;return h.checkValidNumber(e.pollingFreq)?(this.options=Object.assign({},d.INIT_CONFIG,e),this.getPublicEnvVariable(),this.settingFetchHandler=new c.SettingFetchHandler(this.options,this.log),this.settingFetchHandler.setDataReport(this.options.reportNotify),e=Math.round(60*Math.random()),this.log.info(l.ZEGO_SETTING_ACTION.SETTING_INIT+" delay "+e),this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null),this.delayTimer=setTimeout((function(){t.pollingSetting(1e3*t.options.pollingFreq)}),1e3*e),this.settingCacheHandler=new a.SettingCacheHandler("setting_"+(this.options.online?"online_":"test_")+this.options.product+"_"+this.options.appID,this.log,this.options.env),this.inited=!0):(this.log.error(l.ZEGO_SETTING_ACTION.SETTING_INIT+" pollingFreq must be integer number"),!1)},p.prototype.uninit=function(){this.pollingTimer&&(clearTimeout(this.pollingTimer),this.pollingTimer=null)},p.prototype.setEnvVariable=function(e,t){this.proEnvVariable[e]=String(t)},p.prototype.getEnvVariable=function(e){return this.envVariable[e]},p.prototype.setEnvVariables=function(e){var t=this;Object.keys(e).forEach((function(r){"string"!=typeof e[r]&&"number"!=typeof e[r]&&t.log.error("zs.sev env "+r+" type error"),t.proEnvVariable[r]=String(e[r])}))},p.prototype.getEnvVariables=function(){return this.envVariable},p.prototype.enablePolling=function(e,t){var r=this;t?t.forEach((function(t){var o=r.fileList.find((function(e){return e.fileName===t}));o&&(o.needPolling=e)})):this.fileList.forEach((function(t){return t.needPolling=e}))},p.prototype.setToken=function(e){this.token=e},p.prototype.setUserID=function(e){this.userID=e},p.prototype.getSettingCache=function(e){return i(this,void 0,void 0,(function(){var t,r,o;return n(this,(function(i){switch(i.label){case 0:return this.inited?(t=this.fileList.find((function(t){return t.fileName===e})))?[2,Promise.resolve({setting:t.setting,versions:t.versions})]:[3,1]:[2,Promise.reject(u.errorList.NOT_INIT)];case 1:return r=this._getFileName(e),[4,this.settingCacheHandler.getCacheSetting(r)];case 2:return(r=i.sent())&&(this.fileList.find((function(t){return t.fileName===e}))||this.fileList.push({fileName:e,fetchedTime:0,needPolling:!1,setting:r.setting,versions:r.versions}),o={setting:r.setting,versions:r.versions}),[2,Promise.resolve(o)]}}))}))},p.prototype.fetchSetting=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r=!0),this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" call "+e),this.inited?(this.activePolling(),0<Object.keys(t).length?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" get file with params"),this._getCloudSetting(e,o(o({},this.envVariable),t))):(t=this.fileList.find((function(t){return t.fileName===e})))?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" file exist"),(new Date).getTime()-t.fetchedTime<1e3*this.options.pollingFreq?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" fetch time interval in freq"),t.needPolling=r,Promise.resolve({setting:t.setting,versions:t.versions})):this._fetchSetting(e,t,r)):(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" file not found"),this._fetchSetting(e,t,r))):Promise.reject(u.errorList.NOT_INIT)},p.prototype.fetchMultiSetting=function(e,t,r){var s=this;return void 0===t&&(t={}),void 0===r&&(r=!0),this.inited?(this.activePolling(),0<Object.keys(t).length?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" get file with params"),this._getCloudSetting(e,o(o({},this.envVariable),t))):new Promise((function(t,o){var a={},c=[];if(e.forEach((function(e){return i(s,void 0,void 0,(function(){var t;return n(this,(function(r){return(t=this.fileList.find((function(t){return t.fileName===e})))&&(new Date).getTime()-t.fetchedTime<1e3*this.options.pollingFreq?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" fetch time interval in freq"),a[e]={setting:t.setting,versions:t.versions}):c.push(e),[2]}))}))})),!(0<c.length))return t(a);s._getCloudSetting(c,s.envVariable).then((function(e){return s.handleFetchFiles(e,r),Object.assign(a,e),t(a)})).catch((function(e){c.forEach((function(e){return i(s,void 0,void 0,(function(){var t;return n(this,(function(o){switch(o.label){case 0:return(t=this.fileList.find((function(t){return t.fileName==e})))?t.fetchedTime=(new Date).getTime():this.fileList.find((function(t){return t.fileName===e}))||this.fileList.push({fileName:e,fetchedTime:(new Date).getTime(),needPolling:r,setting:{},versions:{}}),[4,this.settingCacheHandler.getCacheSetting(e)];case 1:return t=o.sent(),a[e]={setting:t.setting,versions:t.versions},[2]}}))}))})),0<Object.keys(a).length?t(a):o(e)}))}))):Promise.reject(u.errorList.NOT_INIT)},p.prototype.setLog=function(e){this.log=e},p.prototype._getCloudSetting=function(e,t){var r=this;return new Promise((function(o,s){return i(r,void 0,void 0,(function(){var r,i,a,c,d;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),a=e instanceof Array,[4,this.settingFetchHandler.fetchSetting(a?e:[e],t,this.token,this.userID)];case 1:return r=n.sent(),a?(i={},e.forEach((function(e){var t,o;0==(null===(t=r[e])||void 0===t?void 0:t.code)&&void 0!==(null===(o=r[e])||void 0===o?void 0:o.data)&&(i[e]={setting:null===(o=r[e])||void 0===o?void 0:o.data,versions:null===(e=r[e])||void 0===e?void 0:e.versions})})),0<Object.keys(i).length?o(i):s(u.errorList.MULTI_FILE_NOT_EXIST)):0===(null===(a=r[e])||void 0===a?void 0:a.code)&&null!==(c=r[e])&&void 0!==c&&c.data?o({setting:null===(c=r[e])||void 0===c?void 0:c.data,versions:null===(c=r[e])||void 0===c?void 0:c.versions}):s({code:null===(d=r[e])||void 0===d?void 0:d.code,msg:null===(d=r[e])||void 0===d?void 0:d.message}),[3,3];case 2:return d=n.sent(),s(d),this.log.info(l.ZEGO_SETTING_ACTION.SETTING_GET_CLOUD_SETTING+" fail"),[3,3];case 3:return[2]}}))}))}))},p.prototype.handleFetchFiles=function(e,t){var r=this;Object.keys(e).forEach((function(o){var i=r.fileList.find((function(e){return e.fileName==o}));i?(i.fetchedTime=(new Date).getTime(),i.setting=e[o].setting,i.versions=e[o].versions,i.needPolling=t):r.fileList.find((function(e){return e.fileName===o}))||r.fileList.push({fileName:o,fetchedTime:(new Date).getTime(),needPolling:t,setting:e[o].setting,versions:e[o].versions}),i=r._getFileName(o),r.settingCacheHandler.storeSetting(i,e[o])}))},p.prototype._fetchSetting=function(e,t,r){var o=this;return new Promise((function(s,a){o.log.info(l.ZEGO_SETTING_ACTION.SETTING__FETCH_SETTING+" call"),o._getCloudSetting(e,o.envVariable).then((function(i){t?(t.fetchedTime=(new Date).getTime(),t.setting=i.setting,t.versions=i.versions,t.needPolling=r):o.fileList.find((function(t){return t.fileName===e}))||o.fileList.push({fileName:e,fetchedTime:(new Date).getTime(),needPolling:r,setting:i.setting,versions:i.versions});var n=o._getFileName(e);o.settingCacheHandler.storeSetting(n,i),s(i),o.log.info(l.ZEGO_SETTING_ACTION.SETTING__FETCH_SETTING+" call suc")})).catch((function(c){return i(o,void 0,void 0,(function(){var o;return n(this,(function(i){switch(i.label){case 0:t?t.fetchedTime=(new Date).getTime():this.fileList.find((function(t){return t.fileName===e}))||this.fileList.push({fileName:e,fetchedTime:(new Date).getTime(),needPolling:r,setting:{},versions:{}}),o=this._getFileName(e),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.settingCacheHandler.getCacheSetting(o)];case 2:return o=i.sent(),s(o),[3,4];case 3:return i.sent(),a(c),[3,4];case 4:return this.log.info(l.ZEGO_SETTING_ACTION.SETTING__FETCH_SETTING+" setting not contain or fetch file fail"),[2]}}))}))}))}))},p.prototype.getPublicEnvVariable=function(){var e;0==this.options.env?(this.publicEnvVariable.userAgent=navigator.userAgent,this.publicEnvVariable.platform=navigator.platform,this.publicEnvVariable.browser=h.getBrowser(),this.publicEnvVariable.deviceid=h.generateUUID()):1==this.options.env&&(e=wx.getSystemInfoSync(),this.publicEnvVariable.brand=e.brand,this.publicEnvVariable.model=e.model,this.publicEnvVariable.system=e.system,this.publicEnvVariable.platform=e.platform,this.publicEnvVariable.wechatVersion=e.version,this.publicEnvVariable.wechatSDKVersion=e.SDKVersion,this.publicEnvVariable.deviceid=h.generateUUID(this.options.env))},p.prototype.pollingSetting=function(e){return i(this,void 0,void 0,(function(){var t,r,o,s=this;return n(this,(function(a){switch(a.label){case 0:if(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" call "+e),t=[],this.fileList.forEach((function(e){e.fileName,e.needPolling&&t.push(e.fileName)})),!(0<t.length))return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.settingFetchHandler.fetchSetting(t,this.envVariable,this.token,this.userID)];case 2:return r=a.sent(),this.fileList.forEach((function(e){return i(s,void 0,void 0,(function(){var t,o,i,s;return n(this,(function(n){switch(n.label){case 0:return e.fetchedTime=(new Date).getTime(),t=this._getFileName(e.fileName),r[e.fileName]&&0===r[e.fileName].code&&r[e.fileName].data?(o=JSON.stringify(r[e.fileName].data),i=JSON.stringify(e.setting),s={setting:r[e.fileName].data,versions:null===(s=r[e.fileName])||void 0===s?void 0:s.versions},i!==o&&(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" "+e.fileName+" setting changed"),e.setting=s.setting,e.versions=s.versions,this.options.pollingNotify(e.fileName,s)),[4,this.settingCacheHandler.getCacheSetting(t)]):[3,2];case 1:i=n.sent(),o=JSON.stringify(i),i=JSON.stringify(s),o!==i&&this.settingCacheHandler.storeSetting(t,s),n.label=2;case 2:return[2]}}))}))})),[3,4];case 3:return o=a.sent(),this.log.error(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" fetch fail "+JSON.stringify(o)),[3,4];case 4:return[3,6];case 5:this.log.info(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" polling no file"),a.label=6;case 6:return this.pollingTimer&&clearTimeout(this.pollingTimer),this.pollingTimer=setTimeout((function(){s.pollingSetting(e)}),e),[2]}}))}))},p.prototype._getFileName=function(e){return e},p.prototype.activePolling=function(){this.pollingTimer||this.pollingSetting(1e3*this.options.pollingFreq)},r=p,t.ZegoSetting=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoLog=void 0;var o=(i.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.join(" ")},i.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.join(" ")},i.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.join(" ")},i.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.join(" ")},i.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.join(" ")},i);function i(){}t.ZegoLog=o},function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r=r||Promise)((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,i,n={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,(s=i?[2&s[0],i.value]:s)[0]){case 0:case 1:i=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,o=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(!(i=0<(i=n.trys).length&&i[i.length-1])&&(6===s[0]||2===s[0])){n=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(6===s[0]&&n.label<i[1]){n.label=i[1],i=s;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(s);break}i[2]&&n.ops.pop(),n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e],o=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SettingCacheHandler=void 0;var n=r(0),s=r(7);function a(e,t,r){void 0===r&&(r=0),this.storeName=e,this.log=t,this.store=s.createZegoStore(e,r)}a.prototype.getCacheSetting=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.log.info(n.ZEGO_SETTING_ACTION.SETTINGCACHEHANDLER_GET_CACHE_SETTING+" call"),[4,this.store.getItem(e)];case 1:return[2,t.sent()||""]}}))}))},a.prototype.storeSetting=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return this.log.info(n.ZEGO_SETTING_ACTION.SETTINGCACHEHANDLER_STORE_SETTING+" call"),[4,this.store.setItem(e,t)];case 1:return r.sent(),[2]}}))}))},r=a,t.SettingCacheHandler=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoStore=t.ZegoWechatMiniStore=void 0;var o=r(8),i=r(9),n=(s.prototype.getItem=function(e){var t=this;return new Promise((function(r,o){try{r(wx.getStorageSync(t.keyPrefix+e))}catch(r){o(r)}}))},s.prototype.setItem=function(e,t){var r=this;return new Promise((function(o,i){try{wx.setStorageSync(r.keyPrefix+e,t),o()}catch(o){i(o)}}))},s.prototype.removeItem=function(e){var t=this;return new Promise((function(r,o){try{r(wx.removeStorageSync(t.keyPrefix+e))}catch(r){o(r)}}))},s.prototype.clear=function(){return new Promise((function(e,t){try{wx.clearStorageSync(),e()}catch(e){t(e)}}))},s.prototype.keys=function(){var e=this;return new Promise((function(t,r){try{var o=wx.getStorageInfoSync().keys,i=[];o.forEach((function(t){0==t.indexOf(e.keyPrefix)&&i.push(t.replace(e.keyPrefix,""))})),i.sort(),t(i)}catch(t){r(t)}}))},s);function s(e){this.storeName=e,this.keyPrefix=e+"/",this.storeName}t.ZegoWechatMiniStore=n,t.createZegoStore=function(e,t){return t===i.ZEGO_ENV.BROWSER?o.createInstance({name:e}):new n(e)}},function(t,r){t.exports=e},function(e,t,r){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.SOCKET_DISCONNECT=t.ENUM_REMOTE_TYPE=t.ZEGO_BROWSER_TYPE=t.ZEGO_ENV=t.PROTO_VERSION=void 0,t.PROTO_VERSION="1.0.2",(o=t.ZEGO_ENV||(t.ZEGO_ENV={}))[o.BROWSER=0]="BROWSER",o[o.WEIXINMINI=1]="WEIXINMINI",(o=t.ZEGO_BROWSER_TYPE||(t.ZEGO_BROWSER_TYPE={}))[o.IE=0]="IE",o[o.FIREFOX=1]="FIREFOX",o[o.CHROME=2]="CHROME",o[o.SAFARI=3]="SAFARI",o[o.OPERA=4]="OPERA",o[o.WEIXIN=5]="WEIXIN",o[o.WEIXINMINI=6]="WEIXINMINI",o[o.UNKOWN=7]="UNKOWN",(o=t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={}))[o.DISABLE=0]="DISABLE",o[o.WEBSOCKET=1]="WEBSOCKET",o[o.HTTPS=2]="HTTPS",t.SOCKET_DISCONNECT=-1},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.SettingFetchHandler=void 0;var i=r(0),n=r(11),s=r(2);function a(e,t){this.options=e,this.log=t,this.seq=0}a.prototype.setOptions=function(e){this.options=e},a.prototype.setDataReport=function(e){this.reportFunc=e},a.prototype.fetchSetting=function(e,t,r,a){var c=this;return new Promise((function(l,d){var u={product:c.options.product,files:e,param:o(o({},t),{deviceid:void 0}),appid:c.options.appID,token:r,id_name:a,timestamp:(new Date).getTime(),biztype:0,deviceid:t.deviceid||s.generateUUID(c.options.env),compress:!1,mode:c.options.online?"online":"test"},h=c.seq++;c.reportFunc&&c.reportFunc(h,"request_start"),n.fetch(c.options.urls,u,c.options.env||0).then((function(e){var t,r=e.code,o=(e.msg,e.data);e=e.reportData,c.log.info(i.ZEGO_SETTING_ACTION.SETTINGFETCHHANDLER_FETCHSETTING+" "+r),o&&(t=[],Object.keys(o).forEach((function(e){t.push({name:e,error:o[e].code})}))),c.reportFunc&&c.reportFunc(h,"request_end",{code:r,reportData:e,params:u,files:t}),l(o)})).catch((function(e){var t=e.code,r=e.msg;e.data,e=e.reportData,c.log.warn(i.ZEGO_SETTING_ACTION.SETTINGFETCHHANDLER_FETCHSETTING+" "+t),c.reportFunc&&c.reportFunc(h,"request_end",{code:t,params:u,reportData:e}),d({code:t,msg:r})}))}))},r=a,t.SettingFetchHandler=r},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.fetch=void 0;var i=r(1);t.fetch=function e(t,r,n,s,a,c){return void 0===s&&(s=5),void 0===a&&(a=0),void 0===c&&(c=[]),new Promise((function(l,d){a=a||(new Date).getTime();var u,h,p,g=(new Date).getTime();0===n?(u=new XMLHttpRequest,h=t[(s+1)%2]||t[0],u.open("post",h),1==r.compress&&(u.responseType="arraybuffer"),u.ontimeout=function(){},u.onreadystatechange=function(){var p,f,m,_;4==u.readyState&&(200<=u.status&&u.status<300||304==u.status?(m=void 0,1==r.compress||(m=u.responseText),_=(new Date).getTime()-g,p=(f=JSON.parse(m)).code,m=f.message,f=f.data,c.push({timestamp:g,url:h,error:p,duration:_}),0===p?l({code:p,msg:m,data:f,reportData:c}):d({code:p,msg:m,reportData:c})):(m=(new Date).getTime()-g,c.push({timestamp:g,url:h,error:u.status,duration:m}),_=(new Date).getTime()-a,0<s&&_<8e3?e(t,r,n,--s,a,c).then((function(e){l(e)})).catch((function(e){d(e)})):d(o(o({},i.errorList.FILE_REQUEST_FAIL),{reportData:c}))))},u.timeout=8e3,u.send(JSON.stringify(r))):(p=t[(s+1)%2]||t[0],wx.request({url:p,data:r,method:"POST",success:function(u){var h=(m=u.data).code,f=m.message,m=m.data;void 0!==h?0===h?l({code:h,msg:f,data:m,reportData:c}):d({code:h,msg:f,reportData:c}):(f=(new Date).getTime()-g,c.push({timestamp:g,url:p,error:i.errorList.FILE_REQUEST_FAIL.code,msg:u.data,duration:f}),0<s?e(t,r,n,--s,a,c).then((function(e){l(e)})).catch((function(e){d(e)})):d(o(o({},i.errorList.FILE_REQUEST_FAIL),{reportData:c})))},fail:function(u){var h=(new Date).getTime()-g;c.push({timestamp:g,url:p,error:i.errorList.FILE_REQUEST_FAIL.code,msg:u.errMsg,duration:h}),0<s?e(t,r,n,--s,a,c).then((function(e){l(e)})).catch((function(e){d(e)})):d(o(o({},i.errorList.FILE_REQUEST_FAIL),{reportData:c}))}}))}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INIT_CONFIG=void 0,t.INIT_CONFIG={env:0}}],t.c=o,t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var i in e)t.d(o,i,function(t){return e[t]}.bind(null,i));return o},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3);function t(e){if(o[e])return o[e].exports;var i=o[e]={i:e,l:!1,exports:{}};return r[e].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r,o}(r(34))},function(e,t,r){(function(t){e.exports=function e(t,r,o){function i(s,a){if(!r[s]){if(!t[s]){if(n)return n(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,(function(e){return i(t[s][1][e]||e)}),l,l.exports,e,t,r,o)}return r[s].exports}for(var n=!1,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,r,o){(function(e){"use strict";var t,o,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var n=0,s=new i(d),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),t=function(){a.data=n=++n%2}}else if(e.setImmediate||void 0===e.MessageChannel)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var c=new e.MessageChannel;c.port1.onmessage=d,t=function(){c.port2.postMessage(0)}}var l=[];function d(){var e,t;o=!0;for(var r=l.length;r;){for(t=l,l=[],e=-1;++e<r;)t[e]();r=l.length}o=!1}r.exports=function(e){1!==l.push(e)||o||t()}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){"use strict";var o=e(1);function i(){}var n={},s=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&p(this,e)}function d(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function u(e,t,r){o((function(){var o;try{o=t(r)}catch(t){return n.reject(e,t)}o===e?n.reject(e,new TypeError("Cannot resolve promise with itself")):n.resolve(e,o)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var r=!1;function o(t){r||(r=!0,n.reject(e,t))}function i(t){r||(r=!0,n.resolve(e,t))}var s=g((function(){t(i,o)}));"error"===s.status&&o(s.value)}function g(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===s)return this;var r=new this.constructor(i);return this.state!==c?u(r,this.state===a?e:t,this.outcome):this.queue.push(new d(r,e,t)),r},d.prototype.callFulfilled=function(e){n.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){n.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},n.resolve=function(e,t){var r=g(h,t);if("error"===r.status)return n.reject(e,r.value);var o=r.value;if(o)p(e,o);else{e.state=a,e.outcome=t;for(var i=-1,s=e.queue.length;++i<s;)e.queue[i].callFulfilled(t)}return e},n.reject=function(e,t){e.state=s,e.outcome=t;for(var r=-1,o=e.queue.length;++r<o;)e.queue[r].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:n.resolve(new this(i),e)},l.reject=function(e){var t=new this(i);return n.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,o=!1;if(!r)return this.resolve([]);for(var s=new Array(r),a=0,c=-1,l=new this(i);++c<r;)d(e[c],c);return l;function d(e,i){t.resolve(e).then((function(e){s[i]=e,++a!==r||o||(o=!0,n.resolve(l,s))}),(function(e){o||(o=!0,n.reject(l,e))}))}},l.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,r=!1;if(!t)return this.resolve([]);for(var o,s=-1,a=new this(i);++s<t;)o=e[s],this.resolve(o).then((function(e){r||(r=!0,n.resolve(a,e))}),(function(e){r||(r=!0,n.reject(a,e))}));return a}},{1:1}],3:[function(e,r,o){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function n(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),o=0;o<e.length;o+=1)r.append(e[o]);return r.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var s=Promise;function a(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function c(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function d(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var u=void 0,h={},p=Object.prototype.toString;function g(e){return"boolean"==typeof u?s.resolve(u):function(e){return new s((function(t){var r=e.transaction("local-forage-detect-blob-support","readwrite"),o=n([""]);r.objectStore("local-forage-detect-blob-support").put(o,"key"),r.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},r.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return u=e}))}function f(e){var t=h[e.name],r={};r.promise=new s((function(e,t){r.resolve=e,r.reject=t})),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then((function(){return r.promise})):t.dbReady=r.promise}function m(e){var t=h[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function _(e,t){var r=h[e.name].deferredOperations.pop();if(r)return r.reject(t),r.promise}function E(e,t){return new s((function(r,o){if(h[e.name]=h[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return r(e.db);f(e),e.db.close()}var n=[e.name];t&&n.push(e.version);var s=i.open.apply(i,n);t&&(s.onupgradeneeded=function(t){var r=s.result;try{r.createObjectStore(e.storeName),t.oldVersion<=1&&r.createObjectStore("local-forage-detect-blob-support")}catch(r){if("ConstraintError"!==r.name)throw r;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),s.onerror=function(e){e.preventDefault(),o(s.error)},s.onsuccess=function(){r(s.result),m(e)}}))}function T(e){return E(e,!1)}function S(e){return E(e,!0)}function v(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),o=e.version<e.db.version,i=e.version>e.db.version;if(o&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||r){if(r){var n=e.db.version+1;n>e.version&&(e.version=n)}return!0}return!1}function R(e){return n([function(e){for(var t=e.length,r=new ArrayBuffer(t),o=new Uint8Array(r),i=0;i<t;i++)o[i]=e.charCodeAt(i);return r}(atob(e.data))],{type:e.type})}function C(e){return e&&e.__local_forage_encoded_blob}function y(e){var t=this,r=t._initReady().then((function(){var e=h[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return c(r,e,e),r}function I(e,t,r,o){void 0===o&&(o=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(i){if(o>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return s.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),S(e)})).then((function(){return function(e){f(e);for(var t=h[e.name],r=t.forages,o=0;o<r.length;o++){var i=r[o];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,T(e).then((function(t){return e.db=t,v(e)?S(e):t})).then((function(o){e.db=t.db=o;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=o})).catch((function(t){throw _(e,t),t}))}(e).then((function(){I(e,t,r,o-1)}))})).catch(r);r(i)}}var L={_driver:"asyncStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var o in e)r[o]=e[o];var i=h[r.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},h[r.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=y);var n=[];function a(){return s.resolve()}for(var c=0;c<i.forages.length;c++){var l=i.forages[c];l!==t&&n.push(l._initReady().catch(a))}var d=i.forages.slice(0);return s.all(n).then((function(){return r.db=i.db,T(r)})).then((function(e){return r.db=e,v(r,t._defaultConfig.version)?S(r):e})).then((function(e){r.db=i.db=e,t._dbInfo=r;for(var o=0;o<d.length;o++){var n=d[o];n!==t&&(n._dbInfo.db=r.db,n._dbInfo.version=r.version)}}))},_support:function(){try{if(!i||!i.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var r=this,o=new s((function(t,o){r.ready().then((function(){I(r._dbInfo,"readonly",(function(i,n){if(i)return o(i);try{var s=n.objectStore(r._dbInfo.storeName).openCursor(),a=1;s.onsuccess=function(){var r=s.result;if(r){var o=r.value;C(o)&&(o=R(o));var i=e(o,r.key,a++);void 0!==i?t(i):r.continue()}else t()},s.onerror=function(){o(s.error)}}catch(e){o(e)}}))})).catch(o)}));return a(o,t),o},getItem:function(e,t){var r=this;e=l(e);var o=new s((function(t,o){r.ready().then((function(){I(r._dbInfo,"readonly",(function(i,n){if(i)return o(i);try{var s=n.objectStore(r._dbInfo.storeName).get(e);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),C(e)&&(e=R(e)),t(e)},s.onerror=function(){o(s.error)}}catch(e){o(e)}}))})).catch(o)}));return a(o,t),o},setItem:function(e,t,r){var o=this;e=l(e);var i=new s((function(r,i){var n;o.ready().then((function(){return n=o._dbInfo,"[object Blob]"===p.call(t)?g(n.db).then((function(e){return e?t:(r=t,new s((function(e,t){var o=new FileReader;o.onerror=t,o.onloadend=function(t){var o=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:o,type:r.type})},o.readAsBinaryString(r)})));var r})):t})).then((function(t){I(o._dbInfo,"readwrite",(function(n,s){if(n)return i(n);try{var a=s.objectStore(o._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);s.oncomplete=function(){void 0===t&&(t=null),r(t)},s.onabort=s.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return a(i,r),i},removeItem:function(e,t){var r=this;e=l(e);var o=new s((function(t,o){r.ready().then((function(){I(r._dbInfo,"readwrite",(function(i,n){if(i)return o(i);try{var s=n.objectStore(r._dbInfo.storeName).delete(e);n.oncomplete=function(){t()},n.onerror=function(){o(s.error)},n.onabort=function(){var e=s.error?s.error:s.transaction.error;o(e)}}catch(e){o(e)}}))})).catch(o)}));return a(o,t),o},clear:function(e){var t=this,r=new s((function(e,r){t.ready().then((function(){I(t._dbInfo,"readwrite",(function(o,i){if(o)return r(o);try{var n=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=n.error?n.error:n.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return a(r,e),r},length:function(e){var t=this,r=new s((function(e,r){t.ready().then((function(){I(t._dbInfo,"readonly",(function(o,i){if(o)return r(o);try{var n=i.objectStore(t._dbInfo.storeName).count();n.onsuccess=function(){e(n.result)},n.onerror=function(){r(n.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,e),r},key:function(e,t){var r=this,o=new s((function(t,o){e<0?t(null):r.ready().then((function(){I(r._dbInfo,"readonly",(function(i,n){if(i)return o(i);try{var s=n.objectStore(r._dbInfo.storeName),a=!1,c=s.openKeyCursor();c.onsuccess=function(){var r=c.result;r?0===e||a?t(r.key):(a=!0,r.advance(e)):t(null)},c.onerror=function(){o(c.error)}}catch(e){o(e)}}))})).catch(o)}));return a(o,t),o},keys:function(e){var t=this,r=new s((function(e,r){t.ready().then((function(){I(t._dbInfo,"readonly",(function(o,i){if(o)return r(o);try{var n=i.objectStore(t._dbInfo.storeName).openKeyCursor(),s=[];n.onsuccess=function(){var t=n.result;t?(s.push(t.key),t.continue()):e(s)},n.onerror=function(){r(n.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,e),r},dropInstance:function(e,t){t=d.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var o,n=this;if(e.name){var c=e.name===r.name&&n._dbInfo.db?s.resolve(n._dbInfo.db):T(e).then((function(t){var r=h[e.name],o=r.forages;r.db=t;for(var i=0;i<o.length;i++)o[i]._dbInfo.db=t;return t}));o=e.storeName?c.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var r=t.version+1;f(e);var o=h[e.name],n=o.forages;t.close();for(var a=0;a<n.length;a++){var c=n[a];c._dbInfo.db=null,c._dbInfo.version=r}return new s((function(t,o){var n=i.open(e.name,r);n.onerror=function(e){n.result.close(),o(e)},n.onupgradeneeded=function(){n.result.deleteObjectStore(e.storeName)},n.onsuccess=function(){var e=n.result;e.close(),t(e)}})).then((function(e){o.db=e;for(var t=0;t<n.length;t++){var r=n[t];r._dbInfo.db=e,m(r._dbInfo)}})).catch((function(t){throw(_(e,t)||s.resolve()).catch((function(){})),t}))}})):c.then((function(t){f(e);var r=h[e.name],o=r.forages;t.close();for(var n=0;n<o.length;n++)o[n]._dbInfo.db=null;return new s((function(t,r){var o=i.deleteDatabase(e.name);o.onerror=o.onblocked=function(e){var t=o.result;t&&t.close(),r(e)},o.onsuccess=function(){var e=o.result;e&&e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<o.length;t++)m(o[t]._dbInfo)})).catch((function(t){throw(_(e,t)||s.resolve()).catch((function(){})),t}))}))}else o=s.reject("Invalid arguments");return a(o,t),o}},O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b=/^~~local_forage_type~([^~]+)~/,N="__lfsc__:".length,P=N+"arbf".length,A=Object.prototype.toString;function M(e){var t,r,o,i,n,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),d=new Uint8Array(l);for(t=0;t<a;t+=4)r=O.indexOf(e[t]),o=O.indexOf(e[t+1]),i=O.indexOf(e[t+2]),n=O.indexOf(e[t+3]),d[c++]=r<<2|o>>4,d[c++]=(15&o)<<4|i>>2,d[c++]=(3&i)<<6|63&n;return l}function k(e){var t,r=new Uint8Array(e),o="";for(t=0;t<r.length;t+=3)o+=O[r[t]>>2],o+=O[(3&r[t])<<4|r[t+1]>>4],o+=O[(15&r[t+1])<<2|r[t+2]>>6],o+=O[63&r[t+2]];return r.length%3==2?o=o.substring(0,o.length-1)+"=":r.length%3==1&&(o=o.substring(0,o.length-2)+"=="),o}var U={serialize:function(e,t){var r="";if(e&&(r=A.call(e)),e&&("[object ArrayBuffer]"===r||e.buffer&&"[object ArrayBuffer]"===A.call(e.buffer))){var o,i="__lfsc__:";e instanceof ArrayBuffer?(o=e,i+="arbf"):(o=e.buffer,"[object Int8Array]"===r?i+="si08":"[object Uint8Array]"===r?i+="ui08":"[object Uint8ClampedArray]"===r?i+="uic8":"[object Int16Array]"===r?i+="si16":"[object Uint16Array]"===r?i+="ur16":"[object Int32Array]"===r?i+="si32":"[object Uint32Array]"===r?i+="ui32":"[object Float32Array]"===r?i+="fl32":"[object Float64Array]"===r?i+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(i+k(o))}else if("[object Blob]"===r){var n=new FileReader;n.onload=function(){var r="~~local_forage_type~"+e.type+"~"+k(this.result);t("__lfsc__:blob"+r)},n.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(r){console.error("Couldn't convert value into a JSON string: ",e),t(null,r)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,N))return JSON.parse(e);var t,r=e.substring(P),o=e.substring(N,P);if("blob"===o&&b.test(r)){var i=r.match(b);t=i[1],r=r.substring(i[0].length)}var s=M(r);switch(o){case"arbf":return s;case"blob":return n([s],{type:t});case"si08":return new Int8Array(s);case"ui08":return new Uint8Array(s);case"uic8":return new Uint8ClampedArray(s);case"si16":return new Int16Array(s);case"ur16":return new Uint16Array(s);case"si32":return new Int32Array(s);case"ui32":return new Uint32Array(s);case"fl32":return new Float32Array(s);case"fl64":return new Float64Array(s);default:throw new Error("Unkown type: "+o)}},stringToBuffer:M,bufferToString:k};function D(e,t,r,o){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,o)}function w(e,t,r,o,i,n){e.executeSql(r,o,i,(function(e,s){s.code===s.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?n(e,s):D(e,t,(function(){e.executeSql(r,o,i,n)}),n)}),n):n(e,s)}),n)}function B(e,t,r,o){var i=this;e=l(e);var n=new s((function(n,s){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,l){l?s(l):c.db.transaction((function(r){w(r,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){n(a)}),(function(e,t){s(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(o>0)return void n(B.apply(i,[e,a,r,o-1]));s(t)}}))}))})).catch(s)}));return a(n,r),n}function G(e){return new s((function(t,r){e.transaction((function(o){o.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(r,o){for(var i=[],n=0;n<o.rows.length;n++)i.push(o.rows.item(n).name);t({db:e,storeNames:i})}),(function(e,t){r(t)}))}),(function(e){r(e)}))}))}var Z={_driver:"webSQLStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var o in e)r[o]="string"!=typeof e[o]?e[o].toString():e[o];var i=new s((function(e,o){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e){return o(e)}r.db.transaction((function(i){D(i,r,(function(){t._dbInfo=r,e()}),(function(e,t){o(t)}))}),o)}));return r.serializer=U,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var r=this,o=new s((function(t,o){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){w(r,i,"SELECT * FROM "+i.storeName,[],(function(r,o){for(var n=o.rows,s=n.length,a=0;a<s;a++){var c=n.item(a),l=c.value;if(l&&(l=i.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){o(t)}))}))})).catch(o)}));return a(o,t),o},getItem:function(e,t){var r=this;e=l(e);var o=new s((function(t,o){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){w(r,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,r){var o=r.rows.length?r.rows.item(0).value:null;o&&(o=i.serializer.deserialize(o)),t(o)}),(function(e,t){o(t)}))}))})).catch(o)}));return a(o,t),o},setItem:function(e,t,r){return B.apply(this,[e,t,r,1])},removeItem:function(e,t){var r=this;e=l(e);var o=new s((function(t,o){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){w(r,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){o(t)}))}))})).catch(o)}));return a(o,t),o},clear:function(e){var t=this,r=new s((function(e,r){t.ready().then((function(){var o=t._dbInfo;o.db.transaction((function(t){w(t,o,"DELETE FROM "+o.storeName,[],(function(){e()}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,e),r},length:function(e){var t=this,r=new s((function(e,r){t.ready().then((function(){var o=t._dbInfo;o.db.transaction((function(t){w(t,o,"SELECT COUNT(key) as c FROM "+o.storeName,[],(function(t,r){var o=r.rows.item(0).c;e(o)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,e),r},key:function(e,t){var r=this,o=new s((function(t,o){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){w(r,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,r){var o=r.rows.length?r.rows.item(0).key:null;t(o)}),(function(e,t){o(t)}))}))})).catch(o)}));return a(o,t),o},keys:function(e){var t=this,r=new s((function(e,r){t.ready().then((function(){var o=t._dbInfo;o.db.transaction((function(t){w(t,o,"SELECT key FROM "+o.storeName,[],(function(t,r){for(var o=[],i=0;i<r.rows.length;i++)o.push(r.rows.item(i).key);e(o)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,e),r},dropInstance:function(e,t){t=d.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var o,i=this;return a(o=e.name?new s((function(t){var o;o=e.name===r.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:o,storeNames:[e.storeName]}):t(G(o))})).then((function(e){return new s((function(t,r){e.db.transaction((function(o){function i(e){return new s((function(t,r){o.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){r(t)}))}))}for(var n=[],a=0,c=e.storeNames.length;a<c;a++)n.push(i(e.storeNames[a]));s.all(n).then((function(){t()})).catch((function(e){r(e)}))}),(function(e){r(e)}))}))})):s.reject("Invalid arguments"),t),o}};function H(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}var x={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var r in e)t[r]=e[r];return t.keyPrefix=H(e,this._defaultConfig),!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0?(this._dbInfo=t,t.serializer=U,s.resolve()):s.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var r=this,o=r.ready().then((function(){for(var t=r._dbInfo,o=t.keyPrefix,i=o.length,n=localStorage.length,s=1,a=0;a<n;a++){var c=localStorage.key(a);if(0===c.indexOf(o)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(i),s++)))return l}}}));return a(o,t),o},getItem:function(e,t){var r=this;e=l(e);var o=r.ready().then((function(){var t=r._dbInfo,o=localStorage.getItem(t.keyPrefix+e);return o&&(o=t.serializer.deserialize(o)),o}));return a(o,t),o},setItem:function(e,t,r){var o=this;e=l(e);var i=o.ready().then((function(){void 0===t&&(t=null);var r=t;return new s((function(i,n){var s=o._dbInfo;s.serializer.serialize(t,(function(t,o){if(o)n(o);else try{localStorage.setItem(s.keyPrefix+e,t),i(r)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||n(e),n(e)}}))}))}));return a(i,r),i},removeItem:function(e,t){var r=this;e=l(e);var o=r.ready().then((function(){var t=r._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return a(o,t),o},clear:function(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var o=localStorage.key(r);0===o.indexOf(e)&&localStorage.removeItem(o)}}));return a(r,e),r},length:function(e){var t=this.keys().then((function(e){return e.length}));return a(t,e),t},key:function(e,t){var r=this,o=r.ready().then((function(){var t,o=r._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(o.keyPrefix.length)),t}));return a(o,t),o},keys:function(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo,r=localStorage.length,o=[],i=0;i<r;i++){var n=localStorage.key(i);0===n.indexOf(e.keyPrefix)&&o.push(n.substring(e.keyPrefix.length))}return o}));return a(r,e),r},dropInstance:function(e,t){if(t=d.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}var o,i=this;return a(o=e.name?new s((function(t){e.storeName?t(H(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}})):s.reject("Invalid arguments"),t),o}},W=function(e,t){for(var r,o,i=e.length,n=0;n<i;){if((r=e[n])===(o=t)||"number"==typeof r&&"number"==typeof o&&isNaN(r)&&isNaN(o))return!0;n++}return!1},q=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},z={},Y={},V={INDEXEDDB:L,WEBSQL:Z,LOCALSTORAGE:x},j=[V.INDEXEDDB._driver,V.WEBSQL._driver,V.LOCALSTORAGE._driver],F=["dropInstance"],Q=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(F),K={description:"",driver:j.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function X(e,t){e[t]=function(){var r=arguments;return e.ready().then((function(){return e[t].apply(e,r)}))}}function J(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)t.hasOwnProperty(r)&&(q(t[r])?arguments[0][r]=t[r].slice():arguments[0][r]=t[r])}return arguments[0]}var $=new(function(){function e(t){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),V)if(V.hasOwnProperty(r)){var o=V[r],i=o._driver;this[r]=i,z[i]||this.defineDriver(o)}this._defaultConfig=J({},K),this._config=J({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":o(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,r){var o=new s((function(t,r){try{var o=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void r(i);for(var n=Q.concat("_initStorage"),c=0,l=n.length;c<l;c++){var d=n[c];if((!W(F,d)||e[d])&&"function"!=typeof e[d])return void r(i)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),r=s.reject(t);return a(r,arguments[arguments.length-1]),r}},r=0,o=F.length;r<o;r++){var i=F[r];e[i]||(e[i]=t(i))}}();var u=function(r){z[o]&&console.info("Redefining LocalForage driver: "+o),z[o]=e,Y[o]=r,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(u,r):u(!!e._support):u(!0)}catch(e){r(e)}}));return c(o,t,r),o},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,r){var o=z[e]?s.resolve(z[e]):s.reject(new Error("Driver not found."));return c(o,t,r),o},e.prototype.getSerializer=function(e){var t=s.resolve(U);return c(t,e),t},e.prototype.ready=function(e){var t=this,r=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return c(r,e,e),r},e.prototype.setDriver=function(e,t,r){var o=this;q(e)||(e=[e]);var i=this._getSupportedDrivers(e);function n(){o._config.driver=o.driver()}function a(e){return o._extend(e),n(),o._ready=o._initStorage(o._config),o._ready}var l=null!==this._driverSet?this._driverSet.catch((function(){return s.resolve()})):s.resolve();return this._driverSet=l.then((function(){var e=i[0];return o._dbInfo=null,o._ready=null,o.getDriver(e).then((function(e){o._driver=e._driver,n(),o._wrapLibraryMethodsWithReady(),o._initDriver=function(e){return function(){var t=0;return function r(){for(;t<e.length;){var i=e[t];return t++,o._dbInfo=null,o._ready=null,o.getDriver(i).then(a).catch(r)}n();var c=new Error("No available storage method found.");return o._driverSet=s.reject(c),o._driverSet}()}}(i)}))})).catch((function(){n();var e=new Error("No available storage method found.");return o._driverSet=s.reject(e),o._driverSet})),c(this._driverSet,t,r),this._driverSet},e.prototype.supports=function(e){return!!Y[e]},e.prototype._extend=function(e){J(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,o=e.length;r<o;r++){var i=e[r];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=Q.length;e<t;e++)X(this,Q[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=$},{3:3}]},{},[4])(4)}).call(this,r(35))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r}])}},t={},function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,r),n.exports}(9880);var e,t}));