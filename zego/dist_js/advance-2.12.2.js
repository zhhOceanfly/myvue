!function(e,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var t=r();for(var o in t)("object"==typeof exports?exports:e)[o]=t[o]}}("undefined"!=typeof self?self:this,(function(){return function(){"use strict";var e={2367:function(e,r){var t;Object.defineProperty(r,"__esModule",{value:!0}),r.ZEGO_WEBRTC_ACTION=void 0,(t=r.ZEGO_WEBRTC_ACTION||(r.ZEGO_WEBRTC_ACTION={})).SET_VIDEO_CONFIG="zc.svc",t.SET_AUDIO_CONFIG="zc.sac",t.REPLACE_TRACK="zc.rp",t.ENABLE_STREAM="zc.es",t.ENABLE_MIC_ONLY="zc.emo",t.ACTIVATE_SEI_INSERT="zc.asi",t.MUTE_PUBLISH_STREAM_VIDEO="zc.mpsv.0",t.MUTE_PUBLISH_STREAM_AUDIO="zc.mpsa.0",t.MUTE_MIC="zc.mm",t.MUTE_PLAY_STREAM_VIDEO="zc.mpsv.1",t.MUTE_PLAY_STREAM_AUDIO="zc.mpsa.1"},4495:function(e,r,t){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var r,t=1,o=arguments.length;t<o;t++)for(var a in r=arguments[t])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e},o.apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0}),r.AdvancedModule=void 0;var a=t(2367),i=t(5098),n=t(8706),s=function(){function e(e,r,t,o){this.logger=e,this.dataReport=r,this.streamCenter=t,this.stateCenter=o,this.screenShotReady=!1}return e.prototype.setVideoConfig=function(e,r){var t=this;return this.logger.info(a.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" call"),new Promise((function(o,i){var s=t.stateCenter.getReportSeq();return t.dataReport.newReport(s,n.ZegoRTCLogEvent.kZegoSetVideoConfig.event),e instanceof MediaStream?r&&"object"==typeof r&&0!=Object.keys(r).length?r.width&&!t.stateCenter.checkValidNumber(r.width)?(t.logger.error(a.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints width integer number, range[1, 10000]"),t.dataReport.addMsgInfo(s,{error:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,message:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints width integer number, range[1, 10000]"}),t.dataReport.uploadReport(s),void i({errorCode:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):r.height&&!t.stateCenter.checkValidNumber(r.height)?(t.logger.error(a.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints height integer number, range[1, 10000]"),t.dataReport.addMsgInfo(s,{error:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,message:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints height integer number, range[1, 10000]"}),t.dataReport.uploadReport(s),void i({errorCode:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):void t.setPublishStreamConstraints(e,r,(function(e){t.dataReport.uploadReport(s),o(e)})):(t.logger.error(a.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints wrong"),t.dataReport.addMsgInfo(s,n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError),t.dataReport.uploadReport(s),void i({errorCode:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):(t.logger.error(a.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" localStream not found"),t.dataReport.addMsgInfo(s,n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kLocalStreamError),t.dataReport.uploadReport(s),void i({errorCode:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" localStream no found"}))}))},e.prototype.setAudioConfig=function(e,r){var t=this;return this.logger.info(a.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" call"),new Promise((function(o){var i=t.stateCenter.getReportSeq();return t.dataReport.newReport(i,n.ZegoRTCLogEvent.kZegoSetAudioConfig.event),e instanceof MediaStream?!r||"object"!=typeof r||0==Object.keys(r).length||void 0!==r.AEC&&"boolean"!=typeof r.AEC||void 0!==r.AGC&&"boolean"!=typeof r.AGC||void 0!==r.ANS&&"boolean"!=typeof r.ANS?(t.logger.error(a.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" constraints wrong"),t.dataReport.addMsgInfo(i,n.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError),t.dataReport.uploadReport(i),void o({errorCode:n.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.message+" constraints wrong"})):void t.setPublishStreamConstraints(e,r,(function(e){t.dataReport.uploadReport(i),o(e)})):(t.logger.error(a.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" localStream not found"),t.dataReport.addMsgInfo(i,n.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError),t.dataReport.uploadReport(i),void o({errorCode:n.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.message+" localStream no found"}))}))},e.prototype.enableStream=function(e,r){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.ENABLE_STREAM+" call"),"boolean"!=typeof r.video&&"boolean"!=typeof r.audio)return this.logger.error(a.ZEGO_WEBRTC_ACTION.ENABLE_STREAM+" option error"),!1;var t=!0,o=!0;return"boolean"==typeof r.video&&(t=this.enableCamera(e,r.video,r.retain)),"boolean"==typeof r.audio&&(o=this.enableMicrophone(e,r.audio)),t&&o},e.prototype.enableMicrophoneOnly=function(e){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.ENABLE_MIC_ONLY+" call"),"boolean"!=typeof e)return!1;for(var r=0;r<this.streamCenter.previewStreamList.length;r++)if(!this.streamCenter.previewStreamList[r].enableMicrophoneOnly(e,this.streamCenter))return this.logger.error("zsc.emo.0 previewer "+r+" change mic mute state failed"),!1;return this.streamCenter.isMicEnabled=e,!0},e.prototype.replaceTrack=function(e,r){var t=this;return new Promise((function(o){var i=t.stateCenter.getReportSeq();return t.dataReport.newReport(i,n.ZegoRTCLogEvent.kZegoReplaceTrack.event),e instanceof MediaStream?r&&r instanceof MediaStreamTrack?void t._replaceTrack(e,r,(function(e){t.dataReport.uploadReport(i),o(e)})):(t.logger.error(a.ZEGO_WEBRTC_ACTION.REPLACE_TRACK+" mediastream track no found"),t.dataReport.uploadReport(i,void 0,n.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError),void o({errorCode:n.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.message+" mediastream track no found"})):(t.logger.error(a.ZEGO_WEBRTC_ACTION.REPLACE_TRACK+" localStream not found"),t.dataReport.uploadReport(i,void 0,n.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError),void o({errorCode:n.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.message+" localStream no found"}))}))},e.prototype.setPublishStreamConstraints=function(e,r,t){var o=this,a=null;for(var n in this.logger.info("zsc.spsc.0 constraints",JSON.stringify(r)),this.streamCenter.publisherList)this.streamCenter.publisherList[n].localStream==e&&(a=this.streamCenter.publisherList[n]);if(!a)return this.logger.error("zsc.spsc.0 publisher not found"),void(t&&t({errorCode:i.errorCodeList.PUBLISH_NOT_PUBLISH.code,extendedData:i.errorCodeList.PUBLISH_NOT_PUBLISH.message}));this.logger.info("zsc.spsc.0 streamId ",a.streamID);var s=this.streamCenter.checkPreview(e);if(!s)return this.logger.error("zsc.spsc.0 preview no found"),void(t&&t({errorCode:i.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:i.errorCodeList.PUBLISH_NO_PREVIEW.message}));var d=!1,c=!1;(r.width||r.height||r.frameRate)&&(s.mediaStreamConfig.videoQuality=4,d=!0),void 0===r.ANS&&void 0===r.AGC&&void 0===r.AEC||(c=!0);var g=s.localStream,l=g.getVideoTracks()[0],u=g.getAudioTracks()[0];d&&!l?(this.logger.error("zsc.spsc.0 video track not found"),t&&t({errorCode:i.errorCodeList.TRACK_NOT_FOUND.code,extendedData:i.errorCodeList.TRACK_NOT_FOUND.message})):r.video=!0,c&&!u?(this.logger.error("zsc.spsc.0 audio track not found"),t&&t({errorCode:i.errorCodeList.TRACK_NOT_FOUND.code,extendedData:i.errorCodeList.TRACK_NOT_FOUND.message})):r.audio=!0;var p=JSON.parse(JSON.stringify(s.mediaStreamConfig)),v=Object.assign(s.mediaStreamConfig,r),f=s.getMediaStreamConstraints(v,!0);this.logger.info("zsc.spsc.0 applyConstraints ",JSON.stringify(f));var h=[];if(d&&h.push(l.applyConstraints(f.video)),c&&(u.stop(),h.push(navigator.mediaDevices.getUserMedia({video:!1,audio:f.audio}))),r.maxBitrate){var m=a.publisher.peerConnection.getSenders().find((function(e){return e.track&&"video"===e.track.kind})),E=m.getParameters();m?(E.encodings||(E.encodings=[{}]),E.encodings[0].maxBitrate=1e3*r.maxBitrate,h.push(m.setParameters(E))):this.logger.error("zsc.spsc.0 video sender no found")}if(h.length>0)Promise.all(h).then((function(e){if(o.logger.info("zsc.spsc.0 set constraints success",e[1]),c){var i=(d?e[1]:e[0]).getAudioTracks()[0],n=a.publisher.peerConnection.getSenders().find((function(e){return"audio"===e.track.kind}));if(n&&(n.replaceTrack(i),g)){var s=g.getAudioTracks()[0];g.removeTrack(s),g.addTrack(i);var l=o.streamCenter.checkPreview(g);l&&(l.gainNode=null)}}r.maxBitrate&&a.publisher&&(a.publisher.videoInfo.bitRate=r.maxBitrate),t&&t({errorCode:0,extendedData:""})})).catch((function(e){o.logger.error("zsc.spsc.0 fail reason ",e.name,JSON.stringify(e)),t&&t({errorCode:i.errorCodeList.PUBLISHER_CONSTRAINTS_ERROR.code,extendedData:e.name+" "+(e.constraint?"constraint:"+e.constraint:"")})}));else{if(this.logger.warn("zsc.spsc.0 constaints is no changes"),c){var C=s.getMediaStreamConstraints(p);this.logger.info("zsc.spsc.0 oldMediaStreamConstraints ",JSON.stringify(C)),navigator.mediaDevices.getUserMedia({video:!1,audio:C.audio}).then((function(e){e.getTracks().forEach((function(e){var r=g.getTracks().find((function(r){return r.kind===e.kind})),t=a.publisher.peerConnection.getSenders().find((function(r){return null!==r.track&&r.track.kind===e.kind}));t&&(t.replaceTrack(e),r&&g.removeTrack(r),g.addTrack(e))})),o.logger.info("zsc.spsc.0.1 setbackup suc ")})).catch((function(e){o.logger.error("zsc.spsc.0.1 setbackup fail "+e.name)}))}t&&t({errorCode:i.errorCodeList.PUBLISHER_CONSTRAINTS_ERROR.code,extendedData:"constraints is no changes"})}},e.prototype.useVideoDevice=function(e,r){var t=this;return this.logger.info("zc.uvd.0 call"),new Promise((function(o){var a=t.stateCenter.getReportSeq();if(t.dataReport.newReport(a,n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.event),t.dataReport.addMsgInfo(a,{device:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.device(r)}),!(e instanceof MediaStream))return t.logger.error("zc.uvd.0 localStream not found"),t.dataReport.addMsgInfo(a,n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kLocalStreamError),t.dataReport.uploadReport(a),void o({errorCode:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message});if("string"!=typeof r)return t.logger.error("zc.uvd.0 deviceID must be string"),t.dataReport.addMsgInfo(a,{error:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,message:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message+" deviceID must be string"}),t.dataReport.uploadReport(a),void o({errorCode:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message});var i=function(r){var i;t.dataReport.uploadReport(a);var n=t.streamCenter.checkPublish(e);n&&(n.cameraLabel=(null===(i=e.getVideoTracks()[0])||void 0===i?void 0:i.label)||n.cameraLabel),o(r)};t.stateCenter.getDevices((function(a){if(!a.cameras.find((function(e){return e.deviceID==r})))return t.logger.error("zc.uvd.0 device is not found"),void o({errorCode:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kDevicesNoFoundError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kDevicesNoFoundError.message});t.switchDevice("video",e,r,i)}),(function(o){t.logger.warn("zc.uvd.0 getDevices err:",o),t.switchDevice("video",e,r,i)}))}))},e.prototype.useAudioDevice=function(e,r){var t=this;return this.logger.info("zc.uad.1 call"),new Promise((function(o){var a=t.stateCenter.getReportSeq();t.dataReport.newReport(a,n.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.event),t.dataReport.addMsgInfo(a,{device:n.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.device(r)});var i=function(e,r){t.logger.error("zc.uad.1 "+r);var i=e;i.message=i.message+(r?" "+r:""),t.dataReport.addMsgInfo(a,i),t.dataReport.uploadReport(a),o({errorCode:i.code,extendedData:i.message})},s=function(r){var i;t.dataReport.uploadReport(a);var n=t.streamCenter.checkPublish(e);n&&(n.microLabel=(null===(i=e.getAudioTracks()[0])||void 0===i?void 0:i.label)||n.microLabel),o(r)};e instanceof MediaStream?"string"==typeof r?t.stateCenter.getDevices((function(a){if(!a.microphones.find((function(e){return e.deviceID==r})))return t.logger.error("zc.uad.1 device is not found"),void o({errorCode:n.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kDevicesNoFoundError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kDevicesNoFoundError.message});t.switchDevice("audio",e,r,s)}),(function(o){t.logger.warn("zc.uad.1 getDevices err:",o),t.switchDevice("audio",e,r,s)})):i(n.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kParamError,"deviceID must be string"):i(n.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kLocalStreamError,"localStream not found")}))},e.prototype.publishTarget=function(e){var r=this,t=this.stateCenter.getReportSeq();switch(e.type){case"addpush":this.dataReport.newReport(t,n.ZegoRTCLogEvent.kZegoTaskAddPublishCdnUrl.event);break;case"delpush":case"clearpush":this.dataReport.newReport(t,n.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.event)}return this.dataReport.addMsgInfo(t,{stream:n.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.stream(e.streamID),target_url:n.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.target_url(e.pushUrl)}),new Promise((function(o,a){var s=function(e,o){r.logger.error("zb.pt"+(o||e.message)),r.dataReport.addMsgInfo(t,{error:e.code,message:e.message+(o||"")}),r.dataReport.uploadReport(t),a({errorCode:e.code,extendedData:e.message+(o?" "+o:"")})};if(-1==["addpush","delpush","clearpush"].indexOf(e.type))return r.logger.error("zb.sh.pt cdn push type error"),void s(i.errorCodeList.PUBLISHER_CDN_PUSH_ERROR,"type error");if(e.streamID&&"string"==typeof e.streamID)if(e.pushUrl&&"string"==typeof e.pushUrl)if(r.stateCenter.publishStreamList[e.streamID]){var d=r.streamCenter.getRoomByStreamID(e.streamID);d?d.streamHandler._publishTarget(e,(function(e){r.dataReport.uploadReport(t),o(e)}),s):s(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoLoginError)}else s(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kPublishStreamNoFoundError);else s(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"push url error");else s(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"stream id type error")}))},e.prototype.switchDevice=function(e,r,t,a){var n=this,s=this.streamCenter.checkPreview(r);if(!s)return this.logger.error("zsc.sd.0 preview no found"),void(a&&a({errorCode:i.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:i.errorCodeList.PUBLISH_NO_PREVIEW.message}));if("video"===e&&0==s.mediaStreamConfig.video)return this.logger.error("zsc.sd.0 camera can not be changed when video is false"),void(a&&a({errorCode:i.errorCodeList.VIDEO_DEVICE_FALSE.code,extendedData:i.errorCodeList.VIDEO_DEVICE_FALSE.message}));if("audio"===e&&0==s.mediaStreamConfig.audio)return this.logger.error("zsc.sd.0 microphone can not be changed when audio is false"),void(a&&a({errorCode:i.errorCodeList.AUDIO_DEVICE_FALSE.code,extendedData:i.errorCodeList.AUDIO_DEVICE_FALSE.message}));s.mediaStreamConfig.videoInput!==t&&delete s.mediaStreamConfig.facingMode;var d,c={};"video"===e?(c.videoInput=t,d=r.getVideoTracks()[0]):(c.audioInput=t,d=r.getAudioTracks()[0]);var g=this.stateCenter.browser;this.logger.info("zsc.sd.0 browser "+g),"firefox"===g&&d.stop();var l=o(o({},s.mediaStreamConfig),c),u=s.getMediaStreamConstraints(l),p=function(t,o){var a=n.streamCenter.checkPublish(r);o.getTracks().forEach((function(r){var o,i=t.getTracks().find((function(e){return e.kind===r.kind}));if(i&&(i?i.kind===e?(r.enabled=i.enabled,t.removeTrack(i),i.stop(),t.addTrack(r)):r.stop():t.addTrack(r),"audio"===r.kind&&(s.audioTrack=r),a)){var d=null===(o=a.publisher.peerConnection)||void 0===o?void 0:o.getSenders().find((function(e){return null!==e.track&&e.track.kind===r.kind}));i.kind===e&&(d?(d.replaceTrack(r),s.gainNode=null):n.logger.warn("zsc.sd.0 no sender found, only switching device on localMediaElement"));var c=r.enabled?0:20,g=a.publisher,l=g.camera_status,u=g.mic_status;"video"==e&&c!==l&&g.sendStreamStatus(c,u),"audio"==e&&c!==u&&g.sendStreamStatus(l,c)}})),s.restartSoundLevel()};"audio"==e?u.video=!1:u.audio=!1,navigator.mediaDevices.getUserMedia(u).then((function(t){Object.assign(s.mediaStreamConfig,c),p(r,t),n.logger.info("zsc.sd.0 swtich "+e+" device success"),a&&a({errorCode:0,extendedData:""})}),(function(t){var o,d;"video"==e?null===(o=r.getVideoTracks()[0])||void 0===o||o.stop():null===(d=r.getAudioTracks()[0])||void 0===d||d.stop(),n.logger.warn("zsc.sd.0 swtich "+e+" device failed, stop last device and retry. ",t+""),navigator.mediaDevices.getUserMedia(u).then((function(t){Object.assign(s.mediaStreamConfig,c),p(r,t),n.logger.info("zsc.sd.0 swtich "+e+" device success"),a&&a({errorCode:0,extendedData:""})}),(function(t){n.logger.warn("zsc.sd.0 swtich "+e+" device failed and recover last device. ",t+"");var o=s.getMediaStreamConstraints(s.mediaStreamConfig),d=i.errorCodeList.VIDEO_DEVICE_FALSE;"audio"===e&&(d=i.errorCodeList.AUDIO_DEVICE_FALSE),navigator.mediaDevices.getUserMedia(o).then((function(o){p(r,o),n.logger.info("zsc.sd.0 recover last "+e+" device success"),a&&a({errorCode:d.code,extendedData:d.message+" "+JSON.stringify(t)})}),(function(r){n.logger.error("zsc.sd.0 swtich "+e+" device and recover failed, please recreate stream. ",r+""),a&&a({errorCode:d.code,extendedData:d.message+" "+JSON.stringify(r)})}))}))}))},e.prototype._replaceTrack=function(e,r,t){var o=this.streamCenter.checkPreview(e),a=this.streamCenter.checkPublish(e);if(/Safari/.test(navigator.userAgent)&&/Chrome/.test(navigator.userAgent),a){var n=a.publisher.replaceTrack(r);t&&t(n)}else{if(!o)return this.logger.error("zc.rt.0 preview no found"),void(t&&t({errorCode:i.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:i.errorCodeList.PUBLISH_NO_PREVIEW.message}));var s=o.localStream,d=s.getTracks().find((function(e){return e.kind===r.kind}));d?(s.removeTrack(d),s.addTrack(r),t&&t({errorCode:0,extendedData:""})):(this.logger.error("zc.rt.0 track no found"),t&&t({errorCode:i.errorCodeList.TRACK_NOT_FOUND.code,extendedData:i.errorCodeList.TRACK_NOT_FOUND.message}))}},e.prototype.enableMicrophone=function(e,r){var t=this.streamCenter.checkPreview(e);return t?t.enableMicrophone(r,this.streamCenter):(this.logger.error("zsc.em.0 no preview"),!1)},e.prototype.enableCamera=function(e,r,t){var o=this.streamCenter.checkPreview(e);return o?o.enableCamera(r,this.streamCenter,t):(this.logger.error("zsc.ec.0 no preview"),!1)},e}();r.AdvancedModule=s},4378:function(e,r,t){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var r,t=1,o=arguments.length;t<o;t++)for(var a in r=arguments[t])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e},o.apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0}),r.signal=r.publisher=r.publishModule=r.playModule=r.preview=r.streamHandler=r.zegoWebRTC=r.ENUM_PUBLISH_STREAM_STATE=r.ENUM_STREAM_CMD_PRI=r.ENUM_STREAM_SUB_CMD=r.PROTO_VERSION=void 0;var a=t(2367),i=t(5098),n=t(8706),s=t(7248);r.PROTO_VERSION="2.12.2",r.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},r.ENUM_STREAM_CMD_PRI={liveBegin:"zegochat_js.room_stream_create_req",liveEnd:"zegochat_js.room_stream_delete_req",liveUpdate:"zegochat_js.room_stream_update_req"},r.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},r.zegoWebRTC={mutePublishStreamVideo:function(e,r,t){this.logger.info(a.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" call");var o=this.stateCenter.getReportSeq();if(this.dataReport.newReport(o,n.ZegoRTCLogEvent.kZegoTaskMutePublishVideo),"boolean"!=typeof r||void 0!==t&&"boolean"!=typeof t)return this.logger.error(a.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" option error"),!1;var i=this.rtcModules.advancedModule.enableStream(e,{video:!r,retain:t});return this.dataReport.uploadReport(o),this.logger.info(a.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" end"),i},mutePublishStreamAudio:function(e,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" call");var t=this.stateCenter.getReportSeq();if(this.dataReport.newReport(t,n.ZegoRTCLogEvent.kZegoTaskMutePublishAudio),"boolean"!=typeof r)return this.logger.error(a.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" option error"),!1;var o=this.rtcModules.advancedModule.enableStream(e,{audio:!r});return this.dataReport.uploadReport(t),this.logger.info(a.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" end"),o},mutePlayStreamVideo:function(e,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_VIDEO+" call "+e+" "+r);var t=this.stateCenter.getReportSeq();this.dataReport.newReport(t,n.ZegoRTCLogEvent.kZegoTaskMutePlayVideo);var o=this.rtcModules.playModule.mutePlayStream(e,"video",r);return this.dataReport.uploadReport(t),this.logger.info(a.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_VIDEO+" end"),o},mutePlayStreamAudio:function(e,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_AUDIO+" call "+e+" "+r);var t=this.stateCenter.getReportSeq();this.dataReport.newReport(t,n.ZegoRTCLogEvent.kZegoTaskMutePlayAudio);var o=this.rtcModules.playModule.mutePlayStream(e,"audio",r);return this.dataReport.uploadReport(t),this.logger.info(a.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_AUDIO+"end"),o},muteMicrophone:function(e){this.logger.info(a.ZEGO_WEBRTC_ACTION.MUTE_MIC+" call");var r=this.stateCenter.getReportSeq();if(this.dataReport.newReport(r,n.ZegoRTCLogEvent.kZegoTaskMuteMicrophone),"boolean"!=typeof e)return this.logger.error(a.ZEGO_WEBRTC_ACTION.MUTE_MIC+" option error"),!1;var t=this.rtcModules.advancedModule.enableMicrophoneOnly(!e);return this.dataReport.uploadReport(r),this.logger.info(a.ZEGO_WEBRTC_ACTION.MUTE_MIC+" end"),t},activateSEIInsert:function(e){var r=e.stream,t=e.action,o=e.infoType;return this.rtcModules.publishModule.activateSEIInsert(r,t,o)},getAudioInfo:function(e,r,t){if(!e)return this.logger.error("loclStream is empty!"),!1;var a=o({},t);return new s.MediaUtil(this.ac,a).connectToSource(e,(function(e){r(e)}))},takeSnapShot:function(e,r){if(e&&0!==e.videoHeight){var t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;var o=t.getContext("2d");o&&o.drawImage(e,0,0,t.width,t.height),r.src=t.toDataURL("image/jpeg")}else this.logger.error("video can not empty")},saveSnapShot:function(e,r){if(e&&0!==e.videoHeight){var t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;var o=t.getContext("2d");o&&o.drawImage(e,0,0,t.width,t.height),t.toBlob((function(e){var t=window.URL.createObjectURL(e),o=document.createElement("a");o.style.display="none",o.href=t,o.download=r+".jpeg",document.body.appendChild(o),o.click(),setTimeout((function(){document.body.removeChild(o),window.URL.revokeObjectURL(t)}),100)}))}else this.logger.error("video can not empty")},setStreamExtraInfo:function(e,r){var t=this;return new Promise((function(o,a){var i=t.stateCenter.getReportSeq();t.dataReport.newReport(i,n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.event),t.dataReport.addMsgInfo(i,{stream:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream(e),stream_extra_info:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream_extra_info(r)});var s=function(e,r){t.logger.error("zb.ssei "+r),t.dataReport.addMsgInfo(i,{error:e.code,message:e.message+" "+r}),t.dataReport.uploadReport(i),a({errorCode:e.code,extendedData:e.message+" "+r})};if("string"==typeof e&&""!=e)if("string"==typeof r&&""!=r)if(t.RTM.service.isDisConnect())s(n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login");else if(t.stateCenter.publishStreamList[e]){var d=t.streamCenter.getRoomByStreamID(e);d?(t.dataReport.addMsgInfo(i,{room_sid:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.room_sid(d.sessionID)}),d.streamHandler.setStreamExtraInfo(e,r,o,s),t.dataReport.uploadReport(i)):s(n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login")}else s(n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kPublishStreamNoFoundError,"publish stream no found");else s(n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"extraInfo must be string and no empty");else s(n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"streamID must be string and not empty")}))}},r.streamHandler={_publishTarget:function(e,t,o){var a=this;this.logger.info("zb.sh.ptcall");var s=Math.ceil((new Date).getTime()/1e3),d=e.streamID;this.stateCenter.testEnvironment&&(d="zegotest-"+this.stateCenter.appid+"-"+e.streamID);var c={appid:this.stateCenter.appid,biz_type:0,timestamp:s,seq:this.stateCenter.cdnSeq++,version:1*r.PROTO_VERSION,stream_id:d,pushurl:e.pushUrl},g={channel:"media",cmd:e.type,req_body:JSON.stringify(c)};this.logger.debug("zb.sh.pt send command"),this.sendBizChannelRequest(g,(function(r,s,d){if(a.logger.info("zb.sh.pt receive message"),0!=d.length){var c=JSON.parse(d),g=c.code,l=c.message;g&&0!=g?(a.logger.error("zb.sh.pt "+e.type+" error code: "+g+" "+l),o(i.errorCodeList.UNKNOWN_SERVER_ERROR," cmd: "+e.type+" "+g+" "+l)):(a.logger.info("zb.sh.pt "+e.type+" success"),t&&t({errorCode:0,extendedData:""}))}else o(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoResponseError)}),(function(r,t,i){a.logger.info("zb.sh.pt error: "+r);var s=n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError;2001==r?n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kInvalidChannelError:2002==r&&(s=n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kBizChannelError),a.logger.error("zb.sh.pt "),o(s," cmd: "+e.type+" "+r+"   ")}))},updateStreamExtraInfo:function(e,t,o,a){var i;this.logger.info("zb.sh.usei call"),i="PUBLIC"===this.stateCenter.type?r.ENUM_STREAM_SUB_CMD.liveUpdate:r.ENUM_STREAM_CMD_PRI.liveUpdate,this.stateCenter.publishStreamList[e]&&this.stateCenter.publishStreamList[e].state>=r.ENUM_PUBLISH_STREAM_STATE.update_info?(this.stateCenter.publishStreamList[e].extra_info=t,this.updateStreamInfo(e,i,t),o({errorCode:0})):a(n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kUpdateStreamInfoFailError)},setStreamExtraInfo:function(e,r,t,o){this.updateStreamExtraInfo(e,r,t,o)}},r.preview={enableCamera:function(e,r,t){var o,a,i=this;if(!this.localStream)return this.logger.error("zp.ec.2 no localStream"),!1;(!t||e)&&this.localStream.getVideoTracks().forEach((function(r){if(r.enabled=e,e&&void 0!==typeof r.getSettings().width&&r.getSettings().width>0){var t=r.getSettings().width-1,o=r.getSettings().height-1;r.applyConstraints({width:t,height:o}),setTimeout((function(){r.applyConstraints({width:i.videoInfo.width,height:i.videoInfo.height})}),200)}}));var n=function(i){var n=r.publisherList[i].publisher;if(n.localStream==s.localStream){if(t&&!e){var d=s.localStream.clone(),c=d.getVideoTracks()[0];null==(g=null===(o=n.peerConnection)||void 0===o?void 0:o.getSenders().find((function(e){var r;return(null===(r=e.track)||void 0===r?void 0:r.kind)===c.kind})))||g.replaceTrack(c),d.getTracks().forEach((function(e){return e.stop()}))}else if(e){var g=null===(a=n.peerConnection)||void 0===a?void 0:a.getSenders().find((function(e){var r;return"video"===(null===(r=e.track)||void 0===r?void 0:r.kind)}));null==g||g.replaceTrack(s.localStream.getVideoTracks()[0])}var l=e?0:20,u=s.isAudioEnabled&&r.isMicEnabled?0:20;n.camera_status===l&&n.mic_status===u||n.sendStreamStatus(l,u)}},s=this;for(var d in r.publisherList)n(d);return this.logger.info("zp.ec.2 call success"),!0},enableMicrophone:function(e,r){var t;if(!this.localStream)return this.logger.error("zp.em.2 no localStream"),!1;this.localStream.getAudioTracks().forEach((function(r){r.enabled=e})),this.audioTrack&&(this.audioTrack.enabled=e&&r.isMicEnabled);var o=null===(t=r.checkPublish(this.localStream))||void 0===t?void 0:t.publisher;if(o){var a=o.camera_status,i=e&&r.isMicEnabled?0:20;o.camera_status===a&&o.mic_status===i||o.sendStreamStatus(a,i)}return this.isAudioEnabled=e,this.logger.debug("zp.em.2 call success"),!0}},r.playModule={mutePlayStream:function(e,r,t){var o=this;return this.logger.info("zsc.mps.0 call "+r+" "+t),new Promise((function(a,i){if("string"!=typeof e||""==e)return o.logger.error("zsc.mps.0 streamID must be string and not empty"),void i(!1);if("boolean"!=typeof t)return o.logger.error("zsc.mps.0 mute must be boolean"),void i(!1);var s=o.streamCenter.playerList[e];if(!s)return o.logger.error("zsc.mps.0 player not found"),void i(!1);if("video"===r){if(s.playOption&&!1===s.playOption.video||s.player&&0!==s.player.cameraStatus)return o.logger.error("zsc.mps.0 stream no contain video"),void i(!1);s.player.signal.ActivatePlayVideoStream(o.stateCenter.getSeq(),s.player.sessionId,t,(function(){o.logger.info("zsc.mps.0 suc");var e=o.stateCenter.getReportSeq();o.dataReport.newReport(e,n.ZegoRTCLogEvent.kZegoPlayContentChanged.event),o.dataReport.addMsgInfo(e,{session_id:n.ZegoRTCLogEvent.kZegoPlayContentChanged.session_id(s.player.sessionId),video_activate:n.ZegoRTCLogEvent.kZegoPlayContentChanged.video_activate(t?0:1),audio_activate:n.ZegoRTCLogEvent.kZegoPlayContentChanged.audio_activate(1==s.player.playOption.audio?1:0==s.player.playOption.audio?0:1)}),o.dataReport.uploadReport(e),a(!0)}),(function(){o.logger.error("zsc.mps.0 fail"),i(!1)}))}else{if(s.playOption&&!1===s.playOption.audio||s.player&&0!==s.player.micStatus)return o.logger.error("zsc.mps.0 stream no contain audio"),void i(!1);s.player.signal.ActivatePlayAudioStream(o.stateCenter.getSeq(),s.player.sessionId,t,(function(){o.logger.info("zsc.mps.0 suc");var e=o.stateCenter.getReportSeq();o.dataReport.newReport(e,n.ZegoRTCLogEvent.kZegoPlayContentChanged.event),o.dataReport.addMsgInfo(e,{session_id:n.ZegoRTCLogEvent.kZegoPlayContentChanged.session_id(s.player.sessionId),video_activate:n.ZegoRTCLogEvent.kZegoPlayContentChanged.video_activate(1==s.player.playOption.video?1:0==s.player.playOption.video?0:1),audio_activate:n.ZegoRTCLogEvent.kZegoPlayContentChanged.audio_activate(t?0:1)}),o.dataReport.uploadReport(e),a(!0)}),(function(){o.logger.error("zsc.mps.0 fail"),i(!1)}))}}))},setStreamAudioOutput:function(e,r){var t=this;return!(null==r||0==r.length||!e||(this.logger.debug("zsc.ssao.0 device "+r),e?"undefined"!==e.sinkId?(e.setSinkId(r).then((function(){t.logger.info("zsc.ssao.0 success device: "+r)})).catch((function(e){t.logger.info("zsc.ssao.0 "+e.name)})),0):(this.logger.error("zsc.ssao.0 browser does not suppport"),1):(this.logger.error("zsc.ssao.0 no localVideo"),1)))}},r.publishModule={activateSEIInsert:function(e,r,t){void 0===t&&(t=0);var o=this.streamCenter.checkPreview(e);if(!o)return this.logger.error(a.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" stream is not created"),!1;if(0!==r&&1!==r)return this.logger.error(a.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" value of “action” should be 0 or 1"),!1;o.activatesSEIConfig={action:r,infoType:t};var i=this.streamCenter.checkPublish(e);return i&&(null==i||i.publisher.activateSEIInsert(r,t)),!0}},r.publisher={activateSEIInsert:function(e,r){var t=this;return new Promise((function(o,i){return t.signal?(t.signal&&t.signal.activateSEIInsert(t.stateCenter.getSeq(),t.sessionId,t.peerID,e,r,(function(e,r,i){var n=!1;0===i.result?(t.logger.info(a.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" called success"),n=!0):1===i.result?(t.logger.error(a.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" "+i.peer_id+" invalid param."),n=!1):2===i.result&&(t.logger.error(a.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" peer not exist"),n=!1),o(n)}),(function(e){1===e&&t.logger.error(a.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" request timeout")})),!1):o(!1)}))},replaceTrack:function(e){var r,t=this.localStream;if(!(null===(r=this.peerConnection)||void 0===r?void 0:r.getSenders)||!this.peerConnection.getSenders()[0].replaceTrack){var o=e.kind;return this.toBeReplacedTracks["video"===o?"video":"audio"]=e,this.logger.info("zc.rt.1 replace track will work after stream published"),{errorCode:0,extendedData:""}}var a=t.getTracks().find((function(r){return r.kind===e.kind})),n=this.peerConnection.getSenders().find((function(r){return r.track.kind===e.kind}));if(a&&n){var s=0,d=0;return e.enabled,a.enabled,"video"===e.kind?(s=!0===e.enabled?0:20,d=t.getAudioTracks()[0]&&1==t.getAudioTracks()[0].enabled?0:20):"audio"===e.kind&&(d=!0===e.enabled?0:20,s=t.getVideoTracks()[0]&&1==t.getVideoTracks()[0].enabled?0:20),n.replaceTrack(e),t.removeTrack(a),t.addTrack(e),this.sendStreamStatus(s,d),this.logger.info("zc.rt.1 replace remote track success"),{errorCode:0,extendedData:""}}return this.logger.error("zc.rt.1 publisher track no found"),{errorCode:i.errorCodeList.TRACK_NOT_FOUND.code,extendedData:i.errorCodeList.TRACK_NOT_FOUND.message}}},r.signal={activateSEIInsert:function(e,r,t,o,i,n,s){this.logger.info(a.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" call "+r);var d={peer_id:t,action:o,info_type:i};this.sendMessageWithCallback("ActivateSEIInsertReq",e,r,d,n,s)}}},5098:function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.errorCodeList=void 0,r.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},INPUT_PARAM:{code:1100001,message:"input param error."},PUBLISH_NOT_PUBLISH:{code:1103040,message:"publisher not found"},PUBLISH_NO_PREVIEW:{code:1103044,message:"stream is not from zego"},TRACK_NOT_FOUND:{code:1103047,message:"track is not found"},PUBLISHER_CONSTRAINTS_ERROR:{code:1103029,message:"constraint error"},PUBLISHER_CDN_PUSH_ERROR:{code:1103052,message:"publisher cdn push error"},VIDEO_DEVICE_FALSE:{code:1103045,message:"video is false"},AUDIO_DEVICE_FALSE:{code:1103046,message:"audio is false"},UNKNOWN_SERVER_ERROR:{code:1100999,message:"unknown server error"},DEVICE_NOT_FOUND:{code:1103048,message:"device is not found"},LOCALSTREAM_WRONG:{code:1000018,message:"local stream wrong"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:"publish stream no found"},PUBLISH_TARGET_NO_RESPONSE:{code:1103063,message:"publish target no response"},BIZ_CHANNEL_ERROR:{code:1102021,message:"biz channel error."},INVALID_CHANNEL:{code:1102024,message:"invalid channel"},PUBLISHER_EXTRA_INFO_NULL:{code:1003050,message:"extra info of publishing stream is null"},PUBLISHER_UPDATE_STREAM_INFO_FAIL:{code:1103062,message:"update stream info fail"}}},8706:function(e,r,t){Object.defineProperty(r,"__esModule",{value:!0}),r.ZegoRTCLogEvent=void 0;var o=t(5098),a=function(e){return e};r.ZegoRTCLogEvent={kZegoSetVideoConfig:{event:"/sdk/set_video_config",error:{kParamError:o.errorCodeList.INPUT_PARAM,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG}},kZegoSetAudioConfig:{event:"/sdk/set_audio_config",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoReplaceTrack:{event:"/sdk/replace_track",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskUseVideoDevice:{event:"/device/api/video_c",error:{kParamError:o.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:o.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG},device:a},kZegoTaskUseAudioDevice:{event:"/device/api/audio_c",error:{kParamError:o.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:o.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG},device:a},kZegoTaskPublishTarget:{event:"/sdk/publish_target",error:{kParamError:o.errorCodeList.INPUT_PARAM,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kNoLoginError:o.errorCodeList.NOT_LOGIN,kNoResponseError:o.errorCodeList.PUBLISH_TARGET_NO_RESPONSE,kBizChannelError:o.errorCodeList.BIZ_CHANNEL_ERROR,kInvalidChannelError:o.errorCodeList.INVALID_CHANNEL,kUnknownServerError:o.errorCodeList.UNKNOWN_SERVER_ERROR}},kZegoTaskAddPublishCdnUrl:{event:"/sdk/add_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskRemovePublishCdnUrl:{event:"/sdk/remove_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM},stream:a,target_url:a},kZegoTaskClearPublishCdnUrl:{event:"/sdk/clear_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoPlayContentChanged:{event:"/sdk/play_content_changed",session_id:a,video_activate:a,audio_activate:a},kZegoTaskMutePublishVideo:"/sdk/mute_publish_video",kZegoTaskMutePublishAudio:"/sdk/mute_publish_audio",kZegoTaskMuteMicrophone:"/sdk/mute_microphone",kZegoTaskMutePlayVideo:"/sdk/mute_play_video",kZegoTaskMutePlayAudio:"/sdk/mute_play_audio",kZegoTaskLiveRoomSendStreamExtraInfo:{event:"/liveroom/send_stream_extra_info",error:{kParamError:o.errorCodeList.INPUT_PARAM,kExtraInfoNullError:o.errorCodeList.PUBLISHER_EXTRA_INFO_NULL,kNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kUpdateStreamInfoFailError:o.errorCodeList.PUBLISHER_UPDATE_STREAM_INFO_FAIL},stream:a,stream_extra_info:a,room_sid:a}}},7248:function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.MediaUtil=void 0;var t=function(){function e(e,r){var t=this,o=r.type,a=r.channels,i=void 0===a?1:a,n=r.bufferSize,s=void 0===n?0:n,d=r.sampleBit,c=void 0===d?16:d,g=r.sampleRate,l=void 0===g?44100:g;this.instant=0,this.slow=0,this.clip=0,this.context=e,this.type=o,this.channels=i,this.bufferSize=s,this.sampleBit=c,this.sampleRate=l,this.script=e.createScriptProcessor(s,i,i),(new Date).getTime(),this.script.addEventListener("audioprocess",(function(e){var r,a=e.inputBuffer.getChannelData(0),i=0,n=0;for(r=0;r<a.length;++r)i+=a[r]*a[r],Math.abs(a[r])>.99&&(n+=1);if(t.instant=Math.sqrt(i/a.length),t.slow=.95*t.slow+.05*t.instant,t.clip=n/a.length,"pcm"===o||"wav"===o){for(var s=[],d=0;d<t.channels;d++)s.push(e.inputBuffer.getChannelData(d));t.recorderBuffer(s)}})),"pcm"!==o&&"wav"!==o||this.initRecorderBuffer(o)}return e.prototype.connectToSource=function(e,r){try{this.mic=this.context.createMediaStreamSource(e),this.mic.connect(this.script),this.script.connect(this.context.destination),void 0!==r&&r(null)}catch(e){console.error(e),void 0!==r&&r(e)}return this},e.prototype.recorderBuffer=function(e){this.worker.postMessage({command:"record",val:e})},e.prototype.initRecorderBuffer=function(e){var r=this;this.worker=this.inlineWorker((function(){var e,r,t,o,a,i,n=[];function s(e,r,t){for(var o=0;o<t.length;o++,r+=2){var a=Math.max(-1,Math.min(1,t[o]));e.setInt16(r,a<0?32768*a:32767*a,!0)}}function d(e,r,t){for(var o=0;o<t.length;o++,r++){var a=Math.max(-1,Math.min(1,t[o])),i=a<0?128*a:127*a;i+=128,e.setInt8(r,i)}}function c(e,r,t){for(var o=0;o<t.length;o++)e.setUint8(r+o,t.charCodeAt(o))}function g(e,r){for(var t=new Float32Array(r.length/e),o=0,a=0;o<t.length;)t[o]=r[a],a+=e,o++;return t}function l(e,r,t){for(var o=new Float32Array(r*e.length),a=0,i=0;i<t[0].length;i++)o.set(t[0][i],a),a+=t[0][i].length;return o}function u(e,r){for(var t=new Float32Array(e.length+r.length),o=0;o<e.length+r.length;o+=2)t[o]=e[o/2>>0],t[o+1]=r[o/2>>0];return t}function p(r){var t,o;if(1==e)t=l(n[0],a,n),1!=r&&(o=g(r,t));else if(2==e){var i=l(n[0],a,n),s=l(n[1],a,n);1!=r?o=u(g(r,i),g(r,s)):t=u(i,s)}return 1!=r?o:t}this.onmessage=function(g){switch(g.data.command){case"init":l=g.data.val,e=l.sampleChannel,r=l.sampleBit,t=l.sampleRate,o=l.oldSampleRate,a=l.bufferSize,i=l.type;break;case"record":!function(a){for(var g=0;g<e;g++)n[g]||(n[g]=[]),n[g].push(a[g]);var l=Math.round(o/t);"pcm"===i?function(e){var t=function(e,t){var o;8==t?o=e.length:16==t&&(o=e.length,o*=2);var a=new ArrayBuffer(o),i=new DataView(a);return 8==t?d(i,0,e):16==r&&s(i,0,e),i}(p(e),r);self.postMessage({command:"exportPcmLive",val:t})}(l):"wav"===i&&function(o){var a=function(o,a){var i;8==a?i=o.length:16==r&&(i=o.length,i*=2);var n=new ArrayBuffer(i+44),g=new DataView(n),l=t,u=r,p=e;return c(g,0,"RIFF"),g.setUint32(4,36+i,!0),c(g,8,"WAVE"),c(g,12,"fmt "),g.setUint32(16,16,!0),g.setUint16(20,1,!0),g.setUint16(22,p,!0),g.setUint32(24,l,!0),g.setUint32(28,l*p*(u/8),!0),g.setUint16(32,p*(u/8),!0),g.setUint16(34,u,!0),c(g,36,"data"),g.setUint32(40,i,!0),8==r?d(g,44,o):16==r&&s(g,44,o),g}(p(o),r);self.postMessage({command:"exportWav",val:a})}(l),n=[]}(g.data.val)}var l}})),this.worker.postMessage({command:"init",val:{sampleChannel:this.channels,sampleBit:this.sampleBit,sampleRate:this.sampleRate,oldSampleRate:this.context.sampleRate,bufferSize:this.bufferSize,type:e}}),this.worker.onmessage=function(e){switch(e.data.command){case"exportPcmLive":r.onReceiveBuffer(e.data.val);break;case"exportWav":r.onReceiveWav(e.data.val)}}},e.prototype.onReceiveBuffer=function(e){},e.prototype.onReceiveWav=function(e){},e.prototype.writeString=function(e,r,t){for(var o=0;o<t.length;o++)e.setUint8(r+o,t.charCodeAt(o))},e.prototype.writeBuffer=function(e,r,t){for(var o=0;o<t.byteLength;o++)e.setUint8(r+o,t[o])},e.prototype.concatenation=function(e){for(var r=0,t=0;t<e.length;++t)r+=e[t].buffer.byteLength;var o=new Uint8Array(r),a=0;for(t=0;t<e.length;++t)o.set(new Uint8Array(e[t].buffer),a),a+=e[t].buffer.byteLength;return o},e.prototype.encodeWave=function(e){var r=this.concatenation(e),t=r.byteLength,o=new ArrayBuffer(t+44),a=new DataView(o),i=this.sampleRate,n=this.sampleBit,s=this.channels;return this.writeString(a,0,"RIFF"),a.setUint32(4,36+t,!0),this.writeString(a,8,"WAVE"),this.writeString(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,s,!0),a.setUint32(24,i,!0),a.setUint32(28,i*s*(n/8),!0),a.setUint16(32,s*(n/8),!0),a.setUint16(34,n,!0),this.writeString(a,36,"data"),a.setUint32(40,t,!0),this.writeBuffer(a,44,r),a},e.prototype.stop=function(){this.mic.disconnect(),this.script.disconnect()},e.prototype.inlineWorker=function(e){if(Worker&&e){var r=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],t=URL.createObjectURL(new window.Blob([r],{type:"text/javascript"}));return new Worker(t)}return null},e}();r.MediaUtil=t}},r={};function t(o){var a=r[o];if(void 0!==a)return a.exports;var i=r[o]={exports:{}};return e[o].call(i.exports,i,i.exports,t),i.exports}var o={};return function(){var e=o;Object.defineProperty(e,"__esModule",{value:!0});var r=t(4495),a=t(4378);e.default={type:"Advance",install:function(e,t,o,i,n,s,d,c){for(var g in Object.defineProperty(t.prototype,"initAdvance",{value:function(){this.advancedModule=new r.AdvancedModule(this.logger,this.dataReport,this.streamCenter,this.stateCenter)},writable:!1}),a.zegoWebRTC)Object.defineProperty(e.prototype,g,{value:a.zegoWebRTC[g],writable:!1});for(var g in a.streamHandler)Object.defineProperty(o.prototype,g,{value:a.streamHandler[g],writable:!1});for(var g in a.preview)Object.defineProperty(i.prototype,g,{value:a.preview[g],writable:!1});for(var g in a.playModule)Object.defineProperty(n.prototype,g,{value:a.playModule[g],writable:!1});for(var g in a.publishModule)Object.defineProperty(s.prototype,g,{value:a.publishModule[g],writable:!1});for(var g in a.publisher)Object.defineProperty(d.prototype,g,{value:a.publisher[g],writable:!1});for(var g in a.signal)Object.defineProperty(c.prototype,g,{value:a.signal[g],writable:!1})}}}(),o}()}));