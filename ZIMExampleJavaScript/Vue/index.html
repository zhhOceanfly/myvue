<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="renderer" content="webkit" />
    <title>ZIM</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css" />
    <link rel="stylesheet" href="assets/css/index.css" />
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  </head>
  <body>
    <div id="app">
      <div class="content" v-loading="loading">
        <!-- login form  -->
        <template v-if="router == 0">
          <div class="toolbar">
            <span class="title"> ZIM Example </span>
          </div>
          <div class="vcenter">
            <el-form :model="loginForm" label-position="right" label-width="80px">
              <el-form-item label="userID">
                <el-input v-model="loginForm.userID"></el-input>
              </el-form-item>
              <el-form-item label="userName">
                <el-input v-model="loginForm.userName"></el-input>
              </el-form-item>
              <el-form-item>
                <el-button type="primary" @click="login">login</el-button>
              </el-form-item>
            </el-form>
          </div>
        </template>
        <!-- chat pick form  -->
        <template v-if="router == 1">
          <div class="toolbar">
            <i class="el-icon-back" @click="goback"></i>
            <span class="title"> {{title}} </span>
            <i class="el-icon-back" style="visibility: hidden"></i>
          </div>
          <div class="vcenter">
            <el-form :model="chatPickForm" label-position="right" label-width="80px">
              <el-form-item>
                <el-radio-group v-model="isRoomChat">
                  <el-radio-button :label="false">1v1单聊</el-radio-button>
                  <el-radio-button :label="true">房间Room</el-radio-button>
                </el-radio-group>
              </el-form-item>
              <el-form-item label="toUserID" v-show="!isRoomChat">
                <el-input v-model="chatPickForm.toUserID" placeholder="请输入单聊目标 userID"></el-input>
              </el-form-item>
              <el-form-item label="roomID" v-show="isRoomChat">
                <el-input v-model="chatPickForm.roomID"></el-input>
              </el-form-item>
              <el-form-item label="roomName" v-show="isRoomChat">
                <el-input v-model="chatPickForm.roomName" placeholder="加入房间不需要输入 roomName"></el-input>
              </el-form-item>
              <el-form-item>
                <el-button type="primary" @click="createRoom" v-show="isRoomChat">创建房间</el-button>
                <el-button type="primary" @click="joinChat">{{ isRoomChat ? '加入房间' : '开始聊天' }}</el-button>
              </el-form-item>
            </el-form>
          </div>
        </template>
        <!-- chat window  -->
        <template v-if="router == 2">
          <div :class="isRoomChat ? 'toolbar roomchat_mobile' : 'toolbar'">
            <i class="el-icon-back" @click="goback"></i>
            <span class="title"> {{title}} </span>
            <i :class="isRoomChat ? 'el-icon-user roomchaticon_mobile' : 'el-icon-user'" @click="toggleUserList"></i>
          </div>
          <div :class="isRoomChat ? 'chat_window_wrap roomchat_mobile' : 'chat_window_wrap'">
            <div class="chat_window">
              <ul class="chat_msgs" ref="msgs">
                <li v-for="(item) in msgs" :key="item.messageID" :class="loginForm.userID === item.userID ? 'r' : 'l'">
                  <img
                    :src="loginForm.userID === item.userID ? 'assets/image/chat_2.svg' : 'assets/image/chat_1.svg'"
                  />
                  <div class="msg_wrap">
                    <span class="name">{{item.userID}}</span>
                    <span class="msg">{{item.message}}</span>
                  </div>
                </li>
              </ul>
              <div class="chat_bottom">
                <div style="display: flex">
                  <el-input v-model="textMsg" style="flex: 1"></el-input>
                  <el-button type="primary" @click="sendMsg">send</el-button>
                </div>
                <el-checkbox v-model="byteMsg">byte</el-checkbox>
              </div>
            </div>
            <template v-if="isRoomChat">
              <div class="chat_mask" ref="domMask" @click="toggleUserList"></div>
              <div class="chat_users" ref="domUsers">
                <div class="chat_title">
                  <span class="title"> user list </span>
                  <i class="el-icon-refresh-right" @click="refreshUserList('')"></i>
                </div>
                <ul class="scroll">
                  <li
                    :class="loginForm.userID === item.userID ? 'item self' : 'item'"
                    v-for="item in users"
                    :key="item.userID"
                  >
                    {{`${item.userName || item.userID}`}}
                  </li>
                </ul>
              </div>
            </template>
          </div>
        </template>
      </div>
    </div>
  </body>
  <script src="./assets/js/crypto-js.min.js"></script>
  <script src="./assets/js/zim.js"></script>
  <script src="./assets/js/config.js"></script>
  <script src="./assets/js/biz.js"></script>
</html>
